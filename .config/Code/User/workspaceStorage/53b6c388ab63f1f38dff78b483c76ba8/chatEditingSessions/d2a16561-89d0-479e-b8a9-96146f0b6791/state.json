{"version":2,"sessionId":"d2a16561-89d0-479e-b8a9-96146f0b6791","initialFileContents":[["file:///home/trang/localnsv/mAIware/scanner-worker.js","11c2b0f"],["file:///home/trang/localnsv/mAIware/jsonsamples.js","332a83a"],["file:///home/trang/localnsv/mAIware-server/server.js","5f12f29"],["file:///home/trang/localnsv/mAIware-server/public/dashboard.html","cdc01d5"],["file:///home/trang/localnsv/mAIware-server/public/styles.css","cb12650"],["file:///home/trang/localnsv/mAIware/script.js","101d21e"],["file:///home/trang/localnsv/mAIware/index.html","ae7f0e3"],["file:///home/trang/localnsv/mAIware/style.css","2bf614f"]],"timeline":{"checkpoints":[{"checkpointId":"0bfc338e-df42-48c6-bc55-62a6998a5557","epoch":0,"label":"Initial State","description":"Starting point before any edits"},{"checkpointId":"276b7e40-71f1-4529-bcb7-ef84963904af","requestId":"request_00215662-f551-41ad-901a-4eb745ef44c4","epoch":1,"label":"Request request_00215662-f551-41ad-901a-4eb745ef44c4"},{"checkpointId":"e7d99919-8f82-40de-8ee9-597673e3e92d","requestId":"request_00215662-f551-41ad-901a-4eb745ef44c4","undoStopId":"95d0cf09-a644-445e-8ea0-20ed9b27fe0d","epoch":2,"label":"Request request_00215662-f551-41ad-901a-4eb745ef44c4 - Stop 95d0cf09-a644-445e-8ea0-20ed9b27fe0d"},{"checkpointId":"eabedac4-e89c-43b5-9310-9bf0ad5d2aca","requestId":"request_00215662-f551-41ad-901a-4eb745ef44c4","undoStopId":"b886a13a-5471-4bd1-b5f6-8bb7e585038b","epoch":5,"label":"Request request_00215662-f551-41ad-901a-4eb745ef44c4 - Stop b886a13a-5471-4bd1-b5f6-8bb7e585038b"},{"checkpointId":"286da8a5-b1da-476b-9707-87615274a7ea","requestId":"request_00215662-f551-41ad-901a-4eb745ef44c4","undoStopId":"7b70e93a-51a5-4e46-97b4-b7810bd782bb","epoch":7,"label":"Request request_00215662-f551-41ad-901a-4eb745ef44c4 - Stop 7b70e93a-51a5-4e46-97b4-b7810bd782bb"},{"checkpointId":"0f883408-ec0e-484d-8612-5c7632e56193","requestId":"request_437e96e4-e1db-4dd0-b1ca-407e036609b7","epoch":10,"label":"Request request_437e96e4-e1db-4dd0-b1ca-407e036609b7"},{"checkpointId":"33aca102-bedc-4bba-bb24-e8dce9f935d9","requestId":"request_437e96e4-e1db-4dd0-b1ca-407e036609b7","undoStopId":"3f7c837d-1d3b-46b5-99f9-d001ef67dbaf","epoch":11,"label":"Request request_437e96e4-e1db-4dd0-b1ca-407e036609b7 - Stop 3f7c837d-1d3b-46b5-99f9-d001ef67dbaf"},{"checkpointId":"8d962a53-1468-4187-bf48-2f8c5c5d0f01","requestId":"request_437e96e4-e1db-4dd0-b1ca-407e036609b7","undoStopId":"c28937bb-4ea9-460c-9592-ff6dc41b1f52","epoch":12,"label":"Request request_437e96e4-e1db-4dd0-b1ca-407e036609b7 - Stop c28937bb-4ea9-460c-9592-ff6dc41b1f52"},{"checkpointId":"d1ba79a6-a6e0-4ab3-929c-dba103fb49dd","requestId":"request_8448b3ea-1f65-4ae9-aa3e-1e2b2a47d805","epoch":18,"label":"Request request_8448b3ea-1f65-4ae9-aa3e-1e2b2a47d805"},{"checkpointId":"eeeb8ab3-364f-42d8-9dfa-bfa552374151","requestId":"request_496bf68f-603a-4217-8f85-388427b438ef","epoch":20,"label":"Request request_496bf68f-603a-4217-8f85-388427b438ef"},{"checkpointId":"799322cd-0aba-46dc-9d84-de9d4bbefec8","requestId":"request_496bf68f-603a-4217-8f85-388427b438ef","undoStopId":"b5c0d936-bb4e-4db1-9952-983f33f8a956","epoch":21,"label":"Request request_496bf68f-603a-4217-8f85-388427b438ef - Stop b5c0d936-bb4e-4db1-9952-983f33f8a956"},{"checkpointId":"94a2428f-f946-438b-91aa-a3d953fe609d","requestId":"request_c4b64de9-7660-4b42-afcf-12b654c111ef","epoch":24,"label":"Request request_c4b64de9-7660-4b42-afcf-12b654c111ef"},{"checkpointId":"a357b99b-ff78-49d1-baed-c9317feeb9b6","requestId":"request_c4b64de9-7660-4b42-afcf-12b654c111ef","undoStopId":"5f1f48b2-ed84-4669-8bf4-2adce3bf1264","epoch":25,"label":"Request request_c4b64de9-7660-4b42-afcf-12b654c111ef - Stop 5f1f48b2-ed84-4669-8bf4-2adce3bf1264"},{"checkpointId":"94f0d093-14ae-4cfd-944f-37c30e48eb00","requestId":"request_c4b64de9-7660-4b42-afcf-12b654c111ef","undoStopId":"9e20af0e-e0d3-42a6-a9a4-cb7709ba3d3b","epoch":28,"label":"Request request_c4b64de9-7660-4b42-afcf-12b654c111ef - Stop 9e20af0e-e0d3-42a6-a9a4-cb7709ba3d3b"},{"checkpointId":"69dc8535-0294-46b4-a133-7be967736ec6","requestId":"request_a81df6a6-91d1-44bf-86f6-897ed9dbad49","epoch":31,"label":"Request request_a81df6a6-91d1-44bf-86f6-897ed9dbad49"},{"checkpointId":"a5112fe8-4b01-4883-a7da-1d6fa32a7e04","requestId":"request_a81df6a6-91d1-44bf-86f6-897ed9dbad49","undoStopId":"f0fb104e-ec2b-45a5-a16b-8f2a424bd1e2","epoch":32,"label":"Request request_a81df6a6-91d1-44bf-86f6-897ed9dbad49 - Stop f0fb104e-ec2b-45a5-a16b-8f2a424bd1e2"},{"checkpointId":"262e71ab-9ffd-4820-a0f4-5eff710c5be0","requestId":"request_f84e9d07-b060-4595-acd7-32ca34f0d58e","epoch":35,"label":"Request request_f84e9d07-b060-4595-acd7-32ca34f0d58e"},{"checkpointId":"6e1473ea-b646-425e-8a46-15245ef620f6","requestId":"request_f84e9d07-b060-4595-acd7-32ca34f0d58e","undoStopId":"e89f52b5-ed70-4054-8328-07eebfa9be78","epoch":36,"label":"Request request_f84e9d07-b060-4595-acd7-32ca34f0d58e - Stop e89f52b5-ed70-4054-8328-07eebfa9be78"},{"checkpointId":"5e008cf7-3a77-422f-abce-79fa2b01482a","requestId":"request_f84e9d07-b060-4595-acd7-32ca34f0d58e","undoStopId":"d6f378ca-f57f-4004-9bf4-da8cb00d90db","epoch":39,"label":"Request request_f84e9d07-b060-4595-acd7-32ca34f0d58e - Stop d6f378ca-f57f-4004-9bf4-da8cb00d90db"},{"checkpointId":"10620e30-a564-4b4b-aeef-eae489ec01bb","requestId":"request_f84e9d07-b060-4595-acd7-32ca34f0d58e","undoStopId":"b50b984d-fa50-489e-a508-6e6f03c13d0e","epoch":42,"label":"Request request_f84e9d07-b060-4595-acd7-32ca34f0d58e - Stop b50b984d-fa50-489e-a508-6e6f03c13d0e"},{"checkpointId":"41adaec4-f89d-4945-b7bf-f08ddb4a72f6","requestId":"request_d7ec2804-c986-4ad0-bd16-ba590bdeeb6b","epoch":45,"label":"Request request_d7ec2804-c986-4ad0-bd16-ba590bdeeb6b"},{"checkpointId":"60d0d0e6-bb88-4cc4-91a6-ef617f0de166","requestId":"request_d7ec2804-c986-4ad0-bd16-ba590bdeeb6b","undoStopId":"15c4710a-7519-4edd-ab84-351f8fdbfda7","epoch":46,"label":"Request request_d7ec2804-c986-4ad0-bd16-ba590bdeeb6b - Stop 15c4710a-7519-4edd-ab84-351f8fdbfda7"},{"checkpointId":"85f56f6e-feb1-4efb-80d6-cebc2f78dc41","requestId":"request_52108342-d76d-4ecd-9e21-24782047fabe","epoch":49,"label":"Request request_52108342-d76d-4ecd-9e21-24782047fabe"},{"checkpointId":"8870c9a8-a4c7-4934-a94f-724c76ea26df","requestId":"request_65285225-3adf-4959-8d80-e953c7f30af0","epoch":50,"label":"Request request_65285225-3adf-4959-8d80-e953c7f30af0"},{"checkpointId":"99842642-9f95-4f6d-b944-3620f2744d99","requestId":"request_aa6c5cf9-b2dd-4e76-8b6c-a603b168760b","epoch":52,"label":"Request request_aa6c5cf9-b2dd-4e76-8b6c-a603b168760b"},{"checkpointId":"ad9f40b2-db71-4761-a5d0-c57176e53e5d","requestId":"request_ce418fba-a402-4ae7-8e74-d3420a99f201","epoch":53,"label":"Request request_ce418fba-a402-4ae7-8e74-d3420a99f201"},{"checkpointId":"93192e5d-bbef-4fe6-bce5-09bf5ae65cc0","requestId":"request_05a5b84a-3891-424e-ba29-a5ab551da634","epoch":54,"label":"Request request_05a5b84a-3891-424e-ba29-a5ab551da634"},{"checkpointId":"6c207a6b-9b83-4646-a5fe-0e849cb3fefe","requestId":"request_05a5b84a-3891-424e-ba29-a5ab551da634","undoStopId":"b0d2d96b-08ab-46a8-826f-bdea62fce841","epoch":55,"label":"Request request_05a5b84a-3891-424e-ba29-a5ab551da634 - Stop b0d2d96b-08ab-46a8-826f-bdea62fce841"},{"checkpointId":"d4014b5e-b41d-488c-86be-0d6206997cc5","requestId":"request_05a5b84a-3891-424e-ba29-a5ab551da634","undoStopId":"4a753ff8-b7d1-47f8-ae1b-7c3513dd338a","epoch":58,"label":"Request request_05a5b84a-3891-424e-ba29-a5ab551da634 - Stop 4a753ff8-b7d1-47f8-ae1b-7c3513dd338a"},{"checkpointId":"68b3c9da-df2c-4e05-97ba-8f372d8b2fca","requestId":"request_05a5b84a-3891-424e-ba29-a5ab551da634","undoStopId":"fb742a20-81b4-4b3a-8353-26c0dd6325c0","epoch":61,"label":"Request request_05a5b84a-3891-424e-ba29-a5ab551da634 - Stop fb742a20-81b4-4b3a-8353-26c0dd6325c0"},{"checkpointId":"933da5b9-471e-4902-b6fc-249b6c35c535","requestId":"request_05a5b84a-3891-424e-ba29-a5ab551da634","undoStopId":"d7ee982b-a18e-4010-af15-5ca0497e0955","epoch":63,"label":"Request request_05a5b84a-3891-424e-ba29-a5ab551da634 - Stop d7ee982b-a18e-4010-af15-5ca0497e0955"},{"checkpointId":"f5b255e3-2cd6-4c2a-999d-7dc8afb0182d","requestId":"request_5c21c11f-964f-4128-b95d-f7fa294fb3c0","epoch":65,"label":"Request request_5c21c11f-964f-4128-b95d-f7fa294fb3c0"},{"checkpointId":"2b70c2a5-7359-49d2-82ab-47f89dfef82a","requestId":"request_5c21c11f-964f-4128-b95d-f7fa294fb3c0","undoStopId":"45b0a96a-f252-402a-8b75-183b51dd2d42","epoch":66,"label":"Request request_5c21c11f-964f-4128-b95d-f7fa294fb3c0 - Stop 45b0a96a-f252-402a-8b75-183b51dd2d42"},{"checkpointId":"caac691a-00a3-4b3a-927f-aada9e62c664","requestId":"request_2d995c41-e4fb-4a32-8754-875cabc8f1e3","epoch":69,"label":"Request request_2d995c41-e4fb-4a32-8754-875cabc8f1e3"},{"checkpointId":"70133aa1-b1b7-4a4a-84fe-33ead45c4dc2","requestId":"request_2d995c41-e4fb-4a32-8754-875cabc8f1e3","undoStopId":"cc4c92c5-4f72-4eee-a61c-c023868b039b","epoch":70,"label":"Request request_2d995c41-e4fb-4a32-8754-875cabc8f1e3 - Stop cc4c92c5-4f72-4eee-a61c-c023868b039b"},{"checkpointId":"abc0f681-cb85-42b0-9e26-e65669850b34","requestId":"request_2d995c41-e4fb-4a32-8754-875cabc8f1e3","undoStopId":"8fd979d3-57d6-481d-a2e0-4c7cf062ca58","epoch":73,"label":"Request request_2d995c41-e4fb-4a32-8754-875cabc8f1e3 - Stop 8fd979d3-57d6-481d-a2e0-4c7cf062ca58"},{"checkpointId":"7c8ba243-cf67-4c98-bf91-9f1dd3c951c5","requestId":"request_2d995c41-e4fb-4a32-8754-875cabc8f1e3","undoStopId":"3408cc95-3ad3-4516-b90a-5a41895280cd","epoch":76,"label":"Request request_2d995c41-e4fb-4a32-8754-875cabc8f1e3 - Stop 3408cc95-3ad3-4516-b90a-5a41895280cd"},{"checkpointId":"391a2d4a-9c43-4e63-ad48-419014d98ae2","requestId":"request_f1323eca-5ec2-49e4-9f87-585555c3ec48","epoch":78,"label":"Request request_f1323eca-5ec2-49e4-9f87-585555c3ec48"},{"checkpointId":"421ae2fd-6a90-4768-ab71-9f62a70aff0a","requestId":"request_020092b9-97e0-43b6-b877-ad5f11664ee1","epoch":79,"label":"Request request_020092b9-97e0-43b6-b877-ad5f11664ee1"},{"checkpointId":"69da5975-d8fc-4a69-b6b3-d8409a1cd3ba","requestId":"request_020092b9-97e0-43b6-b877-ad5f11664ee1","undoStopId":"5e2c525b-893b-4a51-9fe0-0e9e7b7b466e","epoch":80,"label":"Request request_020092b9-97e0-43b6-b877-ad5f11664ee1 - Stop 5e2c525b-893b-4a51-9fe0-0e9e7b7b466e"},{"checkpointId":"0ff4807e-88f2-43b3-a6cb-708901e971dc","requestId":"request_020092b9-97e0-43b6-b877-ad5f11664ee1","undoStopId":"01a4a59e-764c-4fa3-aa80-c6a0e700420a","epoch":83,"label":"Request request_020092b9-97e0-43b6-b877-ad5f11664ee1 - Stop 01a4a59e-764c-4fa3-aa80-c6a0e700420a"},{"checkpointId":"dbbe854f-9e6c-4f46-aa89-d30123fc76fc","requestId":"request_020092b9-97e0-43b6-b877-ad5f11664ee1","undoStopId":"ec922f96-0d58-4f9c-a10b-5e8c018e2340","epoch":85,"label":"Request request_020092b9-97e0-43b6-b877-ad5f11664ee1 - Stop ec922f96-0d58-4f9c-a10b-5e8c018e2340"},{"checkpointId":"dc91d21a-9ba8-4767-a20b-682dd81a2905","requestId":"request_020092b9-97e0-43b6-b877-ad5f11664ee1","undoStopId":"a2c8ea72-7c90-4989-8649-10146e774aa3","epoch":87,"label":"Request request_020092b9-97e0-43b6-b877-ad5f11664ee1 - Stop a2c8ea72-7c90-4989-8649-10146e774aa3"},{"checkpointId":"6731304b-7ca4-4f0b-9e05-548bc1d2c1bd","requestId":"request_020092b9-97e0-43b6-b877-ad5f11664ee1","undoStopId":"686da75a-59b4-468e-8cd7-f2f943986d46","epoch":90,"label":"Request request_020092b9-97e0-43b6-b877-ad5f11664ee1 - Stop 686da75a-59b4-468e-8cd7-f2f943986d46"},{"checkpointId":"857b152e-696a-4185-9df3-1b07ba640382","requestId":"request_e1cb39fa-c4c3-4d4b-b7e1-a9c3f8c3b4cc","epoch":93,"label":"Request request_e1cb39fa-c4c3-4d4b-b7e1-a9c3f8c3b4cc"},{"checkpointId":"3e76551a-fd19-420d-87a9-1173548bb0fe","requestId":"request_e1cb39fa-c4c3-4d4b-b7e1-a9c3f8c3b4cc","undoStopId":"dfc1a346-91fa-4bea-a99d-6945a02f23f0","epoch":94,"label":"Request request_e1cb39fa-c4c3-4d4b-b7e1-a9c3f8c3b4cc - Stop dfc1a346-91fa-4bea-a99d-6945a02f23f0"},{"checkpointId":"597b02e1-e688-4c4e-9b21-85646446e9e1","requestId":"request_e1cb39fa-c4c3-4d4b-b7e1-a9c3f8c3b4cc","undoStopId":"2be28858-4acc-4507-b783-0847882e1906","epoch":95,"label":"Request request_e1cb39fa-c4c3-4d4b-b7e1-a9c3f8c3b4cc - Stop 2be28858-4acc-4507-b783-0847882e1906"},{"checkpointId":"38c2e57f-f54f-427e-8c2d-8a43d1575d36","requestId":"request_e1cb39fa-c4c3-4d4b-b7e1-a9c3f8c3b4cc","undoStopId":"4ce7d01a-bc2c-48d0-849f-1f51263ba109","epoch":101,"label":"Request request_e1cb39fa-c4c3-4d4b-b7e1-a9c3f8c3b4cc - Stop 4ce7d01a-bc2c-48d0-849f-1f51263ba109"},{"checkpointId":"5488a0f1-100f-4385-9027-bd48b33ca52f","requestId":"request_e07a7772-968a-477e-a954-72eb3513ede7","epoch":104,"label":"Request request_e07a7772-968a-477e-a954-72eb3513ede7"},{"checkpointId":"9b0d6de9-de3f-447b-b68d-78c6fb894c1b","requestId":"request_e07a7772-968a-477e-a954-72eb3513ede7","undoStopId":"e2f9aa95-d91d-4990-9a8a-2d2667b86df0","epoch":105,"label":"Request request_e07a7772-968a-477e-a954-72eb3513ede7 - Stop e2f9aa95-d91d-4990-9a8a-2d2667b86df0"},{"checkpointId":"1d441d6e-67f9-4673-86d4-d52a2d1cf397","requestId":"request_e07a7772-968a-477e-a954-72eb3513ede7","undoStopId":"0f6dcb31-5372-4272-83dd-5ab090561418","epoch":106,"label":"Request request_e07a7772-968a-477e-a954-72eb3513ede7 - Stop 0f6dcb31-5372-4272-83dd-5ab090561418"},{"checkpointId":"f2bd99ac-52ff-4fff-bcdb-04afd73fec42","requestId":"request_e07a7772-968a-477e-a954-72eb3513ede7","undoStopId":"e3c142ea-9b53-4284-9422-73fe98bea860","epoch":114,"label":"Request request_e07a7772-968a-477e-a954-72eb3513ede7 - Stop e3c142ea-9b53-4284-9422-73fe98bea860"},{"checkpointId":"e854d9e2-de9a-4955-8098-25ddd7e38cd8","requestId":"request_e07a7772-968a-477e-a954-72eb3513ede7","undoStopId":"8c850ff4-c584-41ce-ae8c-261f4e2e14e4","epoch":117,"label":"Request request_e07a7772-968a-477e-a954-72eb3513ede7 - Stop 8c850ff4-c584-41ce-ae8c-261f4e2e14e4"},{"checkpointId":"00578004-e3e7-4b79-9a73-44649229f547","requestId":"request_2898cd94-7697-4906-9e9b-0165db937240","epoch":119,"label":"Request request_2898cd94-7697-4906-9e9b-0165db937240"},{"checkpointId":"579fe885-9c76-4207-a001-e9b4fc89b94a","requestId":"request_2898cd94-7697-4906-9e9b-0165db937240","undoStopId":"1d0c4d11-7d0d-4707-80d3-db07367e1ce2","epoch":120,"label":"Request request_2898cd94-7697-4906-9e9b-0165db937240 - Stop 1d0c4d11-7d0d-4707-80d3-db07367e1ce2"},{"checkpointId":"dde83d6f-cbcd-46d2-8447-9ac77383e393","requestId":"request_48c060e3-68ea-41a9-b274-6b28227135f7","epoch":123,"label":"Request request_48c060e3-68ea-41a9-b274-6b28227135f7"},{"checkpointId":"c99c612c-78de-4fb8-b9ec-0505d7e36310","requestId":"request_48c060e3-68ea-41a9-b274-6b28227135f7","undoStopId":"5b7bae70-e27d-4b0b-9345-d58336127945","epoch":124,"label":"Request request_48c060e3-68ea-41a9-b274-6b28227135f7 - Stop 5b7bae70-e27d-4b0b-9345-d58336127945"},{"checkpointId":"6f2ac2be-01d0-4261-849c-2f4d889de637","requestId":"request_f66fcc2f-7600-4c3d-b58a-9a70f85ff99e","epoch":127,"label":"Request request_f66fcc2f-7600-4c3d-b58a-9a70f85ff99e"},{"checkpointId":"aa533917-d4d4-460d-8763-0c5abb774c85","requestId":"request_f66fcc2f-7600-4c3d-b58a-9a70f85ff99e","undoStopId":"71cfae29-7d98-4073-977d-d9e282a8717a","epoch":128,"label":"Request request_f66fcc2f-7600-4c3d-b58a-9a70f85ff99e - Stop 71cfae29-7d98-4073-977d-d9e282a8717a"},{"checkpointId":"3777dec8-da49-45f8-adc1-90731ec7ec87","requestId":"request_d367970c-4c33-4139-8cfb-aed7f33ec476","epoch":131,"label":"Request request_d367970c-4c33-4139-8cfb-aed7f33ec476"},{"checkpointId":"86053813-0aec-471a-996e-a7730c7bb638","requestId":"request_d367970c-4c33-4139-8cfb-aed7f33ec476","undoStopId":"84507f57-49d5-467b-b64e-31de83edaf83","epoch":132,"label":"Request request_d367970c-4c33-4139-8cfb-aed7f33ec476 - Stop 84507f57-49d5-467b-b64e-31de83edaf83"},{"checkpointId":"db5201d1-d2db-4cde-91b2-df6271303d18","requestId":"request_072750c6-1243-4dc9-a6c2-997a44762e6d","epoch":135,"label":"Request request_072750c6-1243-4dc9-a6c2-997a44762e6d"},{"checkpointId":"204cc1bd-996c-4641-a4df-446370324bf0","requestId":"request_072750c6-1243-4dc9-a6c2-997a44762e6d","undoStopId":"93c64b22-514a-41b1-ab0f-481469745ac1","epoch":136,"label":"Request request_072750c6-1243-4dc9-a6c2-997a44762e6d - Stop 93c64b22-514a-41b1-ab0f-481469745ac1"},{"checkpointId":"4d40c517-977d-44d4-9d77-2214fc5eacaa","requestId":"request_072750c6-1243-4dc9-a6c2-997a44762e6d","undoStopId":"9b765e9f-e551-4155-ba31-661ee80f72c4","epoch":140,"label":"Request request_072750c6-1243-4dc9-a6c2-997a44762e6d - Stop 9b765e9f-e551-4155-ba31-661ee80f72c4"},{"checkpointId":"1dadceef-61d2-4b39-9610-cdf8bc2761b3","requestId":"request_072750c6-1243-4dc9-a6c2-997a44762e6d","undoStopId":"44e8a1b0-29d2-4f28-887c-c7c080cb89c7","epoch":143,"label":"Request request_072750c6-1243-4dc9-a6c2-997a44762e6d - Stop 44e8a1b0-29d2-4f28-887c-c7c080cb89c7"},{"checkpointId":"3b7316c3-3e3a-4d81-93e3-25622d8125e9","requestId":"request_072750c6-1243-4dc9-a6c2-997a44762e6d","undoStopId":"246d875d-9f81-4ac7-b996-fc462e077333","epoch":146,"label":"Request request_072750c6-1243-4dc9-a6c2-997a44762e6d - Stop 246d875d-9f81-4ac7-b996-fc462e077333"},{"checkpointId":"2b37fc81-51b7-4700-8b70-a2d8bca453e9","requestId":"request_072750c6-1243-4dc9-a6c2-997a44762e6d","undoStopId":"ec5c726c-57b1-485c-8614-20c5d55866b1","epoch":148,"label":"Request request_072750c6-1243-4dc9-a6c2-997a44762e6d - Stop ec5c726c-57b1-485c-8614-20c5d55866b1"},{"checkpointId":"e0ec2276-b48e-4ae7-8733-f9d8c36ad12e","requestId":"request_65c3482f-996f-41ad-92f1-68a84ee31e00","epoch":150,"label":"Request request_65c3482f-996f-41ad-92f1-68a84ee31e00"},{"checkpointId":"ef07e5d4-cbc5-4838-bce6-a85e3e7f0a86","requestId":"request_65c3482f-996f-41ad-92f1-68a84ee31e00","undoStopId":"d58ee244-0694-434c-b61a-2384d759a1cf","epoch":151,"label":"Request request_65c3482f-996f-41ad-92f1-68a84ee31e00 - Stop d58ee244-0694-434c-b61a-2384d759a1cf"},{"checkpointId":"f2c61680-ed4e-4540-84b3-fb798bce6502","requestId":"request_91be0cc1-01fb-4211-9903-9c2be6b5539e","epoch":154,"label":"Request request_91be0cc1-01fb-4211-9903-9c2be6b5539e"},{"checkpointId":"c44cc68d-2b1f-4774-9ab7-97bd6845dfb0","requestId":"request_91be0cc1-01fb-4211-9903-9c2be6b5539e","undoStopId":"49b32888-0163-46a2-a321-d78b582c09ba","epoch":155,"label":"Request request_91be0cc1-01fb-4211-9903-9c2be6b5539e - Stop 49b32888-0163-46a2-a321-d78b582c09ba"},{"checkpointId":"81cd5b4c-699a-4bcf-a37d-a74473607fd3","requestId":"request_0bd3737c-96a7-45c8-bdaa-69c39a73dfda","epoch":158,"label":"Request request_0bd3737c-96a7-45c8-bdaa-69c39a73dfda"},{"checkpointId":"b135f081-68f9-4f4c-9e65-aedcbe90e15f","requestId":"request_0bd3737c-96a7-45c8-bdaa-69c39a73dfda","undoStopId":"bcb1d4ab-c9f2-4039-a0ad-79e31f3da3db","epoch":159,"label":"Request request_0bd3737c-96a7-45c8-bdaa-69c39a73dfda - Stop bcb1d4ab-c9f2-4039-a0ad-79e31f3da3db"},{"checkpointId":"93859452-09be-4aa6-94a5-ae9c3bc1c359","requestId":"request_0bd3737c-96a7-45c8-bdaa-69c39a73dfda","undoStopId":"bc1138ff-b705-4076-9b71-c9302cf883ea","epoch":162,"label":"Request request_0bd3737c-96a7-45c8-bdaa-69c39a73dfda - Stop bc1138ff-b705-4076-9b71-c9302cf883ea"},{"checkpointId":"75fe0a65-fe7e-4685-be3b-26b8c0ff4ee9","requestId":"request_0bd3737c-96a7-45c8-bdaa-69c39a73dfda","undoStopId":"8a80bb4b-5f2d-4b20-9595-6d7ebc2fac6c","epoch":165,"label":"Request request_0bd3737c-96a7-45c8-bdaa-69c39a73dfda - Stop 8a80bb4b-5f2d-4b20-9595-6d7ebc2fac6c"}],"currentEpoch":168,"fileBaselines":[["file:///home/trang/localnsv/mAIware/scanner-worker.js::request_00215662-f551-41ad-901a-4eb745ef44c4",{"uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/scanner-worker.js","external":"file:///home/trang/localnsv/mAIware/scanner-worker.js","path":"/home/trang/localnsv/mAIware/scanner-worker.js","scheme":"file"},"requestId":"request_00215662-f551-41ad-901a-4eb745ef44c4","content":"const { parentPort, workerData } = require('node:worker_threads')\nlet chokidar = null\n\ntry {\n  chokidar = require('chokidar')\n} catch (err) {\n  // Fallback to fs.watch when chokidar is unavailable\n}\nconst path = require('node:path')\nconst fs = require('node:fs')\nconst fsPromises = require('node:fs').promises\nconst crypto = require('node:crypto')\nconst axios = require('axios')\nconst FormData = require('form-data')\nconst { getRandomDemoJson } = require('./jsonsamples') //\n\nconst AI_APP_API_ENDPOINT = 'http://localhost:1234/scan' //\nconst FILE_SIZE_THRESHOLD = 50 * 1024 * 1024 * 1024 //\nconst DEFAULT_SCAN_DELAY_MS = 10000\n\nconst fileQueue = [] //\nlet isProcessing = false //\nlet activeWatcher = null //\nlet shutdownRequested = false //\n\nconst delay = (ms) => new Promise(resolve => setTimeout(resolve, ms)) //\n\nconst normalizeBoolean = (value) => {\n  if (typeof value !== 'string') {\n    return false\n  }\n\n  return ['1', 'true', 'yes', 'on'].includes(value.toLowerCase())\n}\n\nconst skipUpload = normalizeBoolean(process.env.MAIWARE_SKIP_UPLOAD)\nconst customDelay = Number.parseInt(process.env.MAIWARE_SCAN_DELAY_MS || '', 10)\nconst SCAN_DELAY_MS = Number.isFinite(customDelay) ? Math.max(0, customDelay) : DEFAULT_SCAN_DELAY_MS\n\nfunction postLog(message) {\n  parentPort.postMessage({ channel: 'log', payload: message })\n}\n\nfunction postError(message) {\n  parentPort.postMessage({ channel: 'error', payload: message })\n}\n\nasync function waitForIdle(timeoutMs = 15000) {\n  const deadline = Date.now() + timeoutMs\n\n  while ((isProcessing || fileQueue.length > 0) && Date.now() < deadline) {\n    await delay(100)\n  }\n\n  if (isProcessing || fileQueue.length > 0) {\n    postError('[Monitor] Shutdown timed out with pending work remaining.')\n  }\n}\n\nasync function processQueue() {\n  if (isProcessing || fileQueue.length === 0) {\n    return\n  }\n\n  isProcessing = true\n  const filePath = fileQueue.shift()\n  const detectedFilename = path.basename(filePath)\n\n  postLog(`[Monitor] Processing: ${detectedFilename}`)\n\n  try {\n    const stats = await fsPromises.stat(filePath)\n\n    if (stats.size < FILE_SIZE_THRESHOLD) {\n      await handleSmallFile(filePath, detectedFilename)\n    } else {\n      postLog(`[Monitor] File ${detectedFilename} is large, skipping server push.`)\n    }\n  } catch (err) {\n    postError(`[Monitor] Error processing ${filePath}: ${err.message}`)\n  } finally {\n    isProcessing = false\n    if (!shutdownRequested) {\n      processQueue()\n    }\n  }\n}\n\nasync function sendResultToServer(scanResult) {\n  const SERVER_URL = 'http://localhost:3000/api/submit-scan';\n  \n  try {\n    const response = await fetch(SERVER_URL, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(scanResult)\n    });\n    \n    if (response.ok) {\n      postLog('[Server] Scan result uploaded successfully');\n    } else {\n      postLog(`[Server] Upload failed: ${response.statusText}`);\n    }\n  } catch (error) {\n    postLog(`[Server] Failed to upload: ${error.message}`);\n  }\n}\n\nasync function handleSmallFile(filePath, detectedFilename) {\n  const uploadTask = async () => {\n    if (skipUpload) {\n      postLog(`[Push] Skipping upload for ${detectedFilename} (MAIWARE_SKIP_UPLOAD).`)\n      return\n    }\n\n    const form = new FormData()\n    form.append('file', fs.createReadStream(filePath))\n\n    try {\n      postLog(`[Push] Starting upload for ${detectedFilename}...`)\n      const response = await axios.post(AI_APP_API_ENDPOINT, form, {\n        headers: form.getHeaders(),\n      })\n      postLog(`[Push] AI App Response: ${response.status} ${JSON.stringify(response.data)}`)\n    } catch (err) {\n      postError(`[Push] AI app push failed: ${err.message}`)\n    }\n  }\n\n  const demoTask = async () => {\n    postLog(`[Scan] Scanning for ${detectedFilename}...`)\n    await delay(SCAN_DELAY_MS)\n\n    let fileHashes = null\n    try {\n      fileHashes = await computeFileHashes(filePath)\n    } catch (err) {\n      postError(`[Hash] Failed to compute hashes for ${detectedFilename}: ${err.message}`)\n    }\n\n    const scanResult = getRandomDemoJson(detectedFilename, fileHashes)\n\n    postLog(`[Scan] Scan completed. (Triggered by ${detectedFilename})`)\n    parentPort.postMessage({ channel: 'scan-result', payload: scanResult })\n    \n    // Send to server\n    await sendResultToServer(scanResult)\n  }\n\n  await Promise.all([\n    uploadTask(),\n    demoTask(),\n  ])\n}\n\nfunction handleDetectedFile(filePath) {\n  const detectedFilename = path.basename(filePath)\n  postLog(`[Monitor] Detected new file: ${detectedFilename}`)\n\n  parentPort.postMessage({ channel: 'scan-started', payload: detectedFilename })\n\n  fileQueue.push(filePath)\n  processQueue()\n}\n\nfunction setupWatcher(downloadPath) {\n  postLog(`[Monitor] Watching for new files in: ${downloadPath}`)\n\n  if (chokidar) {\n    activeWatcher = chokidar.watch(downloadPath, {\n      ignored: /(^|[\\/\\\\])\\..|.*\\.tmp$|.*\\.crdownload$/,\n      persistent: true,\n      ignoreInitial: true,\n      depth: 0,\n      awaitWriteFinish: {\n        stabilityThreshold: 2000,\n        pollInterval: 100\n      }\n    })\n\n    activeWatcher.on('add', handleDetectedFile)\n    return\n  }\n\n  postLog('[Monitor] chokidar not available. Falling back to fs.watch (reduced accuracy).')\n\n  const fallbackWatcher = fs.watch(downloadPath, { persistent: true }, async (eventType, filename) => {\n    if (eventType !== 'rename' || !filename) {\n      return\n    }\n\n    const candidatePath = path.join(downloadPath, filename)\n\n    try {\n      const stats = await fsPromises.stat(candidatePath)\n\n      if (stats.isFile()) {\n        handleDetectedFile(candidatePath)\n      }\n    } catch (err) {\n      // Ignore ENOENT and similar errors when files are removed quickly\n    }\n  })\n\n  activeWatcher = {\n    close: () => {\n      fallbackWatcher.close()\n      return Promise.resolve()\n    }\n  }\n}\n\nasync function closeWatcher() {\n  if (!activeWatcher) {\n    return\n  }\n\n  try {\n    await activeWatcher.close()\n    postLog('[Monitor] File watcher stopped.')\n  } catch (err) {\n    postError(`[Monitor] Failed to close watcher: ${err.message}`)\n  } finally {\n    activeWatcher = null\n  }\n}\n\nfunction queueManualScan(filePath) {\n  const normalized = path.resolve(filePath)\n  fileQueue.push(normalized)\n  postLog(`[Monitor] Manually queued file: ${normalized}`)\n  processQueue()\n}\n\nfunction computeFileHashes(filePath) {\n  return new Promise((resolve, reject) => {\n    const sha256 = crypto.createHash('sha256')\n    const md5 = crypto.createHash('md5')\n    const stream = fs.createReadStream(filePath)\n\n    stream.on('data', (chunk) => {\n      sha256.update(chunk)\n      md5.update(chunk)\n    })\n\n    stream.on('error', (err) => {\n      reject(err)\n    })\n\n    stream.on('end', () => {\n      try {\n        resolve({\n          sha256: sha256.digest('hex'),\n          md5: md5.digest('hex')\n        })\n      } catch (err) {\n        reject(err)\n      }\n    })\n  })\n}\n\nasync function handleShutdownRequest() {\n  if (shutdownRequested) {\n    return\n  }\n\n  shutdownRequested = true\n  postLog('[Monitor] Shutdown requested.')\n\n  await waitForIdle()\n  await closeWatcher()\n\n  parentPort.postMessage({ channel: 'shutdown-complete' })\n\n  setImmediate(() => {\n    try {\n      if (typeof parentPort.close === 'function') {\n        parentPort.close()\n      }\n    } catch (err) {\n      postError(`[Monitor] Failed to close parent port: ${err.message}`)\n    } finally {\n      process.exit(0)\n    }\n  })\n}\n\nif (parentPort) {\n  parentPort.on('message', (message) => {\n    if (!message || typeof message !== 'object') {\n      return\n    }\n\n    const { type, path: manualPath } = message\n\n    switch (type) {\n      case 'shutdown':\n        handleShutdownRequest().catch((err) => {\n          postError(`[Monitor] Shutdown handler failed: ${err.message}`)\n        })\n        break\n      case 'flush-queue':\n        processQueue()\n        break\n      case 'scan-path':\n        if (typeof manualPath === 'string') {\n          queueManualScan(manualPath)\n        }\n        break\n      default:\n        postLog(`[Monitor] Received unknown control message: ${type}`)\n    }\n  })\n}\n\npostLog(`[Monitor] Worker bootstrapped (pid ${process.pid}). Upload ${skipUpload ? 'disabled' : 'enabled'}, scan delay ${SCAN_DELAY_MS}ms.`)\n\nsetupWatcher(workerData.downloadPath)\n\nparentPort.postMessage({ channel: 'ready', payload: { downloadPath: workerData.downloadPath } })\n","epoch":3,"telemetryInfo":{}}],["file:///home/trang/localnsv/mAIware/jsonsamples.js::request_00215662-f551-41ad-901a-4eb745ef44c4",{"uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/jsonsamples.js","external":"file:///home/trang/localnsv/mAIware/jsonsamples.js","path":"/home/trang/localnsv/mAIware/jsonsamples.js","scheme":"file"},"requestId":"request_00215662-f551-41ad-901a-4eb745ef44c4","content":"const crypto = require('node:crypto');\nconst {\n  VENDORS,\n  SIGNATURES,\n  FILE_TYPES,\n  PACKERS,\n  MALWARE_FAMILIES,\n  API_SETS, \n  SUSPICIOUS_STRINGS,\n  BENIGN_STRINGS,\n  CLASSIFICATION,\n  ENTROPY_SECTIONS\n} = require('./datasrcs');\n\n// Generates fake hashes for the demo report.\nconst getFakeHashes = (filename) => {\n  const md5 = crypto.createHash('md5').update(filename + Date.now()).digest('hex');\n  const sha256 = crypto.createHash('sha256').update(filename + Date.now()).digest('hex');\n  return { md5, sha256 };\n};\n\n  // This is our list of 20 \"raw\" samples.\nconst rawSamples = [\n  // --- 8 Benign Samples (c: 0) ---\n  { name: \"vcredist_x64.exe\", c: 0, f: 0, v: 2, p: 0, s: 0, apiSet: 1, strings: [0], e: [{s:0, v:6.51}, {s:1, v:2.12}, {s:2, v:5.89}] },\n  { name: \"Notepad++.exe\", c: 0, f: 0, v: 1, p: 0, s: 2, apiSet: 0, strings: [1, 2], e: [{s:0, v:6.82}, {s:1, v:4.15}, {s:2, v:5.11}] },\n  { name: \"calc.exe\", c: 0, f: 0, v: 2, p: 0, s: 0, apiSet: 1, strings: [3], e: [{s:0, v:6.01}, {s:1, v:1.99}, {s:2, v:3.44}] },\n  { name: \"kernel32.dll\", c: 0, f: 2, v: 2, p: 0, s: 0, apiSet: 0, strings: [4, 5, 6], e: [{s:0, v:6.19}, {s:1, v:2.78}] },\n  { name: \"chrome_installer.exe\", c: 0, f: 0, v: 0, p: 0, s: 1, apiSet: 2, strings: [], e: [{s:0, v:6.7}, {s:1, v:3.5}, {s:2, v:4.9}] },\n  { name: \"putty.exe\", c: 0, f: 0, v: 10, p: 0, s: 3, apiSet: 2, strings: [7], e: [{s:0, v:6.2}, {s:1, v:2.1}] },\n  { name: \"AcroRead.exe\", c: 0, f: 0, v: 16, p: 0, s: 3, apiSet: 0, strings: [], e: [{s:0, v:6.5}, {s:1, v:4.5}, {s:2, v:5.5}] },\n  { name: \"datasheet.pdf\", c: 0, f: 4, v: 4, p: 0, s: 3, apiSet: 0, strings: [], e: [] }, // No entropy for non-PE\n\n  // --- 6 Suspicious Samples (c: 1) ---\n  { name: \"legit_tool_packed.exe\", c: 1, f: 1, v: 3, p: 1, s: 4, apiSet: 3, strings: [20, 21], e: [{s:3, v:7.98}, {s:4, v:7.95}] },\n  { name: \"downloader_obf.exe\", c: 1, f: 1, v: 14, p: 5, s: 4, apiSet: 5, strings: [11, 12], e: [{s:0, v:7.89}, {s:1, v:2.0}] },\n  { name: \"patcher.exe\", c: 1, f: 0, v: 8, p: 0, s: 4, apiSet: 4, strings: [13, 14, 15], e: [{s:0, v:6.4}, {s:1, v:5.1}, {s:5, v:7.2}] },\n  { name: \"installer.msi\", c: 1, f: 3, v: 17, p: 0, s: 3, apiSet: 6, strings: [16, 17, 18], e: [] },\n  { name: \"license_keygen.exe\", c: 1, f: 1, v: 19, p: 2, s: 6, apiSet: 4, strings: [13, 14], e: [{s:0, v:7.6}, {s:1, v:7.5}] },\n  { name: \"setup_with_adware.exe\", c: 1, f: 0, v: 11, p: 0, s: 3, apiSet: 6, strings: [18], e: [{s:0, v:6.3}, {s:2, v:5.8}] },\n  \n  // --- 6 Malware Samples (c: 2) ---\n  { name: \"invoice_8374.exe\", c: 2, f: 0, v: 5, p: 0, s: 4, apiSet: 5, strings: [0, 1], fam: 0, e: [{s:0, v:6.95}, {s:1, v:7.1}] },\n  { name: \"svchost.exe\", c: 2, f: 1, v: 6, p: 0, s: 4, apiSet: 7, strings: [2, 3], fam: 1, e: [{s:0, v:6.88}, {s:1, v:4.0}] },\n  { name: \"document.dll\", c: 2, f: 2, v: 7, p: 0, s: 4, apiSet: 8, strings: [4, 5, 6, 7], fam: 2, e: [{s:0, v:7.01}, {s:2, v:5.1}] },\n  { name: \"update.exe\", c: 2, f: 0, v: 9, p: 0, s: 4, apiSet: 6, strings: [8, 9, 10], fam: 3, e: [{s:0, v:6.75}, {s:1, v:3.1}] },\n  { name: \"javaupdate.exe\", c: 2, f: 1, v: 12, p: 3, s: 5, apiSet: 9, strings: [2, 19, 20], fam: 4, e: [{s:0, v:7.5}, {s:1, v:7.4}] },\n  { name: \"report.pdf.exe\", c: 2, f: 0, v: 13, p: 0, s: 4, apiSet: 10, strings: [0, 11, 12], fam: 7, e: [{s:0, v:6.8}, {s:1, v:7.2}] }\n];\n\n// --- generateGraphData() function has been REMOVED from this file ---\n\n/**\n * Builds a human-readable JSON report by mapping raw sample data.\n * @param {string} detectedFilename - The name of the file that was actually detected.\n * @returns {object} A final, human-readable JSON object.\n */\nfunction getRandomDemoJson(detectedFilename, fileHashes) {\n  // 1. Pick a random raw sample definition\n  const rawSample = rawSamples[Math.floor(Math.random() * rawSamples.length)];\n  const classification = CLASSIFICATION[rawSample.c];\n  \n  // 2. Map API index to the actual list of names\n  // Use empty array as default if index is bad\n  const apiImports = API_SETS[rawSample.apiSet] || [];\n\n  // 3. Build the final, readable JSON object\n  const hashValues =\n    fileHashes && fileHashes.sha256 && fileHashes.md5\n      ? fileHashes\n      : getFakeHashes(detectedFilename);\n\n  const finalJson = {\n    \"detected_filename\": detectedFilename,\n    \"file_hashes\": hashValues,\n    \"classification\": classification,\n    \"malware_family\": rawSample.fam !== undefined ? MALWARE_FAMILIES[rawSample.fam] : null,\n    \"confidence_score\": (Math.random() * (0.99 - 0.55) + 0.55).toFixed(2),\n    \"vendor\": VENDORS[rawSample.v], // This is now an object {name, icon}\n    \"key_findings\": {\n      \"file_type\": FILE_TYPES[rawSample.f], \n      \"packer_detected\": PACKERS[rawSample.p], \n      \"signature\": SIGNATURES[rawSample.s], // This is now an object {name, icon, level}\n      \"section_entropy\": rawSample.e.map(entry => ({\n        name: ENTROPY_SECTIONS[entry.s],\n        entropy: entry.v\n      })),\n      \"api_imports\": apiImports, // <-- RENAMED and simplified\n      \"key_strings\": (rawSample.c === 0) \n        ? rawSample.strings.map(index => BENIGN_STRINGS[index]) \n        : rawSample.strings.map(index => SUSPICIOUS_STRINGS[index]) \n    }\n    // 4. \"graphData\" key is GONE.\n  };\n\n  // Clean up empty fields for a tidier output\n  if (finalJson.malware_family === null) {\n    delete finalJson.malware_family;\n  }\n  if (finalJson.key_findings.api_imports.length === 0) {\n    delete finalJson.key_findings.api_imports;\n  }\n  if (finalJson.key_findings.key_strings.length === 0) {\n    delete finalJson.key_findings.key_strings;\n  }\n  \n  return finalJson;\n}\n\nmodule.exports = {\n  getRandomDemoJson\n};\n","epoch":8,"telemetryInfo":{}}],["file:///home/trang/localnsv/mAIware/scanner-worker.js::request_437e96e4-e1db-4dd0-b1ca-407e036609b7",{"uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/scanner-worker.js","external":"file:///home/trang/localnsv/mAIware/scanner-worker.js","path":"/home/trang/localnsv/mAIware/scanner-worker.js","scheme":"file"},"requestId":"request_437e96e4-e1db-4dd0-b1ca-407e036609b7","content":"const { parentPort, workerData } = require('node:worker_threads')\nlet chokidar = null\n\ntry {\n  chokidar = require('chokidar')\n} catch (err) {\n  // Fallback to fs.watch when chokidar is unavailable\n}\nconst path = require('node:path')\nconst fs = require('node:fs')\nconst fsPromises = require('node:fs').promises\nconst crypto = require('node:crypto')\nconst axios = require('axios')\nconst FormData = require('form-data')\nconst { getRandomDemoJson } = require('./jsonsamples') //\n\nconst AI_APP_API_ENDPOINT = 'http://localhost:1234/scan' //\nconst FILE_SIZE_THRESHOLD = 50 * 1024 * 1024 * 1024 //\nconst DEFAULT_SCAN_DELAY_MS = 10000\n\nconst fileQueue = [] //\nlet isProcessing = false //\nlet activeWatcher = null //\nlet shutdownRequested = false //\n\nconst delay = (ms) => new Promise(resolve => setTimeout(resolve, ms)) //\n\nconst normalizeBoolean = (value) => {\n  if (typeof value !== 'string') {\n    return false\n  }\n\n  return ['1', 'true', 'yes', 'on'].includes(value.toLowerCase())\n}\n\nconst skipUpload = normalizeBoolean(process.env.MAIWARE_SKIP_UPLOAD)\nconst customDelay = Number.parseInt(process.env.MAIWARE_SCAN_DELAY_MS || '', 10)\nconst SCAN_DELAY_MS = Number.isFinite(customDelay) ? Math.max(0, customDelay) : DEFAULT_SCAN_DELAY_MS\n\nfunction postLog(message) {\n  parentPort.postMessage({ channel: 'log', payload: message })\n}\n\nfunction postError(message) {\n  parentPort.postMessage({ channel: 'error', payload: message })\n}\n\nasync function waitForIdle(timeoutMs = 15000) {\n  const deadline = Date.now() + timeoutMs\n\n  while ((isProcessing || fileQueue.length > 0) && Date.now() < deadline) {\n    await delay(100)\n  }\n\n  if (isProcessing || fileQueue.length > 0) {\n    postError('[Monitor] Shutdown timed out with pending work remaining.')\n  }\n}\n\nasync function processQueue() {\n  if (isProcessing || fileQueue.length === 0) {\n    return\n  }\n\n  isProcessing = true\n  const filePath = fileQueue.shift()\n  const detectedFilename = path.basename(filePath)\n\n  postLog(`[Monitor] Processing: ${detectedFilename}`)\n\n  try {\n    const stats = await fsPromises.stat(filePath)\n\n    if (stats.size < FILE_SIZE_THRESHOLD) {\n      await handleSmallFile(filePath, detectedFilename)\n    } else {\n      postLog(`[Monitor] File ${detectedFilename} is large, skipping server push.`)\n    }\n  } catch (err) {\n    postError(`[Monitor] Error processing ${filePath}: ${err.message}`)\n  } finally {\n    isProcessing = false\n    if (!shutdownRequested) {\n      processQueue()\n    }\n  }\n}\n\nasync function sendResultToServer(scanResult) {\n  const SERVER_URL = 'http://localhost:3000/api/submit-scan';\n  \n  try {\n    const response = await fetch(SERVER_URL, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(scanResult)\n    });\n    \n    if (response.ok) {\n      postLog('[Server] Scan result uploaded successfully');\n    } else {\n      postLog(`[Server] Upload failed: ${response.statusText}`);\n    }\n  } catch (error) {\n    postLog(`[Server] Failed to upload: ${error.message}`);\n  }\n}\n\nasync function handleSmallFile(filePath, detectedFilename) {\n  const uploadTask = async () => {\n    if (skipUpload) {\n      postLog(`[Push] Skipping upload for ${detectedFilename} (MAIWARE_SKIP_UPLOAD).`)\n      return\n    }\n\n    const form = new FormData()\n    form.append('file', fs.createReadStream(filePath))\n\n    try {\n      postLog(`[Push] Starting upload for ${detectedFilename}...`)\n      const response = await axios.post(AI_APP_API_ENDPOINT, form, {\n        headers: form.getHeaders(),\n      })\n      postLog(`[Push] AI App Response: ${response.status} ${JSON.stringify(response.data)}`)\n    } catch (err) {\n      postError(`[Push] AI app push failed: ${err.message}`)\n    }\n  }\n\n  const demoTask = async () => {\n    postLog(`[Scan] Scanning for ${detectedFilename}...`)\n    await delay(SCAN_DELAY_MS)\n\n    let fileHashes = null\n    try {\n      fileHashes = await computeFileHashes(filePath)\n    } catch (err) {\n      postError(`[Hash] Failed to compute hashes for ${detectedFilename}: ${err.message}`)\n    }\n\n    const scanResult = getRandomDemoJson(detectedFilename, fileHashes)\n\n    postLog(`[Scan] Scan completed. (Triggered by ${detectedFilename})`)\n    parentPort.postMessage({ channel: 'scan-result', payload: scanResult })\n    \n    // Send to server\n    await sendResultToServer(scanResult)\n  }\n\n  await Promise.all([\n    uploadTask(),\n    demoTask(),\n  ])\n}\n\nfunction handleDetectedFile(filePath) {\n  const detectedFilename = path.basename(filePath)\n  postLog(`[Monitor] Detected new file: ${detectedFilename}`)\n\n  parentPort.postMessage({ channel: 'scan-started', payload: detectedFilename })\n\n  fileQueue.push(filePath)\n  processQueue()\n}\n\nfunction setupWatcher(downloadPath) {\n  postLog(`[Monitor] Watching for new files in: ${downloadPath}`)\n\n  if (chokidar) {\n    activeWatcher = chokidar.watch(downloadPath, {\n      ignored: /(^|[\\/\\\\])\\..|.*\\.tmp$|.*\\.crdownload$/,\n      persistent: true,\n      ignoreInitial: true,\n      depth: 0,\n      awaitWriteFinish: {\n        stabilityThreshold: 2000,\n        pollInterval: 100\n      }\n    })\n\n    activeWatcher.on('add', handleDetectedFile)\n    return\n  }\n\n  postLog('[Monitor] chokidar not available. Falling back to fs.watch (reduced accuracy).')\n\n  const fallbackWatcher = fs.watch(downloadPath, { persistent: true }, async (eventType, filename) => {\n    if (eventType !== 'rename' || !filename) {\n      return\n    }\n\n    const candidatePath = path.join(downloadPath, filename)\n\n    try {\n      const stats = await fsPromises.stat(candidatePath)\n\n      if (stats.isFile()) {\n        handleDetectedFile(candidatePath)\n      }\n    } catch (err) {\n      // Ignore ENOENT and similar errors when files are removed quickly\n    }\n  })\n\n  activeWatcher = {\n    close: () => {\n      fallbackWatcher.close()\n      return Promise.resolve()\n    }\n  }\n}\n\nasync function closeWatcher() {\n  if (!activeWatcher) {\n    return\n  }\n\n  try {\n    await activeWatcher.close()\n    postLog('[Monitor] File watcher stopped.')\n  } catch (err) {\n    postError(`[Monitor] Failed to close watcher: ${err.message}`)\n  } finally {\n    activeWatcher = null\n  }\n}\n\nfunction queueManualScan(filePath) {\n  const normalized = path.resolve(filePath)\n  fileQueue.push(normalized)\n  postLog(`[Monitor] Manually queued file: ${normalized}`)\n  processQueue()\n}\n\nfunction computeFileHashes(filePath) {\n  return new Promise((resolve, reject) => {\n    const sha256 = crypto.createHash('sha256')\n    const md5 = crypto.createHash('md5')\n    const stream = fs.createReadStream(filePath)\n\n    stream.on('data', (chunk) => {\n      sha256.update(chunk)\n      md5.update(chunk)\n    })\n\n    stream.on('error', (err) => {\n      reject(err)\n    })\n\n    stream.on('end', () => {\n      try {\n        resolve({\n          sha256: sha256.digest('hex'),\n          md5: md5.digest('hex')\n        })\n      } catch (err) {\n        reject(err)\n      }\n    })\n  })\n}\n\nasync function handleShutdownRequest() {\n  if (shutdownRequested) {\n    return\n  }\n\n  shutdownRequested = true\n  postLog('[Monitor] Shutdown requested.')\n\n  await waitForIdle()\n  await closeWatcher()\n\n  parentPort.postMessage({ channel: 'shutdown-complete' })\n\n  setImmediate(() => {\n    try {\n      if (typeof parentPort.close === 'function') {\n        parentPort.close()\n      }\n    } catch (err) {\n      postError(`[Monitor] Failed to close parent port: ${err.message}`)\n    } finally {\n      process.exit(0)\n    }\n  })\n}\n\nif (parentPort) {\n  parentPort.on('message', (message) => {\n    if (!message || typeof message !== 'object') {\n      return\n    }\n\n    const { type, path: manualPath } = message\n\n    switch (type) {\n      case 'shutdown':\n        handleShutdownRequest().catch((err) => {\n          postError(`[Monitor] Shutdown handler failed: ${err.message}`)\n        })\n        break\n      case 'flush-queue':\n        processQueue()\n        break\n      case 'scan-path':\n        if (typeof manualPath === 'string') {\n          queueManualScan(manualPath)\n        }\n        break\n      default:\n        postLog(`[Monitor] Received unknown control message: ${type}`)\n    }\n  })\n}\n\npostLog(`[Monitor] Worker bootstrapped (pid ${process.pid}). Upload ${skipUpload ? 'disabled' : 'enabled'}, scan delay ${SCAN_DELAY_MS}ms.`)\n\nsetupWatcher(workerData.downloadPath)\n\nparentPort.postMessage({ channel: 'ready', payload: { downloadPath: workerData.downloadPath } })\n","epoch":13,"telemetryInfo":{}}],["file:///home/trang/localnsv/mAIware/jsonsamples.js::request_437e96e4-e1db-4dd0-b1ca-407e036609b7",{"uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/jsonsamples.js","external":"file:///home/trang/localnsv/mAIware/jsonsamples.js","path":"/home/trang/localnsv/mAIware/jsonsamples.js","scheme":"file"},"requestId":"request_437e96e4-e1db-4dd0-b1ca-407e036609b7","content":"const crypto = require('node:crypto');\nconst {\n  VENDORS,\n  SIGNATURES,\n  FILE_TYPES,\n  PACKERS,\n  MALWARE_FAMILIES,\n  API_SETS, \n  SUSPICIOUS_STRINGS,\n  BENIGN_STRINGS,\n  CLASSIFICATION,\n  ENTROPY_SECTIONS\n} = require('./datasrcs');\n\n// Generates fake hashes for the demo report.\nconst getFakeHashes = (filename) => {\n  const md5 = crypto.createHash('md5').update(filename + Date.now()).digest('hex');\n  const sha256 = crypto.createHash('sha256').update(filename + Date.now()).digest('hex');\n  return { md5, sha256 };\n};\n\n  // This is our list of 20 \"raw\" samples.\nconst rawSamples = [\n  // --- 8 Benign Samples (c: 0) ---\n  { name: \"vcredist_x64.exe\", c: 0, f: 0, v: 2, p: 0, s: 0, apiSet: 1, strings: [0], e: [{s:0, v:6.51}, {s:1, v:2.12}, {s:2, v:5.89}] },\n  { name: \"Notepad++.exe\", c: 0, f: 0, v: 1, p: 0, s: 2, apiSet: 0, strings: [1, 2], e: [{s:0, v:6.82}, {s:1, v:4.15}, {s:2, v:5.11}] },\n  { name: \"calc.exe\", c: 0, f: 0, v: 2, p: 0, s: 0, apiSet: 1, strings: [3], e: [{s:0, v:6.01}, {s:1, v:1.99}, {s:2, v:3.44}] },\n  { name: \"kernel32.dll\", c: 0, f: 2, v: 2, p: 0, s: 0, apiSet: 0, strings: [4, 5, 6], e: [{s:0, v:6.19}, {s:1, v:2.78}] },\n  { name: \"chrome_installer.exe\", c: 0, f: 0, v: 0, p: 0, s: 1, apiSet: 2, strings: [], e: [{s:0, v:6.7}, {s:1, v:3.5}, {s:2, v:4.9}] },\n  { name: \"putty.exe\", c: 0, f: 0, v: 10, p: 0, s: 3, apiSet: 2, strings: [7], e: [{s:0, v:6.2}, {s:1, v:2.1}] },\n  { name: \"AcroRead.exe\", c: 0, f: 0, v: 16, p: 0, s: 3, apiSet: 0, strings: [], e: [{s:0, v:6.5}, {s:1, v:4.5}, {s:2, v:5.5}] },\n  { name: \"datasheet.pdf\", c: 0, f: 4, v: 4, p: 0, s: 3, apiSet: 0, strings: [], e: [] }, // No entropy for non-PE\n\n  // --- 6 Suspicious Samples (c: 1) ---\n  { name: \"legit_tool_packed.exe\", c: 1, f: 1, v: 3, p: 1, s: 4, apiSet: 3, strings: [20, 21], e: [{s:3, v:7.98}, {s:4, v:7.95}] },\n  { name: \"downloader_obf.exe\", c: 1, f: 1, v: 14, p: 5, s: 4, apiSet: 5, strings: [11, 12], e: [{s:0, v:7.89}, {s:1, v:2.0}] },\n  { name: \"patcher.exe\", c: 1, f: 0, v: 8, p: 0, s: 4, apiSet: 4, strings: [13, 14, 15], e: [{s:0, v:6.4}, {s:1, v:5.1}, {s:5, v:7.2}] },\n  { name: \"installer.msi\", c: 1, f: 3, v: 17, p: 0, s: 3, apiSet: 6, strings: [16, 17, 18], e: [] },\n  { name: \"license_keygen.exe\", c: 1, f: 1, v: 19, p: 2, s: 6, apiSet: 4, strings: [13, 14], e: [{s:0, v:7.6}, {s:1, v:7.5}] },\n  { name: \"setup_with_adware.exe\", c: 1, f: 0, v: 11, p: 0, s: 3, apiSet: 6, strings: [18], e: [{s:0, v:6.3}, {s:2, v:5.8}] },\n  \n  // --- 6 Malware Samples (c: 2) ---\n  { name: \"invoice_8374.exe\", c: 2, f: 0, v: 5, p: 0, s: 4, apiSet: 5, strings: [0, 1], fam: 0, e: [{s:0, v:6.95}, {s:1, v:7.1}] },\n  { name: \"svchost.exe\", c: 2, f: 1, v: 6, p: 0, s: 4, apiSet: 7, strings: [2, 3], fam: 1, e: [{s:0, v:6.88}, {s:1, v:4.0}] },\n  { name: \"document.dll\", c: 2, f: 2, v: 7, p: 0, s: 4, apiSet: 8, strings: [4, 5, 6, 7], fam: 2, e: [{s:0, v:7.01}, {s:2, v:5.1}] },\n  { name: \"update.exe\", c: 2, f: 0, v: 9, p: 0, s: 4, apiSet: 6, strings: [8, 9, 10], fam: 3, e: [{s:0, v:6.75}, {s:1, v:3.1}] },\n  { name: \"javaupdate.exe\", c: 2, f: 1, v: 12, p: 3, s: 5, apiSet: 9, strings: [2, 19, 20], fam: 4, e: [{s:0, v:7.5}, {s:1, v:7.4}] },\n  { name: \"report.pdf.exe\", c: 2, f: 0, v: 13, p: 0, s: 4, apiSet: 10, strings: [0, 11, 12], fam: 7, e: [{s:0, v:6.8}, {s:1, v:7.2}] }\n];\n\n// --- generateGraphData() function has been REMOVED from this file ---\n\n/**\n * Builds a human-readable JSON report by mapping raw sample data.\n * @param {string} detectedFilename - The name of the file that was actually detected.\n * @returns {object} A final, human-readable JSON object.\n */\nfunction getRandomDemoJson(detectedFilename, fileHashes) {\n  // 1. Pick a random raw sample definition\n  const rawSample = rawSamples[Math.floor(Math.random() * rawSamples.length)];\n  const classification = CLASSIFICATION[rawSample.c];\n  \n  // 2. Map API index to the actual list of names\n  // Use empty array as default if index is bad\n  const apiImports = API_SETS[rawSample.apiSet] || [];\n\n  // 3. Build the final, readable JSON object\n  const hashValues =\n    fileHashes && fileHashes.sha256 && fileHashes.md5\n      ? fileHashes\n      : getFakeHashes(detectedFilename);\n\n  const finalJson = {\n    \"detected_filename\": detectedFilename,\n    \"file_hashes\": hashValues,\n    \"classification\": classification,\n    \"malware_family\": rawSample.fam !== undefined ? MALWARE_FAMILIES[rawSample.fam] : null,\n    \"confidence_score\": (Math.random() * (0.99 - 0.55) + 0.55).toFixed(2),\n    \"vendor\": VENDORS[rawSample.v], // This is now an object {name, icon}\n    \"key_findings\": {\n      \"file_type\": FILE_TYPES[rawSample.f], \n      \"packer_detected\": PACKERS[rawSample.p], \n      \"signature\": SIGNATURES[rawSample.s], // This is now an object {name, icon, level}\n      \"section_entropy\": rawSample.e.map(entry => ({\n        name: ENTROPY_SECTIONS[entry.s],\n        entropy: entry.v\n      })),\n      \"api_imports\": apiImports, // <-- RENAMED and simplified\n      \"key_strings\": (rawSample.c === 0) \n        ? rawSample.strings.map(index => BENIGN_STRINGS[index]) \n        : rawSample.strings.map(index => SUSPICIOUS_STRINGS[index]) \n    }\n    // 4. \"graphData\" key is GONE.\n  };\n\n  // Clean up empty fields for a tidier output\n  if (finalJson.malware_family === null) {\n    delete finalJson.malware_family;\n  }\n  if (finalJson.key_findings.api_imports.length === 0) {\n    delete finalJson.key_findings.api_imports;\n  }\n  if (finalJson.key_findings.key_strings.length === 0) {\n    delete finalJson.key_findings.key_strings;\n  }\n  \n  return finalJson;\n}\n\nmodule.exports = {\n  getRandomDemoJson\n};\n","epoch":14,"telemetryInfo":{}}],["file:///home/trang/localnsv/mAIware/scanner-worker.js::request_496bf68f-603a-4217-8f85-388427b438ef",{"uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/scanner-worker.js","external":"file:///home/trang/localnsv/mAIware/scanner-worker.js","path":"/home/trang/localnsv/mAIware/scanner-worker.js","scheme":"file"},"requestId":"request_496bf68f-603a-4217-8f85-388427b438ef","content":"const { parentPort, workerData } = require('node:worker_threads')\nlet chokidar = null\n\ntry {\n  chokidar = require('chokidar')\n} catch (err) {\n  // Fallback to fs.watch when chokidar is unavailable\n}\nconst path = require('node:path')\nconst fs = require('node:fs')\nconst fsPromises = require('node:fs').promises\nconst crypto = require('node:crypto')\nconst axios = require('axios')\nconst FormData = require('form-data')\nconst { getRandomDemoJson } = require('./jsonsamples') //\nconst { determinePeStatus } = require('./file-type-detector') //\n\nconst AI_APP_API_ENDPOINT = 'http://localhost:1234/scan' //\nconst FILE_SIZE_THRESHOLD = 50 * 1024 * 1024 * 1024 //\nconst DEFAULT_SCAN_DELAY_MS = 10000\n\nconst fileQueue = [] //\nlet isProcessing = false //\nlet activeWatcher = null //\nlet shutdownRequested = false //\n\nconst delay = (ms) => new Promise(resolve => setTimeout(resolve, ms)) //\n\nconst normalizeBoolean = (value) => {\n  if (typeof value !== 'string') {\n    return false\n  }\n\n  return ['1', 'true', 'yes', 'on'].includes(value.toLowerCase())\n}\n\nconst skipUpload = normalizeBoolean(process.env.MAIWARE_SKIP_UPLOAD)\nconst customDelay = Number.parseInt(process.env.MAIWARE_SCAN_DELAY_MS || '', 10)\nconst SCAN_DELAY_MS = Number.isFinite(customDelay) ? Math.max(0, customDelay) : DEFAULT_SCAN_DELAY_MS\n\nfunction postLog(message) {\n  parentPort.postMessage({ channel: 'log', payload: message })\n}\n\nfunction postError(message) {\n  parentPort.postMessage({ channel: 'error', payload: message })\n}\n\nasync function waitForIdle(timeoutMs = 15000) {\n  const deadline = Date.now() + timeoutMs\n\n  while ((isProcessing || fileQueue.length > 0) && Date.now() < deadline) {\n    await delay(100)\n  }\n\n  if (isProcessing || fileQueue.length > 0) {\n    postError('[Monitor] Shutdown timed out with pending work remaining.')\n  }\n}\n\nasync function processQueue() {\n  if (isProcessing || fileQueue.length === 0) {\n    return\n  }\n\n  isProcessing = true\n  const filePath = fileQueue.shift()\n  const detectedFilename = path.basename(filePath)\n\n  postLog(`[Monitor] Processing: ${detectedFilename}`)\n\n  try {\n    const stats = await fsPromises.stat(filePath)\n\n    if (stats.size < FILE_SIZE_THRESHOLD) {\n      await handleSmallFile(filePath, detectedFilename)\n    } else {\n      postLog(`[Monitor] File ${detectedFilename} is large, skipping server push.`)\n    }\n  } catch (err) {\n    postError(`[Monitor] Error processing ${filePath}: ${err.message}`)\n  } finally {\n    isProcessing = false\n    if (!shutdownRequested) {\n      processQueue()\n    }\n  }\n}\n\nasync function sendResultToServer(scanResult) {\n  const SERVER_URL = 'http://localhost:3000/api/submit-scan';\n  \n  try {\n    const response = await fetch(SERVER_URL, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(scanResult)\n    });\n    \n    if (response.ok) {\n      postLog('[Server] Scan result uploaded successfully');\n    } else {\n      postLog(`[Server] Upload failed: ${response.statusText}`);\n    }\n  } catch (error) {\n    postLog(`[Server] Failed to upload: ${error.message}`);\n  }\n}\n\nasync function handleSmallFile(filePath, detectedFilename) {\n  const uploadTask = async () => {\n    if (skipUpload) {\n      postLog(`[Push] Skipping upload for ${detectedFilename} (MAIWARE_SKIP_UPLOAD).`)\n      return\n    }\n\n    const form = new FormData()\n    form.append('file', fs.createReadStream(filePath))\n\n    try {\n      postLog(`[Push] Starting upload for ${detectedFilename}...`)\n      const response = await axios.post(AI_APP_API_ENDPOINT, form, {\n        headers: form.getHeaders(),\n      })\n      postLog(`[Push] AI App Response: ${response.status} ${JSON.stringify(response.data)}`)\n    } catch (err) {\n      postError(`[Push] AI app push failed: ${err.message}`)\n    }\n  }\n\n  const demoTask = async () => {\n    postLog(`[Scan] Scanning for ${detectedFilename}...`)\n    await delay(SCAN_DELAY_MS)\n\n    let fileHashes = null\n    try {\n      fileHashes = await computeFileHashes(filePath)\n    } catch (err) {\n      postError(`[Hash] Failed to compute hashes for ${detectedFilename}: ${err.message}`)\n    }\n\n    // Check if file is PE\n    let isPe = false\n    try {\n      const peStatus = await determinePeStatus(filePath)\n      isPe = peStatus.isPe\n      postLog(`[PE Detection] ${detectedFilename} is ${isPe ? 'a PE file' : 'not a PE file'}`)\n    } catch (err) {\n      postLog(`[PE Detection] Failed for ${detectedFilename}: ${err.message}`)\n    }\n\n    const scanResult = getRandomDemoJson(detectedFilename, fileHashes, isPe)\n\n    postLog(`[Scan] Scan completed. (Triggered by ${detectedFilename})`)\n    parentPort.postMessage({ channel: 'scan-result', payload: scanResult })\n    \n    // Send to server\n    await sendResultToServer(scanResult)\n  }\n\n  await Promise.all([\n    uploadTask(),\n    demoTask(),\n  ])\n}\n\nfunction handleDetectedFile(filePath) {\n  const detectedFilename = path.basename(filePath)\n  postLog(`[Monitor] Detected new file: ${detectedFilename}`)\n\n  parentPort.postMessage({ channel: 'scan-started', payload: detectedFilename })\n\n  fileQueue.push(filePath)\n  processQueue()\n}\n\nfunction setupWatcher(downloadPath) {\n  postLog(`[Monitor] Watching for new files in: ${downloadPath}`)\n\n  if (chokidar) {\n    activeWatcher = chokidar.watch(downloadPath, {\n      ignored: /(^|[\\/\\\\])\\..|.*\\.tmp$|.*\\.crdownload$/,\n      persistent: true,\n      ignoreInitial: true,\n      depth: 0,\n      awaitWriteFinish: {\n        stabilityThreshold: 2000,\n        pollInterval: 100\n      }\n    })\n\n    activeWatcher.on('add', handleDetectedFile)\n    return\n  }\n\n  postLog('[Monitor] chokidar not available. Falling back to fs.watch (reduced accuracy).')\n\n  const fallbackWatcher = fs.watch(downloadPath, { persistent: true }, async (eventType, filename) => {\n    if (eventType !== 'rename' || !filename) {\n      return\n    }\n\n    const candidatePath = path.join(downloadPath, filename)\n\n    try {\n      const stats = await fsPromises.stat(candidatePath)\n\n      if (stats.isFile()) {\n        handleDetectedFile(candidatePath)\n      }\n    } catch (err) {\n      // Ignore ENOENT and similar errors when files are removed quickly\n    }\n  })\n\n  activeWatcher = {\n    close: () => {\n      fallbackWatcher.close()\n      return Promise.resolve()\n    }\n  }\n}\n\nasync function closeWatcher() {\n  if (!activeWatcher) {\n    return\n  }\n\n  try {\n    await activeWatcher.close()\n    postLog('[Monitor] File watcher stopped.')\n  } catch (err) {\n    postError(`[Monitor] Failed to close watcher: ${err.message}`)\n  } finally {\n    activeWatcher = null\n  }\n}\n\nfunction queueManualScan(filePath) {\n  const normalized = path.resolve(filePath)\n  fileQueue.push(normalized)\n  postLog(`[Monitor] Manually queued file: ${normalized}`)\n  processQueue()\n}\n\nfunction computeFileHashes(filePath) {\n  return new Promise((resolve, reject) => {\n    const sha256 = crypto.createHash('sha256')\n    const md5 = crypto.createHash('md5')\n    const stream = fs.createReadStream(filePath)\n\n    stream.on('data', (chunk) => {\n      sha256.update(chunk)\n      md5.update(chunk)\n    })\n\n    stream.on('error', (err) => {\n      reject(err)\n    })\n\n    stream.on('end', () => {\n      try {\n        resolve({\n          sha256: sha256.digest('hex'),\n          md5: md5.digest('hex')\n        })\n      } catch (err) {\n        reject(err)\n      }\n    })\n  })\n}\n\nasync function handleShutdownRequest() {\n  if (shutdownRequested) {\n    return\n  }\n\n  shutdownRequested = true\n  postLog('[Monitor] Shutdown requested.')\n\n  await waitForIdle()\n  await closeWatcher()\n\n  parentPort.postMessage({ channel: 'shutdown-complete' })\n\n  setImmediate(() => {\n    try {\n      if (typeof parentPort.close === 'function') {\n        parentPort.close()\n      }\n    } catch (err) {\n      postError(`[Monitor] Failed to close parent port: ${err.message}`)\n    } finally {\n      process.exit(0)\n    }\n  })\n}\n\nif (parentPort) {\n  parentPort.on('message', (message) => {\n    if (!message || typeof message !== 'object') {\n      return\n    }\n\n    const { type, path: manualPath } = message\n\n    switch (type) {\n      case 'shutdown':\n        handleShutdownRequest().catch((err) => {\n          postError(`[Monitor] Shutdown handler failed: ${err.message}`)\n        })\n        break\n      case 'flush-queue':\n        processQueue()\n        break\n      case 'scan-path':\n        if (typeof manualPath === 'string') {\n          queueManualScan(manualPath)\n        }\n        break\n      default:\n        postLog(`[Monitor] Received unknown control message: ${type}`)\n    }\n  })\n}\n\npostLog(`[Monitor] Worker bootstrapped (pid ${process.pid}). Upload ${skipUpload ? 'disabled' : 'enabled'}, scan delay ${SCAN_DELAY_MS}ms.`)\n\nsetupWatcher(workerData.downloadPath)\n\nparentPort.postMessage({ channel: 'ready', payload: { downloadPath: workerData.downloadPath } })\n","epoch":22,"telemetryInfo":{}}],["file:///home/trang/localnsv/mAIware/scanner-worker.js::request_c4b64de9-7660-4b42-afcf-12b654c111ef",{"uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/scanner-worker.js","external":"file:///home/trang/localnsv/mAIware/scanner-worker.js","path":"/home/trang/localnsv/mAIware/scanner-worker.js","scheme":"file"},"requestId":"request_c4b64de9-7660-4b42-afcf-12b654c111ef","content":"const { parentPort, workerData } = require('node:worker_threads')\nlet chokidar = null\n\ntry {\n  chokidar = require('chokidar')\n} catch (err) {\n  // Fallback to fs.watch when chokidar is unavailable\n}\nconst path = require('node:path')\nconst fs = require('node:fs')\nconst fsPromises = require('node:fs').promises\nconst crypto = require('node:crypto')\nconst axios = require('axios')\nconst FormData = require('form-data')\nconst { getRandomDemoJson } = require('./jsonsamples') //\nconst { determinePeStatus } = require('./file-type-detector') //\n\nconst AI_APP_API_ENDPOINT = 'http://localhost:1234/scan' //\nconst FILE_SIZE_THRESHOLD = 50 * 1024 * 1024 * 1024 //\nconst DEFAULT_SCAN_DELAY_MS = 10000\n\nconst fileQueue = [] //\nlet isProcessing = false //\nlet activeWatcher = null //\nlet shutdownRequested = false //\n\nconst delay = (ms) => new Promise(resolve => setTimeout(resolve, ms)) //\n\nconst normalizeBoolean = (value) => {\n  if (typeof value !== 'string') {\n    return false\n  }\n\n  return ['1', 'true', 'yes', 'on'].includes(value.toLowerCase())\n}\n\nconst skipUpload = normalizeBoolean(process.env.MAIWARE_SKIP_UPLOAD)\nconst customDelay = Number.parseInt(process.env.MAIWARE_SCAN_DELAY_MS || '', 10)\nconst SCAN_DELAY_MS = Number.isFinite(customDelay) ? Math.max(0, customDelay) : DEFAULT_SCAN_DELAY_MS\n\nfunction postLog(message) {\n  parentPort.postMessage({ channel: 'log', payload: message })\n}\n\nfunction postError(message) {\n  parentPort.postMessage({ channel: 'error', payload: message })\n}\n\nasync function waitForIdle(timeoutMs = 15000) {\n  const deadline = Date.now() + timeoutMs\n\n  while ((isProcessing || fileQueue.length > 0) && Date.now() < deadline) {\n    await delay(100)\n  }\n\n  if (isProcessing || fileQueue.length > 0) {\n    postError('[Monitor] Shutdown timed out with pending work remaining.')\n  }\n}\n\nasync function processQueue() {\n  if (isProcessing || fileQueue.length === 0) {\n    return\n  }\n\n  isProcessing = true\n  const filePath = fileQueue.shift()\n  const detectedFilename = path.basename(filePath)\n\n  postLog(`[Monitor] Processing: ${detectedFilename}`)\n\n  try {\n    const stats = await fsPromises.stat(filePath)\n\n    if (stats.size < FILE_SIZE_THRESHOLD) {\n      await handleSmallFile(filePath, detectedFilename)\n    } else {\n      postLog(`[Monitor] File ${detectedFilename} is large, skipping server push.`)\n    }\n  } catch (err) {\n    postError(`[Monitor] Error processing ${filePath}: ${err.message}`)\n  } finally {\n    isProcessing = false\n    if (!shutdownRequested) {\n      processQueue()\n    }\n  }\n}\n\nasync function sendResultToServer(scanResult) {\n  const SERVER_URL = 'http://localhost:3000/api/submit-scan';\n  \n  try {\n    const response = await fetch(SERVER_URL, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(scanResult)\n    });\n    \n    if (response.ok) {\n      postLog('[Server] Scan result uploaded successfully');\n    } else {\n      postLog(`[Server] Upload failed: ${response.statusText}`);\n    }\n  } catch (error) {\n    postLog(`[Server] Failed to upload: ${error.message}`);\n  }\n}\n\nasync function handleSmallFile(filePath, detectedFilename) {\n  const uploadTask = async () => {\n    if (skipUpload) {\n      postLog(`[Push] Skipping upload for ${detectedFilename} (MAIWARE_SKIP_UPLOAD).`)\n      return\n    }\n\n    const form = new FormData()\n    form.append('file', fs.createReadStream(filePath))\n\n    try {\n      postLog(`[Push] Starting upload for ${detectedFilename}...`)\n      const response = await axios.post(AI_APP_API_ENDPOINT, form, {\n        headers: form.getHeaders(),\n      })\n      postLog(`[Push] AI App Response: ${response.status} ${JSON.stringify(response.data)}`)\n    } catch (err) {\n      postError(`[Push] AI app push failed: ${err.message}`)\n    }\n  }\n\n  const demoTask = async () => {\n    postLog(`[Scan] Scanning for ${detectedFilename}...`)\n    await delay(SCAN_DELAY_MS)\n\n    let fileHashes = null\n    try {\n      fileHashes = await computeFileHashes(filePath)\n    } catch (err) {\n      postError(`[Hash] Failed to compute hashes for ${detectedFilename}: ${err.message}`)\n    }\n\n    // Check if file is PE\n    let isPe = false\n    try {\n      const peStatus = await determinePeStatus(filePath)\n      isPe = peStatus.isPe\n      postLog(`[PE Detection] ${detectedFilename} is ${isPe ? 'a PE file' : 'not a PE file'}`)\n    } catch (err) {\n      postLog(`[PE Detection] Failed for ${detectedFilename}: ${err.message}`)\n    }\n\n    const scanResult = getRandomDemoJson(detectedFilename, fileHashes, isPe)\n\n    postLog(`[Scan] Scan completed. (Triggered by ${detectedFilename})`)\n    parentPort.postMessage({ channel: 'scan-result', payload: scanResult })\n    \n    // Send to server\n    await sendResultToServer(scanResult)\n  }\n\n  await Promise.all([\n    uploadTask(),\n    demoTask(),\n  ])\n}\n\nfunction handleDetectedFile(filePath) {\n  const detectedFilename = path.basename(filePath)\n  postLog(`[Monitor] Detected new file: ${detectedFilename}`)\n\n  parentPort.postMessage({ channel: 'scan-started', payload: detectedFilename })\n\n  fileQueue.push(filePath)\n  processQueue()\n}\n\nfunction setupWatcher(downloadPath) {\n  postLog(`[Monitor] Watching for new files in: ${downloadPath}`)\n\n  if (chokidar) {\n    activeWatcher = chokidar.watch(downloadPath, {\n      ignored: /(^|[\\/\\\\])\\..|.*\\.tmp$|.*\\.crdownload$/,\n      persistent: true,\n      ignoreInitial: true,\n      depth: 0,\n      awaitWriteFinish: {\n        stabilityThreshold: 2000,\n        pollInterval: 100\n      }\n    })\n\n    activeWatcher.on('add', handleDetectedFile)\n    return\n  }\n\n  postLog('[Monitor] chokidar not available. Falling back to fs.watch (reduced accuracy).')\n\n  const fallbackWatcher = fs.watch(downloadPath, { persistent: true }, async (eventType, filename) => {\n    if (eventType !== 'rename' || !filename) {\n      return\n    }\n\n    const candidatePath = path.join(downloadPath, filename)\n\n    try {\n      const stats = await fsPromises.stat(candidatePath)\n\n      if (stats.isFile()) {\n        handleDetectedFile(candidatePath)\n      }\n    } catch (err) {\n      // Ignore ENOENT and similar errors when files are removed quickly\n    }\n  })\n\n  activeWatcher = {\n    close: () => {\n      fallbackWatcher.close()\n      return Promise.resolve()\n    }\n  }\n}\n\nasync function closeWatcher() {\n  if (!activeWatcher) {\n    return\n  }\n\n  try {\n    await activeWatcher.close()\n    postLog('[Monitor] File watcher stopped.')\n  } catch (err) {\n    postError(`[Monitor] Failed to close watcher: ${err.message}`)\n  } finally {\n    activeWatcher = null\n  }\n}\n\nfunction queueManualScan(filePath) {\n  const normalized = path.resolve(filePath)\n  fileQueue.push(normalized)\n  postLog(`[Monitor] Manually queued file: ${normalized}`)\n  processQueue()\n}\n\nfunction computeFileHashes(filePath) {\n  return new Promise((resolve, reject) => {\n    const sha256 = crypto.createHash('sha256')\n    const md5 = crypto.createHash('md5')\n    const stream = fs.createReadStream(filePath)\n\n    stream.on('data', (chunk) => {\n      sha256.update(chunk)\n      md5.update(chunk)\n    })\n\n    stream.on('error', (err) => {\n      reject(err)\n    })\n\n    stream.on('end', () => {\n      try {\n        resolve({\n          sha256: sha256.digest('hex'),\n          md5: md5.digest('hex')\n        })\n      } catch (err) {\n        reject(err)\n      }\n    })\n  })\n}\n\nasync function handleShutdownRequest() {\n  if (shutdownRequested) {\n    return\n  }\n\n  shutdownRequested = true\n  postLog('[Monitor] Shutdown requested.')\n\n  await waitForIdle()\n  await closeWatcher()\n\n  parentPort.postMessage({ channel: 'shutdown-complete' })\n\n  setImmediate(() => {\n    try {\n      if (typeof parentPort.close === 'function') {\n        parentPort.close()\n      }\n    } catch (err) {\n      postError(`[Monitor] Failed to close parent port: ${err.message}`)\n    } finally {\n      process.exit(0)\n    }\n  })\n}\n\nif (parentPort) {\n  parentPort.on('message', (message) => {\n    if (!message || typeof message !== 'object') {\n      return\n    }\n\n    const { type, path: manualPath } = message\n\n    switch (type) {\n      case 'shutdown':\n        handleShutdownRequest().catch((err) => {\n          postError(`[Monitor] Shutdown handler failed: ${err.message}`)\n        })\n        break\n      case 'flush-queue':\n        processQueue()\n        break\n      case 'scan-path':\n        if (typeof manualPath === 'string') {\n          queueManualScan(manualPath)\n        }\n        break\n      default:\n        postLog(`[Monitor] Received unknown control message: ${type}`)\n    }\n  })\n}\n\npostLog(`[Monitor] Worker bootstrapped (pid ${process.pid}). Upload ${skipUpload ? 'disabled' : 'enabled'}, scan delay ${SCAN_DELAY_MS}ms.`)\n\nsetupWatcher(workerData.downloadPath)\n\nparentPort.postMessage({ channel: 'ready', payload: { downloadPath: workerData.downloadPath } })\n","epoch":26,"telemetryInfo":{}}],["file:///home/trang/localnsv/mAIware/jsonsamples.js::request_c4b64de9-7660-4b42-afcf-12b654c111ef",{"uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/jsonsamples.js","external":"file:///home/trang/localnsv/mAIware/jsonsamples.js","path":"/home/trang/localnsv/mAIware/jsonsamples.js","scheme":"file"},"requestId":"request_c4b64de9-7660-4b42-afcf-12b654c111ef","content":"const crypto = require('node:crypto');\nconst {\n  VENDORS,\n  SIGNATURES,\n  FILE_TYPES,\n  PACKERS,\n  MALWARE_FAMILIES,\n  API_SETS, \n  SUSPICIOUS_STRINGS,\n  BENIGN_STRINGS,\n  CLASSIFICATION,\n  ENTROPY_SECTIONS\n} = require('./datasrcs');\n\n// Generates fake hashes for the demo report.\nconst getFakeHashes = (filename) => {\n  const md5 = crypto.createHash('md5').update(filename + Date.now()).digest('hex');\n  const sha256 = crypto.createHash('sha256').update(filename + Date.now()).digest('hex');\n  return { md5, sha256 };\n};\n\n  // This is our list of 20 \"raw\" samples.\nconst rawSamples = [\n  // --- 8 Benign Samples (c: 0) ---\n  { name: \"vcredist_x64.exe\", c: 0, f: 0, v: 2, p: 0, s: 0, apiSet: 1, strings: [0], e: [{s:0, v:6.51}, {s:1, v:2.12}, {s:2, v:5.89}] },\n  { name: \"Notepad++.exe\", c: 0, f: 0, v: 1, p: 0, s: 2, apiSet: 0, strings: [1, 2], e: [{s:0, v:6.82}, {s:1, v:4.15}, {s:2, v:5.11}] },\n  { name: \"calc.exe\", c: 0, f: 0, v: 2, p: 0, s: 0, apiSet: 1, strings: [3], e: [{s:0, v:6.01}, {s:1, v:1.99}, {s:2, v:3.44}] },\n  { name: \"kernel32.dll\", c: 0, f: 2, v: 2, p: 0, s: 0, apiSet: 0, strings: [4, 5, 6], e: [{s:0, v:6.19}, {s:1, v:2.78}] },\n  { name: \"chrome_installer.exe\", c: 0, f: 0, v: 0, p: 0, s: 1, apiSet: 2, strings: [], e: [{s:0, v:6.7}, {s:1, v:3.5}, {s:2, v:4.9}] },\n  { name: \"putty.exe\", c: 0, f: 0, v: 10, p: 0, s: 3, apiSet: 2, strings: [7], e: [{s:0, v:6.2}, {s:1, v:2.1}] },\n  { name: \"AcroRead.exe\", c: 0, f: 0, v: 16, p: 0, s: 3, apiSet: 0, strings: [], e: [{s:0, v:6.5}, {s:1, v:4.5}, {s:2, v:5.5}] },\n  { name: \"datasheet.pdf\", c: 0, f: 4, v: 4, p: 0, s: 3, apiSet: 0, strings: [], e: [] }, // No entropy for non-PE\n\n  // --- 6 Suspicious Samples (c: 1) ---\n  { name: \"legit_tool_packed.exe\", c: 1, f: 1, v: 3, p: 1, s: 4, apiSet: 3, strings: [20, 21], e: [{s:3, v:7.98}, {s:4, v:7.95}] },\n  { name: \"downloader_obf.exe\", c: 1, f: 1, v: 14, p: 5, s: 4, apiSet: 5, strings: [11, 12], e: [{s:0, v:7.89}, {s:1, v:2.0}] },\n  { name: \"patcher.exe\", c: 1, f: 0, v: 8, p: 0, s: 4, apiSet: 4, strings: [13, 14, 15], e: [{s:0, v:6.4}, {s:1, v:5.1}, {s:5, v:7.2}] },\n  { name: \"installer.msi\", c: 1, f: 3, v: 17, p: 0, s: 3, apiSet: 6, strings: [16, 17, 18], e: [] },\n  { name: \"license_keygen.exe\", c: 1, f: 1, v: 19, p: 2, s: 6, apiSet: 4, strings: [13, 14], e: [{s:0, v:7.6}, {s:1, v:7.5}] },\n  { name: \"setup_with_adware.exe\", c: 1, f: 0, v: 11, p: 0, s: 3, apiSet: 6, strings: [18], e: [{s:0, v:6.3}, {s:2, v:5.8}] },\n  \n  // --- 6 Malware Samples (c: 2) ---\n  { name: \"invoice_8374.exe\", c: 2, f: 0, v: 5, p: 0, s: 4, apiSet: 5, strings: [0, 1], fam: 0, e: [{s:0, v:6.95}, {s:1, v:7.1}] },\n  { name: \"svchost.exe\", c: 2, f: 1, v: 6, p: 0, s: 4, apiSet: 7, strings: [2, 3], fam: 1, e: [{s:0, v:6.88}, {s:1, v:4.0}] },\n  { name: \"document.dll\", c: 2, f: 2, v: 7, p: 0, s: 4, apiSet: 8, strings: [4, 5, 6, 7], fam: 2, e: [{s:0, v:7.01}, {s:2, v:5.1}] },\n  { name: \"update.exe\", c: 2, f: 0, v: 9, p: 0, s: 4, apiSet: 6, strings: [8, 9, 10], fam: 3, e: [{s:0, v:6.75}, {s:1, v:3.1}] },\n  { name: \"javaupdate.exe\", c: 2, f: 1, v: 12, p: 3, s: 5, apiSet: 9, strings: [2, 19, 20], fam: 4, e: [{s:0, v:7.5}, {s:1, v:7.4}] },\n  { name: \"report.pdf.exe\", c: 2, f: 0, v: 13, p: 0, s: 4, apiSet: 10, strings: [0, 11, 12], fam: 7, e: [{s:0, v:6.8}, {s:1, v:7.2}] }\n];\n\n// --- generateGraphData() function has been REMOVED from this file ---\n\n/**\n * Builds a human-readable JSON report by mapping raw sample data.\n * @param {string} detectedFilename - The name of the file that was actually detected.\n * @param {object} fileHashes - The file hashes (sha256, md5).\n * @param {boolean} isPe - Whether the file is a PE file or not.\n * @returns {object} A final, human-readable JSON object.\n */\nfunction getRandomDemoJson(detectedFilename, fileHashes, isPe = true) {\n  // For non-PE files, always return benign classification with non-PE file type\n  let rawSample;\n  if (!isPe) {\n    // Use the last benign sample (datasheet.pdf) which has no entropy (non-PE)\n    rawSample = rawSamples[7]; // datasheet.pdf - benign, non-PE (c: 0, f: 4 'PDF Document', e: [])\n  } else {\n    // 1. Pick a random raw sample definition (only from PE samples)\n    rawSample = rawSamples[Math.floor(Math.random() * rawSamples.length)];\n  }\n  const classification = CLASSIFICATION[rawSample.c];\n  \n  // 2. Map API index to the actual list of names\n  // Use empty array as default if index is bad\n  const apiImports = API_SETS[rawSample.apiSet] || [];\n\n  // 3. Build the final, readable JSON object\n  const hashValues =\n    fileHashes && fileHashes.sha256 && fileHashes.md5\n      ? fileHashes\n      : getFakeHashes(detectedFilename);\n\n  const finalJson = {\n    \"detected_filename\": detectedFilename,\n    \"file_hashes\": hashValues,\n    \"classification\": classification,\n    \"malware_family\": rawSample.fam !== undefined ? MALWARE_FAMILIES[rawSample.fam] : null,\n    \"confidence_score\": (Math.random() * (0.99 - 0.55) + 0.55).toFixed(2),\n    \"vendor\": VENDORS[rawSample.v], // This is now an object {name, icon}\n    \"key_findings\": {\n      \"file_type\": FILE_TYPES[rawSample.f], \n      \"packer_detected\": PACKERS[rawSample.p], \n      \"signature\": SIGNATURES[rawSample.s], // This is now an object {name, icon, level}\n      \"section_entropy\": rawSample.e.map(entry => ({\n        name: ENTROPY_SECTIONS[entry.s],\n        entropy: entry.v\n      })),\n      \"api_imports\": apiImports, // <-- RENAMED and simplified\n      \"key_strings\": (rawSample.c === 0) \n        ? rawSample.strings.map(index => BENIGN_STRINGS[index]) \n        : rawSample.strings.map(index => SUSPICIOUS_STRINGS[index]) \n    }\n    // 4. \"graphData\" key is GONE.\n  };\n\n  // Clean up empty fields for a tidier output\n  if (finalJson.malware_family === null) {\n    delete finalJson.malware_family;\n  }\n  if (finalJson.key_findings.api_imports.length === 0) {\n    delete finalJson.key_findings.api_imports;\n  }\n  if (finalJson.key_findings.key_strings.length === 0) {\n    delete finalJson.key_findings.key_strings;\n  }\n  \n  return finalJson;\n}\n\nmodule.exports = {\n  getRandomDemoJson\n};\n","epoch":29,"telemetryInfo":{}}],["file:///home/trang/localnsv/mAIware/scanner-worker.js::request_a81df6a6-91d1-44bf-86f6-897ed9dbad49",{"uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/scanner-worker.js","external":"file:///home/trang/localnsv/mAIware/scanner-worker.js","path":"/home/trang/localnsv/mAIware/scanner-worker.js","scheme":"file"},"requestId":"request_a81df6a6-91d1-44bf-86f6-897ed9dbad49","content":"const { parentPort, workerData } = require('node:worker_threads')\nlet chokidar = null\n\ntry {\n  chokidar = require('chokidar')\n} catch (err) {\n  // Fallback to fs.watch when chokidar is unavailable\n}\nconst path = require('node:path')\nconst fs = require('node:fs')\nconst fsPromises = require('node:fs').promises\nconst crypto = require('node:crypto')\nconst axios = require('axios')\nconst FormData = require('form-data')\nconst { getRandomDemoJson } = require('./jsonsamples') //\nconst { determinePeStatus } = require('./file-type-detector') //\n\nconst AI_APP_API_ENDPOINT = 'http://localhost:1234/scan' //\nconst FILE_SIZE_THRESHOLD = 50 * 1024 * 1024 * 1024 //\nconst DEFAULT_SCAN_DELAY_MS = 10000\n\nconst fileQueue = [] //\nlet isProcessing = false //\nlet activeWatcher = null //\nlet shutdownRequested = false //\n\nconst delay = (ms) => new Promise(resolve => setTimeout(resolve, ms)) //\n\nconst normalizeBoolean = (value) => {\n  if (typeof value !== 'string') {\n    return false\n  }\n\n  return ['1', 'true', 'yes', 'on'].includes(value.toLowerCase())\n}\n\nconst skipUpload = normalizeBoolean(process.env.MAIWARE_SKIP_UPLOAD)\nconst customDelay = Number.parseInt(process.env.MAIWARE_SCAN_DELAY_MS || '', 10)\nconst SCAN_DELAY_MS = Number.isFinite(customDelay) ? Math.max(0, customDelay) : DEFAULT_SCAN_DELAY_MS\n\nfunction postLog(message) {\n  parentPort.postMessage({ channel: 'log', payload: message })\n}\n\nfunction postError(message) {\n  parentPort.postMessage({ channel: 'error', payload: message })\n}\n\nasync function waitForIdle(timeoutMs = 15000) {\n  const deadline = Date.now() + timeoutMs\n\n  while ((isProcessing || fileQueue.length > 0) && Date.now() < deadline) {\n    await delay(100)\n  }\n\n  if (isProcessing || fileQueue.length > 0) {\n    postError('[Monitor] Shutdown timed out with pending work remaining.')\n  }\n}\n\nasync function processQueue() {\n  if (isProcessing || fileQueue.length === 0) {\n    return\n  }\n\n  isProcessing = true\n  const filePath = fileQueue.shift()\n  const detectedFilename = path.basename(filePath)\n\n  postLog(`[Monitor] Processing: ${detectedFilename}`)\n\n  try {\n    const stats = await fsPromises.stat(filePath)\n\n    if (stats.size < FILE_SIZE_THRESHOLD) {\n      await handleSmallFile(filePath, detectedFilename)\n    } else {\n      postLog(`[Monitor] File ${detectedFilename} is large, skipping server push.`)\n    }\n  } catch (err) {\n    postError(`[Monitor] Error processing ${filePath}: ${err.message}`)\n  } finally {\n    isProcessing = false\n    if (!shutdownRequested) {\n      processQueue()\n    }\n  }\n}\n\nasync function sendResultToServer(scanResult) {\n  const SERVER_URL = 'http://localhost:3000/api/submit-scan';\n  \n  try {\n    const response = await fetch(SERVER_URL, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(scanResult)\n    });\n    \n    if (response.ok) {\n      postLog('[Server] Scan result uploaded successfully');\n    } else {\n      postLog(`[Server] Upload failed: ${response.statusText}`);\n    }\n  } catch (error) {\n    postLog(`[Server] Failed to upload: ${error.message}`);\n  }\n}\n\nasync function handleSmallFile(filePath, detectedFilename) {\n  const uploadTask = async () => {\n    if (skipUpload) {\n      postLog(`[Push] Skipping upload for ${detectedFilename} (MAIWARE_SKIP_UPLOAD).`)\n      return\n    }\n\n    const form = new FormData()\n    form.append('file', fs.createReadStream(filePath))\n\n    try {\n      postLog(`[Push] Starting upload for ${detectedFilename}...`)\n      const response = await axios.post(AI_APP_API_ENDPOINT, form, {\n        headers: form.getHeaders(),\n      })\n      postLog(`[Push] AI App Response: ${response.status} ${JSON.stringify(response.data)}`)\n    } catch (err) {\n      postError(`[Push] AI app push failed: ${err.message}`)\n    }\n  }\n\n  const demoTask = async () => {\n    postLog(`[Scan] Scanning for ${detectedFilename}...`)\n    await delay(SCAN_DELAY_MS)\n\n    let fileHashes = null\n    try {\n      fileHashes = await computeFileHashes(filePath)\n    } catch (err) {\n      postError(`[Hash] Failed to compute hashes for ${detectedFilename}: ${err.message}`)\n    }\n\n    // Check if file is PE\n    let isPe = false\n    try {\n      const peStatus = await determinePeStatus(filePath)\n      isPe = peStatus.isPe\n      postLog(`[PE Detection] ${detectedFilename} is ${isPe ? 'a PE file' : 'not a PE file'}`)\n    } catch (err) {\n      postLog(`[PE Detection] Failed for ${detectedFilename}: ${err.message}`)\n    }\n\n    const scanResult = getRandomDemoJson(detectedFilename, fileHashes, isPe)\n\n    postLog(`[Scan] Scan completed. (Triggered by ${detectedFilename})`)\n    parentPort.postMessage({ channel: 'scan-result', payload: scanResult })\n    \n    // Send to server\n    await sendResultToServer(scanResult)\n  }\n\n  await Promise.all([\n    uploadTask(),\n    demoTask(),\n  ])\n}\n\nfunction handleDetectedFile(filePath) {\n  const detectedFilename = path.basename(filePath)\n  postLog(`[Monitor] Detected new file: ${detectedFilename}`)\n\n  parentPort.postMessage({ channel: 'scan-started', payload: detectedFilename })\n\n  fileQueue.push(filePath)\n  processQueue()\n}\n\nfunction setupWatcher(downloadPath) {\n  postLog(`[Monitor] Watching for new files in: ${downloadPath}`)\n\n  if (chokidar) {\n    activeWatcher = chokidar.watch(downloadPath, {\n      ignored: /(^|[\\/\\\\])\\..|.*\\.tmp$|.*\\.crdownload$/,\n      persistent: true,\n      ignoreInitial: true,\n      depth: 0,\n      awaitWriteFinish: {\n        stabilityThreshold: 2000,\n        pollInterval: 100\n      }\n    })\n\n    activeWatcher.on('add', handleDetectedFile)\n    return\n  }\n\n  postLog('[Monitor] chokidar not available. Falling back to fs.watch (reduced accuracy).')\n\n  const fallbackWatcher = fs.watch(downloadPath, { persistent: true }, async (eventType, filename) => {\n    if (eventType !== 'rename' || !filename) {\n      return\n    }\n\n    const candidatePath = path.join(downloadPath, filename)\n\n    try {\n      const stats = await fsPromises.stat(candidatePath)\n\n      if (stats.isFile()) {\n        handleDetectedFile(candidatePath)\n      }\n    } catch (err) {\n      // Ignore ENOENT and similar errors when files are removed quickly\n    }\n  })\n\n  activeWatcher = {\n    close: () => {\n      fallbackWatcher.close()\n      return Promise.resolve()\n    }\n  }\n}\n\nasync function closeWatcher() {\n  if (!activeWatcher) {\n    return\n  }\n\n  try {\n    await activeWatcher.close()\n    postLog('[Monitor] File watcher stopped.')\n  } catch (err) {\n    postError(`[Monitor] Failed to close watcher: ${err.message}`)\n  } finally {\n    activeWatcher = null\n  }\n}\n\nfunction queueManualScan(filePath) {\n  const normalized = path.resolve(filePath)\n  fileQueue.push(normalized)\n  postLog(`[Monitor] Manually queued file: ${normalized}`)\n  processQueue()\n}\n\nfunction computeFileHashes(filePath) {\n  return new Promise((resolve, reject) => {\n    const sha256 = crypto.createHash('sha256')\n    const md5 = crypto.createHash('md5')\n    const stream = fs.createReadStream(filePath)\n\n    stream.on('data', (chunk) => {\n      sha256.update(chunk)\n      md5.update(chunk)\n    })\n\n    stream.on('error', (err) => {\n      reject(err)\n    })\n\n    stream.on('end', () => {\n      try {\n        resolve({\n          sha256: sha256.digest('hex'),\n          md5: md5.digest('hex')\n        })\n      } catch (err) {\n        reject(err)\n      }\n    })\n  })\n}\n\nasync function handleShutdownRequest() {\n  if (shutdownRequested) {\n    return\n  }\n\n  shutdownRequested = true\n  postLog('[Monitor] Shutdown requested.')\n\n  await waitForIdle()\n  await closeWatcher()\n\n  parentPort.postMessage({ channel: 'shutdown-complete' })\n\n  setImmediate(() => {\n    try {\n      if (typeof parentPort.close === 'function') {\n        parentPort.close()\n      }\n    } catch (err) {\n      postError(`[Monitor] Failed to close parent port: ${err.message}`)\n    } finally {\n      process.exit(0)\n    }\n  })\n}\n\nif (parentPort) {\n  parentPort.on('message', (message) => {\n    if (!message || typeof message !== 'object') {\n      return\n    }\n\n    const { type, path: manualPath } = message\n\n    switch (type) {\n      case 'shutdown':\n        handleShutdownRequest().catch((err) => {\n          postError(`[Monitor] Shutdown handler failed: ${err.message}`)\n        })\n        break\n      case 'flush-queue':\n        processQueue()\n        break\n      case 'scan-path':\n        if (typeof manualPath === 'string') {\n          queueManualScan(manualPath)\n        }\n        break\n      default:\n        postLog(`[Monitor] Received unknown control message: ${type}`)\n    }\n  })\n}\n\npostLog(`[Monitor] Worker bootstrapped (pid ${process.pid}). Upload ${skipUpload ? 'disabled' : 'enabled'}, scan delay ${SCAN_DELAY_MS}ms.`)\n\nsetupWatcher(workerData.downloadPath)\n\nparentPort.postMessage({ channel: 'ready', payload: { downloadPath: workerData.downloadPath } })\n","epoch":33,"telemetryInfo":{}}],["file:///home/trang/localnsv/mAIware-server/server.js::request_f84e9d07-b060-4595-acd7-32ca34f0d58e",{"uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware-server/server.js","external":"file:///home/trang/localnsv/mAIware-server/server.js","path":"/home/trang/localnsv/mAIware-server/server.js","scheme":"file"},"requestId":"request_f84e9d07-b060-4595-acd7-32ca34f0d58e","content":"const express = require('express');\nconst cors = require('cors');\nconst path = require('path');\n\nconst app = express();\nconst PORT = process.env.PORT || 3000;\n\n// Middleware\napp.use(cors());\napp.use(express.json({ limit: '10mb' }));\napp.use(express.static('public'));\n\n// In-memory storage (use Redis/MongoDB in production)\nconst scanResults = [];\nconst clients = new Map(); // Track active clients\nconst sseClients = []; // Track SSE connections for dashboard updates\n\n// --- API Endpoints ---\n\n// Health check\napp.get('/api/health', (req, res) => {\n    res.json({ \n        status: 'ok', \n        totalScans: scanResults.length,\n        activeClients: clients.size,\n        timestamp: new Date().toISOString() \n    });\n});\n\n// SSE endpoint for real-time dashboard updates\napp.get('/api/events', (req, res) => {\n    res.setHeader('Content-Type', 'text/event-stream');\n    res.setHeader('Cache-Control', 'no-cache');\n    res.setHeader('Connection', 'keep-alive');\n    res.flushHeaders();\n\n    // Send initial connection message\n    res.write('data: {\"type\":\"connected\"}\\n\\n');\n\n    // Add this client to the list\n    sseClients.push(res);\n\n    // Remove client on disconnect\n    req.on('close', () => {\n        const index = sseClients.indexOf(res);\n        if (index !== -1) {\n            sseClients.splice(index, 1);\n        }\n    });\n});\n\n// Submit scan result from client\napp.post('/api/submit-scan', (req, res) => {\n    try {\n        const scanData = req.body;\n        \n        // Validate required fields\n        if (!scanData.detected_filename || !scanData.classification) {\n            return res.status(400).json({ error: 'Missing required fields' });\n        }\n        \n        // Add server metadata\n        const scanEntry = {\n            ...scanData,\n            serverTimestamp: new Date().toISOString(),\n            scanId: `scan-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n            clientIp: req.ip || req.connection.remoteAddress\n        };\n        \n        // Store result\n        scanResults.unshift(scanEntry); // Add to beginning\n        \n        // Keep only last 1000 scans\n        if (scanResults.length > 1000) {\n            scanResults.pop();\n        }\n        \n        // Update client tracking\n        const clientId = scanData.systemInfo?.ip || req.ip;\n        clients.set(clientId, {\n            lastSeen: new Date().toISOString(),\n            totalScans: (clients.get(clientId)?.totalScans || 0) + 1\n        });\n        \n        console.log(` Received scan: ${scanData.detected_filename}  ${scanData.classification}`);\n        \n        // Notify all connected dashboard clients via SSE\n        const notification = JSON.stringify({ \n            type: 'new-scan', \n            scan: scanEntry \n        });\n        sseClients.forEach(client => {\n            client.write(`data: ${notification}\\n\\n`);\n        });\n        \n        res.json({ \n            success: true, \n            scanId: scanEntry.scanId,\n            message: 'Scan result recorded' \n        });\n        \n    } catch (error) {\n        console.error('Submit error:', error);\n        res.status(500).json({ error: 'Failed to record scan' });\n    }\n});\n\n// Get all scans (for dashboard)\napp.get('/api/scans', (req, res) => {\n    const limit = parseInt(req.query.limit) || 100;\n    const offset = parseInt(req.query.offset) || 0;\n    \n    const paginatedScans = scanResults.slice(offset, offset + limit);\n    \n    res.json({\n        total: scanResults.length,\n        scans: paginatedScans\n    });\n});\n\n// Get statistics\napp.get('/api/stats', (req, res) => {\n    const now = Date.now();\n    const last24h = now - 24 * 60 * 60 * 1000;\n    const last7d = now - 7 * 24 * 60 * 60 * 1000;\n    \n    const recent24h = scanResults.filter(s => \n        new Date(s.serverTimestamp).getTime() > last24h\n    );\n    \n    const recent7d = scanResults.filter(s => \n        new Date(s.serverTimestamp).getTime() > last7d\n    );\n    \n    const malwareCount = scanResults.filter(s => \n        s.classification === 'Malware'\n    ).length;\n    \n    const suspiciousCount = scanResults.filter(s => \n        s.classification === 'Suspicious'\n    ).length;\n    \n    const benignCount = scanResults.filter(s => \n        s.classification === 'Benign'\n    ).length;\n    \n    // Count active clients (seen in last 10 minutes)\n    const activeClients = Array.from(clients.values()).filter(c => \n        new Date(c.lastSeen).getTime() > now - 10 * 60 * 1000\n    ).length;\n    \n    res.json({\n        totalScans: scanResults.length,\n        scans24h: recent24h.length,\n        scans7d: recent7d.length,\n        malwareCount,\n        suspiciousCount,\n        benignCount,\n        activeClients,\n        clients: clients.size\n    });\n});\n\n// NEW: Get daily analysis data for chart\napp.get('/api/daily-scans', (req, res) => {\n    const days = parseInt(req.query.days) || 30; // Default to last 30 days\n    \n    // Create a map to store counts per day\n    const dailyCounts = new Map();\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n    \n    // Initialize the last N days with 0 counts\n    for (let i = days - 1; i >= 0; i--) {\n        const date = new Date(today);\n        date.setDate(date.getDate() - i);\n        const dateKey = date.toISOString().split('T')[0]; // YYYY-MM-DD\n        dailyCounts.set(dateKey, {\n            date: dateKey,\n            total: 0,\n            malware: 0,\n            suspicious: 0,\n            benign: 0\n        });\n    }\n    \n    // Count scans by day\n    scanResults.forEach(scan => {\n        const scanDate = new Date(scan.serverTimestamp);\n        scanDate.setHours(0, 0, 0, 0);\n        const dateKey = scanDate.toISOString().split('T')[0];\n        \n        if (dailyCounts.has(dateKey)) {\n            const counts = dailyCounts.get(dateKey);\n            counts.total++;\n            \n            if (scan.classification === 'Malware') {\n                counts.malware++;\n            } else if (scan.classification === 'Suspicious') {\n                counts.suspicious++;\n            } else if (scan.classification === 'Benign') {\n                counts.benign++;\n            }\n        }\n    });\n    \n    // Convert map to array sorted by date\n    const result = Array.from(dailyCounts.values()).sort((a, b) => \n        a.date.localeCompare(b.date)\n    );\n    \n    res.json({ days: result });\n});\n\n// Get malware source distribution\napp.get('/api/malware-sources', (req, res) => {\n    try {\n        const sources = {\n            'Email Attachment': 0,\n            'Web Download': 0,\n            'USB/External Drive': 0,\n            'Internal Network': 0,\n            'Unknown': 0\n        };\n        \n        scanResults.forEach(scan => {\n            const filename = scan.detected_filename?.toLowerCase() || '';\n            \n            // Categorize based on file patterns and extensions\n            if (filename.match(/\\.(doc|docx|xls|xlsx|pdf|zip|rar|7z)$/)) {\n                sources['Email Attachment']++;\n            } else if (filename.match(/\\.(exe|msi|dmg|pkg|deb|rpm)$/)) {\n                sources['Web Download']++;\n            } else if (filename.match(/\\.(dll|sys|bin)$/)) {\n                sources['Internal Network']++;\n            } else if (filename.match(/\\.(jpg|png|gif|mp3|mp4|avi|mov)$/)) {\n                sources['USB/External Drive']++;\n            } else {\n                sources['Unknown']++;\n            }\n        });\n        \n        // Convert to array format for Chart.js\n        const data = Object.entries(sources).map(([source, count]) => ({\n            source,\n            count\n        }));\n        \n        res.json({ sources: data });\n        \n    } catch (error) {\n        console.error('Malware sources error:', error);\n        res.status(500).json({ error: 'Failed to get malware sources' });\n    }\n});\n\n// Simple IP to location mapping for demo purposes\n// In production, use MaxMind GeoIP2 or a geolocation API service\nfunction getLocationFromIP(ip) {\n    // Handle localhost and local IPs - assign diverse demo locations\n    if (ip === '::1' || ip === '127.0.0.1' || ip.includes('::1') || ip.startsWith('127.')) {\n        // Use a consistent hash of the IP to always assign to the same location\n        const ipHash = ip.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);\n        const locationIndex = ipHash % 18;\n        const demoLocations = [\n            { lat: 37.7749, lng: -122.4194, city: 'San Francisco', country: 'USA' },\n            { lat: 40.7128, lng: -74.0060, city: 'New York', country: 'USA' },\n            { lat: 51.5074, lng: -0.1278, city: 'London', country: 'UK' },\n            { lat: 48.8566, lng: 2.3522, city: 'Paris', country: 'France' },\n            { lat: 35.6762, lng: 139.6503, city: 'Tokyo', country: 'Japan' },\n            { lat: -33.8688, lng: 151.2093, city: 'Sydney', country: 'Australia' },\n            { lat: 52.5200, lng: 13.4050, city: 'Berlin', country: 'Germany' },\n            { lat: 55.7558, lng: 37.6173, city: 'Moscow', country: 'Russia' },\n            { lat: 19.4326, lng: -99.1332, city: 'Mexico City', country: 'Mexico' },\n            { lat: -23.5505, lng: -46.6333, city: 'So Paulo', country: 'Brazil' },\n            { lat: 1.3521, lng: 103.8198, city: 'Singapore', country: 'Singapore' },\n            { lat: 25.2048, lng: 55.2708, city: 'Dubai', country: 'UAE' },\n            { lat: 28.6139, lng: 77.2090, city: 'New Delhi', country: 'India' },\n            { lat: 39.9042, lng: 116.4074, city: 'Beijing', country: 'China' },\n            { lat: 37.5665, lng: 126.9780, city: 'Seoul', country: 'South Korea' },\n            { lat: 43.6532, lng: -79.3832, city: 'Toronto', country: 'Canada' },\n            { lat: -34.6037, lng: -58.3816, city: 'Buenos Aires', country: 'Argentina' },\n            { lat: 59.3293, lng: 18.0686, city: 'Stockholm', country: 'Sweden' },\n        ];\n        return demoLocations[locationIndex];\n    }\n    \n    // Sample IP to location mapping for demo\n    const ipLocations = {\n        '192.168': { lat: 37.7749, lng: -122.4194, city: 'San Francisco', country: 'USA' },\n        '10.0': { lat: 40.7128, lng: -74.0060, city: 'New York', country: 'USA' },\n        '172.16': { lat: 51.5074, lng: -0.1278, city: 'London', country: 'UK' },\n        '172.17': { lat: 48.8566, lng: 2.3522, city: 'Paris', country: 'France' },\n        '172.18': { lat: 35.6762, lng: 139.6503, city: 'Tokyo', country: 'Japan' },\n        '172.19': { lat: -33.8688, lng: 151.2093, city: 'Sydney', country: 'Australia' },\n        '172.20': { lat: 52.5200, lng: 13.4050, city: 'Berlin', country: 'Germany' },\n        '172.21': { lat: 55.7558, lng: 37.6173, city: 'Moscow', country: 'Russia' },\n        '172.22': { lat: 19.4326, lng: -99.1332, city: 'Mexico City', country: 'Mexico' },\n        '172.23': { lat: -23.5505, lng: -46.6333, city: 'So Paulo', country: 'Brazil' },\n    };\n    \n    // Default locations for common IP patterns\n    const defaultLocations = [\n        { lat: 1.3521, lng: 103.8198, city: 'Singapore', country: 'Singapore' },\n        { lat: 25.2048, lng: 55.2708, city: 'Dubai', country: 'UAE' },\n        { lat: 28.6139, lng: 77.2090, city: 'New Delhi', country: 'India' },\n        { lat: 39.9042, lng: 116.4074, city: 'Beijing', country: 'China' },\n        { lat: 37.5665, lng: 126.9780, city: 'Seoul', country: 'South Korea' },\n        { lat: 43.6532, lng: -79.3832, city: 'Toronto', country: 'Canada' },\n        { lat: -34.6037, lng: -58.3816, city: 'Buenos Aires', country: 'Argentina' },\n        { lat: 59.3293, lng: 18.0686, city: 'Stockholm', country: 'Sweden' },\n    ];\n    \n    // Check for known IP prefixes\n    for (const [prefix, location] of Object.entries(ipLocations)) {\n        if (ip.startsWith(prefix)) {\n            return location;\n        }\n    }\n    \n    // For unknown IPs, assign a random location from defaults\n    const hash = ip.split('.').reduce((acc, part) => acc + parseInt(part || 0), 0);\n    return defaultLocations[hash % defaultLocations.length];\n}\n\n// Get geographic data for IP addresses with malware detections\napp.get('/api/geo-data', (req, res) => {\n    try {\n        // Group scans by IP address\n        const ipData = new Map();\n        \n        scanResults.forEach(scan => {\n            const ip = scan.systemInfo?.ip || scan.clientIp || 'Unknown';\n            \n            if (ip === 'Unknown') {\n                return; // Skip unknown addresses\n            }\n            \n            if (!ipData.has(ip)) {\n                const location = getLocationFromIP(ip);\n                ipData.set(ip, {\n                    ip: ip,\n                    location: location,\n                    scans: [],\n                    malwareCount: 0,\n                    suspiciousCount: 0,\n                    benignCount: 0,\n                    totalScans: 0\n                });\n            }\n            \n            const data = ipData.get(ip);\n            data.scans.push({\n                filename: scan.detected_filename,\n                classification: scan.classification,\n                timestamp: scan.serverTimestamp\n            });\n            data.totalScans++;\n            \n            if (scan.classification === 'Malware') {\n                data.malwareCount++;\n            } else if (scan.classification === 'Suspicious') {\n                data.suspiciousCount++;\n            } else if (scan.classification === 'Benign') {\n                data.benignCount++;\n            }\n        });\n        \n        // Convert map to array\n        const geoDataArray = Array.from(ipData.values());\n        \n        res.json({\n            total: geoDataArray.length,\n            locations: geoDataArray\n        });\n        \n    } catch (error) {\n        console.error('Geo data error:', error);\n        res.status(500).json({ error: 'Failed to get geographic data' });\n    }\n});\n\n// Get threat vector correlations for the interactive graph\napp.get('/api/threat-correlations', (req, res) => {\n    try {\n        const nodes = [];\n        const links = [];\n        const nodeMap = new Map();\n        let nodeId = 0;\n        \n        // Helper to get or create node\n        const getNodeId = (label, type, group) => {\n            const key = `${type}:${label}`;\n            if (!nodeMap.has(key)) {\n                const id = nodeId++;\n                nodeMap.set(key, id);\n                nodes.push({\n                    id,\n                    label,\n                    type,\n                    group,\n                    count: 0,\n                    details: []\n                });\n            }\n            return nodeMap.get(key);\n        };\n        \n        // Process all scans and build relationships\n        const malwareFamilies = new Map();\n        \n        scanResults.forEach(scan => {\n            const family = scan.malware_family || (scan.classification === 'Malware' ? 'Unknown Malware' : null);\n            if (!family) return;\n            \n            const agentId = scan.systemInfo?.hostname || scan.clientIp || 'Unknown Agent';\n            \n            // Get or create malware family node\n            const familyId = getNodeId(family, 'malware', 1);\n            const familyNode = nodes.find(n => n.id === familyId);\n            familyNode.count++;\n            familyNode.details.push(scan.detected_filename);\n            \n            // Track family data for correlation\n            if (!malwareFamilies.has(family)) {\n                malwareFamilies.set(family, {\n                    agents: new Set(),\n                    apis: new Map(),\n                    strings: new Map(),\n                    files: []\n                });\n            }\n            const familyData = malwareFamilies.get(family);\n            familyData.agents.add(agentId);\n            familyData.files.push(scan.detected_filename);\n            \n            // Create agent node and link\n            const agentNodeId = getNodeId(agentId, 'agent', 2);\n            const agentNode = nodes.find(n => n.id === agentNodeId);\n            agentNode.count++;\n            links.push({\n                source: familyId,\n                target: agentNodeId,\n                type: 'detected_by',\n                strength: 2\n            });\n            \n            // Process API imports\n            const apis = scan.key_findings?.api_imports || [];\n            apis.forEach(api => {\n                const apiId = getNodeId(api, 'api', 3);\n                const apiNode = nodes.find(n => n.id === apiId);\n                apiNode.count++;\n                \n                // Track API frequency for this family\n                const apiCount = familyData.apis.get(api) || 0;\n                familyData.apis.set(api, apiCount + 1);\n                \n                // Link malware to API (avoid duplicates)\n                if (!links.find(l => l.source === familyId && l.target === apiId)) {\n                    links.push({\n                        source: familyId,\n                        target: apiId,\n                        type: 'uses_api',\n                        strength: 1\n                    });\n                }\n            });\n            \n            // Process suspicious strings\n            const strings = scan.key_findings?.key_strings || [];\n            strings.slice(0, 3).forEach(str => { // Limit to top 3 to avoid clutter\n                const strId = getNodeId(str.substring(0, 50), 'string', 4);\n                const strNode = nodes.find(n => n.id === strId);\n                strNode.count++;\n                \n                const strCount = familyData.strings.get(str) || 0;\n                familyData.strings.set(str, strCount + 1);\n                \n                if (!links.find(l => l.source === familyId && l.target === strId)) {\n                    links.push({\n                        source: familyId,\n                        target: strId,\n                        type: 'contains_string',\n                        strength: 1\n                    });\n                }\n            });\n        });\n        \n        // Create correlations between malware families that share common traits\n        const familyNodes = nodes.filter(n => n.type === 'malware');\n        for (let i = 0; i < familyNodes.length; i++) {\n            for (let j = i + 1; j < familyNodes.length; j++) {\n                const family1 = familyNodes[i].label;\n                const family2 = familyNodes[j].label;\n                const data1 = malwareFamilies.get(family1);\n                const data2 = malwareFamilies.get(family2);\n                \n                // Check for shared agents\n                const sharedAgents = [...data1.agents].filter(a => data2.agents.has(a));\n                \n                if (sharedAgents.length > 0) {\n                    links.push({\n                        source: familyNodes[i].id,\n                        target: familyNodes[j].id,\n                        type: 'correlated_with',\n                        strength: sharedAgents.length\n                    });\n                }\n            }\n        }\n        \n        res.json({\n            nodes,\n            links,\n            metadata: {\n                totalNodes: nodes.length,\n                totalLinks: links.length,\n                malwareFamilies: familyNodes.length\n            }\n        });\n        \n    } catch (error) {\n        console.error('Threat correlations error:', error);\n        res.status(500).json({ error: 'Failed to get threat correlations' });\n    }\n});\n\n// Get Emerging Threat Intelligence - Top IOCs and threats\napp.get('/api/emerging-threats', (req, res) => {\n    try {\n        // Aggregators for different IOC types\n        const malwareFamilies = new Map();\n        const suspiciousAPIs = new Map();\n        const maliciousStrings = new Map();\n        const packers = new Map();\n        \n        // Track threat severity and recency\n        const now = Date.now();\n        const last24h = now - 24 * 60 * 60 * 1000;\n        \n        scanResults.forEach(scan => {\n            const timestamp = new Date(scan.serverTimestamp).getTime();\n            const isRecent = timestamp > last24h;\n            const weight = isRecent ? 2 : 1; // Recent threats weigh more\n            \n            // Only aggregate from Malware and Suspicious classifications\n            if (scan.classification === 'Malware' || scan.classification === 'Suspicious') {\n                \n                // Aggregate Malware Families\n                if (scan.malware_family) {\n                    const family = scan.malware_family;\n                    const current = malwareFamilies.get(family) || { \n                        count: 0, \n                        recent: 0, \n                        severity: scan.classification === 'Malware' ? 3 : 2,\n                        files: [],\n                        agents: new Set()\n                    };\n                    current.count += weight;\n                    if (isRecent) current.recent++;\n                    current.files.push(scan.detected_filename);\n                    current.agents.add(scan.systemInfo?.hostname || scan.clientIp);\n                    malwareFamilies.set(family, current);\n                }\n                \n                // Aggregate Suspicious APIs\n                const apis = scan.key_findings?.api_imports || [];\n                apis.forEach(api => {\n                    const current = suspiciousAPIs.get(api) || { \n                        count: 0, \n                        recent: 0,\n                        families: new Set() \n                    };\n                    current.count += weight;\n                    if (isRecent) current.recent++;\n                    if (scan.malware_family) current.families.add(scan.malware_family);\n                    suspiciousAPIs.set(api, current);\n                });\n                \n                // Aggregate Malicious Strings\n                const strings = scan.key_findings?.key_strings || [];\n                strings.forEach(str => {\n                    const current = maliciousStrings.get(str) || { \n                        count: 0, \n                        recent: 0,\n                        families: new Set() \n                    };\n                    current.count += weight;\n                    if (isRecent) current.recent++;\n                    if (scan.malware_family) current.families.add(scan.malware_family);\n                    maliciousStrings.set(str, current);\n                });\n                \n                // Aggregate Packers\n                const packer = scan.key_findings?.packer_detected;\n                if (packer && packer !== 'None') {\n                    const current = packers.get(packer) || { \n                        count: 0, \n                        recent: 0,\n                        families: new Set() \n                    };\n                    current.count += weight;\n                    if (isRecent) current.recent++;\n                    if (scan.malware_family) current.families.add(scan.malware_family);\n                    packers.set(packer, current);\n                }\n            }\n        });\n        \n        // Helper to convert Map to sorted array\n        const toTopN = (map, n = 5) => {\n            return Array.from(map.entries())\n                .map(([name, data]) => ({\n                    name,\n                    count: data.count,\n                    recent: data.recent,\n                    severity: data.severity || 2,\n                    details: data.families ? Array.from(data.families) : \n                            (data.files ? data.files.slice(0, 3) : []),\n                    agents: data.agents ? data.agents.size : 0\n                }))\n                .sort((a, b) => {\n                    // Sort by: recent activity, then count, then severity\n                    if (b.recent !== a.recent) return b.recent - a.recent;\n                    if (b.count !== a.count) return b.count - a.count;\n                    return (b.severity || 0) - (a.severity || 0);\n                })\n                .slice(0, n);\n        };\n        \n        res.json({\n            timestamp: new Date().toISOString(),\n            topMalwareFamilies: toTopN(malwareFamilies, 5),\n            topSuspiciousAPIs: toTopN(suspiciousAPIs, 5),\n            topMaliciousStrings: toTopN(maliciousStrings, 5),\n            topPackers: toTopN(packers, 5),\n            summary: {\n                totalThreats: scanResults.filter(s => \n                    s.classification === 'Malware' || s.classification === 'Suspicious'\n                ).length,\n                recentThreats: scanResults.filter(s => {\n                    const timestamp = new Date(s.serverTimestamp).getTime();\n                    return (timestamp > last24h) && \n                           (s.classification === 'Malware' || s.classification === 'Suspicious');\n                }).length\n            }\n        });\n        \n    } catch (error) {\n        console.error('Emerging threats error:', error);\n        res.status(500).json({ error: 'Failed to get emerging threats' });\n    }\n});\n\n// Threat Modeler - Simulate analysis of hypothetical malware\napp.post('/api/threat-model', (req, res) => {\n    try {\n        const { fileType, packer, signature, apiImports, keyStrings } = req.body;\n        \n        // Validate inputs\n        if (!fileType || !packer || !signature || !apiImports || !keyStrings) {\n            return res.status(400).json({ error: 'Missing required parameters' });\n        }\n        \n        // Create a synthetic scan result based on the threat profile\n        const crypto = require('crypto');\n        const timestamp = Date.now();\n        const randomHash = crypto.randomBytes(32).toString('hex');\n        \n        // Determine classification based on threat indicators\n        let classification = 'Benign';\n        let confidence = 0.55;\n        let malwareFamily = null;\n        \n        // Scoring system\n        let threatScore = 0;\n        \n        // Packer increases threat score\n        if (packer !== 'None') threatScore += 25;\n        \n        // Signature evaluation\n        if (signature.includes('Not Signed') || signature.includes('Self-Signed')) {\n            threatScore += 20;\n        }\n        \n        // API analysis - check for malicious APIs\n        const maliciousAPIs = ['CreateRemoteThread', 'WriteProcessMemory', 'VirtualAllocEx', \n                               'SetWindowsHookExW', 'URLDownloadToFileW', 'NtInjectThread'];\n        const maliciousAPICount = apiImports.filter(api => \n            maliciousAPIs.some(mal => api.includes(mal))\n        ).length;\n        threatScore += maliciousAPICount * 15;\n        \n        // String analysis - check for malicious strings\n        const maliciousKeywords = ['keylog', 'steal', 'crack', 'patch', 'disable', \n                                   'powershell', 'encrypted', 'ransom', 'payload'];\n        const maliciousStringCount = keyStrings.filter(str => \n            maliciousKeywords.some(keyword => str.toLowerCase().includes(keyword))\n        ).length;\n        threatScore += maliciousStringCount * 20;\n        \n        // Determine classification\n        if (threatScore >= 60) {\n            classification = 'Malware';\n            confidence = 0.85 + (Math.min(threatScore, 100) / 100) * 0.14;\n            \n            // Assign malware family based on characteristics\n            if (keyStrings.some(s => s.toLowerCase().includes('keylog'))) {\n                malwareFamily = 'Spyware.Win32.Keylogger';\n            } else if (apiImports.includes('CreateRemoteThread') || apiImports.includes('WriteProcessMemory')) {\n                malwareFamily = 'Trojan.Downloader.Win32';\n            } else if (keyStrings.some(s => s.toLowerCase().includes('encrypt') || s.toLowerCase().includes('ransom'))) {\n                malwareFamily = 'Ransomware.Win32.Locky';\n            } else if (apiImports.includes('URLDownloadToFileW')) {\n                malwareFamily = 'Dropper.Win32.Emotet';\n            } else {\n                malwareFamily = 'Masquerader.Win32.Agent';\n            }\n        } else if (threatScore >= 30) {\n            classification = 'Suspicious';\n            confidence = 0.65 + (threatScore / 100) * 0.25;\n        } else {\n            classification = 'Benign';\n            confidence = 0.55 + Math.random() * 0.25;\n        }\n        \n        // Build the synthetic scan result\n        const syntheticScan = {\n            detected_filename: `threat_model_${timestamp}.exe`,\n            file_hashes: {\n                sha256: randomHash,\n                md5: crypto.createHash('md5').update(randomHash).digest('hex')\n            },\n            classification,\n            malware_family: malwareFamily,\n            confidence_score: confidence.toFixed(2),\n            vendor: { name: 'mAIware Threat Modeler', icon: 'fas fa-flask' },\n            key_findings: {\n                file_type: fileType,\n                packer_detected: packer,\n                signature: { \n                    name: signature, \n                    icon: signature.includes('Verified') ? 'fas fa-check-shield' : 'fas fa-times-circle',\n                    level: signature.includes('Verified') ? 'verified' : 'untrusted'\n                },\n                api_imports: apiImports,\n                key_strings: keyStrings,\n                threat_score: threatScore\n            },\n            serverTimestamp: new Date().toISOString(),\n            scanId: `model-${timestamp}`,\n            clientIp: req.ip || 'Threat Modeler',\n            isSimulated: true\n        };\n        \n        // Store in scan results\n        scanResults.unshift(syntheticScan);\n        if (scanResults.length > 1000) {\n            scanResults.pop();\n        }\n        \n        // Notify all SSE clients\n        const notification = JSON.stringify({ \n            type: 'new-scan', \n            scan: syntheticScan \n        });\n        sseClients.forEach(client => {\n            client.write(`data: ${notification}\\n\\n`);\n        });\n        \n        console.log(` Threat Model analyzed: ${classification} (${confidence.toFixed(2)} confidence)`);\n        \n        res.json({\n            success: true,\n            result: syntheticScan\n        });\n        \n    } catch (error) {\n        console.error('Threat model error:', error);\n        res.status(500).json({ error: 'Failed to analyze threat model' });\n    }\n});\n\n// Serve dashboard HTML\napp.get('/', (req, res) => {\n    res.sendFile(path.join(__dirname, 'public', 'dashboard.html'));\n});\n\n// Start server\napp.listen(PORT, () => {\n    console.log(`  mAIware Server Dashboard running on http://localhost:${PORT}`);\n    console.log(` Dashboard: http://localhost:${PORT}`);\n    console.log(` API endpoint: http://localhost:${PORT}/api/submit-scan`);\n});\n\n// Cleanup old client entries every hour\nsetInterval(() => {\n    const oneHourAgo = Date.now() - 60 * 60 * 1000;\n    for (const [clientId, data] of clients.entries()) {\n        if (new Date(data.lastSeen).getTime() < oneHourAgo) {\n            clients.delete(clientId);\n        }\n    }\n}, 60 * 60 * 1000);","epoch":37,"telemetryInfo":{}}],["file:///home/trang/localnsv/mAIware-server/public/dashboard.html::request_f84e9d07-b060-4595-acd7-32ca34f0d58e",{"uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware-server/public/dashboard.html","external":"file:///home/trang/localnsv/mAIware-server/public/dashboard.html","path":"/home/trang/localnsv/mAIware-server/public/dashboard.html","scheme":"file"},"requestId":"request_f84e9d07-b060-4595-acd7-32ca34f0d58e","content":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>mAIware Server Dashboard</title>\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css\">\n    <link rel=\"stylesheet\" href=\"styles.css\">\n    <!-- Add Chart.js -->\n    <script src=\"https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js\"></script>\n    <!-- Add Leaflet.js for maps -->\n    <link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.9.4/dist/leaflet.css\" />\n    <script src=\"https://unpkg.com/leaflet@1.9.4/dist/leaflet.js\"></script>\n    <!-- Add D3.js for force-directed graph -->\n    <script src=\"https://d3js.org/d3.v7.min.js\"></script>\n</head>\n<body>\n    <div class=\"container\">\n        <header>\n            <h1><i class=\"fas fa-shield-virus\"></i> mAIware Server</h1>\n            <p class=\"subtitle\">Real-time Malware Analysis Dashboard</p>\n        </header>\n        \n        <div class=\"stats-grid\" id=\"stats-grid\">\n            <div class=\"stat-card info\">\n                <i class=\"fas fa-laptop\"></i>\n                <span class=\"stat-number\" id=\"stat-clients\">0</span>\n                <span class=\"stat-label\">Active Clients</span>\n            </div>\n            <div class=\"stat-card info\">\n                <i class=\"fas fa-chart-line\"></i>\n                <span class=\"stat-number\" id=\"stat-total\">0</span>\n                <span class=\"stat-label\">Total Scans</span>\n            </div>\n            <div class=\"stat-card malware\">\n                <i class=\"fas fa-bug\"></i>\n                <span class=\"stat-number\" id=\"stat-malware\">0</span>\n                <span class=\"stat-label\">Malware</span>\n            </div>\n            <div class=\"stat-card suspicious\">\n                <i class=\"fas fa-exclamation-triangle\"></i>\n                <span class=\"stat-number\" id=\"stat-suspicious\">0</span>\n                <span class=\"stat-label\">Suspicious</span>\n            </div>\n            <div class=\"stat-card benign\">\n                <i class=\"fas fa-check-circle\"></i>\n                <span class=\"stat-number\" id=\"stat-benign\">0</span>\n                <span class=\"stat-label\">Benign</span>\n            </div>\n        </div>\n        \n        <!-- NEW: Emerging Threat Intelligence Panel -->\n        <div class=\"eti-container\">\n            <div class=\"eti-header\">\n                <h2><i class=\"fas fa-exclamation-triangle\"></i> Emerging Threat Intelligence (ETI)</h2>\n                <p class=\"eti-subtitle\">Real-time actionable intelligence on active threats and indicators of compromise</p>\n                <div class=\"eti-summary\">\n                    <span class=\"eti-badge\" id=\"eti-total\">0 Total Threats</span>\n                    <span class=\"eti-badge recent\" id=\"eti-recent\">0 Last 24h</span>\n                </div>\n            </div>\n            \n            <div class=\"eti-grid\">\n                <div class=\"eti-panel\">\n                    <h3><i class=\"fas fa-virus\"></i> Top Malware Families</h3>\n                    <div class=\"eti-subtitle-small\">Most active malware families detected</div>\n                    <div id=\"eti-malware\" class=\"eti-list\"></div>\n                </div>\n                \n                <div class=\"eti-panel\">\n                    <h3><i class=\"fas fa-code\"></i> Top Suspicious APIs</h3>\n                    <div class=\"eti-subtitle-small\">Most frequently called malicious APIs</div>\n                    <div id=\"eti-apis\" class=\"eti-list\"></div>\n                </div>\n                \n                <div class=\"eti-panel\">\n                    <h3><i class=\"fas fa-terminal\"></i> Top Malicious Strings</h3>\n                    <div class=\"eti-subtitle-small\">Most common IOC strings and commands</div>\n                    <div id=\"eti-strings\" class=\"eti-list\"></div>\n                </div>\n                \n                <div class=\"eti-panel\">\n                    <h3><i class=\"fas fa-shield-alt\"></i> Top Packers/Obfuscators</h3>\n                    <div class=\"eti-subtitle-small\">Most used evasion techniques</div>\n                    <div id=\"eti-packers\" class=\"eti-list\"></div>\n                </div>\n            </div>\n        </div>\n        \n        <!-- NEW: Threat Modeler Panel -->\n        <div class=\"modeler-container\">\n            <div class=\"modeler-header\">\n                <h2><i class=\"fas fa-flask\"></i> Predictive Threat Modeler</h2>\n                <p class=\"modeler-subtitle\">Build hypothetical malware and predict how mAIware would classify it</p>\n            </div>\n            \n            <div class=\"modeler-grid\">\n                <div class=\"modeler-builder\">\n                    <h3><i class=\"fas fa-cogs\"></i> Threat Configuration</h3>\n                    \n                    <div class=\"modeler-field\">\n                        <label>File Type</label>\n                        <select id=\"model-filetype\" class=\"modeler-select\">\n                            <option>PE32+ (GUI) x86-64</option>\n                            <option>PE32 (Console) Intel 80386</option>\n                            <option>PE32+ DLL x86-64</option>\n                            <option>MSI Installer</option>\n                            <option>PDF Document</option>\n                        </select>\n                    </div>\n                    \n                    <div class=\"modeler-field\">\n                        <label>Packer/Obfuscator</label>\n                        <select id=\"model-packer\" class=\"modeler-select\">\n                            <option>None</option>\n                            <option>UPX</option>\n                            <option>VMProtect</option>\n                            <option>Themida</option>\n                            <option>ASPack</option>\n                            <option>Unknown (High Entropy)</option>\n                        </select>\n                    </div>\n                    \n                    <div class=\"modeler-field\">\n                        <label>Digital Signature</label>\n                        <select id=\"model-signature\" class=\"modeler-select\">\n                            <option>Verified (Microsoft Corporation)</option>\n                            <option>Verified (Google LLC)</option>\n                            <option>Verified (Unknown Publisher)</option>\n                            <option>Not Signed</option>\n                            <option>Expired Certificate</option>\n                            <option>Self-Signed (Untrusted)</option>\n                        </select>\n                    </div>\n                    \n                    <div class=\"modeler-field\">\n                        <label>API Imports (select multiple)</label>\n                        <select id=\"model-apis\" class=\"modeler-select\" multiple size=\"6\">\n                            <option>CreateRemoteThread</option>\n                            <option>WriteProcessMemory</option>\n                            <option>VirtualAllocEx</option>\n                            <option>SetWindowsHookExW</option>\n                            <option>URLDownloadToFileW</option>\n                            <option>WinExec</option>\n                            <option>RegSetValueExW</option>\n                            <option>CryptEncrypt</option>\n                            <option>Socket</option>\n                            <option>ReadFile</option>\n                        </select>\n                        <small class=\"modeler-hint\">Hold Ctrl/Cmd to select multiple</small>\n                    </div>\n                    \n                    <div class=\"modeler-field\">\n                        <label>Suspicious Strings (select multiple)</label>\n                        <select id=\"model-strings\" class=\"modeler-select\" multiple size=\"6\">\n                            <option>http://bad-c2-server.com/payload.dat</option>\n                            <option>keylog.txt</option>\n                            <option>steal_passwords</option>\n                            <option>powershell -enc</option>\n                            <option>vssadmin.exe delete shadows</option>\n                            <option>HOW_TO_DECRYPT.txt</option>\n                            <option>crack</option>\n                            <option>patch</option>\n                            <option>disable_antivirus</option>\n                        </select>\n                        <small class=\"modeler-hint\">Hold Ctrl/Cmd to select multiple</small>\n                    </div>\n                    \n                    <button class=\"modeler-analyze-btn\" onclick=\"analyzeThreatModel()\">\n                        <i class=\"fas fa-brain\"></i> ANALYZE THREAT\n                    </button>\n                </div>\n                \n                <div class=\"modeler-results\">\n                    <h3><i class=\"fas fa-chart-line\"></i> Prediction Results</h3>\n                    <div id=\"modeler-output\" class=\"modeler-output\">\n                        <div class=\"modeler-placeholder\">\n                            <i class=\"fas fa-arrow-left\"></i>\n                            <p>Configure a threat profile and click ANALYZE to see predictions</p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        \n        <div class=\"scans-container\">\n            <div class=\"scans-header\">\n                <h2>Recent Scans</h2>\n                <button class=\"refresh-btn\" onclick=\"manualRefresh()\">\n                    <i class=\"fas fa-sync-alt\"></i> Refresh\n                </button>\n            </div>\n            \n            <table class=\"scans-table\">\n                <thead>\n                    <tr>\n                        <th>Timestamp</th>\n                        <th>Filename</th>\n                        <th>Classification</th>\n                        <th>Client IP</th>\n                        <th>Hash (SHA256)</th>\n                    </tr>\n                </thead>\n                <tbody id=\"scans-tbody\">\n                    <tr>\n                        <td colspan=\"5\" class=\"empty-state\">\n                            <i class=\"fas fa-inbox\"></i>\n                            <p>No scans yet. Waiting for clients...</p>\n                        </td>\n                    </tr>\n                </tbody>\n            </table>\n        </div>\n        \n        <!-- NEW: Daily Analysis Chart -->\n        <div class=\"chart-container\">\n            <div class=\"chart-header\">\n                <h2>Daily Analysis Trends (Last 30 Days)</h2>\n                <div class=\"chart-controls\">\n                    <button class=\"chart-btn active\" onclick=\"setChartDays(7)\">7 Days</button>\n                    <button class=\"chart-btn\" onclick=\"setChartDays(14)\">14 Days</button>\n                    <button class=\"chart-btn\" onclick=\"setChartDays(30)\">30 Days</button>\n                </div>\n            </div>\n            <canvas id=\"dailyScansChart\"></canvas>\n        </div>\n        \n        <!-- NEW: Geographic Distribution Map -->\n        <div class=\"map-container\">\n            <div class=\"map-header\">\n                <h2><i class=\"fas fa-globe\"></i> Geographic Distribution of Detections</h2>\n                <div class=\"map-legend\">\n                    <span class=\"legend-item\"><span class=\"legend-dot malware-dot\"></span> Malware</span>\n                    <span class=\"legend-item\"><span class=\"legend-dot suspicious-dot\"></span> Suspicious</span>\n                    <span class=\"legend-item\"><span class=\"legend-dot benign-dot\"></span> Benign</span>\n                </div>\n            </div>\n            <div id=\"worldMap\" style=\"height: 500px; border-radius: 8px;\"></div>\n        </div>\n        \n        <!-- NEW: Malware Source Distribution Pie Chart -->\n        <div class=\"chart-container\" style=\"margin-top: 24px;\">\n            <div class=\"chart-header\">\n                <h2><i class=\"fas fa-chart-pie\"></i> Malware Source Distribution</h2>\n            </div>\n            <div style=\"max-width: 500px; margin: 0 auto;\">\n                <canvas id=\"malwareSourceChart\"></canvas>\n            </div>\n        </div>\n        \n        <!-- NEW: Threat Vector Correlation Explorer -->\n        <div class=\"correlation-container\">\n            <div class=\"correlation-header\">\n                <h2><i class=\"fas fa-project-diagram\"></i> Threat Vector Correlation Explorer</h2>\n                <p class=\"correlation-subtitle\">Interactive intelligence map showing relationships between malware families, agents, APIs, and indicators</p>\n            </div>\n            <div class=\"graph-controls\">\n                <button class=\"graph-btn\" onclick=\"resetGraph()\"><i class=\"fas fa-sync\"></i> Reset View</button>\n                <button class=\"graph-btn\" onclick=\"centerGraph()\"><i class=\"fas fa-compress\"></i> Center</button>\n                <div class=\"graph-legend\">\n                    <span class=\"legend-item\"><span class=\"node-sample malware-node\"></span> Malware Family</span>\n                    <span class=\"legend-item\"><span class=\"node-sample agent-node\"></span> Agent/System</span>\n                    <span class=\"legend-item\"><span class=\"node-sample api-node\"></span> API Call</span>\n                    <span class=\"legend-item\"><span class=\"node-sample string-node\"></span> Suspicious String</span>\n                </div>\n            </div>\n            <div id=\"correlationGraph\"></div>\n            <div id=\"nodeDetails\" class=\"node-details\" style=\"display: none;\">\n                <h3 id=\"detailsTitle\"></h3>\n                <div id=\"detailsContent\"></div>\n            </div>\n        </div>\n    </div>\n    \n    <script>\n        let dailyChart = null;\n        let currentChartDays = 30;\n        \n        async function loadStats() {\n            try {\n                const response = await fetch('/api/stats');\n                const stats = await response.json();\n                \n                document.getElementById('stat-clients').textContent = stats.activeClients;\n                document.getElementById('stat-total').textContent = stats.totalScans;\n                document.getElementById('stat-malware').textContent = stats.malwareCount;\n                document.getElementById('stat-suspicious').textContent = stats.suspiciousCount;\n                document.getElementById('stat-benign').textContent = stats.benignCount;\n            } catch (error) {\n                console.error('Failed to load stats:', error);\n            }\n        }\n        \n        async function loadScans() {\n            try {\n                const response = await fetch('/api/scans?limit=50');\n                const data = await response.json();\n                \n                const tbody = document.getElementById('scans-tbody');\n                \n                if (data.scans.length === 0) {\n                    tbody.innerHTML = `\n                        <tr>\n                            <td colspan=\"5\" class=\"empty-state\">\n                                <i class=\"fas fa-inbox\"></i>\n                                <p>No scans yet. Waiting for clients...</p>\n                            </td>\n                        </tr>\n                    `;\n                    return;\n                }\n                \n                tbody.innerHTML = data.scans.map(scan => {\n                    const timestamp = new Date(scan.serverTimestamp).toLocaleString();\n                    const hash = scan.file_hashes?.sha256 || 'N/A';\n                    const hashShort = hash.substring(0, 16) + '...';\n                    const classification = scan.classification || 'Unknown';\n                    const badgeClass = classification.toLowerCase();\n                    \n                    return `\n                        <tr>\n                            <td>${timestamp}</td>\n                            <td>${scan.detected_filename}</td>\n                            <td><span class=\"badge ${badgeClass}\">${classification}</span></td>\n                            <td>${scan.systemInfo?.ip || scan.clientIp || 'Unknown'}</td>\n                            <td class=\"hash\" title=\"${hash}\">${hashShort}</td>\n                        </tr>\n                    `;\n                }).join('');\n                \n            } catch (error) {\n                console.error('Failed to load scans:', error);\n            }\n        }\n        \n        async function loadDailyChart() {\n            try {\n                const response = await fetch(`/api/daily-scans?days=${currentChartDays}`);\n                const data = await response.json();\n                \n                const ctx = document.getElementById('dailyScansChart');\n                \n                // Destroy existing chart if it exists\n                if (dailyChart) {\n                    dailyChart.destroy();\n                }\n                \n                // Format dates for display (MM/DD)\n                const labels = data.days.map(day => {\n                    const date = new Date(day.date);\n                    return `${date.getMonth() + 1}/${date.getDate()}`;\n                });\n                \n                dailyChart = new Chart(ctx, {\n                    type: 'line',\n                    data: {\n                        labels: labels,\n                        datasets: [\n                            {\n                                label: 'Total Scans',\n                                data: data.days.map(d => d.total),\n                                borderColor: '#5a9cf8',\n                                backgroundColor: 'rgba(90, 156, 248, 0.1)',\n                                fill: true,\n                                tension: 0.4,\n                                borderWidth: 2\n                            },\n                            {\n                                label: 'Malware',\n                                data: data.days.map(d => d.malware),\n                                borderColor: '#ff4757',\n                                backgroundColor: 'rgba(255, 71, 87, 0.1)',\n                                fill: true,\n                                tension: 0.4,\n                                borderWidth: 2\n                            },\n                            {\n                                label: 'Suspicious',\n                                data: data.days.map(d => d.suspicious),\n                                borderColor: '#ffa502',\n                                backgroundColor: 'rgba(255, 165, 2, 0.1)',\n                                fill: true,\n                                tension: 0.4,\n                                borderWidth: 2\n                            },\n                            {\n                                label: 'Benign',\n                                data: data.days.map(d => d.benign),\n                                borderColor: '#26de81',\n                                backgroundColor: 'rgba(38, 222, 129, 0.1)',\n                                fill: true,\n                                tension: 0.4,\n                                borderWidth: 2\n                            }\n                        ]\n                    },\n                    options: {\n                        responsive: true,\n                        maintainAspectRatio: false,\n                        interaction: {\n                            mode: 'index',\n                            intersect: false,\n                        },\n                        plugins: {\n                            legend: {\n                                labels: {\n                                    color: '#e0e0e0',\n                                    font: { size: 12 }\n                                }\n                            },\n                            tooltip: {\n                                backgroundColor: 'rgba(0, 0, 0, 0.8)',\n                                titleColor: '#fff',\n                                bodyColor: '#e0e0e0',\n                                borderColor: 'rgba(255, 255, 255, 0.1)',\n                                borderWidth: 1\n                            }\n                        },\n                        scales: {\n                            x: {\n                                ticks: { \n                                    color: '#888',\n                                    maxRotation: 45,\n                                    minRotation: 45\n                                },\n                                grid: { \n                                    color: 'rgba(255, 255, 255, 0.05)' \n                                }\n                            },\n                            y: {\n                                beginAtZero: true,\n                                ticks: { \n                                    color: '#888',\n                                    stepSize: 1\n                                },\n                                grid: { \n                                    color: 'rgba(255, 255, 255, 0.05)' \n                                }\n                            }\n                        }\n                    }\n                });\n                \n            } catch (error) {\n                console.error('Failed to load daily chart:', error);\n            }\n        }\n        \n        let worldMap = null;\n        let markerLayer = null;\n        let mapInitialized = false;\n        let lastGeoDataHash = '';\n        let sourceChart = null;\n        \n        function initializeMap() {\n            if (mapInitialized) return;\n            \n            try {\n                worldMap = L.map('worldMap', {\n                    zoomControl: true,\n                    scrollWheelZoom: true\n                }).setView([20, 0], 2);\n                \n                // Use dark theme tiles\n                L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {\n                    attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors &copy; <a href=\"https://carto.com/attributions\">CARTO</a>',\n                    subdomains: 'abcd',\n                    maxZoom: 19\n                }).addTo(worldMap);\n                \n                markerLayer = L.layerGroup().addTo(worldMap);\n                mapInitialized = true;\n            } catch (error) {\n                console.error('Failed to initialize map:', error);\n            }\n        }\n        \n        async function loadGeoMap() {\n            try {\n                // Initialize map only once\n                if (!mapInitialized) {\n                    initializeMap();\n                }\n                \n                if (!markerLayer) return;\n                \n                const response = await fetch('/api/geo-data');\n                const data = await response.json();\n                \n                // Generate hash of current data to detect changes\n                const currentHash = JSON.stringify(data.locations.map(l => \n                    `${l.ip}-${l.totalScans}-${l.malwareCount}-${l.suspiciousCount}`\n                )).substring(0, 100);\n                \n                // Skip update if data hasn't changed\n                if (currentHash === lastGeoDataHash && markerLayer.getLayers().length > 0) {\n                    return;\n                }\n                lastGeoDataHash = currentHash;\n                \n                // Clear existing markers\n                markerLayer.clearLayers();\n                \n                // Add markers for each location\n                data.locations.forEach(location => {\n                    const { lat, lng, city, country } = location.location;\n                    \n                    // Determine marker color based on severity\n                    let markerColor = '#26de81'; // benign (green)\n                    let primaryClassification = 'Benign';\n                    \n                    if (location.malwareCount > 0) {\n                        markerColor = '#ff4757'; // malware (red)\n                        primaryClassification = 'Malware';\n                    } else if (location.suspiciousCount > 0) {\n                        markerColor = '#ffa502'; // suspicious (orange)\n                        primaryClassification = 'Suspicious';\n                    }\n                    \n                    // Calculate marker size based on total scans (min 8, max 24)\n                    const markerSize = Math.min(24, Math.max(8, 8 + location.totalScans * 2));\n                    \n                    // Create custom circular marker\n                    const marker = L.circleMarker([lat, lng], {\n                        radius: markerSize / 2,\n                        fillColor: markerColor,\n                        color: '#fff',\n                        weight: 2,\n                        opacity: 0.8,\n                        fillOpacity: 0.6\n                    });\n                    \n                    // Create popup content\n                    const popupContent = `\n                        <div style=\"color: #333; min-width: 200px;\">\n                            <h3 style=\"margin: 0 0 10px 0; color: #1a1a1a; font-size: 1.1rem;\">\n                                <i class=\"fas fa-map-marker-alt\" style=\"color: ${markerColor};\"></i>\n                                ${city}, ${country}\n                            </h3>\n                            <p style=\"margin: 5px 0; color: #555;\"><strong>IP:</strong> ${location.ip}</p>\n                            <p style=\"margin: 5px 0; color: #555;\"><strong>Total Scans:</strong> ${location.totalScans}</p>\n                            <div style=\"margin-top: 10px;\">\n                                <div style=\"margin: 3px 0;\">\n                                    <span style=\"color: #ff4757;\"></span> Malware: ${location.malwareCount}\n                                </div>\n                                <div style=\"margin: 3px 0;\">\n                                    <span style=\"color: #ffa502;\"></span> Suspicious: ${location.suspiciousCount}\n                                </div>\n                                <div style=\"margin: 3px 0;\">\n                                    <span style=\"color: #26de81;\"></span> Benign: ${location.benignCount}\n                                </div>\n                            </div>\n                            ${location.scans.length > 0 ? `\n                                <div style=\"margin-top: 10px; padding-top: 10px; border-top: 1px solid #ddd;\">\n                                    <strong>Recent Detections:</strong>\n                                    <ul style=\"margin: 5px 0; padding-left: 20px; font-size: 0.85rem;\">\n                                        ${location.scans.slice(0, 3).map(scan => `\n                                            <li style=\"margin: 2px 0;\">\n                                                ${scan.filename} \n                                                <span style=\"color: ${\n                                                    scan.classification === 'Malware' ? '#ff4757' : \n                                                    scan.classification === 'Suspicious' ? '#ffa502' : '#26de81'\n                                                };\">(${scan.classification})</span>\n                                            </li>\n                                        `).join('')}\n                                        ${location.scans.length > 3 ? `<li>...and ${location.scans.length - 3} more</li>` : ''}\n                                    </ul>\n                                </div>\n                            ` : ''}\n                        </div>\n                    `;\n                    \n                    marker.bindPopup(popupContent);\n                    marker.addTo(markerLayer);\n                    \n                    // Add hover effect\n                    marker.on('mouseover', function() {\n                        this.setStyle({\n                            fillOpacity: 0.9,\n                            opacity: 1\n                        });\n                    });\n                    \n                    marker.on('mouseout', function() {\n                        this.setStyle({\n                            fillOpacity: 0.6,\n                            opacity: 0.8\n                        });\n                    });\n                });\n                \n                console.log(`Map updated with ${data.locations.length} locations`);\n                \n            } catch (error) {\n                console.error('Failed to load geo map:', error);\n            }\n        }\n        \n        async function loadMalwareSources() {\n            try {\n                const response = await fetch('/api/malware-sources');\n                const data = await response.json();\n                \n                const ctx = document.getElementById('malwareSourceChart');\n                \n                // Destroy existing chart if it exists\n                if (sourceChart) {\n                    sourceChart.destroy();\n                }\n                \n                const labels = data.sources.map(s => s.source);\n                const counts = data.sources.map(s => s.count);\n                \n                // Color scheme for different sources\n                const colors = [\n                    '#ff6b6b', // Email Attachment - red\n                    '#4ecdc4', // Web Download - teal\n                    '#ffe66d', // USB/External Drive - yellow\n                    '#a8dadc', // Internal Network - light blue\n                    '#95a5a6'  // Unknown - gray\n                ];\n                \n                sourceChart = new Chart(ctx, {\n                    type: 'pie',\n                    data: {\n                        labels: labels,\n                        datasets: [{\n                            data: counts,\n                            backgroundColor: colors,\n                            borderColor: '#1a1a2e',\n                            borderWidth: 2\n                        }]\n                    },\n                    options: {\n                        responsive: true,\n                        maintainAspectRatio: true,\n                        plugins: {\n                            legend: {\n                                position: 'bottom',\n                                labels: {\n                                    color: '#e0e0e0',\n                                    font: { size: 12 },\n                                    padding: 15\n                                }\n                            },\n                            tooltip: {\n                                backgroundColor: 'rgba(0, 0, 0, 0.8)',\n                                titleColor: '#fff',\n                                bodyColor: '#e0e0e0',\n                                borderColor: 'rgba(255, 255, 255, 0.1)',\n                                borderWidth: 1,\n                                callbacks: {\n                                    label: function(context) {\n                                        const label = context.label || '';\n                                        const value = context.parsed || 0;\n                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);\n                                        const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : 0;\n                                        return `${label}: ${value} (${percentage}%)`;\n                                    }\n                                }\n                            }\n                        }\n                    }\n                });\n                \n            } catch (error) {\n                console.error('Failed to load malware sources:', error);\n            }\n        }\n        \n        async function loadEmergingThreats() {\n            try {\n                const response = await fetch('/api/emerging-threats');\n                const data = await response.json();\n                \n                // Update summary badges\n                document.getElementById('eti-total').textContent = \n                    `${data.summary.totalThreats} Total Threats`;\n                document.getElementById('eti-recent').textContent = \n                    `${data.summary.recentThreats} Last 24h`;\n                \n                // Helper to render IOC list\n                const renderIOCList = (items, container) => {\n                    if (items.length === 0) {\n                        container.innerHTML = '<div class=\"eti-empty\">No threats detected</div>';\n                        return;\n                    }\n                    \n                    container.innerHTML = items.map((item, index) => {\n                        const rank = index + 1;\n                        const recentBadge = item.recent > 0 ? \n                            `<span class=\"eti-recent-badge\">${item.recent} recent</span>` : '';\n                        const agentBadge = item.agents > 0 ? \n                            `<span class=\"eti-agent-badge\">${item.agents} agents</span>` : '';\n                        \n                        return `\n                            <div class=\"eti-item\" data-rank=\"${rank}\">\n                                <div class=\"eti-rank\">${rank}</div>\n                                <div class=\"eti-content\">\n                                    <div class=\"eti-name\">${item.name}</div>\n                                    <div class=\"eti-meta\">\n                                        <span class=\"eti-count\">${item.count} occurrences</span>\n                                        ${recentBadge}\n                                        ${agentBadge}\n                                    </div>\n                                    ${item.details && item.details.length > 0 ? `\n                                        <div class=\"eti-details\">\n                                            ${item.details.slice(0, 2).join(', ')}\n                                            ${item.details.length > 2 ? '...' : ''}\n                                        </div>\n                                    ` : ''}\n                                </div>\n                            </div>\n                        `;\n                    }).join('');\n                };\n                \n                // Render each section\n                renderIOCList(data.topMalwareFamilies, document.getElementById('eti-malware'));\n                renderIOCList(data.topSuspiciousAPIs, document.getElementById('eti-apis'));\n                renderIOCList(data.topMaliciousStrings, document.getElementById('eti-strings'));\n                renderIOCList(data.topPackers, document.getElementById('eti-packers'));\n                \n            } catch (error) {\n                console.error('Failed to load emerging threats:', error);\n            }\n        }\n        \n        async function analyzeThreatModel() {\n            try {\n                // Get selected values\n                const fileType = document.getElementById('model-filetype').value;\n                const packer = document.getElementById('model-packer').value;\n                const signature = document.getElementById('model-signature').value;\n                \n                // Get multiple selections\n                const apisSelect = document.getElementById('model-apis');\n                const apiImports = Array.from(apisSelect.selectedOptions).map(opt => opt.value);\n                \n                const stringsSelect = document.getElementById('model-strings');\n                const keyStrings = Array.from(stringsSelect.selectedOptions).map(opt => opt.value);\n                \n                // Validate\n                if (apiImports.length === 0) {\n                    alert('Please select at least one API import');\n                    return;\n                }\n                if (keyStrings.length === 0) {\n                    alert('Please select at least one suspicious string');\n                    return;\n                }\n                \n                // Show loading state\n                const outputDiv = document.getElementById('modeler-output');\n                outputDiv.innerHTML = `\n                    <div class=\"modeler-loading\">\n                        <i class=\"fas fa-spinner fa-spin\"></i>\n                        <p>Analyzing threat profile...</p>\n                    </div>\n                `;\n                \n                // Send to server\n                const response = await fetch('/api/threat-model', {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({\n                        fileType,\n                        packer,\n                        signature,\n                        apiImports,\n                        keyStrings\n                    })\n                });\n                \n                const data = await response.json();\n                \n                if (data.success) {\n                    const result = data.result;\n                    const classColor = \n                        result.classification === 'Malware' ? '#ff4757' :\n                        result.classification === 'Suspicious' ? '#ffa502' : '#26de81';\n                    \n                    outputDiv.innerHTML = `\n                        <div class=\"prediction-result\">\n                            <div class=\"prediction-header\">\n                                <div class=\"prediction-badge\" style=\"background: ${classColor};\">\n                                    ${result.classification.toUpperCase()}\n                                </div>\n                                <div class=\"prediction-confidence\">\n                                    <div class=\"confidence-label\">Confidence Score</div>\n                                    <div class=\"confidence-value\">${(parseFloat(result.confidence_score) * 100).toFixed(1)}%</div>\n                                </div>\n                            </div>\n                            \n                            ${result.malware_family ? `\n                                <div class=\"prediction-family\">\n                                    <strong>Predicted Malware Family:</strong>\n                                    <span class=\"family-name\">${result.malware_family}</span>\n                                </div>\n                            ` : ''}\n                            \n                            <div class=\"prediction-section\">\n                                <h4>Threat Analysis</h4>\n                                <div class=\"analysis-item\">\n                                    <i class=\"fas fa-file\"></i>\n                                    <span><strong>File Type:</strong> ${result.key_findings.file_type}</span>\n                                </div>\n                                <div class=\"analysis-item\">\n                                    <i class=\"fas fa-box\"></i>\n                                    <span><strong>Packer:</strong> ${result.key_findings.packer_detected}</span>\n                                </div>\n                                <div class=\"analysis-item\">\n                                    <i class=\"fas fa-certificate\"></i>\n                                    <span><strong>Signature:</strong> ${result.key_findings.signature.name}</span>\n                                </div>\n                                <div class=\"analysis-item\">\n                                    <i class=\"fas fa-tachometer-alt\"></i>\n                                    <span><strong>Threat Score:</strong> ${result.key_findings.threat_score}/100</span>\n                                </div>\n                            </div>\n                            \n                            <div class=\"prediction-section\">\n                                <h4>Detected Indicators</h4>\n                                <div class=\"indicator-group\">\n                                    <strong>API Imports:</strong>\n                                    <div class=\"indicator-list\">\n                                        ${result.key_findings.api_imports.map(api => \n                                            `<span class=\"indicator-tag api-tag\">${api}</span>`\n                                        ).join('')}\n                                    </div>\n                                </div>\n                                <div class=\"indicator-group\">\n                                    <strong>Suspicious Strings:</strong>\n                                    <div class=\"indicator-list\">\n                                        ${result.key_findings.key_strings.map(str => \n                                            `<span class=\"indicator-tag string-tag\">${str}</span>`\n                                        ).join('')}\n                                    </div>\n                                </div>\n                            </div>\n                            \n                            <div class=\"prediction-footer\">\n                                <i class=\"fas fa-info-circle\"></i>\n                                This analysis has been added to the scan results and will appear in all visualizations.\n                            </div>\n                        </div>\n                    `;\n                } else {\n                    outputDiv.innerHTML = `\n                        <div class=\"modeler-error\">\n                            <i class=\"fas fa-exclamation-circle\"></i>\n                            <p>Analysis failed: ${data.error}</p>\n                        </div>\n                    `;\n                }\n                \n            } catch (error) {\n                console.error('Failed to analyze threat model:', error);\n                document.getElementById('modeler-output').innerHTML = `\n                    <div class=\"modeler-error\">\n                        <i class=\"fas fa-exclamation-circle\"></i>\n                        <p>Analysis failed. Please try again.</p>\n                    </div>\n                `;\n            }\n        }\n        \n        let graphSimulation = null;\n        let graphSvg = null;\n        \n        async function loadCorrelationGraph() {\n            try {\n                const response = await fetch('/api/threat-correlations');\n                const data = await response.json();\n                \n                // Clear existing graph\n                d3.select('#correlationGraph').selectAll('*').remove();\n                \n                const container = document.getElementById('correlationGraph');\n                const width = container.clientWidth;\n                const height = 600;\n                \n                // Create SVG\n                graphSvg = d3.select('#correlationGraph')\n                    .append('svg')\n                    .attr('width', width)\n                    .attr('height', height)\n                    .style('background', '#0a0a0a')\n                    .style('border-radius', '8px');\n                \n                const g = graphSvg.append('g');\n                \n                // Add zoom behavior\n                const zoom = d3.zoom()\n                    .scaleExtent([0.1, 4])\n                    .on('zoom', (event) => {\n                        g.attr('transform', event.transform);\n                    });\n                \n                graphSvg.call(zoom);\n                \n                // Color schemes for different node types\n                const colorMap = {\n                    malware: '#ff4757',\n                    agent: '#5a9cf8',\n                    api: '#ffa502',\n                    string: '#26de81'\n                };\n                \n                // Create force simulation\n                graphSimulation = d3.forceSimulation(data.nodes)\n                    .force('link', d3.forceLink(data.links)\n                        .id(d => d.id)\n                        .distance(d => d.type === 'correlated_with' ? 200 : 100)\n                        .strength(d => d.strength * 0.3))\n                    .force('charge', d3.forceManyBody().strength(-300))\n                    .force('center', d3.forceCenter(width / 2, height / 2))\n                    .force('collision', d3.forceCollide().radius(30));\n                \n                // Draw links\n                const link = g.append('g')\n                    .selectAll('line')\n                    .data(data.links)\n                    .enter()\n                    .append('line')\n                    .attr('stroke', d => {\n                        if (d.type === 'correlated_with') return '#ff6b6b';\n                        if (d.type === 'detected_by') return '#5a9cf8';\n                        if (d.type === 'uses_api') return '#ffa502';\n                        return '#26de81';\n                    })\n                    .attr('stroke-width', d => Math.sqrt(d.strength) + 1)\n                    .attr('stroke-opacity', 0.6);\n                \n                // Draw nodes\n                const node = g.append('g')\n                    .selectAll('circle')\n                    .data(data.nodes)\n                    .enter()\n                    .append('circle')\n                    .attr('r', d => {\n                        if (d.type === 'malware') return 15 + Math.min(d.count * 2, 15);\n                        if (d.type === 'agent') return 12 + Math.min(d.count, 10);\n                        return 8 + Math.min(d.count, 8);\n                    })\n                    .attr('fill', d => colorMap[d.type])\n                    .attr('stroke', '#fff')\n                    .attr('stroke-width', 2)\n                    .style('cursor', 'pointer')\n                    .call(d3.drag()\n                        .on('start', dragstarted)\n                        .on('drag', dragged)\n                        .on('end', dragended))\n                    .on('click', (event, d) => showNodeDetails(d, data))\n                    .on('mouseover', function(event, d) {\n                        d3.select(this)\n                            .transition()\n                            .duration(200)\n                            .attr('stroke-width', 4)\n                            .attr('r', function() {\n                                const currentR = parseFloat(d3.select(this).attr('r'));\n                                return currentR * 1.3;\n                            });\n                    })\n                    .on('mouseout', function(event, d) {\n                        d3.select(this)\n                            .transition()\n                            .duration(200)\n                            .attr('stroke-width', 2)\n                            .attr('r', function() {\n                                if (d.type === 'malware') return 15 + Math.min(d.count * 2, 15);\n                                if (d.type === 'agent') return 12 + Math.min(d.count, 10);\n                                return 8 + Math.min(d.count, 8);\n                            });\n                    });\n                \n                // Add labels\n                const label = g.append('g')\n                    .selectAll('text')\n                    .data(data.nodes)\n                    .enter()\n                    .append('text')\n                    .text(d => d.label.length > 20 ? d.label.substring(0, 20) + '...' : d.label)\n                    .attr('font-size', d => d.type === 'malware' ? '12px' : '10px')\n                    .attr('fill', '#e0e0e0')\n                    .attr('text-anchor', 'middle')\n                    .attr('dy', d => {\n                        if (d.type === 'malware') return 35;\n                        if (d.type === 'agent') return 25;\n                        return 20;\n                    })\n                    .style('pointer-events', 'none')\n                    .style('font-weight', d => d.type === 'malware' ? 'bold' : 'normal');\n                \n                // Update positions on simulation tick\n                graphSimulation.on('tick', () => {\n                    link\n                        .attr('x1', d => d.source.x)\n                        .attr('y1', d => d.source.y)\n                        .attr('x2', d => d.target.x)\n                        .attr('y2', d => d.target.y);\n                    \n                    node\n                        .attr('cx', d => d.x)\n                        .attr('cy', d => d.y);\n                    \n                    label\n                        .attr('x', d => d.x)\n                        .attr('y', d => d.y);\n                });\n                \n                // Drag functions\n                function dragstarted(event, d) {\n                    if (!event.active) graphSimulation.alphaTarget(0.3).restart();\n                    d.fx = d.x;\n                    d.fy = d.y;\n                }\n                \n                function dragged(event, d) {\n                    d.fx = event.x;\n                    d.fy = event.y;\n                }\n                \n                function dragended(event, d) {\n                    if (!event.active) graphSimulation.alphaTarget(0);\n                    d.fx = null;\n                    d.fy = null;\n                }\n                \n                console.log(`Correlation graph loaded: ${data.nodes.length} nodes, ${data.links.length} links`);\n                \n            } catch (error) {\n                console.error('Failed to load correlation graph:', error);\n            }\n        }\n        \n        function showNodeDetails(node, graphData) {\n            const detailsPanel = document.getElementById('nodeDetails');\n            const detailsTitle = document.getElementById('detailsTitle');\n            const detailsContent = document.getElementById('detailsContent');\n            \n            detailsTitle.textContent = node.label;\n            \n            let html = `<p><strong>Type:</strong> ${node.type.toUpperCase()}</p>`;\n            html += `<p><strong>Occurrences:</strong> ${node.count}</p>`;\n            \n            // Find connections\n            const connections = graphData.links.filter(l => \n                l.source.id === node.id || l.target.id === node.id\n            );\n            \n            if (connections.length > 0) {\n                html += `<p><strong>Connections:</strong> ${connections.length}</p>`;\n                html += '<ul style=\"margin: 10px 0; padding-left: 20px;\">';\n                connections.slice(0, 10).forEach(link => {\n                    const otherNode = link.source.id === node.id ? link.target : link.source;\n                    html += `<li>${link.type.replace(/_/g, ' ')}: ${otherNode.label}</li>`;\n                });\n                if (connections.length > 10) {\n                    html += `<li>...and ${connections.length - 10} more</li>`;\n                }\n                html += '</ul>';\n            }\n            \n            if (node.details && node.details.length > 0) {\n                html += '<p><strong>Associated Files:</strong></p>';\n                html += '<ul style=\"margin: 10px 0; padding-left: 20px; max-height: 150px; overflow-y: auto;\">';\n                node.details.slice(0, 10).forEach(file => {\n                    html += `<li>${file}</li>`;\n                });\n                if (node.details.length > 10) {\n                    html += `<li>...and ${node.details.length - 10} more</li>`;\n                }\n                html += '</ul>';\n            }\n            \n            detailsContent.innerHTML = html;\n            detailsPanel.style.display = 'block';\n        }\n        \n        function resetGraph() {\n            if (graphSimulation) {\n                graphSimulation.alpha(1).restart();\n            }\n        }\n        \n        function centerGraph() {\n            if (graphSvg) {\n                graphSvg.transition().duration(750).call(\n                    d3.zoom().transform,\n                    d3.zoomIdentity\n                );\n            }\n        }\n        \n        function setChartDays(days) {\n            currentChartDays = days;\n            \n            // Update button states\n            document.querySelectorAll('.chart-btn').forEach(btn => {\n                btn.classList.remove('active');\n            });\n            event.target.classList.add('active');\n            \n            loadDailyChart();\n        }\n        \n        function loadData() {\n            loadStats();\n            loadScans();\n            loadDailyChart();\n            loadMalwareSources();\n            loadEmergingThreats();\n            loadCorrelationGraph();\n            loadGeoMap();\n        }\n        \n        function loadDataWithoutMap() {\n            loadStats();\n            loadScans();\n            loadDailyChart();\n            loadMalwareSources();\n            loadEmergingThreats();\n            loadCorrelationGraph();\n        }\n        \n        // Initial load\n        loadData();\n        \n        // Set up Server-Sent Events for real-time updates\n        const eventSource = new EventSource('/api/events');\n        \n        eventSource.onmessage = function(event) {\n            const data = JSON.parse(event.data);\n            \n            if (data.type === 'connected') {\n                console.log('Connected to server for real-time updates');\n            } else if (data.type === 'new-scan') {\n                console.log('New scan received:', data.scan.detected_filename);\n                // Reload all data when new scan arrives\n                loadDataWithoutMap();\n                // Update map less frequently (only if it's been more than 10 seconds)\n                if (!window.lastMapUpdate || Date.now() - window.lastMapUpdate > 10000) {\n                    loadGeoMap();\n                    window.lastMapUpdate = Date.now();\n                }\n            }\n        };\n        \n        eventSource.onerror = function(error) {\n            console.error('SSE Error:', error);\n            // Fallback: reload data every 30 seconds if SSE connection fails\n            if (eventSource.readyState === EventSource.CLOSED) {\n                console.log('SSE connection closed, falling back to polling...');\n                setInterval(loadDataWithoutMap, 30000);\n            }\n        };\n        \n        // Manual refresh button functionality\n        window.manualRefresh = function() {\n            loadData();\n        };\n    </script>\n</body>\n</html>","epoch":40,"telemetryInfo":{}}],["file:///home/trang/localnsv/mAIware-server/public/styles.css::request_f84e9d07-b060-4595-acd7-32ca34f0d58e",{"uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware-server/public/styles.css","external":"file:///home/trang/localnsv/mAIware-server/public/styles.css","path":"/home/trang/localnsv/mAIware-server/public/styles.css","scheme":"file"},"requestId":"request_f84e9d07-b060-4595-acd7-32ca34f0d58e","content":"* { \n    margin: 0; \n    padding: 0; \n    box-sizing: border-box; \n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);\n    color: #e0e0e0;\n    min-height: 100vh;\n    padding: 2rem;\n}\n\n.container {\n    max-width: 1400px;\n    margin: 0 auto;\n}\n\nheader {\n    text-align: center;\n    margin-bottom: 3rem;\n}\n\nh1 {\n    font-size: 2.5rem;\n    color: #5a9cf8;\n    margin-bottom: 0.5rem;\n}\n\n.subtitle {\n    color: #888;\n    font-size: 1.1rem;\n}\n\n.stats-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n    gap: 1.5rem;\n    margin-bottom: 3rem;\n}\n\n/* Emerging Threat Intelligence Panel */\n.eti-container {\n    background: linear-gradient(135deg, rgba(255, 71, 87, 0.1) 0%, rgba(255, 165, 2, 0.1) 100%);\n    border: 2px solid rgba(255, 71, 87, 0.3);\n    border-radius: 12px;\n    padding: 24px;\n    margin-bottom: 3rem;\n    box-shadow: 0 4px 16px rgba(255, 71, 87, 0.2);\n}\n\n.eti-header {\n    margin-bottom: 24px;\n}\n\n.eti-header h2 {\n    margin: 0 0 8px 0;\n    font-size: 1.8rem;\n    color: #ff6b6b;\n    text-shadow: 0 2px 4px rgba(255, 71, 87, 0.3);\n}\n\n.eti-header h2 i {\n    color: #ff4757;\n    margin-right: 10px;\n    animation: pulse 2s infinite;\n}\n\n@keyframes pulse {\n    0%, 100% { opacity: 1; }\n    50% { opacity: 0.6; }\n}\n\n.eti-subtitle {\n    color: #b0b0b0;\n    font-size: 0.95rem;\n    margin: 8px 0 16px 0;\n}\n\n.eti-summary {\n    display: flex;\n    gap: 12px;\n    flex-wrap: wrap;\n}\n\n.eti-badge {\n    background: rgba(90, 156, 248, 0.2);\n    border: 1px solid rgba(90, 156, 248, 0.4);\n    color: #5a9cf8;\n    padding: 6px 14px;\n    border-radius: 20px;\n    font-size: 0.85rem;\n    font-weight: 600;\n}\n\n.eti-badge.recent {\n    background: rgba(255, 71, 87, 0.2);\n    border-color: rgba(255, 71, 87, 0.4);\n    color: #ff6b6b;\n}\n\n.eti-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));\n    gap: 20px;\n}\n\n.eti-panel {\n    background: rgba(0, 0, 0, 0.3);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: 10px;\n    padding: 18px;\n    transition: transform 0.3s, box-shadow 0.3s;\n}\n\n.eti-panel:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);\n}\n\n.eti-panel h3 {\n    margin: 0 0 6px 0;\n    font-size: 1.1rem;\n    color: #e0e0e0;\n}\n\n.eti-panel h3 i {\n    color: #ffa502;\n    margin-right: 8px;\n}\n\n.eti-subtitle-small {\n    color: #888;\n    font-size: 0.8rem;\n    margin-bottom: 14px;\n}\n\n.eti-list {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n}\n\n.eti-item {\n    display: flex;\n    gap: 12px;\n    background: rgba(255, 255, 255, 0.03);\n    border: 1px solid rgba(255, 255, 255, 0.08);\n    border-radius: 8px;\n    padding: 12px;\n    transition: all 0.3s;\n}\n\n.eti-item:hover {\n    background: rgba(255, 255, 255, 0.06);\n    border-color: rgba(255, 165, 2, 0.4);\n    transform: translateX(4px);\n}\n\n.eti-rank {\n    flex-shrink: 0;\n    width: 32px;\n    height: 32px;\n    background: linear-gradient(135deg, #ff6b6b, #ffa502);\n    border-radius: 50%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-weight: bold;\n    font-size: 1rem;\n    color: #fff;\n    box-shadow: 0 2px 8px rgba(255, 107, 107, 0.4);\n}\n\n.eti-item[data-rank=\"1\"] .eti-rank {\n    background: linear-gradient(135deg, #ff4757, #ff6348);\n    transform: scale(1.1);\n}\n\n.eti-content {\n    flex: 1;\n    min-width: 0;\n}\n\n.eti-name {\n    font-weight: 600;\n    color: #e0e0e0;\n    font-size: 0.95rem;\n    margin-bottom: 4px;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n}\n\n.eti-meta {\n    display: flex;\n    gap: 8px;\n    flex-wrap: wrap;\n    align-items: center;\n}\n\n.eti-count {\n    color: #888;\n    font-size: 0.8rem;\n}\n\n.eti-recent-badge {\n    background: rgba(255, 71, 87, 0.2);\n    border: 1px solid rgba(255, 71, 87, 0.4);\n    color: #ff6b6b;\n    padding: 2px 8px;\n    border-radius: 10px;\n    font-size: 0.75rem;\n    font-weight: 600;\n}\n\n.eti-agent-badge {\n    background: rgba(90, 156, 248, 0.2);\n    border: 1px solid rgba(90, 156, 248, 0.4);\n    color: #5a9cf8;\n    padding: 2px 8px;\n    border-radius: 10px;\n    font-size: 0.75rem;\n    font-weight: 600;\n}\n\n.eti-details {\n    margin-top: 6px;\n    color: #999;\n    font-size: 0.75rem;\n    font-style: italic;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n}\n\n.eti-empty {\n    text-align: center;\n    color: #666;\n    padding: 20px;\n    font-style: italic;\n}\n\n/* Threat Modeler */\n.modeler-container {\n    background: linear-gradient(135deg, rgba(90, 156, 248, 0.1) 0%, rgba(38, 222, 129, 0.1) 100%);\n    border: 2px solid rgba(90, 156, 248, 0.3);\n    border-radius: 12px;\n    padding: 24px;\n    margin-bottom: 3rem;\n    box-shadow: 0 4px 16px rgba(90, 156, 248, 0.2);\n}\n\n.modeler-header {\n    margin-bottom: 24px;\n}\n\n.modeler-header h2 {\n    margin: 0 0 8px 0;\n    font-size: 1.8rem;\n    color: #5a9cf8;\n}\n\n.modeler-header h2 i {\n    color: #26de81;\n    margin-right: 10px;\n}\n\n.modeler-subtitle {\n    color: #b0b0b0;\n    font-size: 0.95rem;\n    margin: 0;\n}\n\n.modeler-grid {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 24px;\n}\n\n@media (max-width: 1024px) {\n    .modeler-grid {\n        grid-template-columns: 1fr;\n    }\n}\n\n.modeler-builder,\n.modeler-results {\n    background: rgba(0, 0, 0, 0.3);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: 10px;\n    padding: 20px;\n}\n\n.modeler-builder h3,\n.modeler-results h3 {\n    margin: 0 0 20px 0;\n    font-size: 1.2rem;\n    color: #e0e0e0;\n    border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n    padding-bottom: 10px;\n}\n\n.modeler-builder h3 i {\n    color: #26de81;\n    margin-right: 8px;\n}\n\n.modeler-results h3 i {\n    color: #5a9cf8;\n    margin-right: 8px;\n}\n\n.modeler-field {\n    margin-bottom: 20px;\n}\n\n.modeler-field label {\n    display: block;\n    color: #b0b0b0;\n    font-size: 0.9rem;\n    margin-bottom: 6px;\n    font-weight: 600;\n}\n\n.modeler-select {\n    width: 100%;\n    background: rgba(255, 255, 255, 0.05);\n    border: 1px solid rgba(255, 255, 255, 0.2);\n    border-radius: 6px;\n    color: #e0e0e0;\n    padding: 10px;\n    font-size: 0.9rem;\n    font-family: inherit;\n    cursor: pointer;\n    transition: all 0.3s;\n}\n\n.modeler-select:focus {\n    outline: none;\n    border-color: #5a9cf8;\n    background: rgba(90, 156, 248, 0.1);\n}\n\n.modeler-select option {\n    background: #1a1a2e;\n    color: #e0e0e0;\n    padding: 8px;\n}\n\n.modeler-hint {\n    display: block;\n    color: #666;\n    font-size: 0.75rem;\n    margin-top: 4px;\n    font-style: italic;\n}\n\n.modeler-analyze-btn {\n    width: 100%;\n    background: linear-gradient(135deg, #26de81, #20bf6b);\n    border: none;\n    color: #fff;\n    padding: 14px 24px;\n    border-radius: 8px;\n    font-size: 1rem;\n    font-weight: 700;\n    cursor: pointer;\n    transition: all 0.3s;\n    box-shadow: 0 4px 12px rgba(38, 222, 129, 0.3);\n}\n\n.modeler-analyze-btn:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 6px 16px rgba(38, 222, 129, 0.4);\n}\n\n.modeler-analyze-btn i {\n    margin-right: 8px;\n}\n\n.modeler-output {\n    min-height: 400px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n\n.modeler-placeholder {\n    text-align: center;\n    color: #666;\n}\n\n.modeler-placeholder i {\n    font-size: 3rem;\n    margin-bottom: 16px;\n    opacity: 0.5;\n}\n\n.modeler-placeholder p {\n    font-size: 0.95rem;\n}\n\n.modeler-loading {\n    text-align: center;\n    color: #5a9cf8;\n}\n\n.modeler-loading i {\n    font-size: 3rem;\n    margin-bottom: 16px;\n}\n\n.modeler-error {\n    text-align: center;\n    color: #ff4757;\n}\n\n.modeler-error i {\n    font-size: 3rem;\n    margin-bottom: 16px;\n}\n\n.prediction-result {\n    width: 100%;\n}\n\n.prediction-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 24px;\n    padding: 20px;\n    background: rgba(255, 255, 255, 0.05);\n    border-radius: 8px;\n}\n\n.prediction-badge {\n    padding: 12px 24px;\n    border-radius: 8px;\n    font-size: 1.3rem;\n    font-weight: 800;\n    color: #fff;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n}\n\n.prediction-confidence {\n    text-align: right;\n}\n\n.confidence-label {\n    color: #888;\n    font-size: 0.8rem;\n    margin-bottom: 4px;\n}\n\n.confidence-value {\n    color: #5a9cf8;\n    font-size: 2rem;\n    font-weight: 800;\n}\n\n.prediction-family {\n    padding: 16px;\n    background: rgba(255, 71, 87, 0.1);\n    border-left: 4px solid #ff4757;\n    border-radius: 6px;\n    margin-bottom: 20px;\n    color: #e0e0e0;\n}\n\n.family-name {\n    color: #ff6b6b;\n    font-weight: 700;\n    font-size: 1.1rem;\n    margin-left: 8px;\n}\n\n.prediction-section {\n    margin-bottom: 20px;\n}\n\n.prediction-section h4 {\n    color: #5a9cf8;\n    font-size: 1rem;\n    margin: 0 0 12px 0;\n    border-bottom: 1px solid rgba(90, 156, 248, 0.3);\n    padding-bottom: 6px;\n}\n\n.analysis-item {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    padding: 8px 0;\n    color: #b0b0b0;\n    font-size: 0.9rem;\n}\n\n.analysis-item i {\n    color: #ffa502;\n    width: 20px;\n}\n\n.indicator-group {\n    margin-bottom: 16px;\n}\n\n.indicator-group strong {\n    display: block;\n    color: #e0e0e0;\n    margin-bottom: 8px;\n    font-size: 0.9rem;\n}\n\n.indicator-list {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 8px;\n}\n\n.indicator-tag {\n    padding: 6px 12px;\n    border-radius: 6px;\n    font-size: 0.8rem;\n    font-weight: 600;\n    font-family: 'Courier New', monospace;\n}\n\n.api-tag {\n    background: rgba(255, 165, 2, 0.2);\n    border: 1px solid rgba(255, 165, 2, 0.4);\n    color: #ffa502;\n}\n\n.string-tag {\n    background: rgba(255, 71, 87, 0.2);\n    border: 1px solid rgba(255, 71, 87, 0.4);\n    color: #ff6b6b;\n}\n\n.prediction-footer {\n    margin-top: 20px;\n    padding: 12px;\n    background: rgba(90, 156, 248, 0.1);\n    border-radius: 6px;\n    color: #5a9cf8;\n    font-size: 0.85rem;\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.stat-card {\n    background: rgba(255, 255, 255, 0.05);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: 12px;\n    padding: 1.5rem;\n    text-align: center;\n}\n\n.stat-card i {\n    font-size: 2rem;\n    margin-bottom: 1rem;\n}\n\n.stat-number {\n    display: block;\n    font-size: 2rem;\n    font-weight: bold;\n    margin-bottom: 0.5rem;\n}\n\n.stat-label {\n    color: #888;\n    font-size: 0.9rem;\n}\n\n.stat-card.malware { border-color: #ff4757; }\n.stat-card.malware i { color: #ff4757; }\n.stat-card.malware .stat-number { color: #ff4757; }\n\n.stat-card.suspicious { border-color: #ffa502; }\n.stat-card.suspicious i { color: #ffa502; }\n.stat-card.suspicious .stat-number { color: #ffa502; }\n\n.stat-card.benign { border-color: #26de81; }\n.stat-card.benign i { color: #26de81; }\n.stat-card.benign .stat-number { color: #26de81; }\n\n.stat-card.info { border-color: #5a9cf8; }\n.stat-card.info i { color: #5a9cf8; }\n.stat-card.info .stat-number { color: #5a9cf8; }\n\n.scans-container {\n    background: rgba(255, 255, 255, 0.05);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: 12px;\n    padding: 2rem;\n}\n\n.scans-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 2rem;\n}\n\n.scans-header h2 {\n    color: #5a9cf8;\n}\n\n.refresh-btn {\n    background: #5a9cf8;\n    color: white;\n    border: none;\n    padding: 0.75rem 1.5rem;\n    border-radius: 8px;\n    cursor: pointer;\n    font-size: 1rem;\n    transition: background 0.2s;\n}\n\n.refresh-btn:hover {\n    background: #4a8ce8;\n}\n\n.scans-table {\n    width: 100%;\n    border-collapse: collapse;\n}\n\n.scans-table th {\n    text-align: left;\n    padding: 1rem;\n    background: rgba(255, 255, 255, 0.05);\n    color: #5a9cf8;\n    font-weight: 600;\n}\n\n.scans-table td {\n    padding: 1rem;\n    border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n}\n\n.scans-table tr:hover {\n    background: rgba(255, 255, 255, 0.03);\n}\n\n.badge {\n    display: inline-block;\n    padding: 0.3rem 0.8rem;\n    border-radius: 6px;\n    font-size: 0.85rem;\n    font-weight: 600;\n}\n\n.badge.malware { background: #ff4757; color: white; }\n.badge.suspicious { background: #ffa502; color: white; }\n.badge.benign { background: #26de81; color: white; }\n\n.hash {\n    font-family: 'Courier New', monospace;\n    font-size: 0.85rem;\n    color: #888;\n}\n\n.empty-state {\n    text-align: center;\n    padding: 3rem;\n    color: #666;\n}\n\n.empty-state i {\n    font-size: 4rem;\n    margin-bottom: 1rem;\n    opacity: 0.3;\n}\n\n/* NEW: Chart Container Styles */\n.chart-container {\n    background: rgba(255, 255, 255, 0.05);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: 12px;\n    padding: 2rem;\n    margin-top: 2rem;\n}\n\n.chart-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 2rem;\n}\n\n.chart-header h2 {\n    color: #5a9cf8;\n    margin: 0;\n}\n\n.chart-controls {\n    display: flex;\n    gap: 0.5rem;\n}\n\n.chart-btn {\n    background: rgba(255, 255, 255, 0.05);\n    color: #888;\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    padding: 0.5rem 1rem;\n    border-radius: 6px;\n    cursor: pointer;\n    font-size: 0.9rem;\n    transition: all 0.2s;\n}\n\n.chart-btn:hover {\n    background: rgba(255, 255, 255, 0.1);\n    color: #e0e0e0;\n}\n\n.chart-btn.active {\n    background: #5a9cf8;\n    color: white;\n    border-color: #5a9cf8;\n}\n\n#dailyScansChart {\n    max-height: 400px;\n}\n\n@media (max-width: 768px) {\n    .chart-header {\n        flex-direction: column;\n        gap: 1rem;\n        align-items: flex-start;\n    }\n    \n    .chart-controls {\n        width: 100%;\n        justify-content: stretch;\n    }\n    \n    .chart-btn {\n        flex: 1;\n    }\n}\n\n/* Map Container */\n.map-container {\n    background: rgba(255, 255, 255, 0.03);\n    border-radius: 12px;\n    padding: 24px;\n    margin-top: 24px;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n}\n\n.map-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 20px;\n    flex-wrap: wrap;\n    gap: 16px;\n}\n\n.map-header h2 {\n    margin: 0;\n    font-size: 1.5rem;\n    color: #e0e0e0;\n}\n\n.map-header h2 i {\n    color: #5a9cf8;\n    margin-right: 8px;\n}\n\n.map-legend {\n    display: flex;\n    gap: 20px;\n    flex-wrap: wrap;\n}\n\n.legend-item {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    font-size: 0.9rem;\n    color: #b0b0b0;\n}\n\n.legend-dot {\n    width: 12px;\n    height: 12px;\n    border-radius: 50%;\n    display: inline-block;\n}\n\n.malware-dot {\n    background-color: #ff4757;\n}\n\n.suspicious-dot {\n    background-color: #ffa502;\n}\n\n.benign-dot {\n    background-color: #26de81;\n}\n\n#worldMap {\n    background: #1a1a1a;\n    border: 1px solid rgba(255, 255, 255, 0.1);\n}\n\n/* Correlation Graph */\n.correlation-container {\n    background: rgba(255, 255, 255, 0.03);\n    border-radius: 12px;\n    padding: 24px;\n    margin-top: 24px;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n}\n\n.correlation-header {\n    margin-bottom: 20px;\n}\n\n.correlation-header h2 {\n    margin: 0 0 8px 0;\n    font-size: 1.5rem;\n    color: #e0e0e0;\n}\n\n.correlation-header h2 i {\n    color: #5a9cf8;\n    margin-right: 8px;\n}\n\n.correlation-subtitle {\n    color: #888;\n    font-size: 0.9rem;\n    margin: 0;\n}\n\n.graph-controls {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 16px;\n    flex-wrap: wrap;\n    gap: 16px;\n}\n\n.graph-btn {\n    background: rgba(90, 156, 248, 0.2);\n    border: 1px solid rgba(90, 156, 248, 0.4);\n    color: #5a9cf8;\n    padding: 8px 16px;\n    border-radius: 6px;\n    cursor: pointer;\n    font-size: 0.9rem;\n    transition: all 0.3s;\n}\n\n.graph-btn:hover {\n    background: rgba(90, 156, 248, 0.3);\n    border-color: #5a9cf8;\n}\n\n.graph-btn i {\n    margin-right: 6px;\n}\n\n.graph-legend {\n    display: flex;\n    gap: 20px;\n    flex-wrap: wrap;\n}\n\n.node-sample {\n    width: 12px;\n    height: 12px;\n    border-radius: 50%;\n    display: inline-block;\n    border: 2px solid #fff;\n}\n\n.malware-node {\n    background-color: #ff4757;\n}\n\n.agent-node {\n    background-color: #5a9cf8;\n}\n\n.api-node {\n    background-color: #ffa502;\n}\n\n.string-node {\n    background-color: #26de81;\n}\n\n#correlationGraph {\n    width: 100%;\n    min-height: 600px;\n    position: relative;\n    border-radius: 8px;\n    overflow: hidden;\n}\n\n.node-details {\n    position: absolute;\n    right: 24px;\n    top: 120px;\n    background: rgba(30, 30, 30, 0.95);\n    border: 1px solid rgba(90, 156, 248, 0.4);\n    border-radius: 8px;\n    padding: 16px;\n    max-width: 300px;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n    z-index: 1000;\n}\n\n.node-details h3 {\n    margin: 0 0 12px 0;\n    color: #5a9cf8;\n    font-size: 1.1rem;\n    border-bottom: 1px solid rgba(90, 156, 248, 0.3);\n    padding-bottom: 8px;\n}\n\n.node-details p {\n    margin: 8px 0;\n    color: #e0e0e0;\n    font-size: 0.9rem;\n}\n\n.node-details ul {\n    color: #b0b0b0;\n    font-size: 0.85rem;\n}\n\n.node-details li {\n    margin: 4px 0;\n}\n","epoch":43,"telemetryInfo":{}}],["file:///home/trang/localnsv/mAIware-server/public/dashboard.html::request_d7ec2804-c986-4ad0-bd16-ba590bdeeb6b",{"uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware-server/public/dashboard.html","external":"file:///home/trang/localnsv/mAIware-server/public/dashboard.html","path":"/home/trang/localnsv/mAIware-server/public/dashboard.html","scheme":"file"},"requestId":"request_d7ec2804-c986-4ad0-bd16-ba590bdeeb6b","content":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>mAIware Server Dashboard</title>\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css\">\n    <link rel=\"stylesheet\" href=\"styles.css\">\n    <!-- Add Chart.js -->\n    <script src=\"https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js\"></script>\n    <!-- Add Leaflet.js for maps -->\n    <link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.9.4/dist/leaflet.css\" />\n    <script src=\"https://unpkg.com/leaflet@1.9.4/dist/leaflet.js\"></script>\n    <!-- Add D3.js for force-directed graph -->\n    <script src=\"https://d3js.org/d3.v7.min.js\"></script>\n</head>\n<body>\n    <div class=\"container\">\n        <header>\n            <h1><i class=\"fas fa-shield-virus\"></i> mAIware Server</h1>\n            <p class=\"subtitle\">Real-time Malware Analysis Dashboard</p>\n        </header>\n        \n        <div class=\"stats-grid\" id=\"stats-grid\">\n            <div class=\"stat-card info\">\n                <i class=\"fas fa-laptop\"></i>\n                <span class=\"stat-number\" id=\"stat-clients\">0</span>\n                <span class=\"stat-label\">Active Clients</span>\n            </div>\n            <div class=\"stat-card info\">\n                <i class=\"fas fa-chart-line\"></i>\n                <span class=\"stat-number\" id=\"stat-total\">0</span>\n                <span class=\"stat-label\">Total Scans</span>\n            </div>\n            <div class=\"stat-card malware\">\n                <i class=\"fas fa-bug\"></i>\n                <span class=\"stat-number\" id=\"stat-malware\">0</span>\n                <span class=\"stat-label\">Malware</span>\n            </div>\n            <div class=\"stat-card suspicious\">\n                <i class=\"fas fa-exclamation-triangle\"></i>\n                <span class=\"stat-number\" id=\"stat-suspicious\">0</span>\n                <span class=\"stat-label\">Suspicious</span>\n            </div>\n            <div class=\"stat-card benign\">\n                <i class=\"fas fa-check-circle\"></i>\n                <span class=\"stat-number\" id=\"stat-benign\">0</span>\n                <span class=\"stat-label\">Benign</span>\n            </div>\n        </div>\n        \n        <!-- NEW: Emerging Threat Intelligence Panel -->\n        <div class=\"eti-container\">\n            <div class=\"eti-header\">\n                <h2><i class=\"fas fa-exclamation-triangle\"></i> Emerging Threat Intelligence (ETI)</h2>\n                <p class=\"eti-subtitle\">Real-time actionable intelligence on active threats and indicators of compromise</p>\n                <div class=\"eti-summary\">\n                    <span class=\"eti-badge\" id=\"eti-total\">0 Total Threats</span>\n                    <span class=\"eti-badge recent\" id=\"eti-recent\">0 Last 24h</span>\n                </div>\n            </div>\n            \n            <div class=\"eti-grid\">\n                <div class=\"eti-panel\">\n                    <h3><i class=\"fas fa-virus\"></i> Top Malware Families</h3>\n                    <div class=\"eti-subtitle-small\">Most active malware families detected</div>\n                    <div id=\"eti-malware\" class=\"eti-list\"></div>\n                </div>\n                \n                <div class=\"eti-panel\">\n                    <h3><i class=\"fas fa-code\"></i> Top Suspicious APIs</h3>\n                    <div class=\"eti-subtitle-small\">Most frequently called malicious APIs</div>\n                    <div id=\"eti-apis\" class=\"eti-list\"></div>\n                </div>\n                \n                <div class=\"eti-panel\">\n                    <h3><i class=\"fas fa-terminal\"></i> Top Malicious Strings</h3>\n                    <div class=\"eti-subtitle-small\">Most common IOC strings and commands</div>\n                    <div id=\"eti-strings\" class=\"eti-list\"></div>\n                </div>\n                \n                <div class=\"eti-panel\">\n                    <h3><i class=\"fas fa-shield-alt\"></i> Top Packers/Obfuscators</h3>\n                    <div class=\"eti-subtitle-small\">Most used evasion techniques</div>\n                    <div id=\"eti-packers\" class=\"eti-list\"></div>\n                </div>\n            </div>\n        </div>\n        \n        <!-- NEW: Threat Modeler Panel -->\n        <div class=\"modeler-container\">\n            <div class=\"modeler-header\">\n                <h2><i class=\"fas fa-flask\"></i> Predictive Threat Modeler</h2>\n                <p class=\"modeler-subtitle\">Build hypothetical malware and predict how mAIware would classify it</p>\n            </div>\n            \n            <div class=\"modeler-grid\">\n                <div class=\"modeler-builder\">\n                    <h3><i class=\"fas fa-cogs\"></i> Threat Configuration</h3>\n                    \n                    <div class=\"modeler-field\">\n                        <label>File Type</label>\n                        <select id=\"model-filetype\" class=\"modeler-select\">\n                            <option>PE32+ (GUI) x86-64</option>\n                            <option>PE32 (Console) Intel 80386</option>\n                            <option>PE32+ DLL x86-64</option>\n                            <option>MSI Installer</option>\n                            <option>PDF Document</option>\n                        </select>\n                    </div>\n                    \n                    <div class=\"modeler-field\">\n                        <label>Packer/Obfuscator</label>\n                        <select id=\"model-packer\" class=\"modeler-select\">\n                            <option>None</option>\n                            <option>UPX</option>\n                            <option>VMProtect</option>\n                            <option>Themida</option>\n                            <option>ASPack</option>\n                            <option>Unknown (High Entropy)</option>\n                        </select>\n                    </div>\n                    \n                    <div class=\"modeler-field\">\n                        <label>Digital Signature</label>\n                        <select id=\"model-signature\" class=\"modeler-select\">\n                            <option>Verified (Microsoft Corporation)</option>\n                            <option>Verified (Google LLC)</option>\n                            <option>Verified (Unknown Publisher)</option>\n                            <option>Not Signed</option>\n                            <option>Expired Certificate</option>\n                            <option>Self-Signed (Untrusted)</option>\n                        </select>\n                    </div>\n                    \n                    <div class=\"modeler-field\">\n                        <label>API Imports (select multiple)</label>\n                        <select id=\"model-apis\" class=\"modeler-select\" multiple size=\"6\">\n                            <option>CreateRemoteThread</option>\n                            <option>WriteProcessMemory</option>\n                            <option>VirtualAllocEx</option>\n                            <option>SetWindowsHookExW</option>\n                            <option>URLDownloadToFileW</option>\n                            <option>WinExec</option>\n                            <option>RegSetValueExW</option>\n                            <option>CryptEncrypt</option>\n                            <option>Socket</option>\n                            <option>ReadFile</option>\n                        </select>\n                        <small class=\"modeler-hint\">Hold Ctrl/Cmd to select multiple</small>\n                    </div>\n                    \n                    <div class=\"modeler-field\">\n                        <label>Suspicious Strings (select multiple)</label>\n                        <select id=\"model-strings\" class=\"modeler-select\" multiple size=\"6\">\n                            <option>http://bad-c2-server.com/payload.dat</option>\n                            <option>keylog.txt</option>\n                            <option>steal_passwords</option>\n                            <option>powershell -enc</option>\n                            <option>vssadmin.exe delete shadows</option>\n                            <option>HOW_TO_DECRYPT.txt</option>\n                            <option>crack</option>\n                            <option>patch</option>\n                            <option>disable_antivirus</option>\n                        </select>\n                        <small class=\"modeler-hint\">Hold Ctrl/Cmd to select multiple</small>\n                    </div>\n                    \n                    <button class=\"modeler-analyze-btn\" onclick=\"analyzeThreatModel()\">\n                        <i class=\"fas fa-brain\"></i> ANALYZE THREAT\n                    </button>\n                </div>\n                \n                <div class=\"modeler-results\">\n                    <h3><i class=\"fas fa-chart-line\"></i> Prediction Results</h3>\n                    <div id=\"modeler-output\" class=\"modeler-output\">\n                        <div class=\"modeler-placeholder\">\n                            <i class=\"fas fa-arrow-left\"></i>\n                            <p>Configure a threat profile and click ANALYZE to see predictions</p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        \n        <div class=\"scans-container\">\n            <div class=\"scans-header\">\n                <h2>Recent Scans</h2>\n                <button class=\"refresh-btn\" onclick=\"manualRefresh()\">\n                    <i class=\"fas fa-sync-alt\"></i> Refresh\n                </button>\n            </div>\n            \n            <table class=\"scans-table\">\n                <thead>\n                    <tr>\n                        <th>Timestamp</th>\n                        <th>Filename</th>\n                        <th>Classification</th>\n                        <th>Client IP</th>\n                        <th>Hash (SHA256)</th>\n                    </tr>\n                </thead>\n                <tbody id=\"scans-tbody\">\n                    <tr>\n                        <td colspan=\"5\" class=\"empty-state\">\n                            <i class=\"fas fa-inbox\"></i>\n                            <p>No scans yet. Waiting for clients...</p>\n                        </td>\n                    </tr>\n                </tbody>\n            </table>\n        </div>\n        \n        <!-- NEW: Daily Analysis Chart -->\n        <div class=\"chart-container\">\n            <div class=\"chart-header\">\n                <h2>Daily Analysis Trends (Last 30 Days)</h2>\n                <div class=\"chart-controls\">\n                    <button class=\"chart-btn active\" onclick=\"setChartDays(7)\">7 Days</button>\n                    <button class=\"chart-btn\" onclick=\"setChartDays(14)\">14 Days</button>\n                    <button class=\"chart-btn\" onclick=\"setChartDays(30)\">30 Days</button>\n                </div>\n            </div>\n            <canvas id=\"dailyScansChart\"></canvas>\n        </div>\n        \n        <!-- NEW: Geographic Distribution Map -->\n        <div class=\"map-container\">\n            <div class=\"map-header\">\n                <h2><i class=\"fas fa-globe\"></i> Geographic Distribution of Detections</h2>\n                <div class=\"map-legend\">\n                    <span class=\"legend-item\"><span class=\"legend-dot malware-dot\"></span> Malware</span>\n                    <span class=\"legend-item\"><span class=\"legend-dot suspicious-dot\"></span> Suspicious</span>\n                    <span class=\"legend-item\"><span class=\"legend-dot benign-dot\"></span> Benign</span>\n                </div>\n            </div>\n            <div id=\"worldMap\" style=\"height: 500px; border-radius: 8px;\"></div>\n        </div>\n        \n        <!-- NEW: Malware Source Distribution Pie Chart -->\n        <div class=\"chart-container\" style=\"margin-top: 24px;\">\n            <div class=\"chart-header\">\n                <h2><i class=\"fas fa-chart-pie\"></i> Malware Source Distribution</h2>\n            </div>\n            <div style=\"max-width: 500px; margin: 0 auto;\">\n                <canvas id=\"malwareSourceChart\"></canvas>\n            </div>\n        </div>\n        \n        <!-- NEW: Threat Vector Correlation Explorer -->\n        <div class=\"correlation-container\">\n            <div class=\"correlation-header\">\n                <h2><i class=\"fas fa-project-diagram\"></i> Threat Vector Correlation Explorer</h2>\n                <p class=\"correlation-subtitle\">Interactive intelligence map showing relationships between malware families, agents, APIs, and indicators</p>\n            </div>\n            <div class=\"graph-controls\">\n                <button class=\"graph-btn\" onclick=\"resetGraph()\"><i class=\"fas fa-sync\"></i> Reset View</button>\n                <button class=\"graph-btn\" onclick=\"centerGraph()\"><i class=\"fas fa-compress\"></i> Center</button>\n                <div class=\"graph-legend\">\n                    <span class=\"legend-item\"><span class=\"node-sample malware-node\"></span> Malware Family</span>\n                    <span class=\"legend-item\"><span class=\"node-sample agent-node\"></span> Agent/System</span>\n                    <span class=\"legend-item\"><span class=\"node-sample api-node\"></span> API Call</span>\n                    <span class=\"legend-item\"><span class=\"node-sample string-node\"></span> Suspicious String</span>\n                </div>\n            </div>\n            <div id=\"correlationGraph\"></div>\n            <div id=\"nodeDetails\" class=\"node-details\" style=\"display: none;\">\n                <h3 id=\"detailsTitle\"></h3>\n                <div id=\"detailsContent\"></div>\n            </div>\n        </div>\n    </div>\n    \n    <script>\n        let dailyChart = null;\n        let currentChartDays = 30;\n        \n        async function loadStats() {\n            try {\n                const response = await fetch('/api/stats');\n                const stats = await response.json();\n                \n                document.getElementById('stat-clients').textContent = stats.activeClients;\n                document.getElementById('stat-total').textContent = stats.totalScans;\n                document.getElementById('stat-malware').textContent = stats.malwareCount;\n                document.getElementById('stat-suspicious').textContent = stats.suspiciousCount;\n                document.getElementById('stat-benign').textContent = stats.benignCount;\n            } catch (error) {\n                console.error('Failed to load stats:', error);\n            }\n        }\n        \n        async function loadScans() {\n            try {\n                const response = await fetch('/api/scans?limit=50');\n                const data = await response.json();\n                \n                const tbody = document.getElementById('scans-tbody');\n                \n                if (data.scans.length === 0) {\n                    tbody.innerHTML = `\n                        <tr>\n                            <td colspan=\"5\" class=\"empty-state\">\n                                <i class=\"fas fa-inbox\"></i>\n                                <p>No scans yet. Waiting for clients...</p>\n                            </td>\n                        </tr>\n                    `;\n                    return;\n                }\n                \n                tbody.innerHTML = data.scans.map(scan => {\n                    const timestamp = new Date(scan.serverTimestamp).toLocaleString();\n                    const hash = scan.file_hashes?.sha256 || 'N/A';\n                    const hashShort = hash.length > 16 ? (hash.substring(0, 16) + '...') : hash;\n                    const classification = scan.classification || 'Unknown';\n                    const badgeClass = classification.toLowerCase();\n                    const nonPeTag = scan.is_pe === false ? '<span class=\"badge non-pe\" title=\"Non-PE file\">Non-PE</span>' : '';\n                    return `\n                        <tr>\n                            <td>${timestamp}</td>\n                            <td>${scan.detected_filename} ${nonPeTag}</td>\n                            <td><span class=\"badge ${badgeClass}\">${classification}</span></td>\n                            <td>${scan.systemInfo?.ip || scan.clientIp || 'Unknown'}</td>\n                            <td class=\"hash\" title=\"${hash}\">${hashShort}</td>\n                        </tr>\n                    `;\n                }).join('');\n                \n            } catch (error) {\n                console.error('Failed to load scans:', error);\n            }\n        }\n        \n        async function loadDailyChart() {\n            try {\n                const response = await fetch(`/api/daily-scans?days=${currentChartDays}`);\n                const data = await response.json();\n                \n                const ctx = document.getElementById('dailyScansChart');\n                \n                // Destroy existing chart if it exists\n                if (dailyChart) {\n                    dailyChart.destroy();\n                }\n                \n                // Format dates for display (MM/DD)\n                const labels = data.days.map(day => {\n                    const date = new Date(day.date);\n                    return `${date.getMonth() + 1}/${date.getDate()}`;\n                });\n                \n                dailyChart = new Chart(ctx, {\n                    type: 'line',\n                    data: {\n                        labels: labels,\n                        datasets: [\n                            {\n                                label: 'Total Scans',\n                                data: data.days.map(d => d.total),\n                                borderColor: '#5a9cf8',\n                                backgroundColor: 'rgba(90, 156, 248, 0.1)',\n                                fill: true,\n                                tension: 0.4,\n                                borderWidth: 2\n                            },\n                            {\n                                label: 'Malware',\n                                data: data.days.map(d => d.malware),\n                                borderColor: '#ff4757',\n                                backgroundColor: 'rgba(255, 71, 87, 0.1)',\n                                fill: true,\n                                tension: 0.4,\n                                borderWidth: 2\n                            },\n                            {\n                                label: 'Suspicious',\n                                data: data.days.map(d => d.suspicious),\n                                borderColor: '#ffa502',\n                                backgroundColor: 'rgba(255, 165, 2, 0.1)',\n                                fill: true,\n                                tension: 0.4,\n                                borderWidth: 2\n                            },\n                            {\n                                label: 'Benign',\n                                data: data.days.map(d => d.benign),\n                                borderColor: '#26de81',\n                                backgroundColor: 'rgba(38, 222, 129, 0.1)',\n                                fill: true,\n                                tension: 0.4,\n                                borderWidth: 2\n                            }\n                        ]\n                    },\n                    options: {\n                        responsive: true,\n                        maintainAspectRatio: false,\n                        interaction: {\n                            mode: 'index',\n                            intersect: false,\n                        },\n                        plugins: {\n                            legend: {\n                                labels: {\n                                    color: '#e0e0e0',\n                                    font: { size: 12 }\n                                }\n                            },\n                            tooltip: {\n                                backgroundColor: 'rgba(0, 0, 0, 0.8)',\n                                titleColor: '#fff',\n                                bodyColor: '#e0e0e0',\n                                borderColor: 'rgba(255, 255, 255, 0.1)',\n                                borderWidth: 1\n                            }\n                        },\n                        scales: {\n                            x: {\n                                ticks: { \n                                    color: '#888',\n                                    maxRotation: 45,\n                                    minRotation: 45\n                                },\n                                grid: { \n                                    color: 'rgba(255, 255, 255, 0.05)' \n                                }\n                            },\n                            y: {\n                                beginAtZero: true,\n                                ticks: { \n                                    color: '#888',\n                                    stepSize: 1\n                                },\n                                grid: { \n                                    color: 'rgba(255, 255, 255, 0.05)' \n                                }\n                            }\n                        }\n                    }\n                });\n                \n            } catch (error) {\n                console.error('Failed to load daily chart:', error);\n            }\n        }\n        \n        let worldMap = null;\n        let markerLayer = null;\n        let mapInitialized = false;\n        let lastGeoDataHash = '';\n        let sourceChart = null;\n        \n        function initializeMap() {\n            if (mapInitialized) return;\n            \n            try {\n                worldMap = L.map('worldMap', {\n                    zoomControl: true,\n                    scrollWheelZoom: true\n                }).setView([20, 0], 2);\n                \n                // Use dark theme tiles\n                L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {\n                    attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors &copy; <a href=\"https://carto.com/attributions\">CARTO</a>',\n                    subdomains: 'abcd',\n                    maxZoom: 19\n                }).addTo(worldMap);\n                \n                markerLayer = L.layerGroup().addTo(worldMap);\n                mapInitialized = true;\n            } catch (error) {\n                console.error('Failed to initialize map:', error);\n            }\n        }\n        \n        async function loadGeoMap() {\n            try {\n                // Initialize map only once\n                if (!mapInitialized) {\n                    initializeMap();\n                }\n                \n                if (!markerLayer) return;\n                \n                const response = await fetch('/api/geo-data');\n                const data = await response.json();\n                \n                // Generate hash of current data to detect changes\n                const currentHash = JSON.stringify(data.locations.map(l => \n                    `${l.ip}-${l.totalScans}-${l.malwareCount}-${l.suspiciousCount}`\n                )).substring(0, 100);\n                \n                // Skip update if data hasn't changed\n                if (currentHash === lastGeoDataHash && markerLayer.getLayers().length > 0) {\n                    return;\n                }\n                lastGeoDataHash = currentHash;\n                \n                // Clear existing markers\n                markerLayer.clearLayers();\n                \n                // Add markers for each location\n                data.locations.forEach(location => {\n                    const { lat, lng, city, country } = location.location;\n                    \n                    // Determine marker color based on severity\n                    let markerColor = '#26de81'; // benign (green)\n                    let primaryClassification = 'Benign';\n                    \n                    if (location.malwareCount > 0) {\n                        markerColor = '#ff4757'; // malware (red)\n                        primaryClassification = 'Malware';\n                    } else if (location.suspiciousCount > 0) {\n                        markerColor = '#ffa502'; // suspicious (orange)\n                        primaryClassification = 'Suspicious';\n                    }\n                    \n                    // Calculate marker size based on total scans (min 8, max 24)\n                    const markerSize = Math.min(24, Math.max(8, 8 + location.totalScans * 2));\n                    \n                    // Create custom circular marker\n                    const marker = L.circleMarker([lat, lng], {\n                        radius: markerSize / 2,\n                        fillColor: markerColor,\n                        color: '#fff',\n                        weight: 2,\n                        opacity: 0.8,\n                        fillOpacity: 0.6\n                    });\n                    \n                    // Create popup content\n                    const popupContent = `\n                        <div style=\"color: #333; min-width: 200px;\">\n                            <h3 style=\"margin: 0 0 10px 0; color: #1a1a1a; font-size: 1.1rem;\">\n                                <i class=\"fas fa-map-marker-alt\" style=\"color: ${markerColor};\"></i>\n                                ${city}, ${country}\n                            </h3>\n                            <p style=\"margin: 5px 0; color: #555;\"><strong>IP:</strong> ${location.ip}</p>\n                            <p style=\"margin: 5px 0; color: #555;\"><strong>Total Scans:</strong> ${location.totalScans}</p>\n                            <div style=\"margin-top: 10px;\">\n                                <div style=\"margin: 3px 0;\">\n                                    <span style=\"color: #ff4757;\"></span> Malware: ${location.malwareCount}\n                                </div>\n                                <div style=\"margin: 3px 0;\">\n                                    <span style=\"color: #ffa502;\"></span> Suspicious: ${location.suspiciousCount}\n                                </div>\n                                <div style=\"margin: 3px 0;\">\n                                    <span style=\"color: #26de81;\"></span> Benign: ${location.benignCount}\n                                </div>\n                            </div>\n                            ${location.scans.length > 0 ? `\n                                <div style=\"margin-top: 10px; padding-top: 10px; border-top: 1px solid #ddd;\">\n                                    <strong>Recent Detections:</strong>\n                                    <ul style=\"margin: 5px 0; padding-left: 20px; font-size: 0.85rem;\">\n                                        ${location.scans.slice(0, 3).map(scan => `\n                                            <li style=\"margin: 2px 0;\">\n                                                ${scan.filename} \n                                                <span style=\"color: ${\n                                                    scan.classification === 'Malware' ? '#ff4757' : \n                                                    scan.classification === 'Suspicious' ? '#ffa502' : '#26de81'\n                                                };\">(${scan.classification})</span>\n                                            </li>\n                                        `).join('')}\n                                        ${location.scans.length > 3 ? `<li>...and ${location.scans.length - 3} more</li>` : ''}\n                                    </ul>\n                                </div>\n                            ` : ''}\n                        </div>\n                    `;\n                    \n                    marker.bindPopup(popupContent);\n                    marker.addTo(markerLayer);\n                    \n                    // Add hover effect\n                    marker.on('mouseover', function() {\n                        this.setStyle({\n                            fillOpacity: 0.9,\n                            opacity: 1\n                        });\n                    });\n                    \n                    marker.on('mouseout', function() {\n                        this.setStyle({\n                            fillOpacity: 0.6,\n                            opacity: 0.8\n                        });\n                    });\n                });\n                \n                console.log(`Map updated with ${data.locations.length} locations`);\n                \n            } catch (error) {\n                console.error('Failed to load geo map:', error);\n            }\n        }\n        \n        async function loadMalwareSources() {\n            try {\n                const response = await fetch('/api/malware-sources');\n                const data = await response.json();\n                \n                const ctx = document.getElementById('malwareSourceChart');\n                \n                // Destroy existing chart if it exists\n                if (sourceChart) {\n                    sourceChart.destroy();\n                }\n                \n                const labels = data.sources.map(s => s.source);\n                const counts = data.sources.map(s => s.count);\n                \n                // Color scheme for different sources\n                const colors = [\n                    '#ff6b6b', // Email Attachment - red\n                    '#4ecdc4', // Web Download - teal\n                    '#ffe66d', // USB/External Drive - yellow\n                    '#a8dadc', // Internal Network - light blue\n                    '#95a5a6'  // Unknown - gray\n                ];\n                \n                sourceChart = new Chart(ctx, {\n                    type: 'pie',\n                    data: {\n                        labels: labels,\n                        datasets: [{\n                            data: counts,\n                            backgroundColor: colors,\n                            borderColor: '#1a1a2e',\n                            borderWidth: 2\n                        }]\n                    },\n                    options: {\n                        responsive: true,\n                        maintainAspectRatio: true,\n                        plugins: {\n                            legend: {\n                                position: 'bottom',\n                                labels: {\n                                    color: '#e0e0e0',\n                                    font: { size: 12 },\n                                    padding: 15\n                                }\n                            },\n                            tooltip: {\n                                backgroundColor: 'rgba(0, 0, 0, 0.8)',\n                                titleColor: '#fff',\n                                bodyColor: '#e0e0e0',\n                                borderColor: 'rgba(255, 255, 255, 0.1)',\n                                borderWidth: 1,\n                                callbacks: {\n                                    label: function(context) {\n                                        const label = context.label || '';\n                                        const value = context.parsed || 0;\n                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);\n                                        const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : 0;\n                                        return `${label}: ${value} (${percentage}%)`;\n                                    }\n                                }\n                            }\n                        }\n                    }\n                });\n                \n            } catch (error) {\n                console.error('Failed to load malware sources:', error);\n            }\n        }\n        \n        async function loadEmergingThreats() {\n            try {\n                const response = await fetch('/api/emerging-threats');\n                const data = await response.json();\n                \n                // Update summary badges\n                document.getElementById('eti-total').textContent = \n                    `${data.summary.totalThreats} Total Threats`;\n                document.getElementById('eti-recent').textContent = \n                    `${data.summary.recentThreats} Last 24h`;\n                \n                // Helper to render IOC list\n                const renderIOCList = (items, container) => {\n                    if (items.length === 0) {\n                        container.innerHTML = '<div class=\"eti-empty\">No threats detected</div>';\n                        return;\n                    }\n                    \n                    container.innerHTML = items.map((item, index) => {\n                        const rank = index + 1;\n                        const recentBadge = item.recent > 0 ? \n                            `<span class=\"eti-recent-badge\">${item.recent} recent</span>` : '';\n                        const agentBadge = item.agents > 0 ? \n                            `<span class=\"eti-agent-badge\">${item.agents} agents</span>` : '';\n                        \n                        return `\n                            <div class=\"eti-item\" data-rank=\"${rank}\">\n                                <div class=\"eti-rank\">${rank}</div>\n                                <div class=\"eti-content\">\n                                    <div class=\"eti-name\">${item.name}</div>\n                                    <div class=\"eti-meta\">\n                                        <span class=\"eti-count\">${item.count} occurrences</span>\n                                        ${recentBadge}\n                                        ${agentBadge}\n                                    </div>\n                                    ${item.details && item.details.length > 0 ? `\n                                        <div class=\"eti-details\">\n                                            ${item.details.slice(0, 2).join(', ')}\n                                            ${item.details.length > 2 ? '...' : ''}\n                                        </div>\n                                    ` : ''}\n                                </div>\n                            </div>\n                        `;\n                    }).join('');\n                };\n                \n                // Render each section\n                renderIOCList(data.topMalwareFamilies, document.getElementById('eti-malware'));\n                renderIOCList(data.topSuspiciousAPIs, document.getElementById('eti-apis'));\n                renderIOCList(data.topMaliciousStrings, document.getElementById('eti-strings'));\n                renderIOCList(data.topPackers, document.getElementById('eti-packers'));\n                \n            } catch (error) {\n                console.error('Failed to load emerging threats:', error);\n            }\n        }\n        \n        async function analyzeThreatModel() {\n            try {\n                // Get selected values\n                const fileType = document.getElementById('model-filetype').value;\n                const packer = document.getElementById('model-packer').value;\n                const signature = document.getElementById('model-signature').value;\n                \n                // Get multiple selections\n                const apisSelect = document.getElementById('model-apis');\n                const apiImports = Array.from(apisSelect.selectedOptions).map(opt => opt.value);\n                \n                const stringsSelect = document.getElementById('model-strings');\n                const keyStrings = Array.from(stringsSelect.selectedOptions).map(opt => opt.value);\n                \n                // Validate\n                if (apiImports.length === 0) {\n                    alert('Please select at least one API import');\n                    return;\n                }\n                if (keyStrings.length === 0) {\n                    alert('Please select at least one suspicious string');\n                    return;\n                }\n                \n                // Show loading state\n                const outputDiv = document.getElementById('modeler-output');\n                outputDiv.innerHTML = `\n                    <div class=\"modeler-loading\">\n                        <i class=\"fas fa-spinner fa-spin\"></i>\n                        <p>Analyzing threat profile...</p>\n                    </div>\n                `;\n                \n                // Send to server\n                const response = await fetch('/api/threat-model', {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({\n                        fileType,\n                        packer,\n                        signature,\n                        apiImports,\n                        keyStrings\n                    })\n                });\n                \n                const data = await response.json();\n                \n                if (data.success) {\n                    const result = data.result;\n                    const classColor = \n                        result.classification === 'Malware' ? '#ff4757' :\n                        result.classification === 'Suspicious' ? '#ffa502' : '#26de81';\n                    \n                    outputDiv.innerHTML = `\n                        <div class=\"prediction-result\">\n                            <div class=\"prediction-header\">\n                                <div class=\"prediction-badge\" style=\"background: ${classColor};\">\n                                    ${result.classification.toUpperCase()}\n                                </div>\n                                <div class=\"prediction-confidence\">\n                                    <div class=\"confidence-label\">Confidence Score</div>\n                                    <div class=\"confidence-value\">${(parseFloat(result.confidence_score) * 100).toFixed(1)}%</div>\n                                </div>\n                            </div>\n                            \n                            ${result.malware_family ? `\n                                <div class=\"prediction-family\">\n                                    <strong>Predicted Malware Family:</strong>\n                                    <span class=\"family-name\">${result.malware_family}</span>\n                                </div>\n                            ` : ''}\n                            \n                            <div class=\"prediction-section\">\n                                <h4>Threat Analysis</h4>\n                                <div class=\"analysis-item\">\n                                    <i class=\"fas fa-file\"></i>\n                                    <span><strong>File Type:</strong> ${result.key_findings.file_type}</span>\n                                </div>\n                                <div class=\"analysis-item\">\n                                    <i class=\"fas fa-box\"></i>\n                                    <span><strong>Packer:</strong> ${result.key_findings.packer_detected}</span>\n                                </div>\n                                <div class=\"analysis-item\">\n                                    <i class=\"fas fa-certificate\"></i>\n                                    <span><strong>Signature:</strong> ${result.key_findings.signature.name}</span>\n                                </div>\n                                <div class=\"analysis-item\">\n                                    <i class=\"fas fa-tachometer-alt\"></i>\n                                    <span><strong>Threat Score:</strong> ${result.key_findings.threat_score}/100</span>\n                                </div>\n                            </div>\n                            \n                            <div class=\"prediction-section\">\n                                <h4>Detected Indicators</h4>\n                                <div class=\"indicator-group\">\n                                    <strong>API Imports:</strong>\n                                    <div class=\"indicator-list\">\n                                        ${result.key_findings.api_imports.map(api => \n                                            `<span class=\"indicator-tag api-tag\">${api}</span>`\n                                        ).join('')}\n                                    </div>\n                                </div>\n                                <div class=\"indicator-group\">\n                                    <strong>Suspicious Strings:</strong>\n                                    <div class=\"indicator-list\">\n                                        ${result.key_findings.key_strings.map(str => \n                                            `<span class=\"indicator-tag string-tag\">${str}</span>`\n                                        ).join('')}\n                                    </div>\n                                </div>\n                            </div>\n                            \n                            <div class=\"prediction-footer\">\n                                <i class=\"fas fa-info-circle\"></i>\n                                This analysis has been added to the scan results and will appear in all visualizations.\n                            </div>\n                        </div>\n                    `;\n                } else {\n                    outputDiv.innerHTML = `\n                        <div class=\"modeler-error\">\n                            <i class=\"fas fa-exclamation-circle\"></i>\n                            <p>Analysis failed: ${data.error}</p>\n                        </div>\n                    `;\n                }\n                \n            } catch (error) {\n                console.error('Failed to analyze threat model:', error);\n                document.getElementById('modeler-output').innerHTML = `\n                    <div class=\"modeler-error\">\n                        <i class=\"fas fa-exclamation-circle\"></i>\n                        <p>Analysis failed. Please try again.</p>\n                    </div>\n                `;\n            }\n        }\n        \n        let graphSimulation = null;\n        let graphSvg = null;\n        \n        async function loadCorrelationGraph() {\n            try {\n                const response = await fetch('/api/threat-correlations');\n                const data = await response.json();\n                \n                // Clear existing graph\n                d3.select('#correlationGraph').selectAll('*').remove();\n                \n                const container = document.getElementById('correlationGraph');\n                const width = container.clientWidth;\n                const height = 600;\n                \n                // Create SVG\n                graphSvg = d3.select('#correlationGraph')\n                    .append('svg')\n                    .attr('width', width)\n                    .attr('height', height)\n                    .style('background', '#0a0a0a')\n                    .style('border-radius', '8px');\n                \n                const g = graphSvg.append('g');\n                \n                // Add zoom behavior\n                const zoom = d3.zoom()\n                    .scaleExtent([0.1, 4])\n                    .on('zoom', (event) => {\n                        g.attr('transform', event.transform);\n                    });\n                \n                graphSvg.call(zoom);\n                \n                // Color schemes for different node types\n                const colorMap = {\n                    malware: '#ff4757',\n                    agent: '#5a9cf8',\n                    api: '#ffa502',\n                    string: '#26de81'\n                };\n                \n                // Create force simulation\n                graphSimulation = d3.forceSimulation(data.nodes)\n                    .force('link', d3.forceLink(data.links)\n                        .id(d => d.id)\n                        .distance(d => d.type === 'correlated_with' ? 200 : 100)\n                        .strength(d => d.strength * 0.3))\n                    .force('charge', d3.forceManyBody().strength(-300))\n                    .force('center', d3.forceCenter(width / 2, height / 2))\n                    .force('collision', d3.forceCollide().radius(30));\n                \n                // Draw links\n                const link = g.append('g')\n                    .selectAll('line')\n                    .data(data.links)\n                    .enter()\n                    .append('line')\n                    .attr('stroke', d => {\n                        if (d.type === 'correlated_with') return '#ff6b6b';\n                        if (d.type === 'detected_by') return '#5a9cf8';\n                        if (d.type === 'uses_api') return '#ffa502';\n                        return '#26de81';\n                    })\n                    .attr('stroke-width', d => Math.sqrt(d.strength) + 1)\n                    .attr('stroke-opacity', 0.6);\n                \n                // Draw nodes\n                const node = g.append('g')\n                    .selectAll('circle')\n                    .data(data.nodes)\n                    .enter()\n                    .append('circle')\n                    .attr('r', d => {\n                        if (d.type === 'malware') return 15 + Math.min(d.count * 2, 15);\n                        if (d.type === 'agent') return 12 + Math.min(d.count, 10);\n                        return 8 + Math.min(d.count, 8);\n                    })\n                    .attr('fill', d => colorMap[d.type])\n                    .attr('stroke', '#fff')\n                    .attr('stroke-width', 2)\n                    .style('cursor', 'pointer')\n                    .call(d3.drag()\n                        .on('start', dragstarted)\n                        .on('drag', dragged)\n                        .on('end', dragended))\n                    .on('click', (event, d) => showNodeDetails(d, data))\n                    .on('mouseover', function(event, d) {\n                        d3.select(this)\n                            .transition()\n                            .duration(200)\n                            .attr('stroke-width', 4)\n                            .attr('r', function() {\n                                const currentR = parseFloat(d3.select(this).attr('r'));\n                                return currentR * 1.3;\n                            });\n                    })\n                    .on('mouseout', function(event, d) {\n                        d3.select(this)\n                            .transition()\n                            .duration(200)\n                            .attr('stroke-width', 2)\n                            .attr('r', function() {\n                                if (d.type === 'malware') return 15 + Math.min(d.count * 2, 15);\n                                if (d.type === 'agent') return 12 + Math.min(d.count, 10);\n                                return 8 + Math.min(d.count, 8);\n                            });\n                    });\n                \n                // Add labels\n                const label = g.append('g')\n                    .selectAll('text')\n                    .data(data.nodes)\n                    .enter()\n                    .append('text')\n                    .text(d => d.label.length > 20 ? d.label.substring(0, 20) + '...' : d.label)\n                    .attr('font-size', d => d.type === 'malware' ? '12px' : '10px')\n                    .attr('fill', '#e0e0e0')\n                    .attr('text-anchor', 'middle')\n                    .attr('dy', d => {\n                        if (d.type === 'malware') return 35;\n                        if (d.type === 'agent') return 25;\n                        return 20;\n                    })\n                    .style('pointer-events', 'none')\n                    .style('font-weight', d => d.type === 'malware' ? 'bold' : 'normal');\n                \n                // Update positions on simulation tick\n                graphSimulation.on('tick', () => {\n                    link\n                        .attr('x1', d => d.source.x)\n                        .attr('y1', d => d.source.y)\n                        .attr('x2', d => d.target.x)\n                        .attr('y2', d => d.target.y);\n                    \n                    node\n                        .attr('cx', d => d.x)\n                        .attr('cy', d => d.y);\n                    \n                    label\n                        .attr('x', d => d.x)\n                        .attr('y', d => d.y);\n                });\n                \n                // Drag functions\n                function dragstarted(event, d) {\n                    if (!event.active) graphSimulation.alphaTarget(0.3).restart();\n                    d.fx = d.x;\n                    d.fy = d.y;\n                }\n                \n                function dragged(event, d) {\n                    d.fx = event.x;\n                    d.fy = event.y;\n                }\n                \n                function dragended(event, d) {\n                    if (!event.active) graphSimulation.alphaTarget(0);\n                    d.fx = null;\n                    d.fy = null;\n                }\n                \n                console.log(`Correlation graph loaded: ${data.nodes.length} nodes, ${data.links.length} links`);\n                \n            } catch (error) {\n                console.error('Failed to load correlation graph:', error);\n            }\n        }\n        \n        function showNodeDetails(node, graphData) {\n            const detailsPanel = document.getElementById('nodeDetails');\n            const detailsTitle = document.getElementById('detailsTitle');\n            const detailsContent = document.getElementById('detailsContent');\n            \n            detailsTitle.textContent = node.label;\n            \n            let html = `<p><strong>Type:</strong> ${node.type.toUpperCase()}</p>`;\n            html += `<p><strong>Occurrences:</strong> ${node.count}</p>`;\n            \n            // Find connections\n            const connections = graphData.links.filter(l => \n                l.source.id === node.id || l.target.id === node.id\n            );\n            \n            if (connections.length > 0) {\n                html += `<p><strong>Connections:</strong> ${connections.length}</p>`;\n                html += '<ul style=\"margin: 10px 0; padding-left: 20px;\">';\n                connections.slice(0, 10).forEach(link => {\n                    const otherNode = link.source.id === node.id ? link.target : link.source;\n                    html += `<li>${link.type.replace(/_/g, ' ')}: ${otherNode.label}</li>`;\n                });\n                if (connections.length > 10) {\n                    html += `<li>...and ${connections.length - 10} more</li>`;\n                }\n                html += '</ul>';\n            }\n            \n            if (node.details && node.details.length > 0) {\n                html += '<p><strong>Associated Files:</strong></p>';\n                html += '<ul style=\"margin: 10px 0; padding-left: 20px; max-height: 150px; overflow-y: auto;\">';\n                node.details.slice(0, 10).forEach(file => {\n                    html += `<li>${file}</li>`;\n                });\n                if (node.details.length > 10) {\n                    html += `<li>...and ${node.details.length - 10} more</li>`;\n                }\n                html += '</ul>';\n            }\n            \n            detailsContent.innerHTML = html;\n            detailsPanel.style.display = 'block';\n        }\n        \n        function resetGraph() {\n            if (graphSimulation) {\n                graphSimulation.alpha(1).restart();\n            }\n        }\n        \n        function centerGraph() {\n            if (graphSvg) {\n                graphSvg.transition().duration(750).call(\n                    d3.zoom().transform,\n                    d3.zoomIdentity\n                );\n            }\n        }\n        \n        function setChartDays(days) {\n            currentChartDays = days;\n            \n            // Update button states\n            document.querySelectorAll('.chart-btn').forEach(btn => {\n                btn.classList.remove('active');\n            });\n            event.target.classList.add('active');\n            \n            loadDailyChart();\n        }\n        \n        function loadData() {\n            loadStats();\n            loadScans();\n            loadDailyChart();\n            loadMalwareSources();\n            loadEmergingThreats();\n            loadCorrelationGraph();\n            loadGeoMap();\n        }\n        \n        function loadDataWithoutMap() {\n            loadStats();\n            loadScans();\n            loadDailyChart();\n            loadMalwareSources();\n            loadEmergingThreats();\n            loadCorrelationGraph();\n        }\n        \n        // Initial load\n        loadData();\n        \n        // Set up Server-Sent Events for real-time updates\n        const eventSource = new EventSource('/api/events');\n        \n        eventSource.onmessage = function(event) {\n            const data = JSON.parse(event.data);\n            \n            if (data.type === 'connected') {\n                console.log('Connected to server for real-time updates');\n            } else if (data.type === 'new-scan') {\n                console.log('New scan received:', data.scan.detected_filename);\n                // Reload all data when new scan arrives\n                loadDataWithoutMap();\n                // Update map less frequently (only if it's been more than 10 seconds)\n                if (!window.lastMapUpdate || Date.now() - window.lastMapUpdate > 10000) {\n                    loadGeoMap();\n                    window.lastMapUpdate = Date.now();\n                }\n            }\n        };\n        \n        eventSource.onerror = function(error) {\n            console.error('SSE Error:', error);\n            // Fallback: reload data every 30 seconds if SSE connection fails\n            if (eventSource.readyState === EventSource.CLOSED) {\n                console.log('SSE connection closed, falling back to polling...');\n                setInterval(loadDataWithoutMap, 30000);\n            }\n        };\n        \n        // Manual refresh button functionality\n        window.manualRefresh = function() {\n            loadData();\n        };\n    </script>\n</body>\n</html>","epoch":47,"telemetryInfo":{}}],["file:///home/trang/localnsv/mAIware-server/public/styles.css::request_05a5b84a-3891-424e-ba29-a5ab551da634",{"uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware-server/public/styles.css","external":"file:///home/trang/localnsv/mAIware-server/public/styles.css","path":"/home/trang/localnsv/mAIware-server/public/styles.css","scheme":"file"},"requestId":"request_05a5b84a-3891-424e-ba29-a5ab551da634","content":":root {\n    --bg-primary: #000000;\n    --bg-secondary: #0a0a0a;\n    --bg-card: #0f0f0f;\n    --bg-hover: #151515;\n    --text-primary: #e8f0e8;\n    --text-secondary: #9ca3af;\n    --accent-green: #39ff14;\n    --accent-green-dim: #2ed60f;\n    --accent-yellow: #ffd700;\n    --accent-red: #ff3b3b;\n    --accent-red-dim: #cc2f2f;\n    --border-color: #1a1a1a;\n    --shadow-color: rgba(0, 0, 0, 0.5);\n    --success-glow: rgba(57, 255, 20, 0.3);\n    --danger-glow: rgba(255, 59, 59, 0.3);\n    --warning-glow: rgba(255, 215, 0, 0.3);\n}\n\n[data-theme=\"light\"] {\n    --bg-primary: #f0f4f0;\n    --bg-secondary: #ffffff;\n    --bg-card: #fafafa;\n    --bg-hover: #e8f5e8;\n    --text-primary: #1a1f2e;\n    --text-secondary: #4a5568;\n    --accent-green: #2ed60f;\n    --accent-green-dim: #27b00c;\n    --accent-yellow: #cc9a00;\n    --accent-red: #dc2626;\n    --accent-red-dim: #b91c1c;\n    --border-color: #d1d5db;\n    --shadow-color: rgba(0, 0, 0, 0.1);\n    --success-glow: rgba(46, 214, 15, 0.2);\n    --danger-glow: rgba(220, 38, 38, 0.2);\n    --warning-glow: rgba(204, 154, 0, 0.2);\n}\n\n* { \n    margin: 0; \n    padding: 0; \n    box-sizing: border-box; \n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background: var(--bg-primary);\n    color: var(--text-primary);\n    min-height: 100vh;\n    margin: 0;\n    overflow-x: hidden;\n    position: relative;\n}\n\nbody::before {\n    content: '';\n    position: fixed;\n    top: -50%;\n    left: -50%;\n    width: 200%;\n    height: 200%;\n    background: \n        radial-gradient(circle at 20% 50%, rgba(57, 255, 20, 0.08) 0%, transparent 50%),\n        radial-gradient(circle at 80% 80%, rgba(57, 255, 20, 0.06) 0%, transparent 50%),\n        radial-gradient(circle at 40% 20%, rgba(57, 255, 20, 0.05) 0%, transparent 50%);\n    animation: backgroundGlow 15s ease-in-out infinite;\n    pointer-events: none;\n    z-index: 0;\n}\n\n@keyframes backgroundGlow {\n    0%, 100% { \n        transform: translate(0, 0) scale(1);\n        opacity: 0.4;\n    }\n    33% { \n        transform: translate(10%, 10%) scale(1.1);\n        opacity: 0.6;\n    }\n    66% { \n        transform: translate(-10%, 5%) scale(0.95);\n        opacity: 0.5;\n    }\n}\n\nbody > * {\n    position: relative;\n    z-index: 1;\n}\n\n/* Side Panel Navigation */\n.side-panel {\n    position: fixed;\n    left: 0;\n    top: 0;\n    height: 100vh;\n    width: 70px;\n    background: rgba(10, 10, 10, 0.7);\n    backdrop-filter: blur(20px);\n    -webkit-backdrop-filter: blur(20px);\n    border-right: 1px solid rgba(57, 255, 20, 0.2);\n    box-shadow: 0 0 30px rgba(57, 255, 20, 0.1);\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    z-index: 9999;\n    transition: all 0.3s ease;\n}\n\n.side-panel:hover {\n    background: rgba(15, 15, 15, 0.8);\n    box-shadow: 0 0 40px rgba(57, 255, 20, 0.2);\n}\n\n.panel-icon-strip {\n    width: 100%;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    padding: 2rem 0;\n}\n\n.panel-logo-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 50px;\n    height: 50px;\n    color: var(--accent-green);\n    font-size: 2rem;\n    animation: pulse-glow 3s ease-in-out infinite;\n    cursor: pointer;\n    transition: all 0.3s ease;\n}\n\n.panel-logo-icon:hover {\n    transform: scale(1.1);\n    filter: drop-shadow(0 0 20px var(--success-glow));\n}\n\n@keyframes pulse-glow {\n    0%, 100% { filter: drop-shadow(0 0 5px var(--success-glow)); }\n    50% { filter: drop-shadow(0 0 15px var(--success-glow)) drop-shadow(0 0 25px var(--success-glow)); }\n}\n\n/* Graphs Preview Grid */\n.graphs-preview {\n    position: fixed;\n    left: 70px;\n    top: 50%;\n    transform: translateY(-50%) translateX(-100%);\n    background: rgba(10, 10, 10, 0.85);\n    backdrop-filter: blur(25px);\n    -webkit-backdrop-filter: blur(25px);\n    border: 1px solid rgba(57, 255, 20, 0.3);\n    border-left: none;\n    border-radius: 0 12px 12px 0;\n    padding: 2rem;\n    width: 480px;\n    max-height: 90vh;\n    overflow-y: auto;\n    opacity: 0;\n    visibility: hidden;\n    pointer-events: none;\n    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);\n    box-shadow: 5px 0 40px rgba(57, 255, 20, 0.15), 0 0 0 1px rgba(57, 255, 20, 0.2);\n    z-index: 9998;\n    backdrop-filter: blur(10px);\n}\n\n.graphs-preview::-webkit-scrollbar {\n    width: 6px;\n}\n\n.graphs-preview::-webkit-scrollbar-track {\n    background: var(--bg-secondary);\n    border-radius: 3px;\n}\n\n.graphs-preview::-webkit-scrollbar-thumb {\n    background: var(--accent-green);\n    border-radius: 3px;\n}\n\n.graphs-preview.show {\n    opacity: 1;\n    visibility: visible;\n    pointer-events: auto;\n    transform: translateY(-50%) translateX(0);\n}\n\n.preview-header {\n    margin-bottom: 1rem;\n    padding-bottom: 0.8rem;\n    border-bottom: 1px solid var(--border-color);\n}\n\n.preview-header h3 {\n    color: var(--accent-green);\n    font-size: 1.1rem;\n    margin-bottom: 0.3rem;\n}\n\n.preview-header p {\n    color: var(--text-secondary);\n    font-size: 0.85rem;\n}\n\n/* Analytics Miniview - Scaled down live view */\n.analytics-miniview {\n    position: relative;\n    width: 100%;\n    height: 70vh;\n    background: var(--bg-secondary);\n    border: 2px solid var(--border-color);\n    border-radius: 8px;\n    overflow: hidden;\n    cursor: pointer;\n    transition: all 0.3s ease;\n}\n\n.analytics-miniview:hover {\n    border-color: var(--accent-green);\n    box-shadow: 0 0 30px var(--success-glow);\n}\n\n.miniview-content {\n    width: 100%;\n    height: 100%;\n    transform-origin: top left;\n    transform: scale(0.25);\n    width: 400%;\n    height: 400%;\n    pointer-events: none;\n    overflow: hidden;\n}\n\n.miniview-overlay {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: rgba(10, 14, 20, 0.7);\n    backdrop-filter: blur(1px);\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    gap: 1rem;\n    opacity: 0;\n    transition: opacity 0.3s ease;\n    pointer-events: none;\n}\n\n.analytics-miniview:hover .miniview-overlay {\n    opacity: 1;\n}\n\n.miniview-overlay i {\n    font-size: 3rem;\n    color: var(--accent-green);\n    animation: pulse-scale 2s ease-in-out infinite;\n}\n\n.miniview-overlay span {\n    font-size: 1.2rem;\n    font-weight: 600;\n    color: var(--text-primary);\n    text-transform: uppercase;\n    letter-spacing: 1px;\n}\n.preview-home-nav {\n    margin-top: 1.5rem;\n    padding: 1rem;\n    background: var(--bg-secondary);\n    border: 2px solid var(--border-color);\n    border-radius: 10px;\n    display: flex;\n    align-items: center;\n    gap: 0.8rem;\n    cursor: pointer;\n    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n    opacity: 0;\n    visibility: hidden;\n    transform: translateY(10px);\n}\n\n.preview-home-nav.visible {\n    opacity: 1;\n    visibility: visible;\n    transform: translateY(0);\n}\n\n.preview-home-nav:hover {\n    background: var(--bg-hover);\n    border-color: var(--accent-green);\n    box-shadow: 0 5px 20px var(--success-glow);\n    transform: translateY(-2px);\n}\n\n.preview-home-nav i {\n    font-size: 1.5rem;\n    color: var(--accent-green);\n}\n\n.preview-home-nav span {\n    font-size: 1rem;\n    font-weight: 600;\n    color: var(--text-primary);\n}\n\n.preview-label {\n    flex: 1;\n    font-size: 0.95rem;\n    font-weight: 600;\n    color: var(--text-primary);\n    letter-spacing: 0.3px;\n}\n\n/* Analytics Miniview - Screenshot preview */\n.analytics-miniview {\n    position: relative;\n    width: 100%;\n    height: 70vh;\n    background: var(--bg-secondary);\n    border: 2px solid var(--border-color);\n    border-radius: 8px;\n    overflow: hidden;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    padding: 1.5rem;\n}\n\n.analytics-miniview:hover {\n    border-color: var(--accent-green);\n    box-shadow: 0 0 30px var(--success-glow);\n}\n\n.miniview-preview {\n    width: 100%;\n    height: 100%;\n    display: flex;\n    flex-direction: column;\n    gap: 1rem;\n    opacity: 0.7;\n}\n\n.preview-row {\n    display: flex;\n    gap: 1rem;\n    flex: 1;\n}\n\n.preview-box {\n    flex: 1;\n    background: rgba(15, 15, 15, 0.5);\n    backdrop-filter: blur(10px);\n    border: 1px solid rgba(57, 255, 20, 0.2);\n    border-radius: 6px;\n    position: relative;\n    overflow: hidden;\n    padding: 0.5rem;\n}\n\n.preview-box.large {\n    flex: 2;\n}\n\n.preview-box.wide {\n    flex: 1;\n    min-height: 150px;\n}\n\n.box-header {\n    font-size: 0.65rem;\n    color: var(--accent-green);\n    margin-bottom: 0.5rem;\n    opacity: 0.8;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.box-content {\n    height: calc(100% - 1.5rem);\n    position: relative;\n}\n\n.map-visual {\n    background: radial-gradient(circle at center, rgba(57, 255, 20, 0.05), transparent);\n    position: relative;\n}\n\n.map-dot {\n    position: absolute;\n    width: 8px;\n    height: 8px;\n    background: var(--accent-green);\n    border-radius: 50%;\n    box-shadow: 0 0 10px var(--accent-green);\n    animation: map-pulse 2s ease-in-out infinite;\n}\n\n.map-dot:nth-child(2) { animation-delay: 0.5s; }\n.map-dot:nth-child(3) { animation-delay: 1s; }\n\n@keyframes map-pulse {\n    0%, 100% { transform: scale(1); opacity: 0.6; }\n    50% { transform: scale(1.5); opacity: 1; }\n}\n\n.chart-visual {\n    display: flex;\n    align-items: flex-end;\n    justify-content: space-around;\n    height: 100%;\n    padding: 0.5rem;\n    gap: 0.3rem;\n}\n\n.chart-bar {\n    flex: 1;\n    background: linear-gradient(180deg, var(--accent-green), transparent);\n    border-radius: 2px;\n    animation: bar-grow 2s ease-in-out infinite;\n    opacity: 0.7;\n}\n\n.chart-bar:nth-child(2) { animation-delay: 0.2s; }\n.chart-bar:nth-child(3) { animation-delay: 0.4s; }\n.chart-bar:nth-child(4) { animation-delay: 0.6s; }\n\n@keyframes bar-grow {\n    0%, 100% { transform: scaleY(0.8); }\n    50% { transform: scaleY(1); }\n}\n\n.list-visual {\n    display: flex;\n    flex-direction: column;\n    gap: 0.4rem;\n    padding: 0.3rem;\n}\n\n.list-item {\n    height: 0.4rem;\n    background: linear-gradient(90deg, var(--accent-green), transparent);\n    border-radius: 2px;\n    opacity: 0.6;\n    animation: list-fade 3s ease-in-out infinite;\n}\n\n.list-item:nth-child(2) { animation-delay: 0.5s; width: 80%; }\n.list-item:nth-child(3) { animation-delay: 1s; width: 60%; }\n\n@keyframes list-fade {\n    0%, 100% { opacity: 0.4; }\n    50% { opacity: 0.8; }\n}\n\n.network-visual {\n    position: relative;\n    height: 100%;\n}\n\n.network-node {\n    position: absolute;\n    width: 6px;\n    height: 6px;\n    background: var(--accent-green);\n    border-radius: 50%;\n    box-shadow: 0 0 8px var(--accent-green);\n    animation: node-pulse 3s ease-in-out infinite;\n}\n\n.network-node:nth-child(2) { animation-delay: 0.7s; }\n.network-node:nth-child(3) { animation-delay: 1.4s; }\n\n@keyframes node-pulse {\n    0%, 100% { transform: scale(1); opacity: 0.5; }\n    50% { transform: scale(1.3); opacity: 1; }\n}\n\n.heat-visual {\n    background: \n        radial-gradient(circle at 30% 30%, rgba(57, 255, 20, 0.3), transparent 40%),\n        radial-gradient(circle at 70% 60%, rgba(57, 255, 20, 0.2), transparent 40%),\n        radial-gradient(circle at 50% 80%, rgba(57, 255, 20, 0.25), transparent 40%);\n    animation: heat-shift 4s ease-in-out infinite;\n}\n\n@keyframes heat-shift {\n    0%, 100% { opacity: 0.5; }\n    50% { opacity: 0.8; }\n}\n\n.pie-visual {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    height: 100%;\n}\n\n.pie-chart {\n    width: 40px;\n    height: 40px;\n    border-radius: 50%;\n    background: conic-gradient(\n        var(--accent-green) 0deg 120deg,\n        var(--accent-yellow) 120deg 240deg,\n        var(--accent-red) 240deg 360deg\n    );\n    box-shadow: 0 0 15px rgba(57, 255, 20, 0.4);\n    animation: pie-spin 10s linear infinite;\n}\n\n@keyframes pie-spin {\n    0% { transform: rotate(0deg); }\n    100% { transform: rotate(360deg); }\n}\n\n.miniview-overlay {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: rgba(10, 14, 20, 0.7);\n    backdrop-filter: blur(1px);\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    gap: 1rem;\n    opacity: 0;\n    transition: opacity 0.3s ease;\n    pointer-events: none;\n}\n\n.analytics-miniview:hover .miniview-overlay {\n    opacity: 1;\n}\n\n.miniview-overlay i {\n    font-size: 3rem;\n    color: var(--accent-green);\n    animation: pulse-scale 2s ease-in-out infinite;\n}\n\n.miniview-overlay span {\n    font-size: 1.2rem;\n    font-weight: 600;\n    color: var(--text-primary);\n    text-transform: uppercase;\n    letter-spacing: 1px;\n}\n\n/* Main Content Area */\n.main-content {\n    margin-left: 70px;\n    min-height: 100vh;\n    padding: 2rem;\n    transition: margin-left 0.4s cubic-bezier(0.4, 0, 0.2, 1);\n    position: relative;\n}\n\n/* Backdrop overlay for preview panel */\n.preview-backdrop {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    background: rgba(0, 0, 0, 0.4);\n    backdrop-filter: blur(2px);\n    opacity: 0;\n    visibility: hidden;\n    transition: all 0.3s ease;\n    z-index: 9998;\n    pointer-events: none;\n}\n\n.preview-backdrop.show {\n    opacity: 1;\n    visibility: visible;\n}\n\n/* View Containers */\n.view-container {\n    display: none;\n    animation: fadeIn 0.4s ease-in-out;\n}\n\n.view-container.active {\n    display: block;\n}\n\n@keyframes fadeIn {\n    from {\n        opacity: 0;\n        transform: translateY(10px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n/* Dashboard Header */\n.dashboard-header {\n    text-align: center;\n    margin-bottom: 2.5rem;\n}\n\n.header-content h1 {\n    font-size: 2.5rem;\n    margin-bottom: 0.5rem;\n    color: var(--accent-green);\n    font-weight: 700;\n    letter-spacing: 2px;\n}\n\n.header-content .subtitle {\n    font-size: 1.2rem;\n    color: var(--text-secondary);\n    font-weight: 500;\n}\n\n.pulse-icon {\n    display: inline-block;\n    animation: pulse-scale 2s ease-in-out infinite;\n}\n\n@keyframes pulse-scale {\n    0%, 100% {\n        transform: scale(1);\n        filter: drop-shadow(0 0 5px var(--success-glow));\n    }\n    50% {\n        transform: scale(1.05);\n        filter: drop-shadow(0 0 15px var(--success-glow));\n    }\n}\n\n/* Animations */\n.animate-slide-in {\n    animation: slideIn 0.6s ease-out;\n}\n\n@keyframes slideIn {\n    from {\n        opacity: 0;\n        transform: translateX(-30px);\n    }\n    to {\n        opacity: 1;\n        transform: translateX(0);\n    }\n}\n\n.animate-fade-in {\n    animation: fadeInUp 0.6s ease-out;\n}\n\n@keyframes fadeInUp {\n    from {\n        opacity: 0;\n        transform: translateY(20px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n.container {\n    max-width: 1400px;\n    margin: 0 auto;\n}\n\n/* Theme Toggle Button */\n.theme-toggle {\n    position: fixed;\n    top: 20px;\n    right: 20px;\n    z-index: 10000;\n    background: rgba(15, 15, 15, 0.6);\n    backdrop-filter: blur(20px);\n    -webkit-backdrop-filter: blur(20px);\n    border: 1px solid rgba(57, 255, 20, 0.3);\n    border-radius: 50px;\n    padding: 10px 20px;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    font-size: 1rem;\n    color: var(--text-primary);\n    transition: all 0.3s ease;\n    box-shadow: 0 4px 20px rgba(57, 255, 20, 0.2);\n    font-weight: 600;\n}\n\n.theme-toggle:hover {\n    background: rgba(15, 15, 15, 0.8);\n    border-color: var(--accent-green);\n    box-shadow: 0 0 30px var(--success-glow);\n    transform: translateY(-2px);\n}\n\n.theme-toggle .icon {\n    font-size: 1.2rem;\n}\n\n/* Threat Ticker */\n.threat-ticker-container {\n    background: var(--bg-secondary);\n    border: 2px solid var(--accent-green);\n    border-radius: 8px;\n    padding: 12px;\n    margin-bottom: 2rem;\n    display: flex;\n    align-items: center;\n    gap: 16px;\n    overflow: hidden;\n    box-shadow: 0 2px 8px var(--success-glow);\n}\n\n.ticker-label {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 8px 16px;\n    background: linear-gradient(135deg, #ff4757, #ff6348);\n    border-radius: 6px;\n    font-weight: 700;\n    font-size: 0.75rem;\n    color: #fff;\n    white-space: nowrap;\n    box-shadow: 0 2px 8px rgba(255, 71, 87, 0.4);\n}\n\n.ticker-label i {\n    animation: pulse-broadcast 2s infinite;\n}\n\n@keyframes pulse-broadcast {\n    0%, 100% { opacity: 1; transform: scale(1); }\n    50% { opacity: 0.6; transform: scale(0.9); }\n}\n\n.threat-ticker {\n    flex: 1;\n    overflow: hidden;\n    position: relative;\n}\n\n.ticker-content {\n    display: flex;\n    gap: 40px;\n    white-space: nowrap;\n    animation: scroll-ticker 30s linear infinite;\n}\n\n.ticker-content:hover {\n    animation-play-state: paused;\n}\n\n@keyframes scroll-ticker {\n    0% { transform: translateX(0); }\n    100% { transform: translateX(-50%); }\n}\n\n.ticker-item {\n    color: #e0e0e0;\n    font-size: 0.9rem;\n    display: inline-flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.ticker-item i {\n    font-size: 0.5rem;\n    animation: blink 1.5s infinite;\n}\n\n@keyframes blink {\n    0%, 100% { opacity: 1; }\n    50% { opacity: 0.3; }\n}\n\n/* Notification System */\n.notification-container {\n    position: fixed;\n    top: 20px;\n    right: 20px;\n    z-index: 10000;\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n    max-width: 400px;\n}\n\n.threat-notification {\n    background: rgba(30, 30, 30, 0.98);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-left: 4px solid #ff4757;\n    border-radius: 8px;\n    padding: 16px;\n    display: flex;\n    gap: 12px;\n    align-items: flex-start;\n    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);\n    transform: translateX(450px);\n    opacity: 0;\n    transition: all 0.3s ease-out;\n}\n\n.threat-notification.show {\n    transform: translateX(0);\n    opacity: 1;\n}\n\n.notification-icon {\n    font-size: 1.5rem;\n    flex-shrink: 0;\n}\n\n.notification-content {\n    flex: 1;\n}\n\n.notification-title {\n    font-size: 0.95rem;\n    color: #e0e0e0;\n    margin-bottom: 4px;\n}\n\n.notification-title strong {\n    text-transform: uppercase;\n    font-weight: 800;\n}\n\n.notification-details {\n    font-size: 0.85rem;\n    color: #b0b0b0;\n    margin-bottom: 6px;\n}\n\n.notification-meta {\n    font-size: 0.75rem;\n    color: #888;\n    display: flex;\n    align-items: center;\n    gap: 6px;\n}\n\n.notification-close {\n    cursor: pointer;\n    color: #666;\n    transition: color 0.2s;\n    font-size: 0.9rem;\n}\n\n.notification-close:hover {\n    color: #e0e0e0;\n}\n\n/* Stat Card Pulse Animation */\n.stat-pulse {\n    animation: stat-pulse-animation 0.6s ease-out;\n}\n\n@keyframes stat-pulse-animation {\n    0% { transform: scale(1); }\n    50% { transform: scale(1.05); box-shadow: 0 8px 24px rgba(90, 156, 248, 0.4); }\n    100% { transform: scale(1); }\n}\n\nh1 {\n    font-size: 2.5rem;\n    color: #5a9cf8;\n    margin-bottom: 0.5rem;\n}\n\n.subtitle {\n    color: #888;\n    font-size: 1.1rem;\n}\n\n.stats-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n    gap: 1.5rem;\n    margin-bottom: 3rem;\n}\n\n.stat-card {\n    background: var(--bg-card);\n    border: 2px solid var(--border-color);\n    border-radius: 12px;\n    padding: 1.5rem;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 0.8rem;\n    position: relative;\n    overflow: hidden;\n    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);\n}\n\n.stat-card::before {\n    content: '';\n    position: absolute;\n    top: -50%;\n    left: -50%;\n    width: 200%;\n    height: 200%;\n    background: radial-gradient(circle, var(--accent-green) 0%, transparent 70%);\n    opacity: 0;\n    transition: opacity 0.4s ease;\n}\n\n.stat-card:hover::before {\n    opacity: 0.05;\n}\n\n.stat-card:hover {\n    transform: translateY(-5px) scale(1.02);\n    border-color: var(--accent-green);\n    box-shadow: 0 10px 30px var(--success-glow);\n}\n\n.stat-card i {\n    font-size: 2.5rem;\n    opacity: 0.8;\n    transition: all 0.3s ease;\n}\n\n.stat-card:hover i {\n    transform: scale(1.1) rotateY(180deg);\n    opacity: 1;\n}\n\n.stat-number {\n    font-size: 2.5rem;\n    font-weight: 700;\n    transition: all 0.3s ease;\n}\n\n.stat-card:hover .stat-number {\n    transform: scale(1.1);\n    text-shadow: 0 0 20px currentColor;\n}\n\n.stat-label {\n    font-size: 0.9rem;\n    color: var(--text-secondary);\n    font-weight: 600;\n}\n\n.stat-glow {\n    position: absolute;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    height: 3px;\n    background: linear-gradient(90deg, transparent, var(--accent-green), transparent);\n    opacity: 0;\n    transition: opacity 0.4s ease;\n}\n\n.stat-card:hover .stat-glow {\n    opacity: 1;\n    animation: glowSlide 2s ease-in-out infinite;\n}\n\n@keyframes glowSlide {\n    0%, 100% {\n        transform: translateX(-100%);\n    }\n    50% {\n        transform: translateX(100%);\n    }\n}\n\n.stat-card.malware {\n    border-color: rgba(255, 59, 59, 0.3);\n}\n\n.stat-card.malware i,\n.stat-card.malware .stat-number {\n    color: var(--accent-red);\n}\n\n.stat-card.malware:hover {\n    border-color: var(--accent-red);\n    box-shadow: 0 10px 30px var(--danger-glow);\n}\n\n.stat-card.suspicious {\n    border-color: rgba(255, 215, 0, 0.3);\n}\n\n.stat-card.suspicious i,\n.stat-card.suspicious .stat-number {\n    color: var(--accent-yellow);\n}\n\n.stat-card.suspicious:hover {\n    border-color: var(--accent-yellow);\n    box-shadow: 0 10px 30px var(--warning-glow);\n}\n\n.stat-card.benign i,\n.stat-card.benign .stat-number,\n.stat-card.info i,\n.stat-card.info .stat-number {\n    color: var(--accent-green);\n}\n\n/* Analytics View */\n.analytics-header {\n    display: flex;\n    align-items: center;\n    gap: 2rem;\n    margin-bottom: 2.5rem;\n}\n\n.back-btn {\n    background: var(--bg-card);\n    border: 2px solid var(--accent-green);\n    color: var(--accent-green);\n    padding: 0.8rem 1.5rem;\n    border-radius: 8px;\n    font-size: 1rem;\n    font-weight: 600;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    transition: all 0.3s ease;\n}\n\n.back-btn:hover {\n    background: var(--accent-green);\n    color: var(--bg-primary);\n    transform: translateX(-5px);\n    box-shadow: 0 5px 20px var(--success-glow);\n}\n\n.analytics-header h1 {\n    font-size: 2rem;\n    color: var(--accent-green);\n    font-weight: 700;\n}\n\n.analytics-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));\n    gap: 2rem;\n    max-height: calc(100vh - 200px);\n    overflow-y: auto;\n    padding-right: 1rem;\n    grid-auto-flow: dense;\n}\n\n/* Panel size classes for flexible tiling */\n.analytics-panel.panel-small {\n    grid-column: span 1;\n}\n\n.analytics-panel.panel-medium {\n    grid-column: span 1;\n}\n\n.analytics-panel.panel-large {\n    grid-column: span 2;\n}\n\n@media (max-width: 1400px) {\n    .analytics-grid {\n        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));\n    }\n    \n    .analytics-panel.panel-large {\n        grid-column: span 1;\n    }\n}\n\n.analytics-grid::-webkit-scrollbar {\n    width: 8px;\n}\n\n.analytics-grid::-webkit-scrollbar-track {\n    background: var(--bg-secondary);\n    border-radius: 4px;\n}\n\n.analytics-grid::-webkit-scrollbar-thumb {\n    background: var(--accent-green);\n    border-radius: 4px;\n}\n\n.analytics-grid::-webkit-scrollbar-thumb:hover {\n    background: var(--accent-green-dim);\n}\n\n.analytics-panel {\n    animation: slideInPanel 0.5s ease-out;\n    animation-fill-mode: backwards;\n}\n\n.analytics-panel:nth-child(1) { animation-delay: 0.05s; }\n.analytics-panel:nth-child(2) { animation-delay: 0.1s; }\n.analytics-panel:nth-child(3) { animation-delay: 0.15s; }\n.analytics-panel:nth-child(4) { animation-delay: 0.2s; }\n.analytics-panel:nth-child(5) { animation-delay: 0.25s; }\n.analytics-panel:nth-child(6) { animation-delay: 0.3s; }\n\n@keyframes slideInPanel {\n    from {\n        opacity: 0;\n        transform: translateY(30px) scale(0.95);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0) scale(1);\n    }\n}\n\n/* Advanced Analytics Grid for Mini Charts */\n.advanced-analytics-grid {\n    background: rgba(15, 15, 15, 0.5);\n    backdrop-filter: blur(10px);\n    border: 1px solid rgba(57, 255, 20, 0.2);\n    border-radius: 12px;\n    padding: 1.5rem;\n}\n\n.mini-charts-grid {\n    display: grid;\n    grid-template-columns: repeat(2, 1fr);\n    gap: 1.5rem;\n    margin-top: 1rem;\n}\n\n.mini-chart-container {\n    background: rgba(10, 10, 10, 0.6);\n    border: 1px solid rgba(57, 255, 20, 0.15);\n    border-radius: 8px;\n    padding: 1rem;\n}\n\n.mini-chart-container h3 {\n    color: var(--accent-green);\n    font-size: 0.95rem;\n    margin: 0 0 0.75rem 0;\n    font-weight: 600;\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n}\n\n.mini-chart-container h3 i {\n    font-size: 0.9rem;\n}\n\n@media (max-width: 1200px) {\n    .mini-charts-grid {\n        grid-template-columns: 1fr;\n    }\n}\n\n/* Emerging Threat Intelligence Panel */\n.eti-container {\n    background: linear-gradient(135deg, rgba(255, 71, 87, 0.1) 0%, rgba(255, 165, 2, 0.1) 100%);\n    border: 2px solid rgba(255, 71, 87, 0.3);\n    border-radius: 12px;\n    padding: 24px;\n    margin-bottom: 3rem;\n    box-shadow: 0 4px 16px rgba(255, 71, 87, 0.2);\n}\n\n.eti-header {\n    margin-bottom: 24px;\n}\n\n.eti-header h2 {\n    margin: 0 0 8px 0;\n    font-size: 1.8rem;\n    color: #ff6b6b;\n    text-shadow: 0 2px 4px rgba(255, 71, 87, 0.3);\n}\n\n.eti-header h2 i {\n    color: #ff4757;\n    margin-right: 10px;\n    animation: pulse 2s infinite;\n}\n\n@keyframes pulse {\n    0%, 100% { opacity: 1; }\n    50% { opacity: 0.6; }\n}\n\n.eti-subtitle {\n    color: #b0b0b0;\n    font-size: 0.95rem;\n    margin: 8px 0 16px 0;\n}\n\n.eti-summary {\n    display: flex;\n    gap: 12px;\n    flex-wrap: wrap;\n}\n\n.eti-badge {\n    background: rgba(90, 156, 248, 0.2);\n    border: 1px solid rgba(90, 156, 248, 0.4);\n    color: #5a9cf8;\n    padding: 6px 14px;\n    border-radius: 20px;\n    font-size: 0.85rem;\n    font-weight: 600;\n}\n\n.eti-badge.recent {\n    background: rgba(255, 71, 87, 0.2);\n    border-color: rgba(255, 71, 87, 0.4);\n    color: #ff6b6b;\n}\n\n.eti-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));\n    gap: 20px;\n}\n\n.eti-panel {\n    background: rgba(0, 0, 0, 0.3);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: 10px;\n    padding: 18px;\n    transition: transform 0.3s, box-shadow 0.3s;\n}\n\n.eti-panel:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);\n}\n\n.eti-panel h3 {\n    margin: 0 0 6px 0;\n    font-size: 1.1rem;\n    color: #e0e0e0;\n}\n\n.eti-panel h3 i {\n    color: #ffa502;\n    margin-right: 8px;\n}\n\n.eti-subtitle-small {\n    color: #888;\n    font-size: 0.8rem;\n    margin-bottom: 14px;\n}\n\n.eti-list {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n}\n\n.eti-item {\n    display: flex;\n    gap: 12px;\n    background: rgba(255, 255, 255, 0.03);\n    border: 1px solid rgba(255, 255, 255, 0.08);\n    border-radius: 8px;\n    padding: 12px;\n    transition: all 0.3s;\n}\n\n.eti-item:hover {\n    background: rgba(255, 255, 255, 0.06);\n    border-color: rgba(255, 165, 2, 0.4);\n    transform: translateX(4px);\n}\n\n.eti-rank {\n    flex-shrink: 0;\n    width: 32px;\n    height: 32px;\n    background: linear-gradient(135deg, #ff6b6b, #ffa502);\n    border-radius: 50%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-weight: bold;\n    font-size: 1rem;\n    color: #fff;\n    box-shadow: 0 2px 8px rgba(255, 107, 107, 0.4);\n}\n\n.eti-item[data-rank=\"1\"] .eti-rank {\n    background: linear-gradient(135deg, #ff4757, #ff6348);\n    transform: scale(1.1);\n}\n\n.eti-content {\n    flex: 1;\n    min-width: 0;\n}\n\n.eti-name {\n    font-weight: 600;\n    color: #e0e0e0;\n    font-size: 0.95rem;\n    margin-bottom: 4px;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n}\n\n.eti-meta {\n    display: flex;\n    gap: 8px;\n    flex-wrap: wrap;\n    align-items: center;\n}\n\n.eti-count {\n    color: #888;\n    font-size: 0.8rem;\n}\n\n.eti-recent-badge {\n    background: rgba(255, 71, 87, 0.2);\n    border: 1px solid rgba(255, 71, 87, 0.4);\n    color: #ff6b6b;\n    padding: 2px 8px;\n    border-radius: 10px;\n    font-size: 0.75rem;\n    font-weight: 600;\n}\n\n.eti-agent-badge {\n    background: rgba(90, 156, 248, 0.2);\n    border: 1px solid rgba(90, 156, 248, 0.4);\n    color: #5a9cf8;\n    padding: 2px 8px;\n    border-radius: 10px;\n    font-size: 0.75rem;\n    font-weight: 600;\n}\n\n.eti-details {\n    margin-top: 6px;\n    color: #999;\n    font-size: 0.75rem;\n    font-style: italic;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n}\n\n.eti-empty {\n    text-align: center;\n    color: #666;\n    padding: 20px;\n    font-style: italic;\n}\n\n/* Threat Modeler */\n.modeler-container {\n    background: linear-gradient(135deg, rgba(90, 156, 248, 0.1) 0%, rgba(38, 222, 129, 0.1) 100%);\n    border: 2px solid rgba(90, 156, 248, 0.3);\n    border-radius: 12px;\n    padding: 24px;\n    margin-bottom: 3rem;\n    box-shadow: 0 4px 16px rgba(90, 156, 248, 0.2);\n}\n\n.modeler-header {\n    margin-bottom: 24px;\n}\n\n.modeler-header h2 {\n    margin: 0 0 8px 0;\n    font-size: 1.8rem;\n    color: #5a9cf8;\n}\n\n.modeler-header h2 i {\n    color: #26de81;\n    margin-right: 10px;\n}\n\n.modeler-subtitle {\n    color: #b0b0b0;\n    font-size: 0.95rem;\n    margin: 0;\n}\n\n.modeler-grid {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 24px;\n}\n\n@media (max-width: 1024px) {\n    .modeler-grid {\n        grid-template-columns: 1fr;\n    }\n}\n\n.modeler-builder,\n.modeler-results {\n    background: rgba(0, 0, 0, 0.3);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: 10px;\n    padding: 20px;\n}\n\n.modeler-builder h3,\n.modeler-results h3 {\n    margin: 0 0 20px 0;\n    font-size: 1.2rem;\n    color: #e0e0e0;\n    border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n    padding-bottom: 10px;\n}\n\n.modeler-builder h3 i {\n    color: #26de81;\n    margin-right: 8px;\n}\n\n.modeler-results h3 i {\n    color: #5a9cf8;\n    margin-right: 8px;\n}\n\n.modeler-field {\n    margin-bottom: 20px;\n}\n\n.modeler-field label {\n    display: block;\n    color: #b0b0b0;\n    font-size: 0.9rem;\n    margin-bottom: 6px;\n    font-weight: 600;\n}\n\n.modeler-select {\n    width: 100%;\n    background: rgba(255, 255, 255, 0.05);\n    border: 1px solid rgba(255, 255, 255, 0.2);\n    border-radius: 6px;\n    color: #e0e0e0;\n    padding: 10px;\n    font-size: 0.9rem;\n    font-family: inherit;\n    cursor: pointer;\n    transition: all 0.3s;\n}\n\n.modeler-select:focus {\n    outline: none;\n    border-color: #5a9cf8;\n    background: rgba(90, 156, 248, 0.1);\n}\n\n.modeler-select option {\n    background: #1a1a2e;\n    color: #e0e0e0;\n    padding: 8px;\n}\n\n.modeler-hint {\n    display: block;\n    color: #666;\n    font-size: 0.75rem;\n    margin-top: 4px;\n    font-style: italic;\n}\n\n.modeler-analyze-btn {\n    width: 100%;\n    background: linear-gradient(135deg, #26de81, #20bf6b);\n    border: none;\n    color: #fff;\n    padding: 14px 24px;\n    border-radius: 8px;\n    font-size: 1rem;\n    font-weight: 700;\n    cursor: pointer;\n    transition: all 0.3s;\n    box-shadow: 0 4px 12px rgba(38, 222, 129, 0.3);\n}\n\n.modeler-analyze-btn:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 6px 16px rgba(38, 222, 129, 0.4);\n}\n\n.modeler-analyze-btn i {\n    margin-right: 8px;\n}\n\n.modeler-output {\n    min-height: 400px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n\n.modeler-placeholder {\n    text-align: center;\n    color: #666;\n}\n\n.modeler-placeholder i {\n    font-size: 3rem;\n    margin-bottom: 16px;\n    opacity: 0.5;\n}\n\n.modeler-placeholder p {\n    font-size: 0.95rem;\n}\n\n.modeler-loading {\n    text-align: center;\n    color: #5a9cf8;\n}\n\n.modeler-loading i {\n    font-size: 3rem;\n    margin-bottom: 16px;\n}\n\n.modeler-error {\n    text-align: center;\n    color: #ff4757;\n}\n\n.modeler-error i {\n    font-size: 3rem;\n    margin-bottom: 16px;\n}\n\n.prediction-result {\n    width: 100%;\n}\n\n.prediction-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 24px;\n    padding: 20px;\n    background: rgba(255, 255, 255, 0.05);\n    border-radius: 8px;\n}\n\n.prediction-badge {\n    padding: 12px 24px;\n    border-radius: 8px;\n    font-size: 1.3rem;\n    font-weight: 800;\n    color: #fff;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n}\n\n.prediction-confidence {\n    text-align: right;\n}\n\n.confidence-label {\n    color: #888;\n    font-size: 0.8rem;\n    margin-bottom: 4px;\n}\n\n.confidence-value {\n    color: #5a9cf8;\n    font-size: 2rem;\n    font-weight: 800;\n}\n\n.prediction-family {\n    padding: 16px;\n    background: rgba(255, 71, 87, 0.1);\n    border-left: 4px solid #ff4757;\n    border-radius: 6px;\n    margin-bottom: 20px;\n    color: #e0e0e0;\n}\n\n.family-name {\n    color: #ff6b6b;\n    font-weight: 700;\n    font-size: 1.1rem;\n    margin-left: 8px;\n}\n\n.prediction-section {\n    margin-bottom: 20px;\n}\n\n.prediction-section h4 {\n    color: #5a9cf8;\n    font-size: 1rem;\n    margin: 0 0 12px 0;\n    border-bottom: 1px solid rgba(90, 156, 248, 0.3);\n    padding-bottom: 6px;\n}\n\n.analysis-item {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    padding: 8px 0;\n    color: #b0b0b0;\n    font-size: 0.9rem;\n}\n\n.analysis-item i {\n    color: #ffa502;\n    width: 20px;\n}\n\n.indicator-group {\n    margin-bottom: 16px;\n}\n\n.indicator-group strong {\n    display: block;\n    color: #e0e0e0;\n    margin-bottom: 8px;\n    font-size: 0.9rem;\n}\n\n.indicator-list {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 8px;\n}\n\n.indicator-tag {\n    padding: 6px 12px;\n    border-radius: 6px;\n    font-size: 0.8rem;\n    font-weight: 600;\n    font-family: 'Courier New', monospace;\n}\n\n.api-tag {\n    background: rgba(255, 165, 2, 0.2);\n    border: 1px solid rgba(255, 165, 2, 0.4);\n    color: #ffa502;\n}\n\n.string-tag {\n    background: rgba(255, 71, 87, 0.2);\n    border: 1px solid rgba(255, 71, 87, 0.4);\n    color: #ff6b6b;\n}\n\n.prediction-footer {\n    margin-top: 20px;\n    padding: 12px;\n    background: rgba(90, 156, 248, 0.1);\n    border-radius: 6px;\n    color: #5a9cf8;\n    font-size: 0.85rem;\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.scans-container {\n    background: var(--bg-card);\n    border: 2px solid var(--border-color);\n    border-radius: 12px;\n    padding: 2rem;\n    transition: all 0.3s ease;\n}\n\n.scans-container:hover {\n    border-color: var(--accent-green);\n    box-shadow: 0 5px 20px var(--shadow-color);\n}\n\n.scans-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 2rem;\n}\n\n.scans-header h2 {\n    color: #5a9cf8;\n}\n\n.refresh-btn {\n    background: #5a9cf8;\n    color: white;\n    border: none;\n    padding: 0.75rem 1.5rem;\n    border-radius: 8px;\n    cursor: pointer;\n    font-size: 1rem;\n    transition: background 0.2s;\n}\n\n.refresh-btn:hover {\n    background: #4a8ce8;\n}\n\n.scans-table {\n    width: 100%;\n    border-collapse: collapse;\n}\n\n.scans-table th {\n    text-align: left;\n    padding: 1rem;\n    background: rgba(255, 255, 255, 0.05);\n    color: #5a9cf8;\n    font-weight: 600;\n}\n\n.scans-table td {\n    padding: 1rem;\n    border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n}\n\n.scans-table tr:hover {\n    background: rgba(255, 255, 255, 0.03);\n}\n\n.badge {\n    display: inline-block;\n    padding: 0.3rem 0.8rem;\n    border-radius: 6px;\n    font-size: 0.85rem;\n    font-weight: 600;\n}\n\n.badge.malware { background: #ff4757; color: white; }\n.badge.suspicious { background: #ffa502; color: white; }\n.badge.benign { background: #26de81; color: white; }\n.badge.non-pe { background: #4b5563; color: #fff; }\n\n.hash {\n    font-family: 'Courier New', monospace;\n    font-size: 0.85rem;\n    color: #888;\n}\n\n.empty-state {\n    text-align: center;\n    padding: 3rem;\n    color: #666;\n}\n\n.empty-state i {\n    font-size: 4rem;\n    margin-bottom: 1rem;\n    opacity: 0.3;\n}\n\n/* NEW: Chart Container Styles */\n.chart-container {\n    background: rgba(255, 255, 255, 0.05);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: 12px;\n    padding: 2rem;\n    margin-top: 2rem;\n}\n\n.chart-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 2rem;\n}\n\n.chart-header h2 {\n    color: var(--accent-green);\n    margin: 0;\n}\n\n.chart-subtitle {\n    font-size: 0.85rem;\n    color: var(--text-secondary);\n    margin: 0.5rem 0 0 0;\n    font-weight: normal;\n}\n\n.chart-controls {\n    display: flex;\n    gap: 0.5rem;\n}\n\n.chart-btn {\n    background: rgba(255, 255, 255, 0.05);\n    color: #888;\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    padding: 0.5rem 1rem;\n    border-radius: 6px;\n    cursor: pointer;\n    font-size: 0.9rem;\n    transition: all 0.2s;\n}\n\n.chart-btn:hover {\n    background: rgba(255, 255, 255, 0.1);\n    color: #e0e0e0;\n}\n\n.chart-btn.active {\n    background: #5a9cf8;\n    color: white;\n    border-color: #5a9cf8;\n}\n\n#dailyScansChart {\n    max-height: 400px;\n}\n\n@media (max-width: 1024px) {\n    .analytics-grid {\n        grid-template-columns: 1fr;\n        gap: 1.5rem;\n    }\n    \n    .analytics-panel.panel-small,\n    .analytics-panel.panel-large {\n        grid-column: span 1;\n    }\n    \n    .graphs-preview {\n        width: 400px;\n    }\n}\n\n@media (max-width: 768px) {\n    .main-content {\n        margin-left: 0;\n        padding: 1rem;\n    }\n    \n    .side-panel {\n        width: 50px;\n    }\n    \n    .panel-logo-icon {\n        width: 40px;\n        height: 40px;\n        font-size: 1.5rem;\n    }\n    \n    .graphs-preview {\n        left: 50px;\n        width: calc(100vw - 50px);\n        border-radius: 0;\n    }\n    \n    .dashboard-header h1 {\n        font-size: 1.8rem;\n    }\n    \n    .stats-grid {\n        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\n        gap: 1rem;\n    }\n    \n    .chart-header {\n        flex-direction: column;\n        gap: 1rem;\n        align-items: flex-start;\n    }\n    \n    .chart-controls {\n        width: 100%;\n        justify-content: stretch;\n    }\n    \n    .chart-btn {\n        flex: 1;\n    }\n    \n    .map-view-toggle {\n        width: 100%;\n        justify-content: stretch;\n    }\n    \n    .map-btn {\n        flex: 1;\n        font-size: 0.8rem;\n        padding: 0.4rem 0.6rem;\n    }\n    \n    .geo-context-panel {\n        flex-direction: column;\n    }\n    \n    .context-stat {\n        width: 100%;\n    }\n    \n    .map-timeline-control {\n        flex-direction: column;\n        gap: 0.5rem;\n    }\n    \n    .timeline-info {\n        text-align: center;\n    }\n    \n    .analytics-header {\n        flex-direction: column;\n        align-items: flex-start;\n    }\n}\n\n/* Map Container */\n.map-container {\n    background: var(--bg-card);\n    border-radius: 12px;\n    padding: 24px;\n    box-shadow: 0 4px 12px var(--shadow-color);\n    border: 2px solid var(--border-color);\n    transition: all 0.3s ease;\n    min-height: 600px;\n}\n\n.map-container:hover {\n    border-color: var(--accent-green);\n    box-shadow: 0 8px 24px var(--shadow-color), 0 0 20px var(--success-glow);\n}\n\n#worldMap {\n    width: 100%;\n    height: 500px;\n    border-radius: 8px;\n    margin-bottom: 15px;\n    background: var(--bg-secondary);\n    border: 1px solid var(--border-color);\n    z-index: 1;\n    position: relative;\n}\n\n.map-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 20px;\n    flex-wrap: wrap;\n    gap: 16px;\n}\n\n.map-header h2 {\n    margin: 0;\n    font-size: 1.5rem;\n    color: var(--accent-green);\n    text-shadow: 0 0 10px var(--success-glow);\n}\n\n.map-header h2 i {\n    color: var(--accent-green);\n    margin-right: 8px;\n}\n\n.map-controls {\n    display: flex;\n    gap: 20px;\n    align-items: center;\n    flex-wrap: wrap;\n}\n\n.map-view-toggle {\n    display: flex;\n    gap: 8px;\n    background: var(--bg-secondary);\n    padding: 4px;\n    border-radius: 8px;\n    border: 1px solid var(--border-color);\n}\n\n.map-btn {\n    background: transparent;\n    border: none;\n    padding: 8px 16px;\n    border-radius: 6px;\n    cursor: pointer;\n    color: var(--text-secondary);\n    font-size: 0.9rem;\n    font-weight: 600;\n    transition: all 0.2s ease;\n    display: flex;\n    align-items: center;\n    gap: 6px;\n}\n\n.map-btn:hover {\n    background: var(--bg-hover);\n    color: var(--text-primary);\n}\n\n.map-btn.active {\n    background: var(--accent-green);\n    color: var(--bg-primary);\n    box-shadow: 0 0 10px var(--success-glow);\n}\n\n.map-btn i {\n    font-size: 1rem;\n}\n\n.map-legend {\n    display: flex;\n    gap: 20px;\n    flex-wrap: wrap;\n}\n\n.legend-item {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    font-size: 0.9rem;\n    color: var(--text-secondary);\n}\n\n.legend-dot {\n    width: 12px;\n    height: 12px;\n    border-radius: 50%;\n    display: inline-block;\n    box-shadow: 0 0 6px currentColor;\n}\n\n.malware-dot {\n    background-color: var(--accent-red);\n}\n\n.suspicious-dot {\n    background-color: var(--accent-yellow);\n}\n\n.benign-dot {\n    background-color: var(--accent-green);\n}\n\n.geo-context-panel {\n    display: flex;\n    justify-content: space-around;\n    gap: 20px;\n    padding: 15px;\n    background: var(--bg-secondary);\n    border-radius: 8px;\n    margin-bottom: 15px;\n    border: 1px solid var(--border-color);\n}\n\n.context-stat {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 5px;\n}\n\n.context-label {\n    font-size: 0.85rem;\n    color: var(--text-secondary);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.context-value {\n    font-size: 1.5rem;\n    font-weight: 700;\n    color: var(--accent-green);\n    text-shadow: 0 0 10px var(--success-glow);\n}\n\n.context-value.threat-count {\n    color: var(--accent-red);\n    text-shadow: 0 0 10px var(--danger-glow);\n}\n\n.map-timeline-control {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 12px;\n    background: var(--bg-secondary);\n    border-radius: 8px;\n    margin-top: 15px;\n    border: 1px solid var(--border-color);\n}\n\n.timeline-btn {\n    background: linear-gradient(135deg, var(--accent-green) 0%, var(--accent-green-dim) 100%);\n    color: var(--bg-primary);\n    border: none;\n    padding: 10px 20px;\n    border-radius: 6px;\n    cursor: pointer;\n    font-size: 0.95rem;\n    font-weight: 600;\n    transition: all 0.2s ease;\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    box-shadow: 0 4px 12px var(--success-glow);\n}\n\n.timeline-btn:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 6px 16px var(--success-glow);\n    filter: brightness(1.1);\n}\n\n.timeline-btn i {\n    font-size: 1rem;\n}\n\n.timeline-info {\n    color: var(--text-secondary);\n    font-size: 0.9rem;\n    font-style: italic;\n}\n\n#worldMap {\n    background: var(--bg-secondary);\n    border: 2px solid var(--border-color);\n}\n\n/* Leaflet popup customization for theme */\n.leaflet-popup-content-wrapper {\n    background: var(--bg-card) !important;\n    color: var(--text-primary) !important;\n    border: 2px solid var(--accent-green) !important;\n    box-shadow: 0 4px 15px var(--shadow-color) !important;\n    border-radius: 8px !important;\n}\n\n.leaflet-popup-tip {\n    background: var(--bg-card) !important;\n}\n\n.leaflet-popup-content h3 {\n    color: var(--accent-green) !important;\n}\n\n.leaflet-popup-content button {\n    background: var(--accent-green) !important;\n    color: var(--bg-primary) !important;\n    border: none !important;\n    padding: 8px 16px !important;\n    border-radius: 6px !important;\n    cursor: pointer !important;\n    font-weight: 600 !important;\n    transition: all 0.2s ease !important;\n}\n\n.leaflet-popup-content button:hover {\n    transform: translateY(-2px) !important;\n    box-shadow: 0 4px 12px var(--success-glow) !important;\n}\n\n/* Correlation Graph */\n.correlation-container {\n    background: rgba(255, 255, 255, 0.03);\n    border-radius: 12px;\n    padding: 24px;\n    margin-top: 24px;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n}\n\n.correlation-header {\n    margin-bottom: 20px;\n}\n\n.correlation-header h2 {\n    margin: 0 0 8px 0;\n    font-size: 1.5rem;\n    color: #e0e0e0;\n}\n\n.correlation-header h2 i {\n    color: #5a9cf8;\n    margin-right: 8px;\n}\n\n.correlation-subtitle {\n    color: #888;\n    font-size: 0.9rem;\n    margin: 0;\n}\n\n.graph-controls {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 16px;\n    flex-wrap: wrap;\n    gap: 16px;\n}\n\n.graph-btn {\n    background: rgba(90, 156, 248, 0.2);\n    border: 1px solid rgba(90, 156, 248, 0.4);\n    color: #5a9cf8;\n    padding: 8px 16px;\n    border-radius: 6px;\n    cursor: pointer;\n    font-size: 0.9rem;\n    transition: all 0.3s;\n}\n\n.graph-btn:hover {\n    background: rgba(90, 156, 248, 0.3);\n    border-color: #5a9cf8;\n}\n\n.graph-btn i {\n    margin-right: 6px;\n}\n\n.graph-legend {\n    display: flex;\n    gap: 20px;\n    flex-wrap: wrap;\n}\n\n.node-sample {\n    width: 12px;\n    height: 12px;\n    border-radius: 50%;\n    display: inline-block;\n    border: 2px solid #fff;\n}\n\n.malware-node {\n    background-color: #ff4757;\n}\n\n.agent-node {\n    background-color: #5a9cf8;\n}\n\n.api-node {\n    background-color: #ffa502;\n}\n\n.string-node {\n    background-color: #26de81;\n}\n\n#correlationGraph {\n    width: 100%;\n    min-height: 600px;\n    position: relative;\n    border-radius: 8px;\n    overflow: hidden;\n}\n\n.node-details {\n    position: absolute;\n    right: 24px;\n    top: 120px;\n    background: rgba(30, 30, 30, 0.95);\n    border: 1px solid rgba(90, 156, 248, 0.4);\n    border-radius: 8px;\n    padding: 16px;\n    max-width: 300px;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n    z-index: 1000;\n}\n\n.node-details h3 {\n    margin: 0 0 12px 0;\n    color: #5a9cf8;\n    font-size: 1.1rem;\n    border-bottom: 1px solid rgba(90, 156, 248, 0.3);\n    padding-bottom: 8px;\n}\n\n.node-details p {\n    margin: 8px 0;\n    color: #e0e0e0;\n    font-size: 0.9rem;\n}\n\n.node-details ul {\n    color: #b0b0b0;\n    font-size: 0.85rem;\n}\n\n.node-details li {\n    margin: 4px 0;\n}\n","epoch":56,"telemetryInfo":{}}],["file:///home/trang/localnsv/mAIware-server/public/dashboard.html::request_05a5b84a-3891-424e-ba29-a5ab551da634",{"uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware-server/public/dashboard.html","external":"file:///home/trang/localnsv/mAIware-server/public/dashboard.html","path":"/home/trang/localnsv/mAIware-server/public/dashboard.html","scheme":"file"},"requestId":"request_05a5b84a-3891-424e-ba29-a5ab551da634","content":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>mAIware Server Dashboard</title>\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css\">\n    <link rel=\"stylesheet\" href=\"styles.css?v=3.0\">\n    <!-- Add Chart.js -->\n    <script src=\"https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js\"></script>\n    <!-- Add Leaflet.js for maps -->\n    <link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.9.4/dist/leaflet.css\" />\n    <script src=\"https://unpkg.com/leaflet@1.9.4/dist/leaflet.js\"></script>\n    <!-- Add Leaflet Heatmap Plugin -->\n    <script src=\"https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js\"></script>\n    <!-- Add D3.js for force-directed graph -->\n    <script src=\"https://d3js.org/d3.v7.min.js\"></script>\n    <!-- Add html2canvas for screenshots -->\n    <script src=\"https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js\"></script>\n</head>\n<body>\n    <!-- Theme Toggle Button -->\n    <button class=\"theme-toggle\" id=\"themeToggle\" onclick=\"toggleTheme()\">\n        <span class=\"icon\" id=\"themeIcon\"></span>\n        <span id=\"themeText\">Dark</span>\n    </button>\n\n    <!-- Preview Backdrop -->\n    <div class=\"preview-backdrop\" id=\"previewBackdrop\"></div>\n\n    <!-- Side Navigation Panel -->\n    <div class=\"side-panel\" id=\"sidePanel\">\n        <!-- Logo Icon (always visible) -->\n        <div class=\"panel-icon-strip\">\n            <div class=\"panel-logo-icon\">\n                <i class=\"fas fa-shield-virus\"></i>\n            </div>\n        </div>\n        \n        <!-- Analytics Preview Panel (slides out on hover) -->\n        <div class=\"graphs-preview\" id=\"graphsPreview\">\n            <div class=\"preview-header\">\n                <h3><i class=\"fas fa-chart-line\"></i> Analytics Preview</h3>\n                <p>Click anywhere to view full analytics</p>\n            </div>\n            \n            <!-- Scaled-down live view of analytics -->\n            <div class=\"analytics-miniview\" id=\"analyticsMiniview\" onclick=\"switchView('analytics')\">\n                <div class=\"miniview-preview\">\n                    <div class=\"preview-row\">\n                        <div class=\"preview-box large\">\n                            <div class=\"box-header\">Global Threat Map</div>\n                            <div class=\"box-content map-visual\">\n                                <div class=\"map-dot\" style=\"top: 30%; left: 40%;\"></div>\n                                <div class=\"map-dot\" style=\"top: 60%; left: 70%;\"></div>\n                                <div class=\"map-dot\" style=\"top: 45%; left: 25%;\"></div>\n                            </div>\n                        </div>\n                        <div class=\"preview-box large\">\n                            <div class=\"box-header\">Attack Timeline</div>\n                            <div class=\"box-content chart-visual\">\n                                <div class=\"chart-bar\" style=\"height: 40%;\"></div>\n                                <div class=\"chart-bar\" style=\"height: 70%;\"></div>\n                                <div class=\"chart-bar\" style=\"height: 55%;\"></div>\n                                <div class=\"chart-bar\" style=\"height: 85%;\"></div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"preview-row\">\n                        <div class=\"preview-box\">\n                            <div class=\"box-header\">Top Threats</div>\n                            <div class=\"box-content list-visual\">\n                                <div class=\"list-item\"></div>\n                                <div class=\"list-item\"></div>\n                                <div class=\"list-item\"></div>\n                            </div>\n                        </div>\n                        <div class=\"preview-box\">\n                            <div class=\"box-header\">Correlations</div>\n                            <div class=\"box-content network-visual\">\n                                <div class=\"network-node\" style=\"top: 30%; left: 30%;\"></div>\n                                <div class=\"network-node\" style=\"top: 60%; left: 50%;\"></div>\n                                <div class=\"network-node\" style=\"top: 45%; left: 70%;\"></div>\n                            </div>\n                        </div>\n                        <div class=\"preview-box\">\n                            <div class=\"box-header\">Heatmap</div>\n                            <div class=\"box-content heat-visual\"></div>\n                        </div>\n                    </div>\n                    <div class=\"preview-row\">\n                        <div class=\"preview-box wide\">\n                            <div class=\"box-header\">File Analysis & Distribution</div>\n                            <div class=\"box-content pie-visual\">\n                                <div class=\"pie-chart\"></div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <div class=\"miniview-overlay\">\n                    <i class=\"fas fa-expand-alt\"></i>\n                    <span>Click to view analytics</span>\n                </div>\n            </div>                <!-- Home Navigation Button -->\n                <div class=\"preview-home-nav\" id=\"homeNavBtn\" onclick=\"switchView('dashboard')\">\n                    <i class=\"fas fa-home\"></i>\n                    <span>Back to Dashboard</span>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <div class=\"main-content\" id=\"mainContent\">\n        <!-- DASHBOARD VIEW -->\n        <div class=\"view-container active\" id=\"dashboardView\">\n            <header class=\"dashboard-header\">\n                <div class=\"header-content\">\n                    <h1><i class=\"fas fa-shield-virus pulse-icon\"></i> mAIware Server</h1>\n                    <p class=\"subtitle\">Real-time Malware Analysis Dashboard</p>\n                </div>\n            </header>\n            \n            <!-- Real-time Threat Ticker -->\n            <div class=\"threat-ticker-container animate-slide-in\">\n                <div class=\"ticker-label\">\n                    <i class=\"fas fa-broadcast-tower pulse-icon\"></i>\n                    <span>LIVE THREAT FEED</span>\n                </div>\n                <div class=\"threat-ticker\" id=\"threat-ticker\">\n                    <div class=\"ticker-content\" id=\"ticker-content\">\n                        <span class=\"ticker-item\">System ready - Monitoring for threats...</span>\n                    </div>\n                </div>\n            </div>\n            \n            <!-- Notification Toast Container -->\n            <div id=\"notification-container\" class=\"notification-container\"></div>\n            \n            <!-- Stats Grid -->\n            <div class=\"stats-grid animate-fade-in\" id=\"stats-grid\">\n                <div class=\"stat-card info\">\n                    <i class=\"fas fa-laptop\"></i>\n                    <span class=\"stat-number\" id=\"stat-clients\">0</span>\n                    <span class=\"stat-label\">Active Clients</span>\n                    <div class=\"stat-glow\"></div>\n                </div>\n                <div class=\"stat-card info\">\n                    <i class=\"fas fa-chart-line\"></i>\n                    <span class=\"stat-number\" id=\"stat-total\">0</span>\n                    <span class=\"stat-label\">Total Scans</span>\n                    <div class=\"stat-glow\"></div>\n                </div>\n                <div class=\"stat-card malware\">\n                    <i class=\"fas fa-bug\"></i>\n                    <span class=\"stat-number\" id=\"stat-malware\">0</span>\n                    <span class=\"stat-label\">Malware</span>\n                    <div class=\"stat-glow\"></div>\n                </div>\n                <div class=\"stat-card suspicious\">\n                    <i class=\"fas fa-exclamation-triangle\"></i>\n                    <span class=\"stat-number\" id=\"stat-suspicious\">0</span>\n                    <span class=\"stat-label\">Suspicious</span>\n                    <div class=\"stat-glow\"></div>\n                </div>\n                <div class=\"stat-card benign\">\n                    <i class=\"fas fa-check-circle\"></i>\n                    <span class=\"stat-number\" id=\"stat-benign\">0</span>\n                    <span class=\"stat-label\">Benign</span>\n                    <div class=\"stat-glow\"></div>\n                </div>\n            </div>\n            \n            <!-- Recent Scans -->\n            <div class=\"scans-container animate-fade-in\">\n                <div class=\"scans-header\">\n                    <h2><i class=\"fas fa-list\"></i> Recent Scans</h2>\n                    <button class=\"refresh-btn\" onclick=\"manualRefresh()\">\n                        <i class=\"fas fa-sync-alt\"></i> Refresh\n                    </button>\n                </div>\n                \n                <table class=\"scans-table\">\n                    <thead>\n                        <tr>\n                            <th>Timestamp</th>\n                            <th>Filename</th>\n                            <th>Classification</th>\n                            <th>Client IP</th>\n                            <th>Hash (SHA256)</th>\n                        </tr>\n                    </thead>\n                    <tbody id=\"scans-tbody\">\n                        <tr>\n                            <td colspan=\"5\" class=\"empty-state\">\n                                <i class=\"fas fa-inbox\"></i>\n                                <p>No scans yet. Waiting for clients...</p>\n                            </td>\n                        </tr>\n                    </tbody>\n                </table>\n            </div>\n        </div>\n\n        <!-- ANALYTICS VIEW -->\n        <div class=\"view-container\" id=\"analyticsView\">\n            <div class=\"analytics-header\">\n                <button class=\"back-btn\" onclick=\"switchView('dashboard')\">\n                    <i class=\"fas fa-arrow-left\"></i> Back to Dashboard\n                </button>\n                <h1><i class=\"fas fa-chart-line\"></i> Analytics & Intelligence</h1>\n            </div>\n            \n            <div class=\"analytics-grid\" id=\"analyticsGrid\">\n                \n                <!-- Daily Analysis Chart -->\n                <div class=\"chart-container analytics-panel panel-large\">\n                    <div class=\"chart-header\">\n                        <h2><i class=\"fas fa-chart-line\"></i> Daily Analysis Trends</h2>\n                        <div class=\"chart-controls\">\n                            <button class=\"chart-btn active\" onclick=\"setChartDays(7)\">7 Days</button>\n                            <button class=\"chart-btn\" onclick=\"setChartDays(14)\">14 Days</button>\n                            <button class=\"chart-btn\" onclick=\"setChartDays(30)\">30 Days</button>\n                        </div>\n                    </div>\n                    <canvas id=\"dailyScansChart\"></canvas>\n                </div>\n                    <canvas id=\"dailyScansChart\"></canvas>\n                </div>\n\n                <!-- Geographic Threat Intelligence Map -->\n                <div class=\"map-container analytics-panel panel-large\">\n                    <div class=\"map-header\">\n                        <h2><i class=\"fas fa-globe-americas\"></i> Global Threat Intelligence Map</h2>\n                        <div class=\"map-controls\">\n                            <div class=\"map-view-toggle\">\n                                <button class=\"map-btn active\" data-view=\"markers\" onclick=\"switchMapView('markers')\">\n                                    <i class=\"fas fa-map-marker-alt\"></i> Markers\n                                </button>\n                                <button class=\"map-btn\" data-view=\"heatmap\" onclick=\"switchMapView('heatmap')\">\n                                    <i class=\"fas fa-fire\"></i> Heatmap\n                                </button>\n                                <button class=\"map-btn\" data-view=\"choropleth\" onclick=\"switchMapView('choropleth')\">\n                                    <i class=\"fas fa-globe\"></i> Choropleth\n                                </button>\n                            </div>\n                            <div class=\"map-legend\">\n                                <span class=\"legend-item\"><span class=\"legend-dot malware-dot\"></span> Malware</span>\n                                <span class=\"legend-item\"><span class=\"legend-dot suspicious-dot\"></span> Suspicious</span>\n                                <span class=\"legend-item\"><span class=\"legend-dot benign-dot\"></span> Benign</span>\n                            </div>\n                        </div>\n                    </div>\n                    \n                    <!-- Geographic Context Panel -->\n                    <div class=\"geo-context-panel\" id=\"geoContext\">\n                        <div class=\"context-stat\">\n                            <span class=\"context-label\">Active Regions:</span>\n                            <span class=\"context-value\" id=\"activeRegions\">0</span>\n                        </div>\n                        <div class=\"context-stat\">\n                            <span class=\"context-label\">Hotspot:</span>\n                            <span class=\"context-value\" id=\"topRegion\">None</span>\n                        </div>\n                        <div class=\"context-stat\">\n                            <span class=\"context-label\">Total Threats:</span>\n                            <span class=\"context-value threat-count\" id=\"geoThreatCount\">0</span>\n                        </div>\n                    </div>\n                    \n                    <div id=\"worldMap\" style=\"height: 500px; border-radius: 8px; margin-bottom: 15px;\"></div>\n                    \n                    <!-- Timeline Control -->\n                    <div class=\"map-timeline-control\">\n                        <button class=\"timeline-btn\" onclick=\"replayThreats()\" id=\"replayBtn\">\n                            <i class=\"fas fa-play\"></i> Replay Last 24h\n                        </button>\n                        <div class=\"timeline-info\" id=\"timelineInfo\">\n                            Click replay to see threat propagation over time\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Malware Source Distribution -->\n                <div class=\"chart-container analytics-panel panel-small\">\n                    <div class=\"chart-header\">\n                        <h2><i class=\"fas fa-chart-pie\"></i> Malware Source Distribution</h2>\n                    </div>\n                    <div style=\"max-width: 500px; margin: 0 auto;\">\n                        <canvas id=\"malwareSourceChart\"></canvas>\n                    </div>\n                </div>\n\n                <!-- Graph 2: \"Noisiest\" Agents Over Time -->\n                <div class=\"chart-container analytics-panel panel-large\">\n                    <div class=\"chart-header\">\n                        <h2><i class=\"fas fa-desktop\"></i> \"Noisiest\" Agents Over Time</h2>\n                        <p class=\"chart-subtitle\">Threat detection trends for top 5 high-risk agents</p>\n                    </div>\n                    <div style=\"height: 300px;\">\n                        <canvas id=\"noisyAgentsChart\"></canvas>\n                    </div>\n                </div>\n\n                <!-- Advanced Analytics Grid -->\n                <div class=\"analytics-panel panel-large advanced-analytics-grid\">\n                    <div class=\"chart-header\">\n                        <h2><i class=\"fas fa-chart-area\"></i> Advanced Statistical Analysis</h2>\n                        <p class=\"chart-subtitle\">Deep dive into signature verification, packer usage, AI confidence, and entropy patterns</p>\n                    </div>\n                    \n                    <div class=\"mini-charts-grid\">\n                        <!-- Graph 3: Signature Status vs. Classification -->\n                        <div class=\"mini-chart-container\">\n                            <h3><i class=\"fas fa-certificate\"></i> Signature vs. Classification</h3>\n                            <div style=\"height: 200px;\">\n                                <canvas id=\"signatureClassChart\"></canvas>\n                            </div>\n                        </div>\n\n                        <!-- Graph 4: Packer Usage vs. Classification -->\n                        <div class=\"mini-chart-container\">\n                            <h3><i class=\"fas fa-box\"></i> Packer vs. Classification</h3>\n                            <div style=\"height: 200px;\">\n                                <canvas id=\"packerClassChart\"></canvas>\n                            </div>\n                        </div>\n\n                        <!-- Graph 5: Confidence Score Distribution -->\n                        <div class=\"mini-chart-container\">\n                            <h3><i class=\"fas fa-brain\"></i> AI Confidence Distribution</h3>\n                            <div style=\"height: 200px;\">\n                                <canvas id=\"confidenceHistChart\"></canvas>\n                            </div>\n                        </div>\n\n                        <!-- Graph 6: File Entropy Distribution -->\n                        <div class=\"mini-chart-container\">\n                            <h3><i class=\"fas fa-chart-bar\"></i> Entropy Distribution</h3>\n                            <div style=\"height: 200px;\">\n                                <canvas id=\"entropyBoxChart\"></canvas>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Threat Vector Correlation Explorer -->\n                <div class=\"correlation-container analytics-panel panel-large\">\n                    <div class=\"correlation-header\">\n                        <h2><i class=\"fas fa-project-diagram\"></i> Threat Vector Correlation Explorer</h2>\n                        <p class=\"correlation-subtitle\">Interactive intelligence map showing relationships between malware families, agents, APIs, and indicators</p>\n                    </div>\n                    <div class=\"graph-controls\">\n                        <button class=\"graph-btn\" onclick=\"resetGraph()\"><i class=\"fas fa-sync\"></i> Reset View</button>\n                        <button class=\"graph-btn\" onclick=\"centerGraph()\"><i class=\"fas fa-compress\"></i> Center</button>\n                        <div class=\"graph-legend\">\n                            <span class=\"legend-item\"><span class=\"node-sample malware-node\"></span> Malware Family</span>\n                            <span class=\"legend-item\"><span class=\"node-sample agent-node\"></span> Agent/System</span>\n                            <span class=\"legend-item\"><span class=\"node-sample api-node\"></span> API Call</span>\n                            <span class=\"legend-item\"><span class=\"node-sample string-node\"></span> Suspicious String</span>\n                        </div>\n                    </div>\n                    <div id=\"correlationGraph\"></div>\n                    <div id=\"nodeDetails\" class=\"node-details\" style=\"display: none;\">\n                        <h3 id=\"detailsTitle\"></h3>\n                        <div id=\"detailsContent\"></div>\n                    </div>\n                </div>\n\n                <!-- Emerging Threat Intelligence Panel -->\n                <div class=\"eti-container analytics-panel panel-large\">\n                    <div class=\"eti-header\">\n                        <h2><i class=\"fas fa-exclamation-triangle\"></i> Emerging Threat Intelligence (ETI)</h2>\n                        <p class=\"eti-subtitle\">Real-time actionable intelligence on active threats and indicators of compromise</p>\n                        <div class=\"eti-summary\">\n                            <span class=\"eti-badge\" id=\"eti-total\">0 Total Threats</span>\n                            <span class=\"eti-badge recent\" id=\"eti-recent\">0 Last 24h</span>\n                        </div>\n                    </div>\n                    \n                    <div class=\"eti-grid\">\n                        <div class=\"eti-panel\">\n                            <h3><i class=\"fas fa-virus\"></i> Top Malware Families</h3>\n                            <div class=\"eti-subtitle-small\">Most active malware families detected</div>\n                            <div id=\"eti-malware\" class=\"eti-list\"></div>\n                        </div>\n                        \n                        <div class=\"eti-panel\">\n                            <h3><i class=\"fas fa-code\"></i> Top Suspicious APIs</h3>\n                            <div class=\"eti-subtitle-small\">Most frequently called malicious APIs</div>\n                            <div id=\"eti-apis\" class=\"eti-list\"></div>\n                        </div>\n                        \n                        <div class=\"eti-panel\">\n                            <h3><i class=\"fas fa-terminal\"></i> Top Malicious Strings</h3>\n                            <div class=\"eti-subtitle-small\">Most common IOC strings and commands</div>\n                            <div id=\"eti-strings\" class=\"eti-list\"></div>\n                        </div>\n                        \n                        <div class=\"eti-panel\">\n                            <h3><i class=\"fas fa-shield-alt\"></i> Top Packers/Obfuscators</h3>\n                            <div class=\"eti-subtitle-small\">Most used evasion techniques</div>\n                            <div id=\"eti-packers\" class=\"eti-list\"></div>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Predictive Threat Modeler -->\n                <div class=\"modeler-container analytics-panel panel-large\">\n                    <div class=\"modeler-header\">\n                        <h2><i class=\"fas fa-flask\"></i> Predictive Threat Modeler</h2>\n                        <p class=\"modeler-subtitle\">Build hypothetical malware and predict how mAIware would classify it</p>\n                    </div>\n                    \n                    <div class=\"modeler-grid\">\n                <div class=\"modeler-builder\">\n                    <h3><i class=\"fas fa-cogs\"></i> Threat Configuration</h3>\n                    \n                    <div class=\"modeler-field\">\n                        <label>File Type</label>\n                        <select id=\"model-filetype\" class=\"modeler-select\">\n                            <option>PE32+ (GUI) x86-64</option>\n                            <option>PE32 (Console) Intel 80386</option>\n                            <option>PE32+ DLL x86-64</option>\n                            <option>MSI Installer</option>\n                            <option>PDF Document</option>\n                        </select>\n                    </div>\n                    \n                    <div class=\"modeler-field\">\n                        <label>Packer/Obfuscator</label>\n                        <select id=\"model-packer\" class=\"modeler-select\">\n                            <option>None</option>\n                            <option>UPX</option>\n                            <option>VMProtect</option>\n                            <option>Themida</option>\n                            <option>ASPack</option>\n                            <option>Unknown (High Entropy)</option>\n                        </select>\n                    </div>\n                    \n                    <div class=\"modeler-field\">\n                        <label>Digital Signature</label>\n                        <select id=\"model-signature\" class=\"modeler-select\">\n                            <option>Verified (Microsoft Corporation)</option>\n                            <option>Verified (Google LLC)</option>\n                            <option>Verified (Unknown Publisher)</option>\n                            <option>Not Signed</option>\n                            <option>Expired Certificate</option>\n                            <option>Self-Signed (Untrusted)</option>\n                        </select>\n                    </div>\n                    \n                    <div class=\"modeler-field\">\n                        <label>API Imports (select multiple)</label>\n                        <select id=\"model-apis\" class=\"modeler-select\" multiple size=\"6\">\n                            <option>CreateRemoteThread</option>\n                            <option>WriteProcessMemory</option>\n                            <option>VirtualAllocEx</option>\n                            <option>SetWindowsHookExW</option>\n                            <option>URLDownloadToFileW</option>\n                            <option>WinExec</option>\n                            <option>RegSetValueExW</option>\n                            <option>CryptEncrypt</option>\n                            <option>Socket</option>\n                            <option>ReadFile</option>\n                        </select>\n                        <small class=\"modeler-hint\">Hold Ctrl/Cmd to select multiple</small>\n                    </div>\n                    \n                    <div class=\"modeler-field\">\n                        <label>Suspicious Strings (select multiple)</label>\n                        <select id=\"model-strings\" class=\"modeler-select\" multiple size=\"6\">\n                            <option>http://bad-c2-server.com/payload.dat</option>\n                            <option>keylog.txt</option>\n                            <option>steal_passwords</option>\n                            <option>powershell -enc</option>\n                            <option>vssadmin.exe delete shadows</option>\n                            <option>HOW_TO_DECRYPT.txt</option>\n                            <option>crack</option>\n                            <option>patch</option>\n                            <option>disable_antivirus</option>\n                        </select>\n                        <small class=\"modeler-hint\">Hold Ctrl/Cmd to select multiple</small>\n                    </div>\n                    \n                    <button class=\"modeler-analyze-btn\" onclick=\"analyzeThreatModel()\">\n                        <i class=\"fas fa-brain\"></i> ANALYZE THREAT\n                    </button>\n                </div>\n                \n                <div class=\"modeler-results\">\n                    <h3><i class=\"fas fa-chart-line\"></i> Prediction Results</h3>\n                    <div id=\"modeler-output\" class=\"modeler-output\">\n                        <div class=\"modeler-placeholder\">\n                            <i class=\"fas fa-arrow-left\"></i>\n                            <p>Configure a threat profile and click ANALYZE to see predictions</p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        \n            </div>\n        </div>\n    </div>\n    \n    <script>\n        // View Switching System\n        function switchView(viewName) {\n            const views = document.querySelectorAll('.view-container');\n            \n            views.forEach(view => {\n                view.classList.remove('active');\n                if (view.id === `${viewName}View`) {\n                    view.classList.add('active');\n                }\n            });\n            \n            currentView = viewName;\n            \n            // Fix map display when switching to analytics view\n            if (viewName === 'analytics') {\n                setTimeout(() => {\n                    if (worldMap) {\n                        worldMap.invalidateSize();\n                    }\n                    // Capture screenshot for preview after charts have rendered\n                    setTimeout(() => {\n                        createAnalyticsMiniview();\n                    }, 1500);\n                }, 100);\n            }\n            \n            // Close graphs preview when switching views\n            document.getElementById('graphsPreview').classList.remove('show');\n            document.getElementById('previewBackdrop').classList.remove('show');\n        }\n        \n        // Side Panel Hover System\n        const sidePanel = document.getElementById('sidePanel');\n        const graphsPreview = document.getElementById('graphsPreview');\n        const previewBackdrop = document.getElementById('previewBackdrop');\n        const homeNavBtn = document.getElementById('homeNavBtn');\n        let previewTimeout;\n        let previewsRendered = false;\n        let currentView = 'dashboard';\n        \n        // Show preview panel on sidebar hover\n        sidePanel.addEventListener('mouseenter', () => {\n            clearTimeout(previewTimeout);\n            previewTimeout = setTimeout(() => {\n                graphsPreview.classList.add('show');\n                previewBackdrop.classList.add('show');\n                \n                // Show/hide home button based on current view\n                if (currentView === 'analytics') {\n                    homeNavBtn.classList.add('visible');\n                } else {\n                    homeNavBtn.classList.remove('visible');\n                }\n            }, 200);\n        });\n        \n        sidePanel.addEventListener('mouseleave', () => {\n            clearTimeout(previewTimeout);\n            setTimeout(() => {\n                if (!graphsPreview.matches(':hover')) {\n                    graphsPreview.classList.remove('show');\n                    previewBackdrop.classList.remove('show');\n                }\n            }, 100);\n        });\n        \n        // Keep preview open when hovering over it\n        graphsPreview.addEventListener('mouseleave', () => {\n            graphsPreview.classList.remove('show');\n            previewBackdrop.classList.remove('show');\n        });\n        \n        // Close preview when clicking backdrop\n        previewBackdrop.addEventListener('click', () => {\n            graphsPreview.classList.remove('show');\n            previewBackdrop.classList.remove('show');\n        });\n        \n        // Create analytics miniview by taking a screenshot\n        let isCapturingSnapshot = false;\n        let hasInitialSnapshot = false;\n        \n        async function createAnalyticsMiniview() {\n            // Simplified - no actual screenshot, just a visual preview\n            hasInitialSnapshot = true;\n        }\n        \n        // Auto-scroll on hover down in analytics view\n        let scrollInterval;\n        const analyticsGrid = document.getElementById('analyticsGrid');\n        \n        if (analyticsGrid) {\n            analyticsGrid.addEventListener('mousemove', (e) => {\n                const rect = analyticsGrid.getBoundingClientRect();\n                const mouseY = e.clientY - rect.top;\n                const triggerZone = 100; // pixels from bottom\n                \n                if (rect.height - mouseY < triggerZone) {\n                    if (!scrollInterval) {\n                        scrollInterval = setInterval(() => {\n                            analyticsGrid.scrollBy({ top: 2, behavior: 'smooth' });\n                        }, 16);\n                    }\n                } else {\n                    if (scrollInterval) {\n                        clearInterval(scrollInterval);\n                        scrollInterval = null;\n                    }\n                }\n            });\n            \n            analyticsGrid.addEventListener('mouseleave', () => {\n                if (scrollInterval) {\n                    clearInterval(scrollInterval);\n                    scrollInterval = null;\n                }\n            });\n        }\n        \n        // Theme Toggle\n        window.toggleTheme = function() {\n            const html = document.documentElement;\n            const themeIcon = document.getElementById('themeIcon');\n            const themeText = document.getElementById('themeText');\n            \n            const currentTheme = html.getAttribute('data-theme');\n            \n            if (currentTheme === 'light') {\n                html.setAttribute('data-theme', '');\n                themeIcon.textContent = '';\n                themeText.textContent = 'Dark';\n                localStorage.setItem('theme', 'dark');\n            } else {\n                html.setAttribute('data-theme', 'light');\n                themeIcon.textContent = '';\n                themeText.textContent = 'Light';\n                localStorage.setItem('theme', 'light');\n            }\n        };\n        \n        // Load saved theme\n        const savedTheme = localStorage.getItem('theme');\n        if (savedTheme === 'light') {\n            document.documentElement.setAttribute('data-theme', 'light');\n            document.getElementById('themeIcon').textContent = '';\n            document.getElementById('themeText').textContent = 'Light';\n        }\n        \n        let dailyChart = null;\n        let currentChartDays = 30;\n        \n        // Notification and Animation System\n        const notificationQueue = [];\n        let isShowingNotification = false;\n        \n        function showThreatNotification(scan) {\n            const container = document.getElementById('notification-container');\n            \n            const classColor = \n                scan.classification === 'Malware' ? '#ff4757' :\n                scan.classification === 'Suspicious' ? '#ffa502' : '#26de81';\n            \n            const icon = \n                scan.classification === 'Malware' ? 'fa-skull-crossbones' :\n                scan.classification === 'Suspicious' ? 'fa-exclamation-triangle' : 'fa-check-circle';\n            \n            const notification = document.createElement('div');\n            notification.className = 'threat-notification';\n            notification.style.borderLeftColor = classColor;\n            notification.innerHTML = `\n                <div class=\"notification-icon\" style=\"color: ${classColor};\">\n                    <i class=\"fas ${icon}\"></i>\n                </div>\n                <div class=\"notification-content\">\n                    <div class=\"notification-title\">\n                        <strong>${scan.classification}</strong> detected\n                    </div>\n                    <div class=\"notification-details\">\n                        ${scan.detected_filename}\n                        ${scan.malware_family ? ` - ${scan.malware_family}` : ''}\n                    </div>\n                    <div class=\"notification-meta\">\n                        <i class=\"fas fa-desktop\"></i> ${scan.systemInfo?.hostname || scan.clientIp || 'Unknown'}\n                    </div>\n                </div>\n                <div class=\"notification-close\" onclick=\"this.parentElement.remove()\">\n                    <i class=\"fas fa-times\"></i>\n                </div>\n            `;\n            \n            container.appendChild(notification);\n            \n            // Animate in\n            setTimeout(() => notification.classList.add('show'), 10);\n            \n            // Auto-remove after 8 seconds\n            setTimeout(() => {\n                notification.classList.remove('show');\n                setTimeout(() => notification.remove(), 300);\n            }, 8000);\n        }\n        \n        function addToThreatTicker(scan) {\n            const ticker = document.getElementById('ticker-content');\n            const timestamp = new Date(scan.serverTimestamp).toLocaleTimeString();\n            \n            const classColor = \n                scan.classification === 'Malware' ? '#ff4757' :\n                scan.classification === 'Suspicious' ? '#ffa502' : '#26de81';\n            \n            const tickerItem = document.createElement('span');\n            tickerItem.className = 'ticker-item';\n            tickerItem.style.color = classColor;\n            tickerItem.innerHTML = `\n                <i class=\"fas fa-circle\"></i>\n                [${timestamp}] ${scan.classification}: ${scan.detected_filename}\n                ${scan.malware_family ? `(${scan.malware_family})` : ''}\n                on ${scan.systemInfo?.hostname || scan.clientIp || 'Unknown'}\n            `;\n            \n            ticker.appendChild(tickerItem);\n            \n            // Keep only last 10 items\n            while (ticker.children.length > 10) {\n                ticker.removeChild(ticker.firstChild);\n            }\n        }\n        \n        function animateStatCard(elementId, newValue) {\n            const element = document.getElementById(elementId);\n            if (!element) return;\n            \n            const currentValue = parseInt(element.textContent) || 0;\n            if (newValue > currentValue) {\n                // Pulse animation\n                element.parentElement.classList.add('stat-pulse');\n                setTimeout(() => element.parentElement.classList.remove('stat-pulse'), 600);\n                \n                // Animate number increment\n                const duration = 500;\n                const steps = 20;\n                const increment = (newValue - currentValue) / steps;\n                let current = currentValue;\n                let step = 0;\n                \n                const interval = setInterval(() => {\n                    step++;\n                    current += increment;\n                    element.textContent = Math.round(current);\n                    \n                    if (step >= steps) {\n                        element.textContent = newValue;\n                        clearInterval(interval);\n                    }\n                }, duration / steps);\n            } else {\n                element.textContent = newValue;\n            }\n        }\n        \n        async function loadStats() {\n            try {\n                const response = await fetch('/api/stats');\n                const stats = await response.json();\n                \n                animateStatCard('stat-clients', stats.activeClients);\n                animateStatCard('stat-total', stats.totalScans);\n                animateStatCard('stat-malware', stats.malwareCount);\n                animateStatCard('stat-suspicious', stats.suspiciousCount);\n                animateStatCard('stat-benign', stats.benignCount);\n            } catch (error) {\n                console.error('Failed to load stats:', error);\n            }\n        }\n        \n        async function loadScans() {\n            try {\n                const response = await fetch('/api/scans?limit=50');\n                const data = await response.json();\n                \n                const tbody = document.getElementById('scans-tbody');\n                \n                if (data.scans.length === 0) {\n                    tbody.innerHTML = `\n                        <tr>\n                            <td colspan=\"5\" class=\"empty-state\">\n                                <i class=\"fas fa-inbox\"></i>\n                                <p>No scans yet. Waiting for clients...</p>\n                            </td>\n                        </tr>\n                    `;\n                    return;\n                }\n                \n                tbody.innerHTML = data.scans.map(scan => {\n                    const timestamp = new Date(scan.serverTimestamp).toLocaleString();\n                    const hash = scan.file_hashes?.sha256 || 'N/A';\n                    const hashShort = hash.length > 16 ? (hash.substring(0, 16) + '...') : hash;\n                    const isNonPe = scan.is_pe === false;\n                    const classification = isNonPe ? 'Non-PE' : (scan.classification || 'Unknown');\n                    const badgeClass = isNonPe ? 'non-pe' : classification.toLowerCase();\n                    const nonPeTag = isNonPe ? '<span class=\"badge non-pe\" title=\"Non-PE file\">Non-PE</span>' : '';\n                    return `\n                        <tr>\n                            <td>${timestamp}</td>\n                            <td>${scan.detected_filename} ${nonPeTag}</td>\n                            <td><span class=\"badge ${badgeClass}\">${classification}</span></td>\n                            <td>${scan.systemInfo?.ip || scan.clientIp || 'Unknown'}</td>\n                            <td class=\"hash\" title=\"${hash}\">${hashShort}</td>\n                        </tr>\n                    `;\n                }).join('');\n                \n            } catch (error) {\n                console.error('Failed to load scans:', error);\n            }\n        }\n        \n        async function loadDailyChart() {\n            try {\n                const response = await fetch(`/api/daily-scans?days=${currentChartDays}`);\n                const data = await response.json();\n                \n                const ctx = document.getElementById('dailyScansChart');\n                \n                // Destroy existing chart if it exists\n                if (dailyChart) {\n                    dailyChart.destroy();\n                }\n                \n                // Format dates for display (MM/DD)\n                const labels = data.days.map(day => {\n                    const date = new Date(day.date);\n                    return `${date.getMonth() + 1}/${date.getDate()}`;\n                });\n                \n                dailyChart = new Chart(ctx, {\n                    type: 'line',\n                    data: {\n                        labels: labels,\n                        datasets: [\n                            {\n                                label: 'Total Scans',\n                                data: data.days.map(d => d.total),\n                                borderColor: '#5a9cf8',\n                                backgroundColor: 'rgba(90, 156, 248, 0.1)',\n                                fill: true,\n                                tension: 0.4,\n                                borderWidth: 2\n                            },\n                            {\n                                label: 'Malware',\n                                data: data.days.map(d => d.malware),\n                                borderColor: '#ff4757',\n                                backgroundColor: 'rgba(255, 71, 87, 0.1)',\n                                fill: true,\n                                tension: 0.4,\n                                borderWidth: 2\n                            },\n                            {\n                                label: 'Suspicious',\n                                data: data.days.map(d => d.suspicious),\n                                borderColor: '#ffa502',\n                                backgroundColor: 'rgba(255, 165, 2, 0.1)',\n                                fill: true,\n                                tension: 0.4,\n                                borderWidth: 2\n                            },\n                            {\n                                label: 'Benign',\n                                data: data.days.map(d => d.benign),\n                                borderColor: '#26de81',\n                                backgroundColor: 'rgba(38, 222, 129, 0.1)',\n                                fill: true,\n                                tension: 0.4,\n                                borderWidth: 2\n                            }\n                        ]\n                    },\n                    options: {\n                        responsive: true,\n                        maintainAspectRatio: false,\n                        interaction: {\n                            mode: 'index',\n                            intersect: false,\n                        },\n                        plugins: {\n                            legend: {\n                                labels: {\n                                    color: '#e0e0e0',\n                                    font: { size: 12 }\n                                }\n                            },\n                            tooltip: {\n                                backgroundColor: 'rgba(0, 0, 0, 0.8)',\n                                titleColor: '#fff',\n                                bodyColor: '#e0e0e0',\n                                borderColor: 'rgba(255, 255, 255, 0.1)',\n                                borderWidth: 1\n                            }\n                        },\n                        scales: {\n                            x: {\n                                ticks: { \n                                    color: '#888',\n                                    maxRotation: 45,\n                                    minRotation: 45\n                                },\n                                grid: { \n                                    color: 'rgba(255, 255, 255, 0.05)' \n                                }\n                            },\n                            y: {\n                                beginAtZero: true,\n                                ticks: { \n                                    color: '#888',\n                                    stepSize: 1\n                                },\n                                grid: { \n                                    color: 'rgba(255, 255, 255, 0.05)' \n                                }\n                            }\n                        }\n                    }\n                });\n                \n            } catch (error) {\n                console.error('Failed to load daily chart:', error);\n            }\n        }\n        \n        let worldMap = null;\n        let markerLayer = null;\n        let heatmapLayer = null;\n        let choroplethLayer = null;\n        let mapInitialized = false;\n        let lastGeoDataHash = '';\n        let sourceChart = null;\n        let currentMapView = 'markers';\n        let geoDataCache = null;\n        let replayInterval = null;\n        \n        // Country boundaries for choropleth (simplified)\n        const countryCoordinates = {\n            'United States': { center: [37.0902, -95.7129], weight: 0 },\n            'China': { center: [35.8617, 104.1954], weight: 0 },\n            'United Kingdom': { center: [55.3781, -3.4360], weight: 0 },\n            'Germany': { center: [51.1657, 10.4515], weight: 0 },\n            'France': { center: [46.2276, 2.2137], weight: 0 },\n            'Russia': { center: [61.5240, 105.3188], weight: 0 },\n            'Japan': { center: [36.2048, 138.2529], weight: 0 },\n            'India': { center: [20.5937, 78.9629], weight: 0 },\n            'Brazil': { center: [-14.2350, -51.9253], weight: 0 },\n            'Australia': { center: [-25.2744, 133.7751], weight: 0 }\n        };\n        \n        function initializeMap() {\n            if (mapInitialized) return;\n            \n            try {\n                worldMap = L.map('worldMap', {\n                    zoomControl: true,\n                    scrollWheelZoom: true,\n                    preferCanvas: false,\n                    worldCopyJump: true\n                }).setView([20, 0], 2);\n                \n                // Use dark theme tiles\n                L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {\n                    attribution: '&copy; OpenStreetMap contributors',\n                    subdomains: 'abcd',\n                    maxZoom: 18,\n                    minZoom: 1,\n                    noWrap: false,\n                    bounds: [[-90, -180], [90, 180]]\n                }).addTo(worldMap);\n                \n                markerLayer = L.layerGroup().addTo(worldMap);\n                mapInitialized = true;\n                \n                // Fix map display after initialization\n                setTimeout(() => {\n                    if (worldMap) worldMap.invalidateSize();\n                }, 100);\n            } catch (error) {\n                console.error('Failed to initialize map:', error);\n            }\n        }\n        \n        // Switch between map visualization modes\n        window.switchMapView = function(view) {\n            currentMapView = view;\n            \n            // Update button states\n            document.querySelectorAll('.map-btn').forEach(btn => {\n                btn.classList.remove('active');\n            });\n            document.querySelector(`[data-view=\"${view}\"]`).classList.add('active');\n            \n            // Reload map with new view\n            if (geoDataCache) {\n                renderMapView(geoDataCache);\n            }\n        };\n        \n        // Render different map views\n        function renderMapView(data) {\n            if (!worldMap) return;\n            \n            // Clear all layers\n            if (markerLayer) markerLayer.clearLayers();\n            if (heatmapLayer) {\n                worldMap.removeLayer(heatmapLayer);\n                heatmapLayer = null;\n            }\n            if (choroplethLayer) {\n                worldMap.removeLayer(choroplethLayer);\n                choroplethLayer = null;\n            }\n            \n            switch (currentMapView) {\n                case 'markers':\n                    renderMarkers(data);\n                    break;\n                case 'heatmap':\n                    renderHeatmap(data);\n                    break;\n                case 'choropleth':\n                    renderChoropleth(data);\n                    break;\n            }\n            \n            updateGeoContext(data);\n        }\n        \n        // Render traditional markers\n        function renderMarkers(data) {\n            data.locations.forEach(location => {\n                const { lat, lng, city, country } = location.location;\n                \n                let markerColor = '#26de81'; // benign\n                if (location.malwareCount > 0) {\n                    markerColor = '#ff3b3b'; // malware\n                } else if (location.suspiciousCount > 0) {\n                    markerColor = '#ffd700'; // suspicious\n                }\n                \n                const markerSize = Math.min(24, Math.max(8, 8 + location.totalScans * 2));\n                \n                const marker = L.circleMarker([lat, lng], {\n                    radius: markerSize / 2,\n                    fillColor: markerColor,\n                    color: '#fff',\n                    weight: 2,\n                    opacity: 0.8,\n                    fillOpacity: 0.6\n                });\n                \n                const popupContent = `\n                    <div style=\"color: var(--text-primary); min-width: 200px;\">\n                        <h3 style=\"margin: 0 0 10px 0; color: var(--accent-green); font-size: 1.1rem;\">\n                            <i class=\"fas fa-map-marker-alt\" style=\"color: ${markerColor};\"></i>\n                            ${city}, ${country}\n                        </h3>\n                        <p style=\"margin: 5px 0;\"><strong>IP:</strong> ${location.ip}</p>\n                        <p style=\"margin: 5px 0;\"><strong>Total Scans:</strong> ${location.totalScans}</p>\n                        <div style=\"margin-top: 10px;\">\n                            <div><span style=\"color: #ff3b3b;\"></span> Malware: ${location.malwareCount}</div>\n                            <div><span style=\"color: #ffd700;\"></span> Suspicious: ${location.suspiciousCount}</div>\n                            <div><span style=\"color: #39ff14;\"></span> Benign: ${location.benignCount}</div>\n                        </div>\n                        <button onclick=\"filterByLocation('${country}')\" \n                                style=\"margin-top: 10px; padding: 5px 10px; background: var(--accent-green); \n                                       color: var(--bg-primary); border: none; border-radius: 5px; cursor: pointer;\">\n                            Filter by ${country}\n                        </button>\n                    </div>\n                `;\n                \n                marker.bindPopup(popupContent);\n                marker.addTo(markerLayer);\n                \n                marker.on('mouseover', function() {\n                    this.setStyle({ fillOpacity: 0.9, opacity: 1 });\n                });\n                marker.on('mouseout', function() {\n                    this.setStyle({ fillOpacity: 0.6, opacity: 0.8 });\n                });\n            });\n        }\n        \n        // Render heatmap overlay\n        function renderHeatmap(data) {\n            const heatData = [];\n            \n            data.locations.forEach(location => {\n                const { lat, lng } = location.location;\n                // Weight by threat severity: malware = 1.0, suspicious = 0.5, benign = 0.2\n                const weight = (location.malwareCount * 1.0 + \n                               location.suspiciousCount * 0.5 + \n                               location.benignCount * 0.2) / location.totalScans;\n                \n                // Add multiple points for higher intensity\n                const intensity = Math.ceil(location.totalScans * weight);\n                for (let i = 0; i < intensity; i++) {\n                    heatData.push([lat, lng, weight]);\n                }\n            });\n            \n            heatmapLayer = L.heatLayer(heatData, {\n                radius: 35,\n                blur: 25,\n                maxZoom: 10,\n                max: 1.0,\n                gradient: {\n                    0.0: '#39ff14',  // Green (low threat)\n                    0.3: '#ffd700',  // Yellow\n                    0.6: '#ffa502',  // Orange\n                    0.8: '#ff6348',  // Red\n                    1.0: '#ff3b3b'   // Bright red (high threat)\n                }\n            }).addTo(worldMap);\n        }\n        \n        // Render choropleth (country-level threat shading)\n        function renderChoropleth(data) {\n            // Aggregate threats by country\n            const countryStats = {};\n            data.locations.forEach(location => {\n                const country = location.location.country;\n                if (!countryStats[country]) {\n                    countryStats[country] = { total: 0, malware: 0, suspicious: 0 };\n                }\n                countryStats[country].total += location.totalScans;\n                countryStats[country].malware += location.malwareCount;\n                countryStats[country].suspicious += location.suspiciousCount;\n            });\n            \n            // Find max for normalization\n            const maxThreats = Math.max(...Object.values(countryStats).map(s => \n                s.malware + s.suspicious * 0.5\n            ));\n            \n            // Draw circles for countries with threat data\n            choroplethLayer = L.layerGroup();\n            \n            Object.entries(countryStats).forEach(([country, stats]) => {\n                if (countryCoordinates[country]) {\n                    const threatScore = (stats.malware + stats.suspicious * 0.5) / maxThreats;\n                    \n                    // Color gradient from green to red\n                    let color;\n                    if (threatScore < 0.2) color = '#39ff14';\n                    else if (threatScore < 0.4) color = '#ffd700';\n                    else if (threatScore < 0.6) color = '#ffa502';\n                    else if (threatScore < 0.8) color = '#ff6348';\n                    else color = '#ff3b3b';\n                    \n                    const circle = L.circle(countryCoordinates[country].center, {\n                        color: color,\n                        fillColor: color,\n                        fillOpacity: 0.4,\n                        radius: 500000 * (1 + threatScore * 2),\n                        weight: 2\n                    });\n                    \n                    circle.bindPopup(`\n                        <div style=\"color: var(--text-primary);\">\n                            <h3 style=\"color: var(--accent-green);\">${country}</h3>\n                            <p><strong>Total Threats:</strong> ${stats.total}</p>\n                            <p><strong>Malware:</strong> ${stats.malware}</p>\n                            <p><strong>Suspicious:</strong> ${stats.suspicious}</p>\n                            <p><strong>Threat Level:</strong> ${(threatScore * 100).toFixed(0)}%</p>\n                        </div>\n                    `);\n                    \n                    circle.addTo(choroplethLayer);\n                }\n            });\n            \n            choroplethLayer.addTo(worldMap);\n        }\n        \n        // Update geographic context panel\n        function updateGeoContext(data) {\n            const countries = new Set(data.locations.map(l => l.location.country));\n            document.getElementById('activeRegions').textContent = countries.size;\n            \n            // Find hotspot (country with most threats)\n            const countryThreats = {};\n            data.locations.forEach(loc => {\n                const country = loc.location.country;\n                countryThreats[country] = (countryThreats[country] || 0) + \n                    loc.malwareCount + loc.suspiciousCount;\n            });\n            \n            const hotspot = Object.entries(countryThreats)\n                .sort((a, b) => b[1] - a[1])[0];\n            \n            if (hotspot) {\n                const percentage = ((hotspot[1] / data.locations.reduce((sum, l) => \n                    sum + l.malwareCount + l.suspiciousCount, 0)) * 100).toFixed(0);\n                document.getElementById('topRegion').textContent = \n                    `${hotspot[0]} (${percentage}% of threats)`;\n            }\n            \n            const totalThreats = data.locations.reduce((sum, l) => \n                sum + l.malwareCount + l.suspiciousCount, 0);\n            document.getElementById('geoThreatCount').textContent = totalThreats;\n        }\n        \n        // Filter dashboard by geographic location\n        window.filterByLocation = function(country) {\n            console.log(`Filtering by country: ${country}`);\n            // This would filter the tables and charts - simplified for demo\n            alert(`Geographic filtering activated for ${country}.\\nIn full implementation, this would filter all dashboard data.`);\n        };\n        \n        // Replay threats over last 24 hours\n        window.replayThreats = async function() {\n            const btn = document.getElementById('replayBtn');\n            const info = document.getElementById('timelineInfo');\n            \n            if (replayInterval) {\n                clearInterval(replayInterval);\n                replayInterval = null;\n                btn.innerHTML = '<i class=\"fas fa-play\"></i> Replay Last 24h';\n                info.textContent = 'Replay stopped';\n                if (geoDataCache) renderMapView(geoDataCache);\n                return;\n            }\n            \n            if (!geoDataCache || geoDataCache.locations.length === 0) {\n                info.textContent = 'No data available for replay';\n                return;\n            }\n            \n            btn.innerHTML = '<i class=\"fas fa-stop\"></i> Stop Replay';\n            info.textContent = 'Replaying threat detection timeline...';\n            \n            // Sort locations by timestamp\n            const sortedLocations = [...geoDataCache.locations].sort((a, b) => {\n                const timeA = a.scans[0]?.timestamp || 0;\n                const timeB = b.scans[0]?.timestamp || 0;\n                return new Date(timeA) - new Date(timeB);\n            });\n            \n            if (markerLayer) markerLayer.clearLayers();\n            let index = 0;\n            \n            replayInterval = setInterval(() => {\n                if (index >= sortedLocations.length) {\n                    clearInterval(replayInterval);\n                    replayInterval = null;\n                    btn.innerHTML = '<i class=\"fas fa-play\"></i> Replay Last 24h';\n                    info.textContent = 'Replay complete';\n                    return;\n                }\n                \n                const location = sortedLocations[index];\n                const { lat, lng, city, country } = location.location;\n                \n                let markerColor = location.malwareCount > 0 ? '#ff3b3b' : \n                                 location.suspiciousCount > 0 ? '#ffd700' : '#39ff14';\n                \n                // Animated marker appearance\n                const marker = L.circleMarker([lat, lng], {\n                    radius: 0,\n                    fillColor: markerColor,\n                    color: '#fff',\n                    weight: 2,\n                    opacity: 1,\n                    fillOpacity: 0.8\n                }).addTo(markerLayer);\n                \n                // Animate marker growth\n                let size = 0;\n                const growInterval = setInterval(() => {\n                    size += 2;\n                    if (size >= 12) {\n                        clearInterval(growInterval);\n                        marker.setStyle({ opacity: 0.8, fillOpacity: 0.6 });\n                    }\n                    marker.setRadius(size / 2);\n                }, 50);\n                \n                marker.bindPopup(`\n                    <div style=\"color: var(--text-primary);\">\n                        <strong>${city}, ${country}</strong><br>\n                        ${location.scans[0]?.filename || 'Unknown file'}\n                    </div>\n                `);\n                \n                info.textContent = `Replaying: ${index + 1}/${sortedLocations.length} - ${city}, ${country}`;\n                index++;\n            }, 800); // Show new threat every 800ms\n        };\n        \n        async function loadGeoMap() {\n            try {\n                // Initialize map only once\n                if (!mapInitialized) {\n                    initializeMap();\n                }\n                \n                if (!worldMap) return;\n                \n                const response = await fetch('/api/geo-data');\n                const data = await response.json();\n                \n                // Generate hash of current data to detect changes\n                const currentHash = JSON.stringify(data.locations.map(l => \n                    `${l.ip}-${l.totalScans}-${l.malwareCount}-${l.suspiciousCount}`\n                )).substring(0, 100);\n                \n                // Skip update if data hasn't changed\n                if (currentHash === lastGeoDataHash && markerLayer && markerLayer.getLayers().length > 0) {\n                    return;\n                }\n                lastGeoDataHash = currentHash;\n                \n                // Cache data for replay and other features\n                geoDataCache = data;\n                \n                // Render current view\n                renderMapView(data);\n                \n                console.log(`Map updated with ${data.locations.length} locations in ${currentMapView} mode`);\n                \n            } catch (error) {\n                console.error('Failed to load geo map:', error);\n            }\n        }\n        \n        async function loadMalwareSources() {\n            try {\n                const response = await fetch('/api/malware-sources');\n                const data = await response.json();\n                \n                const ctx = document.getElementById('malwareSourceChart');\n                \n                // Destroy existing chart if it exists\n                if (sourceChart) {\n                    sourceChart.destroy();\n                }\n                \n                const labels = data.sources.map(s => s.source);\n                const counts = data.sources.map(s => s.count);\n                \n                // Color scheme for different sources\n                const colors = [\n                    '#ff6b6b', // Email Attachment - red\n                    '#4ecdc4', // Web Download - teal\n                    '#ffe66d', // USB/External Drive - yellow\n                    '#a8dadc', // Internal Network - light blue\n                    '#95a5a6'  // Unknown - gray\n                ];\n                \n                sourceChart = new Chart(ctx, {\n                    type: 'pie',\n                    data: {\n                        labels: labels,\n                        datasets: [{\n                            data: counts,\n                            backgroundColor: colors,\n                            borderColor: '#1a1a2e',\n                            borderWidth: 2\n                        }]\n                    },\n                    options: {\n                        responsive: true,\n                        maintainAspectRatio: true,\n                        plugins: {\n                            legend: {\n                                position: 'bottom',\n                                labels: {\n                                    color: '#e0e0e0',\n                                    font: { size: 12 },\n                                    padding: 15\n                                }\n                            },\n                            tooltip: {\n                                backgroundColor: 'rgba(0, 0, 0, 0.8)',\n                                titleColor: '#fff',\n                                bodyColor: '#e0e0e0',\n                                borderColor: 'rgba(255, 255, 255, 0.1)',\n                                borderWidth: 1,\n                                callbacks: {\n                                    label: function(context) {\n                                        const label = context.label || '';\n                                        const value = context.parsed || 0;\n                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);\n                                        const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : 0;\n                                        return `${label}: ${value} (${percentage}%)`;\n                                    }\n                                }\n                            }\n                        }\n                    }\n                });\n                \n            } catch (error) {\n                console.error('Failed to load malware sources:', error);\n            }\n        }\n        \n        // Graph 2: \"Noisiest\" Agents Over Time\n        let noisyAgentsChart = null;\n        async function loadNoisyAgentsChart() {\n            try {\n                const response = await fetch('/api/noisy-agents');\n                const data = await response.json();\n                \n                console.log('Noisy agents data:', data);\n                \n                const ctx = document.getElementById('noisyAgentsChart');\n                if (!ctx) return;\n                \n                if (noisyAgentsChart) noisyAgentsChart.destroy();\n                \n                // Show message if no data\n                if (!data.agents || data.agents.length === 0) {\n                    ctx.parentElement.innerHTML = '<div style=\"padding: 2rem; text-align: center; color: var(--text-secondary);\">No agent data available yet. Start scanning files to see trends.</div>';\n                    return;\n                }\n                \n                const colors = [\n                    '#ff3b3b', '#39ff14', '#ffd700', '#1e90ff', '#ff1493'\n                ];\n                \n                noisyAgentsChart = new Chart(ctx, {\n                    type: 'line',\n                    data: {\n                        labels: data.dates,\n                        datasets: data.agents.map((agent, idx) => ({\n                            label: agent.agentId,\n                            data: agent.counts,\n                            borderColor: colors[idx],\n                            backgroundColor: colors[idx] + '20',\n                            tension: 0.4,\n                            borderWidth: 2,\n                            fill: false\n                        }))\n                    },\n                    options: {\n                        responsive: true,\n                        maintainAspectRatio: false,\n                        plugins: {\n                            legend: {\n                                labels: { color: '#e0e0e0', font: { size: 11 } }\n                            },\n                            tooltip: {\n                                backgroundColor: 'rgba(0, 0, 0, 0.8)',\n                                titleColor: '#fff',\n                                bodyColor: '#e0e0e0'\n                            }\n                        },\n                        scales: {\n                            y: {\n                                beginAtZero: true,\n                                ticks: { color: '#888' },\n                                grid: { color: 'rgba(255, 255, 255, 0.05)' }\n                            },\n                            x: {\n                                ticks: { color: '#888' },\n                                grid: { color: 'rgba(255, 255, 255, 0.05)' }\n                            }\n                        }\n                    }\n                });\n            } catch (error) {\n                console.error('Failed to load noisy agents chart:', error);\n                const ctx = document.getElementById('noisyAgentsChart');\n                if (ctx) {\n                    ctx.parentElement.innerHTML = '<div style=\"padding: 2rem; text-align: center; color: var(--accent-red);\">Error loading chart data</div>';\n                }\n            }\n        }\n        \n        // Graph 3: Signature Status vs. Classification\n        let signatureClassChart = null;\n        async function loadSignatureClassChart() {\n            try {\n                const response = await fetch('/api/signature-classification');\n                const data = await response.json();\n                \n                console.log('Signature classification data:', data);\n                \n                const ctx = document.getElementById('signatureClassChart');\n                if (!ctx) {\n                    console.warn('signatureClassChart canvas not found');\n                    return;\n                }\n                \n                if (signatureClassChart) signatureClassChart.destroy();\n                \n                signatureClassChart = new Chart(ctx, {\n                    type: 'bar',\n                    data: {\n                        labels: ['Benign', 'Suspicious', 'Malware'],\n                        datasets: [\n                            {\n                                label: 'Verified',\n                                data: [data.benign.verified, data.suspicious.verified, data.malware.verified],\n                                backgroundColor: '#39ff14',\n                                stack: 'stack0'\n                            },\n                            {\n                                label: 'Unknown',\n                                data: [data.benign.unknown, data.suspicious.unknown, data.malware.unknown],\n                                backgroundColor: '#ffd700',\n                                stack: 'stack0'\n                            },\n                            {\n                                label: 'Untrusted',\n                                data: [data.benign.untrusted, data.suspicious.untrusted, data.malware.untrusted],\n                                backgroundColor: '#ff3b3b',\n                                stack: 'stack0'\n                            }\n                        ]\n                    },\n                    options: {\n                        responsive: true,\n                        maintainAspectRatio: false,\n                        plugins: {\n                            legend: {\n                                labels: { color: '#e0e0e0', font: { size: 11 } }\n                            },\n                            tooltip: {\n                                backgroundColor: 'rgba(0, 0, 0, 0.8)',\n                                callbacks: {\n                                    label: function(context) {\n                                        const total = context.chart.data.datasets\n                                            .reduce((sum, ds) => sum + ds.data[context.dataIndex], 0);\n                                        const percentage = ((context.parsed.y / total) * 100).toFixed(1);\n                                        return `${context.dataset.label}: ${context.parsed.y} (${percentage}%)`;\n                                    }\n                                }\n                            }\n                        },\n                        scales: {\n                            y: {\n                                stacked: true,\n                                ticks: { color: '#888' },\n                                grid: { color: 'rgba(255, 255, 255, 0.05)' }\n                            },\n                            x: {\n                                stacked: true,\n                                ticks: { color: '#888' },\n                                grid: { display: false }\n                            }\n                        }\n                    }\n                });\n            } catch (error) {\n                console.error('Failed to load signature classification chart:', error);\n                const ctx = document.getElementById('signatureClassChart');\n                if (ctx && ctx.parentElement) {\n                    ctx.parentElement.innerHTML = '<div style=\"padding: 1rem; text-align: center; color: var(--text-secondary); font-size: 0.85rem;\">No data available</div>';\n                }\n            }\n        }\n        \n        // Graph 4: Packer Usage vs. Classification\n        let packerClassChart = null;\n        async function loadPackerClassChart() {\n            try {\n                const response = await fetch('/api/packer-classification');\n                const data = await response.json();\n                \n                console.log('Packer classification data:', data);\n                \n                const ctx = document.getElementById('packerClassChart');\n                if (!ctx) {\n                    console.warn('packerClassChart canvas not found');\n                    return;\n                }\n                \n                if (packerClassChart) packerClassChart.destroy();\n                \n                packerClassChart = new Chart(ctx, {\n                    type: 'bar',\n                    data: {\n                        labels: data.packers,\n                        datasets: [\n                            {\n                                label: 'Benign Files',\n                                data: data.benignCounts,\n                                backgroundColor: '#39ff14'\n                            },\n                            {\n                                label: 'Malware Files',\n                                data: data.malwareCounts,\n                                backgroundColor: '#ff3b3b'\n                            }\n                        ]\n                    },\n                    options: {\n                        responsive: true,\n                        maintainAspectRatio: false,\n                        plugins: {\n                            legend: {\n                                labels: { color: '#e0e0e0', font: { size: 11 } }\n                            },\n                            tooltip: {\n                                backgroundColor: 'rgba(0, 0, 0, 0.8)'\n                            }\n                        },\n                        scales: {\n                            y: {\n                                beginAtZero: true,\n                                ticks: { color: '#888' },\n                                grid: { color: 'rgba(255, 255, 255, 0.05)' }\n                            },\n                            x: {\n                                ticks: { color: '#888' },\n                                grid: { display: false }\n                            }\n                        }\n                    }\n                });\n            } catch (error) {\n                console.error('Failed to load packer classification chart:', error);\n                const ctx = document.getElementById('packerClassChart');\n                if (ctx && ctx.parentElement) {\n                    ctx.parentElement.innerHTML = '<div style=\"padding: 1rem; text-align: center; color: var(--text-secondary); font-size: 0.85rem;\">No data available</div>';\n                }\n            }\n        }\n        \n        // Graph 5: Confidence Score Histogram\n        let confidenceHistChart = null;\n        async function loadConfidenceHistChart() {\n            try {\n                const response = await fetch('/api/confidence-distribution');\n                const data = await response.json();\n                \n                console.log('Confidence distribution data:', data);\n                \n                const ctx = document.getElementById('confidenceHistChart');\n                if (!ctx) {\n                    console.warn('confidenceHistChart canvas not found');\n                    return;\n                }\n                \n                if (confidenceHistChart) confidenceHistChart.destroy();\n                \n                confidenceHistChart = new Chart(ctx, {\n                    type: 'bar',\n                    data: {\n                        labels: data.bins,\n                        datasets: [{\n                            label: 'Scan Count',\n                            data: data.counts,\n                            backgroundColor: '#39ff14',\n                            borderColor: '#2ed60f',\n                            borderWidth: 1\n                        }]\n                    },\n                    options: {\n                        responsive: true,\n                        maintainAspectRatio: false,\n                        plugins: {\n                            legend: {\n                                labels: { color: '#e0e0e0', font: { size: 11 } }\n                            },\n                            tooltip: {\n                                backgroundColor: 'rgba(0, 0, 0, 0.8)'\n                            }\n                        },\n                        scales: {\n                            y: {\n                                beginAtZero: true,\n                                ticks: { color: '#888' },\n                                grid: { color: 'rgba(255, 255, 255, 0.05)' },\n                                title: {\n                                    display: true,\n                                    text: 'Number of Scans',\n                                    color: '#888'\n                                }\n                            },\n                            x: {\n                                ticks: { color: '#888' },\n                                grid: { display: false },\n                                title: {\n                                    display: true,\n                                    text: 'Confidence Score Range',\n                                    color: '#888'\n                                }\n                            }\n                        }\n                    }\n                });\n            } catch (error) {\n                console.error('Failed to load confidence histogram:', error);\n                const ctx = document.getElementById('confidenceHistChart');\n                if (ctx && ctx.parentElement) {\n                    ctx.parentElement.innerHTML = '<div style=\"padding: 1rem; text-align: center; color: var(--text-secondary); font-size: 0.85rem;\">No data available</div>';\n                }\n            }\n        }\n        \n        // Graph 6: File Entropy Distribution (Box Plot simulation)\n        let entropyBoxChart = null;\n        async function loadEntropyBoxChart() {\n            try {\n                const response = await fetch('/api/entropy-distribution');\n                const data = await response.json();\n                \n                console.log('Entropy distribution data:', data);\n                \n                const ctx = document.getElementById('entropyBoxChart');\n                if (!ctx) {\n                    console.warn('entropyBoxChart canvas not found');\n                    return;\n                }\n                \n                if (entropyBoxChart) entropyBoxChart.destroy();\n                \n                // Create violin/box plot effect with multiple bars\n                const benignData = [\n                    data.benign.min,\n                    data.benign.q1,\n                    data.benign.median,\n                    data.benign.q3,\n                    data.benign.max\n                ];\n                \n                const malwareData = [\n                    data.malware.min,\n                    data.malware.q1,\n                    data.malware.median,\n                    data.malware.q3,\n                    data.malware.max\n                ];\n                \n                entropyBoxChart = new Chart(ctx, {\n                    type: 'bar',\n                    data: {\n                        labels: ['Min', 'Q1', 'Median', 'Q3', 'Max'],\n                        datasets: [\n                            {\n                                label: 'Benign Files',\n                                data: benignData,\n                                backgroundColor: '#39ff14',\n                                borderColor: '#2ed60f',\n                                borderWidth: 1\n                            },\n                            {\n                                label: 'Malware Files',\n                                data: malwareData,\n                                backgroundColor: '#ff3b3b',\n                                borderColor: '#cc2f2f',\n                                borderWidth: 1\n                            }\n                        ]\n                    },\n                    options: {\n                        responsive: true,\n                        maintainAspectRatio: false,\n                        plugins: {\n                            legend: {\n                                labels: { color: '#e0e0e0', font: { size: 11 } }\n                            },\n                            tooltip: {\n                                backgroundColor: 'rgba(0, 0, 0, 0.8)',\n                                callbacks: {\n                                    label: function(context) {\n                                        return `${context.dataset.label}: ${context.parsed.y.toFixed(3)}`;\n                                    }\n                                }\n                            }\n                        },\n                        scales: {\n                            y: {\n                                beginAtZero: true,\n                                max: 8.0,\n                                ticks: { color: '#888' },\n                                grid: { color: 'rgba(255, 255, 255, 0.05)' },\n                                title: {\n                                    display: true,\n                                    text: 'Entropy Value',\n                                    color: '#888'\n                                }\n                            },\n                            x: {\n                                ticks: { color: '#888' },\n                                grid: { display: false }\n                            }\n                        }\n                    }\n                });\n            } catch (error) {\n                console.error('Failed to load entropy distribution chart:', error);\n                const ctx = document.getElementById('entropyBoxChart');\n                if (ctx && ctx.parentElement) {\n                    ctx.parentElement.innerHTML = '<div style=\"padding: 1rem; text-align: center; color: var(--text-secondary); font-size: 0.85rem;\">No data available</div>';\n                }\n            }\n        }\n        \n        async function loadEmergingThreats() {\n            try {\n                const response = await fetch('/api/emerging-threats');\n                const data = await response.json();\n                \n                // Update summary badges\n                document.getElementById('eti-total').textContent = \n                    `${data.summary.totalThreats} Total Threats`;\n                document.getElementById('eti-recent').textContent = \n                    `${data.summary.recentThreats} Last 24h`;\n                \n                // Helper to render IOC list\n                const renderIOCList = (items, container) => {\n                    if (items.length === 0) {\n                        container.innerHTML = '<div class=\"eti-empty\">No threats detected</div>';\n                        return;\n                    }\n                    \n                    container.innerHTML = items.map((item, index) => {\n                        const rank = index + 1;\n                        const recentBadge = item.recent > 0 ? \n                            `<span class=\"eti-recent-badge\">${item.recent} recent</span>` : '';\n                        const agentBadge = item.agents > 0 ? \n                            `<span class=\"eti-agent-badge\">${item.agents} agents</span>` : '';\n                        \n                        return `\n                            <div class=\"eti-item\" data-rank=\"${rank}\">\n                                <div class=\"eti-rank\">${rank}</div>\n                                <div class=\"eti-content\">\n                                    <div class=\"eti-name\">${item.name}</div>\n                                    <div class=\"eti-meta\">\n                                        <span class=\"eti-count\">${item.count} occurrences</span>\n                                        ${recentBadge}\n                                        ${agentBadge}\n                                    </div>\n                                    ${item.details && item.details.length > 0 ? `\n                                        <div class=\"eti-details\">\n                                            ${item.details.slice(0, 2).join(', ')}\n                                            ${item.details.length > 2 ? '...' : ''}\n                                        </div>\n                                    ` : ''}\n                                </div>\n                            </div>\n                        `;\n                    }).join('');\n                };\n                \n                // Render each section\n                renderIOCList(data.topMalwareFamilies, document.getElementById('eti-malware'));\n                renderIOCList(data.topSuspiciousAPIs, document.getElementById('eti-apis'));\n                renderIOCList(data.topMaliciousStrings, document.getElementById('eti-strings'));\n                renderIOCList(data.topPackers, document.getElementById('eti-packers'));\n                \n            } catch (error) {\n                console.error('Failed to load emerging threats:', error);\n            }\n        }\n        \n        async function analyzeThreatModel() {\n            try {\n                // Get selected values\n                const fileType = document.getElementById('model-filetype').value;\n                const packer = document.getElementById('model-packer').value;\n                const signature = document.getElementById('model-signature').value;\n                \n                // Get multiple selections\n                const apisSelect = document.getElementById('model-apis');\n                const apiImports = Array.from(apisSelect.selectedOptions).map(opt => opt.value);\n                \n                const stringsSelect = document.getElementById('model-strings');\n                const keyStrings = Array.from(stringsSelect.selectedOptions).map(opt => opt.value);\n                \n                // Validate\n                if (apiImports.length === 0) {\n                    alert('Please select at least one API import');\n                    return;\n                }\n                if (keyStrings.length === 0) {\n                    alert('Please select at least one suspicious string');\n                    return;\n                }\n                \n                // Show loading state\n                const outputDiv = document.getElementById('modeler-output');\n                outputDiv.innerHTML = `\n                    <div class=\"modeler-loading\">\n                        <i class=\"fas fa-spinner fa-spin\"></i>\n                        <p>Analyzing threat profile...</p>\n                    </div>\n                `;\n                \n                // Send to server\n                const response = await fetch('/api/threat-model', {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({\n                        fileType,\n                        packer,\n                        signature,\n                        apiImports,\n                        keyStrings\n                    })\n                });\n                \n                const data = await response.json();\n                \n                if (data.success) {\n                    const result = data.result;\n                    const classColor = \n                        result.classification === 'Malware' ? '#ff4757' :\n                        result.classification === 'Suspicious' ? '#ffa502' : '#26de81';\n                    \n                    outputDiv.innerHTML = `\n                        <div class=\"prediction-result\">\n                            <div class=\"prediction-header\">\n                                <div class=\"prediction-badge\" style=\"background: ${classColor};\">\n                                    ${result.classification.toUpperCase()}\n                                </div>\n                                <div class=\"prediction-confidence\">\n                                    <div class=\"confidence-label\">Confidence Score</div>\n                                    <div class=\"confidence-value\">${(parseFloat(result.confidence_score) * 100).toFixed(1)}%</div>\n                                </div>\n                            </div>\n                            \n                            ${result.malware_family ? `\n                                <div class=\"prediction-family\">\n                                    <strong>Predicted Malware Family:</strong>\n                                    <span class=\"family-name\">${result.malware_family}</span>\n                                </div>\n                            ` : ''}\n                            \n                            <div class=\"prediction-section\">\n                                <h4>Threat Analysis</h4>\n                                <div class=\"analysis-item\">\n                                    <i class=\"fas fa-file\"></i>\n                                    <span><strong>File Type:</strong> ${result.key_findings.file_type}</span>\n                                </div>\n                                <div class=\"analysis-item\">\n                                    <i class=\"fas fa-box\"></i>\n                                    <span><strong>Packer:</strong> ${result.key_findings.packer_detected}</span>\n                                </div>\n                                <div class=\"analysis-item\">\n                                    <i class=\"fas fa-certificate\"></i>\n                                    <span><strong>Signature:</strong> ${result.key_findings.signature.name}</span>\n                                </div>\n                                <div class=\"analysis-item\">\n                                    <i class=\"fas fa-tachometer-alt\"></i>\n                                    <span><strong>Threat Score:</strong> ${result.key_findings.threat_score}/100</span>\n                                </div>\n                            </div>\n                            \n                            <div class=\"prediction-section\">\n                                <h4>Detected Indicators</h4>\n                                <div class=\"indicator-group\">\n                                    <strong>API Imports:</strong>\n                                    <div class=\"indicator-list\">\n                                        ${result.key_findings.api_imports.map(api => \n                                            `<span class=\"indicator-tag api-tag\">${api}</span>`\n                                        ).join('')}\n                                    </div>\n                                </div>\n                                <div class=\"indicator-group\">\n                                    <strong>Suspicious Strings:</strong>\n                                    <div class=\"indicator-list\">\n                                        ${result.key_findings.key_strings.map(str => \n                                            `<span class=\"indicator-tag string-tag\">${str}</span>`\n                                        ).join('')}\n                                    </div>\n                                </div>\n                            </div>\n                            \n                            <div class=\"prediction-footer\">\n                                <i class=\"fas fa-info-circle\"></i>\n                                This analysis has been added to the scan results and will appear in all visualizations.\n                            </div>\n                        </div>\n                    `;\n                } else {\n                    outputDiv.innerHTML = `\n                        <div class=\"modeler-error\">\n                            <i class=\"fas fa-exclamation-circle\"></i>\n                            <p>Analysis failed: ${data.error}</p>\n                        </div>\n                    `;\n                }\n                \n            } catch (error) {\n                console.error('Failed to analyze threat model:', error);\n                document.getElementById('modeler-output').innerHTML = `\n                    <div class=\"modeler-error\">\n                        <i class=\"fas fa-exclamation-circle\"></i>\n                        <p>Analysis failed. Please try again.</p>\n                    </div>\n                `;\n            }\n        }\n        \n        let graphSimulation = null;\n        let graphSvg = null;\n        \n        async function loadCorrelationGraph() {\n            try {\n                const response = await fetch('/api/threat-correlations');\n                const data = await response.json();\n                \n                // Clear existing graph\n                d3.select('#correlationGraph').selectAll('*').remove();\n                \n                const container = document.getElementById('correlationGraph');\n                const width = container.clientWidth;\n                const height = 600;\n                \n                // Create SVG\n                graphSvg = d3.select('#correlationGraph')\n                    .append('svg')\n                    .attr('width', width)\n                    .attr('height', height)\n                    .style('background', '#0a0a0a')\n                    .style('border-radius', '8px');\n                \n                const g = graphSvg.append('g');\n                \n                // Add zoom behavior\n                const zoom = d3.zoom()\n                    .scaleExtent([0.1, 4])\n                    .on('zoom', (event) => {\n                        g.attr('transform', event.transform);\n                    });\n                \n                graphSvg.call(zoom);\n                \n                // Color schemes for different node types\n                const colorMap = {\n                    malware: '#ff4757',\n                    agent: '#5a9cf8',\n                    api: '#ffa502',\n                    string: '#26de81'\n                };\n                \n                // Create force simulation\n                graphSimulation = d3.forceSimulation(data.nodes)\n                    .force('link', d3.forceLink(data.links)\n                        .id(d => d.id)\n                        .distance(d => d.type === 'correlated_with' ? 200 : 100)\n                        .strength(d => d.strength * 0.3))\n                    .force('charge', d3.forceManyBody().strength(-300))\n                    .force('center', d3.forceCenter(width / 2, height / 2))\n                    .force('collision', d3.forceCollide().radius(30));\n                \n                // Draw links\n                const link = g.append('g')\n                    .selectAll('line')\n                    .data(data.links)\n                    .enter()\n                    .append('line')\n                    .attr('stroke', d => {\n                        if (d.type === 'correlated_with') return '#ff6b6b';\n                        if (d.type === 'detected_by') return '#5a9cf8';\n                        if (d.type === 'uses_api') return '#ffa502';\n                        return '#26de81';\n                    })\n                    .attr('stroke-width', d => Math.sqrt(d.strength) + 1)\n                    .attr('stroke-opacity', 0.6);\n                \n                // Draw nodes\n                const node = g.append('g')\n                    .selectAll('circle')\n                    .data(data.nodes)\n                    .enter()\n                    .append('circle')\n                    .attr('r', d => {\n                        if (d.type === 'malware') return 15 + Math.min(d.count * 2, 15);\n                        if (d.type === 'agent') return 12 + Math.min(d.count, 10);\n                        return 8 + Math.min(d.count, 8);\n                    })\n                    .attr('fill', d => colorMap[d.type])\n                    .attr('stroke', '#fff')\n                    .attr('stroke-width', 2)\n                    .style('cursor', 'pointer')\n                    .call(d3.drag()\n                        .on('start', dragstarted)\n                        .on('drag', dragged)\n                        .on('end', dragended))\n                    .on('click', (event, d) => showNodeDetails(d, data))\n                    .on('mouseover', function(event, d) {\n                        d3.select(this)\n                            .transition()\n                            .duration(200)\n                            .attr('stroke-width', 4)\n                            .attr('r', function() {\n                                const currentR = parseFloat(d3.select(this).attr('r'));\n                                return currentR * 1.3;\n                            });\n                    })\n                    .on('mouseout', function(event, d) {\n                        d3.select(this)\n                            .transition()\n                            .duration(200)\n                            .attr('stroke-width', 2)\n                            .attr('r', function() {\n                                if (d.type === 'malware') return 15 + Math.min(d.count * 2, 15);\n                                if (d.type === 'agent') return 12 + Math.min(d.count, 10);\n                                return 8 + Math.min(d.count, 8);\n                            });\n                    });\n                \n                // Add labels\n                const label = g.append('g')\n                    .selectAll('text')\n                    .data(data.nodes)\n                    .enter()\n                    .append('text')\n                    .text(d => d.label.length > 20 ? d.label.substring(0, 20) + '...' : d.label)\n                    .attr('font-size', d => d.type === 'malware' ? '12px' : '10px')\n                    .attr('fill', '#e0e0e0')\n                    .attr('text-anchor', 'middle')\n                    .attr('dy', d => {\n                        if (d.type === 'malware') return 35;\n                        if (d.type === 'agent') return 25;\n                        return 20;\n                    })\n                    .style('pointer-events', 'none')\n                    .style('font-weight', d => d.type === 'malware' ? 'bold' : 'normal');\n                \n                // Update positions on simulation tick\n                graphSimulation.on('tick', () => {\n                    link\n                        .attr('x1', d => d.source.x)\n                        .attr('y1', d => d.source.y)\n                        .attr('x2', d => d.target.x)\n                        .attr('y2', d => d.target.y);\n                    \n                    node\n                        .attr('cx', d => d.x)\n                        .attr('cy', d => d.y);\n                    \n                    label\n                        .attr('x', d => d.x)\n                        .attr('y', d => d.y);\n                });\n                \n                // Drag functions\n                function dragstarted(event, d) {\n                    if (!event.active) graphSimulation.alphaTarget(0.3).restart();\n                    d.fx = d.x;\n                    d.fy = d.y;\n                }\n                \n                function dragged(event, d) {\n                    d.fx = event.x;\n                    d.fy = event.y;\n                }\n                \n                function dragended(event, d) {\n                    if (!event.active) graphSimulation.alphaTarget(0);\n                    d.fx = null;\n                    d.fy = null;\n                }\n                \n                console.log(`Correlation graph loaded: ${data.nodes.length} nodes, ${data.links.length} links`);\n                \n            } catch (error) {\n                console.error('Failed to load correlation graph:', error);\n            }\n        }\n        \n        function showNodeDetails(node, graphData) {\n            const detailsPanel = document.getElementById('nodeDetails');\n            const detailsTitle = document.getElementById('detailsTitle');\n            const detailsContent = document.getElementById('detailsContent');\n            \n            detailsTitle.textContent = node.label;\n            \n            let html = `<p><strong>Type:</strong> ${node.type.toUpperCase()}</p>`;\n            html += `<p><strong>Occurrences:</strong> ${node.count}</p>`;\n            \n            // Find connections\n            const connections = graphData.links.filter(l => \n                l.source.id === node.id || l.target.id === node.id\n            );\n            \n            if (connections.length > 0) {\n                html += `<p><strong>Connections:</strong> ${connections.length}</p>`;\n                html += '<ul style=\"margin: 10px 0; padding-left: 20px;\">';\n                connections.slice(0, 10).forEach(link => {\n                    const otherNode = link.source.id === node.id ? link.target : link.source;\n                    html += `<li>${link.type.replace(/_/g, ' ')}: ${otherNode.label}</li>`;\n                });\n                if (connections.length > 10) {\n                    html += `<li>...and ${connections.length - 10} more</li>`;\n                }\n                html += '</ul>';\n            }\n            \n            if (node.details && node.details.length > 0) {\n                html += '<p><strong>Associated Files:</strong></p>';\n                html += '<ul style=\"margin: 10px 0; padding-left: 20px; max-height: 150px; overflow-y: auto;\">';\n                node.details.slice(0, 10).forEach(file => {\n                    html += `<li>${file}</li>`;\n                });\n                if (node.details.length > 10) {\n                    html += `<li>...and ${node.details.length - 10} more</li>`;\n                }\n                html += '</ul>';\n            }\n            \n            detailsContent.innerHTML = html;\n            detailsPanel.style.display = 'block';\n        }\n        \n        function resetGraph() {\n            if (graphSimulation) {\n                graphSimulation.alpha(1).restart();\n            }\n        }\n        \n        function centerGraph() {\n            if (graphSvg) {\n                graphSvg.transition().duration(750).call(\n                    d3.zoom().transform,\n                    d3.zoomIdentity\n                );\n            }\n        }\n        \n        function setChartDays(days) {\n            currentChartDays = days;\n            \n            // Update button states\n            document.querySelectorAll('.chart-btn').forEach(btn => {\n                btn.classList.remove('active');\n            });\n            event.target.classList.add('active');\n            \n            loadDailyChart();\n        }\n        \n        function loadData() {\n            loadStats();\n            loadScans();\n            loadDailyChart();\n            loadMalwareSources();\n            loadNoisyAgentsChart();\n            loadSignatureClassChart();\n            loadPackerClassChart();\n            loadConfidenceHistChart();\n            loadEntropyBoxChart();\n            loadEmergingThreats();\n            loadCorrelationGraph();\n            loadGeoMap();\n        }\n        \n        function loadDataWithoutMap() {\n            loadStats();\n            loadScans();\n            loadDailyChart();\n            loadMalwareSources();\n            loadNoisyAgentsChart();\n            loadSignatureClassChart();\n            loadPackerClassChart();\n            loadConfidenceHistChart();\n            loadEntropyBoxChart();\n            loadEmergingThreats();\n            loadCorrelationGraph();\n        }\n        \n        // Initial load\n        loadData();\n        \n        // Set up Server-Sent Events for real-time updates\n        const eventSource = new EventSource('/api/events');\n        \n        eventSource.onmessage = function(event) {\n            const data = JSON.parse(event.data);\n            \n            if (data.type === 'connected') {\n                console.log('Connected to server for real-time updates');\n            } else if (data.type === 'new-scan') {\n                console.log('New scan received:', data.scan.detected_filename);\n                \n                // Show notification toast\n                showThreatNotification(data.scan);\n                \n                // Add to threat ticker\n                addToThreatTicker(data.scan);\n                \n                // Reload all data when new scan arrives\n                loadDataWithoutMap();\n                // Update map less frequently (only if it's been more than 10 seconds)\n                if (!window.lastMapUpdate || Date.now() - window.lastMapUpdate > 10000) {\n                    loadGeoMap();\n                    window.lastMapUpdate = Date.now();\n                }\n            }\n        };\n        \n        eventSource.onerror = function(error) {\n            console.error('SSE Error:', error);\n            // Fallback: reload data every 30 seconds if SSE connection fails\n            if (eventSource.readyState === EventSource.CLOSED) {\n                console.log('SSE connection closed, falling back to polling...');\n                setInterval(loadDataWithoutMap, 30000);\n            }\n        };\n        \n        // Manual refresh button functionality\n        window.manualRefresh = function() {\n            loadData();\n        };\n    </script>\n    \n    <!-- Theme Toggle Script -->\n    <script>\n        // Theme Toggle Functionality\n        window.toggleTheme = function() {\n            const html = document.documentElement;\n            const currentTheme = html.getAttribute('data-theme');\n            const newTheme = currentTheme === 'light' ? '' : 'light';\n            \n            if (newTheme) {\n                html.setAttribute('data-theme', newTheme);\n            } else {\n                html.removeAttribute('data-theme');\n            }\n            localStorage.setItem('theme', newTheme || 'dark');\n            \n            // Update button icon and text\n            const themeIcon = document.getElementById('themeIcon');\n            const themeText = document.getElementById('themeText');\n            \n            if (newTheme === 'light') {\n                themeIcon.textContent = '';\n                themeText.textContent = 'Light';\n            } else {\n                themeIcon.textContent = '';\n                themeText.textContent = 'Dark';\n            }\n        };\n        \n        // Load saved theme on page load\n        (function() {\n            const savedTheme = localStorage.getItem('theme') || 'dark';\n            if (savedTheme === 'light') {\n                document.documentElement.setAttribute('data-theme', 'light');\n            }\n            \n            const themeIcon = document.getElementById('themeIcon');\n            const themeText = document.getElementById('themeText');\n            \n            if (savedTheme === 'light') {\n                themeIcon.textContent = '';\n                themeText.textContent = 'Light';\n            } else {\n                themeIcon.textContent = '';\n                themeText.textContent = 'Dark';\n            }\n        })();\n    </script>\n</body>\n</html>","epoch":59,"telemetryInfo":{}}],["file:///home/trang/localnsv/mAIware-server/public/styles.css::request_5c21c11f-964f-4128-b95d-f7fa294fb3c0",{"uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware-server/public/styles.css","external":"file:///home/trang/localnsv/mAIware-server/public/styles.css","path":"/home/trang/localnsv/mAIware-server/public/styles.css","scheme":"file"},"requestId":"request_5c21c11f-964f-4128-b95d-f7fa294fb3c0","content":":root {\n    --bg-primary: #000000;\n    --bg-secondary: #0a0a0a;\n    --bg-card: #0f0f0f;\n    --bg-hover: #151515;\n    --text-primary: #e8f0e8;\n    --text-secondary: #9ca3af;\n    --accent-green: #39ff14;\n    --accent-green-dim: #2ed60f;\n    --accent-yellow: #ffd700;\n    --accent-red: #ff3b3b;\n    --accent-red-dim: #cc2f2f;\n    --border-color: #1a1a1a;\n    --shadow-color: rgba(0, 0, 0, 0.5);\n    --success-glow: rgba(57, 255, 20, 0.3);\n    --danger-glow: rgba(255, 59, 59, 0.3);\n    --warning-glow: rgba(255, 215, 0, 0.3);\n}\n\n[data-theme=\"light\"] {\n    --bg-primary: #f0f4f0;\n    --bg-secondary: #ffffff;\n    --bg-card: #fafafa;\n    --bg-hover: #e8f5e8;\n    --text-primary: #1a1f2e;\n    --text-secondary: #4a5568;\n    --accent-green: #2ed60f;\n    --accent-green-dim: #27b00c;\n    --accent-yellow: #cc9a00;\n    --accent-red: #dc2626;\n    --accent-red-dim: #b91c1c;\n    --border-color: #d1d5db;\n    --shadow-color: rgba(0, 0, 0, 0.1);\n    --success-glow: rgba(46, 214, 15, 0.2);\n    --danger-glow: rgba(220, 38, 38, 0.2);\n    --warning-glow: rgba(204, 154, 0, 0.2);\n}\n\n* { \n    margin: 0; \n    padding: 0; \n    box-sizing: border-box; \n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background: var(--bg-primary);\n    color: var(--text-primary);\n    min-height: 100vh;\n    margin: 0;\n    overflow-x: hidden;\n    position: relative;\n}\n\nbody::before {\n    content: '';\n    position: fixed;\n    top: -50%;\n    left: -50%;\n    width: 200%;\n    height: 200%;\n    background: \n        radial-gradient(circle at 20% 50%, rgba(57, 255, 20, 0.08) 0%, transparent 50%),\n        radial-gradient(circle at 80% 80%, rgba(57, 255, 20, 0.06) 0%, transparent 50%),\n        radial-gradient(circle at 40% 20%, rgba(57, 255, 20, 0.05) 0%, transparent 50%);\n    animation: backgroundGlow 15s ease-in-out infinite;\n    pointer-events: none;\n    z-index: 0;\n}\n\n@keyframes backgroundGlow {\n    0%, 100% { \n        transform: translate(0, 0) scale(1);\n        opacity: 0.4;\n    }\n    33% { \n        transform: translate(10%, 10%) scale(1.1);\n        opacity: 0.6;\n    }\n    66% { \n        transform: translate(-10%, 5%) scale(0.95);\n        opacity: 0.5;\n    }\n}\n\nbody > * {\n    position: relative;\n    z-index: 1;\n}\n\n/* Side Panel Navigation */\n.side-panel {\n    position: fixed;\n    left: 0;\n    top: 0;\n    height: 100vh;\n    width: 70px;\n    background: rgba(10, 10, 10, 0.7);\n    backdrop-filter: blur(20px);\n    -webkit-backdrop-filter: blur(20px);\n    border-right: 1px solid rgba(57, 255, 20, 0.2);\n    box-shadow: 0 0 30px rgba(57, 255, 20, 0.1);\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    z-index: 9999;\n    transition: all 0.3s ease;\n}\n\n.side-panel:hover {\n    background: rgba(15, 15, 15, 0.8);\n    box-shadow: 0 0 40px rgba(57, 255, 20, 0.2);\n}\n\n.panel-icon-strip {\n    width: 100%;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    padding: 2rem 0;\n}\n\n.panel-logo-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 50px;\n    height: 50px;\n    color: var(--accent-green);\n    font-size: 2rem;\n    animation: pulse-glow 3s ease-in-out infinite;\n    cursor: pointer;\n    transition: all 0.3s ease;\n}\n\n.panel-logo-icon:hover {\n    transform: scale(1.1);\n    filter: drop-shadow(0 0 20px var(--success-glow));\n}\n\n@keyframes pulse-glow {\n    0%, 100% { filter: drop-shadow(0 0 5px var(--success-glow)); }\n    50% { filter: drop-shadow(0 0 15px var(--success-glow)) drop-shadow(0 0 25px var(--success-glow)); }\n}\n\n/* Graphs Preview Grid */\n.graphs-preview {\n    position: fixed;\n    left: 70px;\n    top: 50%;\n    transform: translateY(-50%) translateX(-100%);\n    background: rgba(10, 10, 10, 0.85);\n    backdrop-filter: blur(25px);\n    -webkit-backdrop-filter: blur(25px);\n    border: 1px solid rgba(57, 255, 20, 0.3);\n    border-left: none;\n    border-radius: 0 12px 12px 0;\n    padding: 2rem;\n    width: 480px;\n    max-height: 90vh;\n    overflow-y: auto;\n    opacity: 0;\n    visibility: hidden;\n    pointer-events: none;\n    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);\n    box-shadow: 5px 0 40px rgba(57, 255, 20, 0.15), 0 0 0 1px rgba(57, 255, 20, 0.2);\n    z-index: 9998;\n    backdrop-filter: blur(10px);\n}\n\n.graphs-preview::-webkit-scrollbar {\n    width: 6px;\n}\n\n.graphs-preview::-webkit-scrollbar-track {\n    background: var(--bg-secondary);\n    border-radius: 3px;\n}\n\n.graphs-preview::-webkit-scrollbar-thumb {\n    background: var(--accent-green);\n    border-radius: 3px;\n}\n\n.graphs-preview.show {\n    opacity: 1;\n    visibility: visible;\n    pointer-events: auto;\n    transform: translateY(-50%) translateX(0);\n}\n\n.preview-header {\n    margin-bottom: 1rem;\n    padding-bottom: 0.8rem;\n    border-bottom: 1px solid var(--border-color);\n}\n\n.preview-header h3 {\n    color: var(--accent-green);\n    font-size: 1.1rem;\n    margin-bottom: 0.3rem;\n}\n\n.preview-header p {\n    color: var(--text-secondary);\n    font-size: 0.85rem;\n}\n\n/* Analytics Miniview - Scaled down live view */\n.analytics-miniview {\n    position: relative;\n    width: 100%;\n    height: 70vh;\n    background: var(--bg-secondary);\n    border: 2px solid var(--border-color);\n    border-radius: 8px;\n    overflow: hidden;\n    cursor: pointer;\n    transition: all 0.3s ease;\n}\n\n.analytics-miniview:hover {\n    border-color: var(--accent-green);\n    box-shadow: 0 0 30px var(--success-glow);\n}\n\n.miniview-content {\n    width: 100%;\n    height: 100%;\n    transform-origin: top left;\n    transform: scale(0.25);\n    width: 400%;\n    height: 400%;\n    pointer-events: none;\n    overflow: hidden;\n}\n\n.miniview-overlay {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: rgba(10, 14, 20, 0.7);\n    backdrop-filter: blur(1px);\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    gap: 1rem;\n    opacity: 0;\n    transition: opacity 0.3s ease;\n    pointer-events: none;\n}\n\n.analytics-miniview:hover .miniview-overlay {\n    opacity: 1;\n}\n\n.miniview-overlay i {\n    font-size: 3rem;\n    color: var(--accent-green);\n    animation: pulse-scale 2s ease-in-out infinite;\n}\n\n.miniview-overlay span {\n    font-size: 1.2rem;\n    font-weight: 600;\n    color: var(--text-primary);\n    text-transform: uppercase;\n    letter-spacing: 1px;\n}\n.preview-home-nav {\n    margin-top: 1.5rem;\n    padding: 1rem;\n    background: var(--bg-secondary);\n    border: 2px solid var(--border-color);\n    border-radius: 10px;\n    display: flex;\n    align-items: center;\n    gap: 0.8rem;\n    cursor: pointer;\n    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n    opacity: 0;\n    visibility: hidden;\n    transform: translateY(10px);\n}\n\n.preview-home-nav.visible {\n    opacity: 1;\n    visibility: visible;\n    transform: translateY(0);\n}\n\n.preview-home-nav:hover {\n    background: var(--bg-hover);\n    border-color: var(--accent-green);\n    box-shadow: 0 5px 20px var(--success-glow);\n    transform: translateY(-2px);\n}\n\n.preview-home-nav i {\n    font-size: 1.5rem;\n    color: var(--accent-green);\n}\n\n.preview-home-nav span {\n    font-size: 1rem;\n    font-weight: 600;\n    color: var(--text-primary);\n}\n\n.preview-label {\n    flex: 1;\n    font-size: 0.95rem;\n    font-weight: 600;\n    color: var(--text-primary);\n    letter-spacing: 0.3px;\n}\n\n/* Analytics Miniview - Screenshot preview */\n.analytics-miniview {\n    position: relative;\n    width: 100%;\n    height: 70vh;\n    background: var(--bg-secondary);\n    border: 2px solid var(--border-color);\n    border-radius: 8px;\n    overflow: hidden;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    padding: 1.5rem;\n}\n\n.analytics-miniview:hover {\n    border-color: var(--accent-green);\n    box-shadow: 0 0 30px var(--success-glow);\n}\n\n.miniview-preview {\n    width: 100%;\n    height: 100%;\n    display: flex;\n    flex-direction: column;\n    gap: 1rem;\n    opacity: 0.7;\n}\n\n.preview-row {\n    display: flex;\n    gap: 1rem;\n    flex: 1;\n}\n\n.preview-box {\n    flex: 1;\n    background: rgba(15, 15, 15, 0.5);\n    backdrop-filter: blur(10px);\n    border: 1px solid rgba(57, 255, 20, 0.2);\n    border-radius: 6px;\n    position: relative;\n    overflow: hidden;\n    padding: 0.5rem;\n}\n\n.preview-box.large {\n    flex: 2;\n}\n\n.preview-box.wide {\n    flex: 1;\n    min-height: 150px;\n}\n\n.box-header {\n    font-size: 0.65rem;\n    color: var(--accent-green);\n    margin-bottom: 0.5rem;\n    opacity: 0.8;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.box-content {\n    height: calc(100% - 1.5rem);\n    position: relative;\n}\n\n.map-visual {\n    background: radial-gradient(circle at center, rgba(57, 255, 20, 0.05), transparent);\n    position: relative;\n}\n\n.map-dot {\n    position: absolute;\n    width: 8px;\n    height: 8px;\n    background: var(--accent-green);\n    border-radius: 50%;\n    box-shadow: 0 0 10px var(--accent-green);\n    animation: map-pulse 2s ease-in-out infinite;\n}\n\n.map-dot:nth-child(2) { animation-delay: 0.5s; }\n.map-dot:nth-child(3) { animation-delay: 1s; }\n\n@keyframes map-pulse {\n    0%, 100% { transform: scale(1); opacity: 0.6; }\n    50% { transform: scale(1.5); opacity: 1; }\n}\n\n.chart-visual {\n    display: flex;\n    align-items: flex-end;\n    justify-content: space-around;\n    height: 100%;\n    padding: 0.5rem;\n    gap: 0.3rem;\n}\n\n.chart-bar {\n    flex: 1;\n    background: linear-gradient(180deg, var(--accent-green), transparent);\n    border-radius: 2px;\n    animation: bar-grow 2s ease-in-out infinite;\n    opacity: 0.7;\n}\n\n.chart-bar:nth-child(2) { animation-delay: 0.2s; }\n.chart-bar:nth-child(3) { animation-delay: 0.4s; }\n.chart-bar:nth-child(4) { animation-delay: 0.6s; }\n\n@keyframes bar-grow {\n    0%, 100% { transform: scaleY(0.8); }\n    50% { transform: scaleY(1); }\n}\n\n.list-visual {\n    display: flex;\n    flex-direction: column;\n    gap: 0.4rem;\n    padding: 0.3rem;\n}\n\n.list-item {\n    height: 0.4rem;\n    background: linear-gradient(90deg, var(--accent-green), transparent);\n    border-radius: 2px;\n    opacity: 0.6;\n    animation: list-fade 3s ease-in-out infinite;\n}\n\n.list-item:nth-child(2) { animation-delay: 0.5s; width: 80%; }\n.list-item:nth-child(3) { animation-delay: 1s; width: 60%; }\n\n@keyframes list-fade {\n    0%, 100% { opacity: 0.4; }\n    50% { opacity: 0.8; }\n}\n\n.network-visual {\n    position: relative;\n    height: 100%;\n}\n\n.network-node {\n    position: absolute;\n    width: 6px;\n    height: 6px;\n    background: var(--accent-green);\n    border-radius: 50%;\n    box-shadow: 0 0 8px var(--accent-green);\n    animation: node-pulse 3s ease-in-out infinite;\n}\n\n.network-node:nth-child(2) { animation-delay: 0.7s; }\n.network-node:nth-child(3) { animation-delay: 1.4s; }\n\n@keyframes node-pulse {\n    0%, 100% { transform: scale(1); opacity: 0.5; }\n    50% { transform: scale(1.3); opacity: 1; }\n}\n\n.heat-visual {\n    background: \n        radial-gradient(circle at 30% 30%, rgba(57, 255, 20, 0.3), transparent 40%),\n        radial-gradient(circle at 70% 60%, rgba(57, 255, 20, 0.2), transparent 40%),\n        radial-gradient(circle at 50% 80%, rgba(57, 255, 20, 0.25), transparent 40%);\n    animation: heat-shift 4s ease-in-out infinite;\n}\n\n@keyframes heat-shift {\n    0%, 100% { opacity: 0.5; }\n    50% { opacity: 0.8; }\n}\n\n.pie-visual {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    height: 100%;\n}\n\n.pie-chart {\n    width: 40px;\n    height: 40px;\n    border-radius: 50%;\n    background: conic-gradient(\n        var(--accent-green) 0deg 120deg,\n        var(--accent-yellow) 120deg 240deg,\n        var(--accent-red) 240deg 360deg\n    );\n    box-shadow: 0 0 15px rgba(57, 255, 20, 0.4);\n    animation: pie-spin 10s linear infinite;\n}\n\n@keyframes pie-spin {\n    0% { transform: rotate(0deg); }\n    100% { transform: rotate(360deg); }\n}\n\n.miniview-overlay {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: rgba(10, 14, 20, 0.7);\n    backdrop-filter: blur(1px);\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    gap: 1rem;\n    opacity: 0;\n    transition: opacity 0.3s ease;\n    pointer-events: none;\n}\n\n.analytics-miniview:hover .miniview-overlay {\n    opacity: 1;\n}\n\n.miniview-overlay i {\n    font-size: 3rem;\n    color: var(--accent-green);\n    animation: pulse-scale 2s ease-in-out infinite;\n}\n\n.miniview-overlay span {\n    font-size: 1.2rem;\n    font-weight: 600;\n    color: var(--text-primary);\n    text-transform: uppercase;\n    letter-spacing: 1px;\n}\n\n/* Main Content Area */\n.main-content {\n    margin-left: 70px;\n    min-height: 100vh;\n    padding: 2rem;\n    transition: margin-left 0.4s cubic-bezier(0.4, 0, 0.2, 1);\n    position: relative;\n}\n\n/* Backdrop overlay for preview panel */\n.preview-backdrop {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    background: rgba(0, 0, 0, 0.4);\n    backdrop-filter: blur(2px);\n    opacity: 0;\n    visibility: hidden;\n    transition: all 0.3s ease;\n    z-index: 9998;\n    pointer-events: none;\n}\n\n.preview-backdrop.show {\n    opacity: 1;\n    visibility: visible;\n}\n\n/* View Containers */\n.view-container {\n    display: none;\n    animation: fadeIn 0.4s ease-in-out;\n}\n\n.view-container.active {\n    display: block;\n}\n\n@keyframes fadeIn {\n    from {\n        opacity: 0;\n        transform: translateY(10px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n/* Dashboard Header */\n.dashboard-header {\n    text-align: center;\n    margin-bottom: 2.5rem;\n}\n\n.header-content h1 {\n    font-size: 2.5rem;\n    margin-bottom: 0.5rem;\n    color: var(--accent-green);\n    font-weight: 700;\n    letter-spacing: 2px;\n}\n\n.header-content .subtitle {\n    font-size: 1.2rem;\n    color: var(--text-secondary);\n    font-weight: 500;\n}\n\n.pulse-icon {\n    display: inline-block;\n    animation: pulse-scale 2s ease-in-out infinite;\n}\n\n@keyframes pulse-scale {\n    0%, 100% {\n        transform: scale(1);\n        filter: drop-shadow(0 0 5px var(--success-glow));\n    }\n    50% {\n        transform: scale(1.05);\n        filter: drop-shadow(0 0 15px var(--success-glow));\n    }\n}\n\n/* Animations */\n.animate-slide-in {\n    animation: slideIn 0.6s ease-out;\n}\n\n@keyframes slideIn {\n    from {\n        opacity: 0;\n        transform: translateX(-30px);\n    }\n    to {\n        opacity: 1;\n        transform: translateX(0);\n    }\n}\n\n.animate-fade-in {\n    animation: fadeInUp 0.6s ease-out;\n}\n\n@keyframes fadeInUp {\n    from {\n        opacity: 0;\n        transform: translateY(20px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n.container {\n    max-width: 1400px;\n    margin: 0 auto;\n}\n\n/* Theme Toggle Button */\n.theme-toggle {\n    position: fixed;\n    top: 20px;\n    right: 20px;\n    z-index: 10000;\n    background: rgba(15, 15, 15, 0.6);\n    backdrop-filter: blur(20px);\n    -webkit-backdrop-filter: blur(20px);\n    border: 1px solid rgba(57, 255, 20, 0.3);\n    border-radius: 50px;\n    padding: 10px 20px;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    font-size: 1rem;\n    color: var(--text-primary);\n    transition: all 0.3s ease;\n    box-shadow: 0 4px 20px rgba(57, 255, 20, 0.2);\n    font-weight: 600;\n}\n\n.theme-toggle:hover {\n    background: rgba(15, 15, 15, 0.8);\n    border-color: var(--accent-green);\n    box-shadow: 0 0 30px var(--success-glow);\n    transform: translateY(-2px);\n}\n\n.theme-toggle .icon {\n    font-size: 1.2rem;\n}\n\n/* Threat Ticker */\n.threat-ticker-container {\n    background: var(--bg-secondary);\n    border: 2px solid var(--accent-green);\n    border-radius: 8px;\n    padding: 12px;\n    margin-bottom: 2rem;\n    display: flex;\n    align-items: center;\n    gap: 16px;\n    overflow: hidden;\n    box-shadow: 0 2px 8px var(--success-glow);\n}\n\n.ticker-label {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 8px 16px;\n    background: linear-gradient(135deg, #ff4757, #ff6348);\n    border-radius: 6px;\n    font-weight: 700;\n    font-size: 0.75rem;\n    color: #fff;\n    white-space: nowrap;\n    box-shadow: 0 2px 8px rgba(255, 71, 87, 0.4);\n}\n\n.ticker-label i {\n    animation: pulse-broadcast 2s infinite;\n}\n\n@keyframes pulse-broadcast {\n    0%, 100% { opacity: 1; transform: scale(1); }\n    50% { opacity: 0.6; transform: scale(0.9); }\n}\n\n.threat-ticker {\n    flex: 1;\n    overflow: hidden;\n    position: relative;\n}\n\n.ticker-content {\n    display: flex;\n    gap: 40px;\n    white-space: nowrap;\n    animation: scroll-ticker 30s linear infinite;\n}\n\n.ticker-content:hover {\n    animation-play-state: paused;\n}\n\n@keyframes scroll-ticker {\n    0% { transform: translateX(0); }\n    100% { transform: translateX(-50%); }\n}\n\n.ticker-item {\n    color: #e0e0e0;\n    font-size: 0.9rem;\n    display: inline-flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.ticker-item i {\n    font-size: 0.5rem;\n    animation: blink 1.5s infinite;\n}\n\n@keyframes blink {\n    0%, 100% { opacity: 1; }\n    50% { opacity: 0.3; }\n}\n\n/* Notification System */\n.notification-container {\n    position: fixed;\n    top: 20px;\n    right: 20px;\n    z-index: 10000;\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n    max-width: 400px;\n}\n\n.threat-notification {\n    background: rgba(30, 30, 30, 0.98);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-left: 4px solid #ff4757;\n    border-radius: 8px;\n    padding: 16px;\n    display: flex;\n    gap: 12px;\n    align-items: flex-start;\n    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);\n    transform: translateX(450px);\n    opacity: 0;\n    transition: all 0.3s ease-out;\n}\n\n.threat-notification.show {\n    transform: translateX(0);\n    opacity: 1;\n}\n\n.notification-icon {\n    font-size: 1.5rem;\n    flex-shrink: 0;\n}\n\n.notification-content {\n    flex: 1;\n}\n\n.notification-title {\n    font-size: 0.95rem;\n    color: #e0e0e0;\n    margin-bottom: 4px;\n}\n\n.notification-title strong {\n    text-transform: uppercase;\n    font-weight: 800;\n}\n\n.notification-details {\n    font-size: 0.85rem;\n    color: #b0b0b0;\n    margin-bottom: 6px;\n}\n\n.notification-meta {\n    font-size: 0.75rem;\n    color: #888;\n    display: flex;\n    align-items: center;\n    gap: 6px;\n}\n\n.notification-close {\n    cursor: pointer;\n    color: #666;\n    transition: color 0.2s;\n    font-size: 0.9rem;\n}\n\n.notification-close:hover {\n    color: #e0e0e0;\n}\n\n/* Stat Card Pulse Animation */\n.stat-pulse {\n    animation: stat-pulse-animation 0.6s ease-out;\n}\n\n@keyframes stat-pulse-animation {\n    0% { transform: scale(1); }\n    50% { transform: scale(1.05); box-shadow: 0 8px 24px rgba(90, 156, 248, 0.4); }\n    100% { transform: scale(1); }\n}\n\nh1 {\n    font-size: 2.5rem;\n    color: #5a9cf8;\n    margin-bottom: 0.5rem;\n}\n\n.subtitle {\n    color: #888;\n    font-size: 1.1rem;\n}\n\n.stats-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n    gap: 1.5rem;\n    margin-bottom: 3rem;\n}\n\n.stat-card {\n    background: var(--bg-card);\n    border: 2px solid var(--border-color);\n    border-radius: 12px;\n    padding: 1.5rem;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 0.8rem;\n    position: relative;\n    overflow: hidden;\n    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);\n}\n\n.stat-card::before {\n    content: '';\n    position: absolute;\n    top: -50%;\n    left: -50%;\n    width: 200%;\n    height: 200%;\n    background: radial-gradient(circle, var(--accent-green) 0%, transparent 70%);\n    opacity: 0;\n    transition: opacity 0.4s ease;\n}\n\n.stat-card:hover::before {\n    opacity: 0.05;\n}\n\n.stat-card:hover {\n    transform: translateY(-5px) scale(1.02);\n    border-color: var(--accent-green);\n    box-shadow: 0 10px 30px var(--success-glow);\n}\n\n.stat-card i {\n    font-size: 2.5rem;\n    opacity: 0.8;\n    transition: all 0.3s ease;\n}\n\n.stat-card:hover i {\n    transform: scale(1.1) rotateY(180deg);\n    opacity: 1;\n}\n\n.stat-number {\n    font-size: 2.5rem;\n    font-weight: 700;\n    transition: all 0.3s ease;\n}\n\n.stat-card:hover .stat-number {\n    transform: scale(1.1);\n    text-shadow: 0 0 20px currentColor;\n}\n\n.stat-label {\n    font-size: 0.9rem;\n    color: var(--text-secondary);\n    font-weight: 600;\n}\n\n.stat-glow {\n    position: absolute;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    height: 3px;\n    background: linear-gradient(90deg, transparent, var(--accent-green), transparent);\n    opacity: 0;\n    transition: opacity 0.4s ease;\n}\n\n.stat-card:hover .stat-glow {\n    opacity: 1;\n    animation: glowSlide 2s ease-in-out infinite;\n}\n\n@keyframes glowSlide {\n    0%, 100% {\n        transform: translateX(-100%);\n    }\n    50% {\n        transform: translateX(100%);\n    }\n}\n\n.stat-card.malware {\n    border-color: rgba(255, 59, 59, 0.3);\n}\n\n.stat-card.malware i,\n.stat-card.malware .stat-number {\n    color: var(--accent-red);\n}\n\n.stat-card.malware:hover {\n    border-color: var(--accent-red);\n    box-shadow: 0 10px 30px var(--danger-glow);\n}\n\n.stat-card.suspicious {\n    border-color: rgba(255, 215, 0, 0.3);\n}\n\n.stat-card.suspicious i,\n.stat-card.suspicious .stat-number {\n    color: var(--accent-yellow);\n}\n\n.stat-card.suspicious:hover {\n    border-color: var(--accent-yellow);\n    box-shadow: 0 10px 30px var(--warning-glow);\n}\n\n.stat-card.benign i,\n.stat-card.benign .stat-number,\n.stat-card.info i,\n.stat-card.info .stat-number {\n    color: var(--accent-green);\n}\n\n/* Analytics View */\n.analytics-header {\n    display: flex;\n    align-items: center;\n    gap: 2rem;\n    margin-bottom: 2.5rem;\n}\n\n.back-btn {\n    background: var(--bg-card);\n    border: 2px solid var(--accent-green);\n    color: var(--accent-green);\n    padding: 0.8rem 1.5rem;\n    border-radius: 8px;\n    font-size: 1rem;\n    font-weight: 600;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    transition: all 0.3s ease;\n}\n\n.back-btn:hover {\n    background: var(--accent-green);\n    color: var(--bg-primary);\n    transform: translateX(-5px);\n    box-shadow: 0 5px 20px var(--success-glow);\n}\n\n.analytics-header h1 {\n    font-size: 2rem;\n    color: var(--accent-green);\n    font-weight: 700;\n}\n\n.analytics-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));\n    gap: 2rem;\n    max-height: calc(100vh - 200px);\n    overflow-y: auto;\n    padding-right: 1rem;\n    grid-auto-flow: dense;\n}\n\n/* Panel size classes for flexible tiling */\n.analytics-panel.panel-small {\n    grid-column: span 1;\n}\n\n.analytics-panel.panel-medium {\n    grid-column: span 1;\n}\n\n.analytics-panel.panel-large {\n    grid-column: span 2;\n}\n\n@media (max-width: 1400px) {\n    .analytics-grid {\n        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));\n    }\n    \n    .analytics-panel.panel-large {\n        grid-column: span 1;\n    }\n}\n\n.analytics-grid::-webkit-scrollbar {\n    width: 8px;\n}\n\n.analytics-grid::-webkit-scrollbar-track {\n    background: var(--bg-secondary);\n    border-radius: 4px;\n}\n\n.analytics-grid::-webkit-scrollbar-thumb {\n    background: var(--accent-green);\n    border-radius: 4px;\n}\n\n.analytics-grid::-webkit-scrollbar-thumb:hover {\n    background: var(--accent-green-dim);\n}\n\n.analytics-panel {\n    animation: slideInPanel 0.5s ease-out;\n    animation-fill-mode: backwards;\n}\n\n.analytics-panel:nth-child(1) { animation-delay: 0.05s; }\n.analytics-panel:nth-child(2) { animation-delay: 0.1s; }\n.analytics-panel:nth-child(3) { animation-delay: 0.15s; }\n.analytics-panel:nth-child(4) { animation-delay: 0.2s; }\n.analytics-panel:nth-child(5) { animation-delay: 0.25s; }\n.analytics-panel:nth-child(6) { animation-delay: 0.3s; }\n\n@keyframes slideInPanel {\n    from {\n        opacity: 0;\n        transform: translateY(30px) scale(0.95);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0) scale(1);\n    }\n}\n\n/* Advanced Analytics Grid for Mini Charts */\n.advanced-analytics-grid {\n    background: rgba(15, 15, 15, 0.5);\n    backdrop-filter: blur(10px);\n    border: 1px solid rgba(57, 255, 20, 0.2);\n    border-radius: 12px;\n    padding: 1.5rem;\n}\n\n.mini-charts-grid {\n    display: grid;\n    grid-template-columns: repeat(2, 1fr);\n    gap: 1.5rem;\n    margin-top: 1rem;\n}\n\n.mini-chart-container {\n    background: rgba(10, 10, 10, 0.6);\n    border: 1px solid rgba(57, 255, 20, 0.15);\n    border-radius: 8px;\n    padding: 1rem;\n}\n\n.mini-chart-container h3 {\n    color: var(--accent-green);\n    font-size: 0.95rem;\n    margin: 0 0 0.75rem 0;\n    font-weight: 600;\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n}\n\n.mini-chart-container h3 i {\n    font-size: 0.9rem;\n}\n\n@media (max-width: 1200px) {\n    .mini-charts-grid {\n        grid-template-columns: 1fr;\n    }\n}\n\n/* Emerging Threat Intelligence Panel */\n.eti-container {\n    background: linear-gradient(135deg, rgba(255, 71, 87, 0.1) 0%, rgba(255, 165, 2, 0.1) 100%);\n    border: 2px solid rgba(255, 71, 87, 0.3);\n    border-radius: 12px;\n    padding: 24px;\n    margin-bottom: 3rem;\n    box-shadow: 0 4px 16px rgba(255, 71, 87, 0.2);\n}\n\n.eti-header {\n    margin-bottom: 24px;\n}\n\n.eti-header h2 {\n    margin: 0 0 8px 0;\n    font-size: 1.8rem;\n    color: #ff6b6b;\n    text-shadow: 0 2px 4px rgba(255, 71, 87, 0.3);\n}\n\n.eti-header h2 i {\n    color: #ff4757;\n    margin-right: 10px;\n    animation: pulse 2s infinite;\n}\n\n@keyframes pulse {\n    0%, 100% { opacity: 1; }\n    50% { opacity: 0.6; }\n}\n\n.eti-subtitle {\n    color: #b0b0b0;\n    font-size: 0.95rem;\n    margin: 8px 0 16px 0;\n}\n\n.eti-summary {\n    display: flex;\n    gap: 12px;\n    flex-wrap: wrap;\n}\n\n.eti-badge {\n    background: rgba(90, 156, 248, 0.2);\n    border: 1px solid rgba(90, 156, 248, 0.4);\n    color: #5a9cf8;\n    padding: 6px 14px;\n    border-radius: 20px;\n    font-size: 0.85rem;\n    font-weight: 600;\n}\n\n.eti-badge.recent {\n    background: rgba(255, 71, 87, 0.2);\n    border-color: rgba(255, 71, 87, 0.4);\n    color: #ff6b6b;\n}\n\n.eti-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));\n    gap: 20px;\n}\n\n.eti-panel {\n    background: rgba(0, 0, 0, 0.3);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: 10px;\n    padding: 18px;\n    transition: transform 0.3s, box-shadow 0.3s;\n}\n\n.eti-panel:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);\n}\n\n.eti-panel h3 {\n    margin: 0 0 6px 0;\n    font-size: 1.1rem;\n    color: #e0e0e0;\n}\n\n.eti-panel h3 i {\n    color: #ffa502;\n    margin-right: 8px;\n}\n\n.eti-subtitle-small {\n    color: #888;\n    font-size: 0.8rem;\n    margin-bottom: 14px;\n}\n\n.eti-list {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n}\n\n.eti-item {\n    display: flex;\n    gap: 12px;\n    background: rgba(255, 255, 255, 0.03);\n    border: 1px solid rgba(255, 255, 255, 0.08);\n    border-radius: 8px;\n    padding: 12px;\n    transition: all 0.3s;\n}\n\n.eti-item:hover {\n    background: rgba(255, 255, 255, 0.06);\n    border-color: rgba(255, 165, 2, 0.4);\n    transform: translateX(4px);\n}\n\n.eti-rank {\n    flex-shrink: 0;\n    width: 32px;\n    height: 32px;\n    background: linear-gradient(135deg, #ff6b6b, #ffa502);\n    border-radius: 50%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-weight: bold;\n    font-size: 1rem;\n    color: #fff;\n    box-shadow: 0 2px 8px rgba(255, 107, 107, 0.4);\n}\n\n.eti-item[data-rank=\"1\"] .eti-rank {\n    background: linear-gradient(135deg, #ff4757, #ff6348);\n    transform: scale(1.1);\n}\n\n.eti-content {\n    flex: 1;\n    min-width: 0;\n}\n\n.eti-name {\n    font-weight: 600;\n    color: #e0e0e0;\n    font-size: 0.95rem;\n    margin-bottom: 4px;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n}\n\n.eti-meta {\n    display: flex;\n    gap: 8px;\n    flex-wrap: wrap;\n    align-items: center;\n}\n\n.eti-count {\n    color: #888;\n    font-size: 0.8rem;\n}\n\n.eti-recent-badge {\n    background: rgba(255, 71, 87, 0.2);\n    border: 1px solid rgba(255, 71, 87, 0.4);\n    color: #ff6b6b;\n    padding: 2px 8px;\n    border-radius: 10px;\n    font-size: 0.75rem;\n    font-weight: 600;\n}\n\n.eti-agent-badge {\n    background: rgba(90, 156, 248, 0.2);\n    border: 1px solid rgba(90, 156, 248, 0.4);\n    color: #5a9cf8;\n    padding: 2px 8px;\n    border-radius: 10px;\n    font-size: 0.75rem;\n    font-weight: 600;\n}\n\n.eti-details {\n    margin-top: 6px;\n    color: #999;\n    font-size: 0.75rem;\n    font-style: italic;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n}\n\n.eti-empty {\n    text-align: center;\n    color: #666;\n    padding: 20px;\n    font-style: italic;\n}\n\n/* Threat Modeler */\n.modeler-container {\n    background: linear-gradient(135deg, rgba(90, 156, 248, 0.1) 0%, rgba(38, 222, 129, 0.1) 100%);\n    border: 2px solid rgba(90, 156, 248, 0.3);\n    border-radius: 12px;\n    padding: 24px;\n    margin-bottom: 3rem;\n    box-shadow: 0 4px 16px rgba(90, 156, 248, 0.2);\n}\n\n.modeler-header {\n    margin-bottom: 24px;\n}\n\n.modeler-header h2 {\n    margin: 0 0 8px 0;\n    font-size: 1.8rem;\n    color: #5a9cf8;\n}\n\n.modeler-header h2 i {\n    color: #26de81;\n    margin-right: 10px;\n}\n\n.modeler-subtitle {\n    color: #b0b0b0;\n    font-size: 0.95rem;\n    margin: 0;\n}\n\n.modeler-grid {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 24px;\n}\n\n@media (max-width: 1024px) {\n    .modeler-grid {\n        grid-template-columns: 1fr;\n    }\n}\n\n.modeler-builder,\n.modeler-results {\n    background: rgba(0, 0, 0, 0.3);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: 10px;\n    padding: 20px;\n}\n\n.modeler-builder h3,\n.modeler-results h3 {\n    margin: 0 0 20px 0;\n    font-size: 1.2rem;\n    color: #e0e0e0;\n    border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n    padding-bottom: 10px;\n}\n\n.modeler-builder h3 i {\n    color: #26de81;\n    margin-right: 8px;\n}\n\n.modeler-results h3 i {\n    color: #5a9cf8;\n    margin-right: 8px;\n}\n\n.modeler-field {\n    margin-bottom: 20px;\n}\n\n.modeler-field label {\n    display: block;\n    color: #b0b0b0;\n    font-size: 0.9rem;\n    margin-bottom: 6px;\n    font-weight: 600;\n}\n\n.modeler-select {\n    width: 100%;\n    background: rgba(255, 255, 255, 0.05);\n    border: 1px solid rgba(255, 255, 255, 0.2);\n    border-radius: 6px;\n    color: #e0e0e0;\n    padding: 10px;\n    font-size: 0.9rem;\n    font-family: inherit;\n    cursor: pointer;\n    transition: all 0.3s;\n}\n\n.modeler-select:focus {\n    outline: none;\n    border-color: #5a9cf8;\n    background: rgba(90, 156, 248, 0.1);\n}\n\n.modeler-select option {\n    background: #1a1a2e;\n    color: #e0e0e0;\n    padding: 8px;\n}\n\n.modeler-hint {\n    display: block;\n    color: #666;\n    font-size: 0.75rem;\n    margin-top: 4px;\n    font-style: italic;\n}\n\n.modeler-analyze-btn {\n    width: 100%;\n    background: linear-gradient(135deg, #26de81, #20bf6b);\n    border: none;\n    color: #fff;\n    padding: 14px 24px;\n    border-radius: 8px;\n    font-size: 1rem;\n    font-weight: 700;\n    cursor: pointer;\n    transition: all 0.3s;\n    box-shadow: 0 4px 12px rgba(38, 222, 129, 0.3);\n}\n\n.modeler-analyze-btn:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 6px 16px rgba(38, 222, 129, 0.4);\n}\n\n.modeler-analyze-btn i {\n    margin-right: 8px;\n}\n\n.modeler-output {\n    min-height: 400px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n\n.modeler-placeholder {\n    text-align: center;\n    color: #666;\n}\n\n.modeler-placeholder i {\n    font-size: 3rem;\n    margin-bottom: 16px;\n    opacity: 0.5;\n}\n\n.modeler-placeholder p {\n    font-size: 0.95rem;\n}\n\n.modeler-loading {\n    text-align: center;\n    color: #5a9cf8;\n}\n\n.modeler-loading i {\n    font-size: 3rem;\n    margin-bottom: 16px;\n}\n\n.modeler-error {\n    text-align: center;\n    color: #ff4757;\n}\n\n.modeler-error i {\n    font-size: 3rem;\n    margin-bottom: 16px;\n}\n\n.prediction-result {\n    width: 100%;\n}\n\n.prediction-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 24px;\n    padding: 20px;\n    background: rgba(255, 255, 255, 0.05);\n    border-radius: 8px;\n}\n\n.prediction-badge {\n    padding: 12px 24px;\n    border-radius: 8px;\n    font-size: 1.3rem;\n    font-weight: 800;\n    color: #fff;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n}\n\n.prediction-confidence {\n    text-align: right;\n}\n\n.confidence-label {\n    color: #888;\n    font-size: 0.8rem;\n    margin-bottom: 4px;\n}\n\n.confidence-value {\n    color: #5a9cf8;\n    font-size: 2rem;\n    font-weight: 800;\n}\n\n.prediction-family {\n    padding: 16px;\n    background: rgba(255, 71, 87, 0.1);\n    border-left: 4px solid #ff4757;\n    border-radius: 6px;\n    margin-bottom: 20px;\n    color: #e0e0e0;\n}\n\n.family-name {\n    color: #ff6b6b;\n    font-weight: 700;\n    font-size: 1.1rem;\n    margin-left: 8px;\n}\n\n.prediction-section {\n    margin-bottom: 20px;\n}\n\n.prediction-section h4 {\n    color: #5a9cf8;\n    font-size: 1rem;\n    margin: 0 0 12px 0;\n    border-bottom: 1px solid rgba(90, 156, 248, 0.3);\n    padding-bottom: 6px;\n}\n\n.analysis-item {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    padding: 8px 0;\n    color: #b0b0b0;\n    font-size: 0.9rem;\n}\n\n.analysis-item i {\n    color: #ffa502;\n    width: 20px;\n}\n\n.indicator-group {\n    margin-bottom: 16px;\n}\n\n.indicator-group strong {\n    display: block;\n    color: #e0e0e0;\n    margin-bottom: 8px;\n    font-size: 0.9rem;\n}\n\n.indicator-list {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 8px;\n}\n\n.indicator-tag {\n    padding: 6px 12px;\n    border-radius: 6px;\n    font-size: 0.8rem;\n    font-weight: 600;\n    font-family: 'Courier New', monospace;\n}\n\n.api-tag {\n    background: rgba(255, 165, 2, 0.2);\n    border: 1px solid rgba(255, 165, 2, 0.4);\n    color: #ffa502;\n}\n\n.string-tag {\n    background: rgba(255, 71, 87, 0.2);\n    border: 1px solid rgba(255, 71, 87, 0.4);\n    color: #ff6b6b;\n}\n\n.prediction-footer {\n    margin-top: 20px;\n    padding: 12px;\n    background: rgba(90, 156, 248, 0.1);\n    border-radius: 6px;\n    color: #5a9cf8;\n    font-size: 0.85rem;\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.scans-container {\n    background: var(--bg-card);\n    border: 2px solid var(--border-color);\n    border-radius: 12px;\n    padding: 2rem;\n    transition: all 0.3s ease;\n}\n\n.scans-container:hover {\n    border-color: var(--accent-green);\n    box-shadow: 0 5px 20px var(--shadow-color);\n}\n\n.scans-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 2rem;\n}\n\n.scans-header h2 {\n    color: #5a9cf8;\n}\n\n.refresh-btn {\n    background: #5a9cf8;\n    color: white;\n    border: none;\n    padding: 0.75rem 1.5rem;\n    border-radius: 8px;\n    cursor: pointer;\n    font-size: 1rem;\n    transition: background 0.2s;\n}\n\n.refresh-btn:hover {\n    background: #4a8ce8;\n}\n\n.scans-table {\n    width: 100%;\n    border-collapse: collapse;\n}\n\n.scans-table th {\n    text-align: left;\n    padding: 1rem;\n    background: rgba(255, 255, 255, 0.05);\n    color: #5a9cf8;\n    font-weight: 600;\n}\n\n.scans-table td {\n    padding: 1rem;\n    border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n}\n\n.scans-table tr:hover {\n    background: rgba(255, 255, 255, 0.03);\n}\n\n.badge {\n    display: inline-block;\n    padding: 0.3rem 0.8rem;\n    border-radius: 6px;\n    font-size: 0.85rem;\n    font-weight: 600;\n}\n\n.badge.malware { background: #ff4757; color: white; }\n.badge.suspicious { background: #ffa502; color: white; }\n.badge.benign { background: #26de81; color: white; }\n.badge.non-pe { background: #4b5563; color: #fff; }\n\n.hash {\n    font-family: 'Courier New', monospace;\n    font-size: 0.85rem;\n    color: #888;\n}\n\n.empty-state {\n    text-align: center;\n    padding: 3rem;\n    color: #666;\n}\n\n.empty-state i {\n    font-size: 4rem;\n    margin-bottom: 1rem;\n    opacity: 0.3;\n}\n\n/* NEW: Chart Container Styles */\n.chart-container {\n    background: rgba(255, 255, 255, 0.05);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: 12px;\n    padding: 2rem;\n    margin-top: 2rem;\n}\n\n.chart-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 2rem;\n}\n\n.chart-header h2 {\n    color: var(--accent-green);\n    margin: 0;\n}\n\n.chart-subtitle {\n    font-size: 0.85rem;\n    color: var(--text-secondary);\n    margin: 0.5rem 0 0 0;\n    font-weight: normal;\n}\n\n.chart-controls {\n    display: flex;\n    gap: 0.5rem;\n}\n\n.chart-btn {\n    background: rgba(255, 255, 255, 0.05);\n    color: #888;\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    padding: 0.5rem 1rem;\n    border-radius: 6px;\n    cursor: pointer;\n    font-size: 0.9rem;\n    transition: all 0.2s;\n}\n\n.chart-btn:hover {\n    background: rgba(255, 255, 255, 0.1);\n    color: #e0e0e0;\n}\n\n.chart-btn.active {\n    background: #5a9cf8;\n    color: white;\n    border-color: #5a9cf8;\n}\n\n#dailyScansChart {\n    max-height: 400px;\n}\n\n@media (max-width: 1024px) {\n    .analytics-grid {\n        grid-template-columns: 1fr;\n        gap: 1.5rem;\n    }\n    \n    .analytics-panel.panel-small,\n    .analytics-panel.panel-large {\n        grid-column: span 1;\n    }\n    \n    .graphs-preview {\n        width: 400px;\n    }\n}\n\n@media (max-width: 768px) {\n    .main-content {\n        margin-left: 0;\n        padding: 1rem;\n    }\n    \n    .side-panel {\n        width: 50px;\n    }\n    \n    .panel-logo-icon {\n        width: 40px;\n        height: 40px;\n        font-size: 1.5rem;\n    }\n    \n    .graphs-preview {\n        left: 50px;\n        width: calc(100vw - 50px);\n        border-radius: 0;\n    }\n    \n    .dashboard-header h1 {\n        font-size: 1.8rem;\n    }\n    \n    .stats-grid {\n        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\n        gap: 1rem;\n    }\n    \n    .chart-header {\n        flex-direction: column;\n        gap: 1rem;\n        align-items: flex-start;\n    }\n    \n    .chart-controls {\n        width: 100%;\n        justify-content: stretch;\n    }\n    \n    .chart-btn {\n        flex: 1;\n    }\n    \n    .map-view-toggle {\n        width: 100%;\n        justify-content: stretch;\n    }\n    \n    .map-btn {\n        flex: 1;\n        font-size: 0.8rem;\n        padding: 0.4rem 0.6rem;\n    }\n    \n    .geo-context-panel {\n        flex-direction: column;\n    }\n    \n    .context-stat {\n        width: 100%;\n    }\n    \n    .map-timeline-control {\n        flex-direction: column;\n        gap: 0.5rem;\n    }\n    \n    .timeline-info {\n        text-align: center;\n    }\n    \n    .analytics-header {\n        flex-direction: column;\n        align-items: flex-start;\n    }\n}\n\n/* Map Container */\n.map-container {\n    background: var(--bg-card);\n    border-radius: 12px;\n    padding: 24px;\n    box-shadow: 0 4px 12px var(--shadow-color);\n    border: 2px solid var(--border-color);\n    transition: all 0.3s ease;\n    min-height: 600px;\n}\n\n.map-container:hover {\n    border-color: var(--accent-green);\n    box-shadow: 0 8px 24px var(--shadow-color), 0 0 20px var(--success-glow);\n}\n\n#worldMap {\n    width: 100%;\n    height: 500px;\n    border-radius: 8px;\n    margin-bottom: 15px;\n    background: var(--bg-secondary);\n    border: 1px solid var(--border-color);\n    z-index: 1;\n    position: relative;\n}\n\n.map-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 20px;\n    flex-wrap: wrap;\n    gap: 16px;\n}\n\n.map-header h2 {\n    margin: 0;\n    font-size: 1.5rem;\n    color: var(--accent-green);\n    text-shadow: 0 0 10px var(--success-glow);\n}\n\n.map-header h2 i {\n    color: var(--accent-green);\n    margin-right: 8px;\n}\n\n.map-controls {\n    display: flex;\n    gap: 20px;\n    align-items: center;\n    flex-wrap: wrap;\n}\n\n.map-view-toggle {\n    display: flex;\n    gap: 8px;\n    background: var(--bg-secondary);\n    padding: 4px;\n    border-radius: 8px;\n    border: 1px solid var(--border-color);\n}\n\n.map-btn {\n    background: transparent;\n    border: none;\n    padding: 8px 16px;\n    border-radius: 6px;\n    cursor: pointer;\n    color: var(--text-secondary);\n    font-size: 0.9rem;\n    font-weight: 600;\n    transition: all 0.2s ease;\n    display: flex;\n    align-items: center;\n    gap: 6px;\n}\n\n.map-btn:hover {\n    background: var(--bg-hover);\n    color: var(--text-primary);\n}\n\n.map-btn.active {\n    background: var(--accent-green);\n    color: var(--bg-primary);\n    box-shadow: 0 0 10px var(--success-glow);\n}\n\n.map-btn i {\n    font-size: 1rem;\n}\n\n.map-legend {\n    display: flex;\n    gap: 20px;\n    flex-wrap: wrap;\n}\n\n.legend-item {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    font-size: 0.9rem;\n    color: var(--text-secondary);\n}\n\n.legend-dot {\n    width: 12px;\n    height: 12px;\n    border-radius: 50%;\n    display: inline-block;\n    box-shadow: 0 0 6px currentColor;\n}\n\n.malware-dot {\n    background-color: var(--accent-red);\n}\n\n.suspicious-dot {\n    background-color: var(--accent-yellow);\n}\n\n.benign-dot {\n    background-color: var(--accent-green);\n}\n\n.geo-context-panel {\n    display: flex;\n    justify-content: space-around;\n    gap: 20px;\n    padding: 15px;\n    background: var(--bg-secondary);\n    border-radius: 8px;\n    margin-bottom: 15px;\n    border: 1px solid var(--border-color);\n}\n\n.context-stat {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 5px;\n}\n\n.context-label {\n    font-size: 0.85rem;\n    color: var(--text-secondary);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.context-value {\n    font-size: 1.5rem;\n    font-weight: 700;\n    color: var(--accent-green);\n    text-shadow: 0 0 10px var(--success-glow);\n}\n\n.context-value.threat-count {\n    color: var(--accent-red);\n    text-shadow: 0 0 10px var(--danger-glow);\n}\n\n.map-timeline-control {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 12px;\n    background: var(--bg-secondary);\n    border-radius: 8px;\n    margin-top: 15px;\n    border: 1px solid var(--border-color);\n}\n\n.timeline-btn {\n    background: linear-gradient(135deg, var(--accent-green) 0%, var(--accent-green-dim) 100%);\n    color: var(--bg-primary);\n    border: none;\n    padding: 10px 20px;\n    border-radius: 6px;\n    cursor: pointer;\n    font-size: 0.95rem;\n    font-weight: 600;\n    transition: all 0.2s ease;\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    box-shadow: 0 4px 12px var(--success-glow);\n}\n\n.timeline-btn:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 6px 16px var(--success-glow);\n    filter: brightness(1.1);\n}\n\n.timeline-btn i {\n    font-size: 1rem;\n}\n\n.timeline-info {\n    color: var(--text-secondary);\n    font-size: 0.9rem;\n    font-style: italic;\n}\n\n#worldMap {\n    background: var(--bg-secondary);\n    border: 2px solid var(--border-color);\n}\n\n/* Leaflet popup customization for theme */\n.leaflet-popup-content-wrapper {\n    background: var(--bg-card) !important;\n    color: var(--text-primary) !important;\n    border: 2px solid var(--accent-green) !important;\n    box-shadow: 0 4px 15px var(--shadow-color) !important;\n    border-radius: 8px !important;\n}\n\n.leaflet-popup-tip {\n    background: var(--bg-card) !important;\n}\n\n.leaflet-popup-content h3 {\n    color: var(--accent-green) !important;\n}\n\n.leaflet-popup-content button {\n    background: var(--accent-green) !important;\n    color: var(--bg-primary) !important;\n    border: none !important;\n    padding: 8px 16px !important;\n    border-radius: 6px !important;\n    cursor: pointer !important;\n    font-weight: 600 !important;\n    transition: all 0.2s ease !important;\n}\n\n.leaflet-popup-content button:hover {\n    transform: translateY(-2px) !important;\n    box-shadow: 0 4px 12px var(--success-glow) !important;\n}\n\n/* Correlation Graph */\n.correlation-container {\n    background: rgba(255, 255, 255, 0.03);\n    border-radius: 12px;\n    padding: 24px;\n    margin-top: 24px;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n}\n\n.correlation-header {\n    margin-bottom: 20px;\n}\n\n.correlation-header h2 {\n    margin: 0 0 8px 0;\n    font-size: 1.5rem;\n    color: #e0e0e0;\n}\n\n.correlation-header h2 i {\n    color: #5a9cf8;\n    margin-right: 8px;\n}\n\n.correlation-subtitle {\n    color: #888;\n    font-size: 0.9rem;\n    margin: 0;\n}\n\n.graph-controls {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 16px;\n    flex-wrap: wrap;\n    gap: 16px;\n}\n\n.graph-btn {\n    background: rgba(90, 156, 248, 0.2);\n    border: 1px solid rgba(90, 156, 248, 0.4);\n    color: #5a9cf8;\n    padding: 8px 16px;\n    border-radius: 6px;\n    cursor: pointer;\n    font-size: 0.9rem;\n    transition: all 0.3s;\n}\n\n.graph-btn:hover {\n    background: rgba(90, 156, 248, 0.3);\n    border-color: #5a9cf8;\n}\n\n.graph-btn i {\n    margin-right: 6px;\n}\n\n.graph-legend {\n    display: flex;\n    gap: 20px;\n    flex-wrap: wrap;\n}\n\n.node-sample {\n    width: 12px;\n    height: 12px;\n    border-radius: 50%;\n    display: inline-block;\n    border: 2px solid #fff;\n}\n\n.malware-node {\n    background-color: #ff4757;\n}\n\n.agent-node {\n    background-color: #5a9cf8;\n}\n\n.api-node {\n    background-color: #ffa502;\n}\n\n.string-node {\n    background-color: #26de81;\n}\n\n#correlationGraph {\n    width: 100%;\n    min-height: 600px;\n    position: relative;\n    border-radius: 8px;\n    overflow: hidden;\n}\n\n.node-details {\n    position: absolute;\n    right: 24px;\n    top: 120px;\n    background: rgba(30, 30, 30, 0.95);\n    border: 1px solid rgba(90, 156, 248, 0.4);\n    border-radius: 8px;\n    padding: 16px;\n    max-width: 300px;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n    z-index: 1000;\n}\n\n.node-details h3 {\n    margin: 0 0 12px 0;\n    color: #5a9cf8;\n    font-size: 1.1rem;\n    border-bottom: 1px solid rgba(90, 156, 248, 0.3);\n    padding-bottom: 8px;\n}\n\n.node-details p {\n    margin: 8px 0;\n    color: #e0e0e0;\n    font-size: 0.9rem;\n}\n\n.node-details ul {\n    color: #b0b0b0;\n    font-size: 0.85rem;\n}\n\n.node-details li {\n    margin: 4px 0;\n}\n\n/* ========================================\n   LIGHT THEME CONTRAST FIXES\n   ======================================== */\n\n/* Fix 1 & 2: Analytics preview backgrounds - lighter for better green contrast */\n[data-theme=\"light\"] .eti-container {\n    background: linear-gradient(135deg, rgba(255, 71, 87, 0.05) 0%, rgba(255, 165, 2, 0.05) 100%);\n    border-color: rgba(255, 71, 87, 0.2);\n}\n\n[data-theme=\"light\"] .modeler-container {\n    background: linear-gradient(135deg, rgba(90, 156, 248, 0.05) 0%, rgba(38, 222, 129, 0.05) 100%);\n    border-color: rgba(90, 156, 248, 0.2);\n}\n\n/* Fix 3: Theme toggle button text - darker for contrast */\n[data-theme=\"light\"] .theme-toggle {\n    color: #1a1f2e;\n    background: rgba(255, 255, 255, 0.8);\n    border-color: rgba(46, 214, 15, 0.4);\n}\n\n/* Fix 4: Daily Analysis chart - darker labels and grid (handled in JS via CSS vars) */\n[data-theme=\"light\"] {\n    --chart-text-color: #374151;\n    --chart-grid-color: rgba(0, 0, 0, 0.12);\n}\n\n:root {\n    --chart-text-color: #9ca3af;\n    --chart-grid-color: rgba(255, 255, 255, 0.1);\n}\n\n/* Fix 5: Chart container labels - darker in light theme */\n[data-theme=\"light\"] .chart-header h2,\n[data-theme=\"light\"] .chart-header {\n    color: #1a1f2e;\n}\n\n/* Fix 6: Threat Vector Correlation header - darker */\n[data-theme=\"light\"] .correlation-header h2 {\n    color: #1a1f2e;\n}\n\n[data-theme=\"light\"] .correlation-subtitle {\n    color: #4a5568;\n}\n\n/* Fix 7: ETI subtitle and summary - darker for better contrast */\n[data-theme=\"light\"] .eti-subtitle {\n    color: #4a5568;\n}\n\n[data-theme=\"light\"] .eti-summary {\n    color: #374151;\n}\n\n/* Fix 8: Prediction labels in threat modeler - darker */\n[data-theme=\"light\"] .modeler-subtitle {\n    color: #4a5568;\n}\n\n[data-theme=\"light\"] .modeler-field label {\n    color: #374151;\n}\n\n[data-theme=\"light\"] .modeler-hint {\n    color: #6b7280;\n}\n","epoch":67,"telemetryInfo":{}}],["file:///home/trang/localnsv/mAIware-server/public/styles.css::request_2d995c41-e4fb-4a32-8754-875cabc8f1e3",{"uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware-server/public/styles.css","external":"file:///home/trang/localnsv/mAIware-server/public/styles.css","path":"/home/trang/localnsv/mAIware-server/public/styles.css","scheme":"file"},"requestId":"request_2d995c41-e4fb-4a32-8754-875cabc8f1e3","content":":root {\n    --bg-primary: #000000;\n    --bg-secondary: #0a0a0a;\n    --bg-card: #0f0f0f;\n    --bg-hover: #151515;\n    --text-primary: #e8f0e8;\n    --text-secondary: #9ca3af;\n    --accent-green: #39ff14;\n    --accent-green-dim: #2ed60f;\n    --accent-yellow: #ffd700;\n    --accent-red: #ff3b3b;\n    --accent-red-dim: #cc2f2f;\n    --border-color: #1a1a1a;\n    --shadow-color: rgba(0, 0, 0, 0.5);\n    --success-glow: rgba(57, 255, 20, 0.3);\n    --danger-glow: rgba(255, 59, 59, 0.3);\n    --warning-glow: rgba(255, 215, 0, 0.3);\n}\n\n[data-theme=\"light\"] {\n    --bg-primary: #f0f4f0;\n    --bg-secondary: #ffffff;\n    --bg-card: #fafafa;\n    --bg-hover: #e8f5e8;\n    --text-primary: #1a1f2e;\n    --text-secondary: #4a5568;\n    --accent-green: #2ed60f;\n    --accent-green-dim: #27b00c;\n    --accent-yellow: #cc9a00;\n    --accent-red: #dc2626;\n    --accent-red-dim: #b91c1c;\n    --border-color: #d1d5db;\n    --shadow-color: rgba(0, 0, 0, 0.1);\n    --success-glow: rgba(46, 214, 15, 0.2);\n    --danger-glow: rgba(220, 38, 38, 0.2);\n    --warning-glow: rgba(204, 154, 0, 0.2);\n}\n\n* { \n    margin: 0; \n    padding: 0; \n    box-sizing: border-box; \n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background: var(--bg-primary);\n    color: var(--text-primary);\n    min-height: 100vh;\n    margin: 0;\n    overflow-x: hidden;\n    position: relative;\n}\n\nbody::before {\n    content: '';\n    position: fixed;\n    top: -50%;\n    left: -50%;\n    width: 200%;\n    height: 200%;\n    background: \n        radial-gradient(circle at 20% 50%, rgba(57, 255, 20, 0.08) 0%, transparent 50%),\n        radial-gradient(circle at 80% 80%, rgba(57, 255, 20, 0.06) 0%, transparent 50%),\n        radial-gradient(circle at 40% 20%, rgba(57, 255, 20, 0.05) 0%, transparent 50%);\n    animation: backgroundGlow 15s ease-in-out infinite;\n    pointer-events: none;\n    z-index: 0;\n}\n\n@keyframes backgroundGlow {\n    0%, 100% { \n        transform: translate(0, 0) scale(1);\n        opacity: 0.4;\n    }\n    33% { \n        transform: translate(10%, 10%) scale(1.1);\n        opacity: 0.6;\n    }\n    66% { \n        transform: translate(-10%, 5%) scale(0.95);\n        opacity: 0.5;\n    }\n}\n\nbody > * {\n    position: relative;\n    z-index: 1;\n}\n\n/* Side Panel Navigation */\n.side-panel {\n    position: fixed;\n    left: 0;\n    top: 0;\n    height: 100vh;\n    width: 70px;\n    background: rgba(10, 10, 10, 0.7);\n    backdrop-filter: blur(20px);\n    -webkit-backdrop-filter: blur(20px);\n    border-right: 1px solid rgba(57, 255, 20, 0.2);\n    box-shadow: 0 0 30px rgba(57, 255, 20, 0.1);\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    z-index: 9999;\n    transition: all 0.3s ease;\n}\n\n.side-panel:hover {\n    background: rgba(15, 15, 15, 0.8);\n    box-shadow: 0 0 40px rgba(57, 255, 20, 0.2);\n}\n\n.panel-icon-strip {\n    width: 100%;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    padding: 2rem 0;\n}\n\n.panel-logo-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 50px;\n    height: 50px;\n    color: var(--accent-green);\n    font-size: 2rem;\n    animation: pulse-glow 3s ease-in-out infinite;\n    cursor: pointer;\n    transition: all 0.3s ease;\n}\n\n.panel-logo-icon:hover {\n    transform: scale(1.1);\n    filter: drop-shadow(0 0 20px var(--success-glow));\n}\n\n@keyframes pulse-glow {\n    0%, 100% { filter: drop-shadow(0 0 5px var(--success-glow)); }\n    50% { filter: drop-shadow(0 0 15px var(--success-glow)) drop-shadow(0 0 25px var(--success-glow)); }\n}\n\n/* Graphs Preview Grid */\n.graphs-preview {\n    position: fixed;\n    left: 70px;\n    top: 50%;\n    transform: translateY(-50%) translateX(-100%);\n    background: rgba(10, 10, 10, 0.85);\n    backdrop-filter: blur(25px);\n    -webkit-backdrop-filter: blur(25px);\n    border: 1px solid rgba(57, 255, 20, 0.3);\n    border-left: none;\n    border-radius: 0 12px 12px 0;\n    padding: 2rem;\n    width: 480px;\n    max-height: 90vh;\n    overflow-y: auto;\n    opacity: 0;\n    visibility: hidden;\n    pointer-events: none;\n    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);\n    box-shadow: 5px 0 40px rgba(57, 255, 20, 0.15), 0 0 0 1px rgba(57, 255, 20, 0.2);\n    z-index: 9998;\n    backdrop-filter: blur(10px);\n}\n\n.graphs-preview::-webkit-scrollbar {\n    width: 6px;\n}\n\n.graphs-preview::-webkit-scrollbar-track {\n    background: var(--bg-secondary);\n    border-radius: 3px;\n}\n\n.graphs-preview::-webkit-scrollbar-thumb {\n    background: var(--accent-green);\n    border-radius: 3px;\n}\n\n.graphs-preview.show {\n    opacity: 1;\n    visibility: visible;\n    pointer-events: auto;\n    transform: translateY(-50%) translateX(0);\n}\n\n.preview-header {\n    margin-bottom: 1rem;\n    padding-bottom: 0.8rem;\n    border-bottom: 1px solid var(--border-color);\n}\n\n.preview-header h3 {\n    color: var(--accent-green);\n    font-size: 1.1rem;\n    margin-bottom: 0.3rem;\n}\n\n.preview-header p {\n    color: var(--text-secondary);\n    font-size: 0.85rem;\n}\n\n/* Analytics Miniview - Scaled down live view */\n.analytics-miniview {\n    position: relative;\n    width: 100%;\n    height: 70vh;\n    background: var(--bg-secondary);\n    border: 2px solid var(--border-color);\n    border-radius: 8px;\n    overflow: hidden;\n    cursor: pointer;\n    transition: all 0.3s ease;\n}\n\n.analytics-miniview:hover {\n    border-color: var(--accent-green);\n    box-shadow: 0 0 30px var(--success-glow);\n}\n\n.miniview-content {\n    width: 100%;\n    height: 100%;\n    transform-origin: top left;\n    transform: scale(0.25);\n    width: 400%;\n    height: 400%;\n    pointer-events: none;\n    overflow: hidden;\n}\n\n.miniview-overlay {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: rgba(10, 14, 20, 0.7);\n    backdrop-filter: blur(1px);\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    gap: 1rem;\n    opacity: 0;\n    transition: opacity 0.3s ease;\n    pointer-events: none;\n}\n\n.analytics-miniview:hover .miniview-overlay {\n    opacity: 1;\n}\n\n.miniview-overlay i {\n    font-size: 3rem;\n    color: var(--accent-green);\n    animation: pulse-scale 2s ease-in-out infinite;\n}\n\n.miniview-overlay span {\n    font-size: 1.2rem;\n    font-weight: 600;\n    color: var(--text-primary);\n    text-transform: uppercase;\n    letter-spacing: 1px;\n}\n.preview-home-nav {\n    margin-top: 1.5rem;\n    padding: 1rem;\n    background: var(--bg-secondary);\n    border: 2px solid var(--border-color);\n    border-radius: 10px;\n    display: flex;\n    align-items: center;\n    gap: 0.8rem;\n    cursor: pointer;\n    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n    opacity: 0;\n    visibility: hidden;\n    transform: translateY(10px);\n}\n\n.preview-home-nav.visible {\n    opacity: 1;\n    visibility: visible;\n    transform: translateY(0);\n}\n\n.preview-home-nav:hover {\n    background: var(--bg-hover);\n    border-color: var(--accent-green);\n    box-shadow: 0 5px 20px var(--success-glow);\n    transform: translateY(-2px);\n}\n\n.preview-home-nav i {\n    font-size: 1.5rem;\n    color: var(--accent-green);\n}\n\n.preview-home-nav span {\n    font-size: 1rem;\n    font-weight: 600;\n    color: var(--text-primary);\n}\n\n.preview-label {\n    flex: 1;\n    font-size: 0.95rem;\n    font-weight: 600;\n    color: var(--text-primary);\n    letter-spacing: 0.3px;\n}\n\n/* Analytics Miniview - Screenshot preview */\n.analytics-miniview {\n    position: relative;\n    width: 100%;\n    height: 70vh;\n    background: var(--bg-secondary);\n    border: 2px solid var(--border-color);\n    border-radius: 8px;\n    overflow: hidden;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    padding: 1.5rem;\n}\n\n.analytics-miniview:hover {\n    border-color: var(--accent-green);\n    box-shadow: 0 0 30px var(--success-glow);\n}\n\n.miniview-preview {\n    width: 100%;\n    height: 100%;\n    display: flex;\n    flex-direction: column;\n    gap: 1rem;\n    opacity: 0.7;\n}\n\n.preview-row {\n    display: flex;\n    gap: 1rem;\n    flex: 1;\n}\n\n.preview-box {\n    flex: 1;\n    background: rgba(15, 15, 15, 0.5);\n    backdrop-filter: blur(10px);\n    border: 1px solid rgba(57, 255, 20, 0.2);\n    border-radius: 6px;\n    position: relative;\n    overflow: hidden;\n    padding: 0.5rem;\n}\n\n.preview-box.large {\n    flex: 2;\n}\n\n.preview-box.wide {\n    flex: 1;\n    min-height: 150px;\n}\n\n.box-header {\n    font-size: 0.65rem;\n    color: var(--accent-green);\n    margin-bottom: 0.5rem;\n    opacity: 0.8;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.box-content {\n    height: calc(100% - 1.5rem);\n    position: relative;\n}\n\n.map-visual {\n    background: radial-gradient(circle at center, rgba(57, 255, 20, 0.05), transparent);\n    position: relative;\n}\n\n.map-dot {\n    position: absolute;\n    width: 8px;\n    height: 8px;\n    background: var(--accent-green);\n    border-radius: 50%;\n    box-shadow: 0 0 10px var(--accent-green);\n    animation: map-pulse 2s ease-in-out infinite;\n}\n\n.map-dot:nth-child(2) { animation-delay: 0.5s; }\n.map-dot:nth-child(3) { animation-delay: 1s; }\n\n@keyframes map-pulse {\n    0%, 100% { transform: scale(1); opacity: 0.6; }\n    50% { transform: scale(1.5); opacity: 1; }\n}\n\n.chart-visual {\n    display: flex;\n    align-items: flex-end;\n    justify-content: space-around;\n    height: 100%;\n    padding: 0.5rem;\n    gap: 0.3rem;\n}\n\n.chart-bar {\n    flex: 1;\n    background: linear-gradient(180deg, var(--accent-green), transparent);\n    border-radius: 2px;\n    animation: bar-grow 2s ease-in-out infinite;\n    opacity: 0.7;\n}\n\n.chart-bar:nth-child(2) { animation-delay: 0.2s; }\n.chart-bar:nth-child(3) { animation-delay: 0.4s; }\n.chart-bar:nth-child(4) { animation-delay: 0.6s; }\n\n@keyframes bar-grow {\n    0%, 100% { transform: scaleY(0.8); }\n    50% { transform: scaleY(1); }\n}\n\n.list-visual {\n    display: flex;\n    flex-direction: column;\n    gap: 0.4rem;\n    padding: 0.3rem;\n}\n\n.list-item {\n    height: 0.4rem;\n    background: linear-gradient(90deg, var(--accent-green), transparent);\n    border-radius: 2px;\n    opacity: 0.6;\n    animation: list-fade 3s ease-in-out infinite;\n}\n\n.list-item:nth-child(2) { animation-delay: 0.5s; width: 80%; }\n.list-item:nth-child(3) { animation-delay: 1s; width: 60%; }\n\n@keyframes list-fade {\n    0%, 100% { opacity: 0.4; }\n    50% { opacity: 0.8; }\n}\n\n.network-visual {\n    position: relative;\n    height: 100%;\n}\n\n.network-node {\n    position: absolute;\n    width: 6px;\n    height: 6px;\n    background: var(--accent-green);\n    border-radius: 50%;\n    box-shadow: 0 0 8px var(--accent-green);\n    animation: node-pulse 3s ease-in-out infinite;\n}\n\n.network-node:nth-child(2) { animation-delay: 0.7s; }\n.network-node:nth-child(3) { animation-delay: 1.4s; }\n\n@keyframes node-pulse {\n    0%, 100% { transform: scale(1); opacity: 0.5; }\n    50% { transform: scale(1.3); opacity: 1; }\n}\n\n.heat-visual {\n    background: \n        radial-gradient(circle at 30% 30%, rgba(57, 255, 20, 0.3), transparent 40%),\n        radial-gradient(circle at 70% 60%, rgba(57, 255, 20, 0.2), transparent 40%),\n        radial-gradient(circle at 50% 80%, rgba(57, 255, 20, 0.25), transparent 40%);\n    animation: heat-shift 4s ease-in-out infinite;\n}\n\n@keyframes heat-shift {\n    0%, 100% { opacity: 0.5; }\n    50% { opacity: 0.8; }\n}\n\n.pie-visual {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    height: 100%;\n}\n\n.pie-chart {\n    width: 40px;\n    height: 40px;\n    border-radius: 50%;\n    background: conic-gradient(\n        var(--accent-green) 0deg 120deg,\n        var(--accent-yellow) 120deg 240deg,\n        var(--accent-red) 240deg 360deg\n    );\n    box-shadow: 0 0 15px rgba(57, 255, 20, 0.4);\n    animation: pie-spin 10s linear infinite;\n}\n\n@keyframes pie-spin {\n    0% { transform: rotate(0deg); }\n    100% { transform: rotate(360deg); }\n}\n\n.miniview-overlay {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background: rgba(10, 14, 20, 0.7);\n    backdrop-filter: blur(1px);\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    justify-content: center;\n    gap: 1rem;\n    opacity: 0;\n    transition: opacity 0.3s ease;\n    pointer-events: none;\n}\n\n.analytics-miniview:hover .miniview-overlay {\n    opacity: 1;\n}\n\n.miniview-overlay i {\n    font-size: 3rem;\n    color: var(--accent-green);\n    animation: pulse-scale 2s ease-in-out infinite;\n}\n\n.miniview-overlay span {\n    font-size: 1.2rem;\n    font-weight: 600;\n    color: var(--text-primary);\n    text-transform: uppercase;\n    letter-spacing: 1px;\n}\n\n/* Main Content Area */\n.main-content {\n    margin-left: 70px;\n    min-height: 100vh;\n    padding: 2rem;\n    transition: margin-left 0.4s cubic-bezier(0.4, 0, 0.2, 1);\n    position: relative;\n}\n\n/* Backdrop overlay for preview panel */\n.preview-backdrop {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    background: rgba(0, 0, 0, 0.4);\n    backdrop-filter: blur(2px);\n    opacity: 0;\n    visibility: hidden;\n    transition: all 0.3s ease;\n    z-index: 9998;\n    pointer-events: none;\n}\n\n.preview-backdrop.show {\n    opacity: 1;\n    visibility: visible;\n}\n\n/* View Containers */\n.view-container {\n    display: none;\n    animation: fadeIn 0.4s ease-in-out;\n}\n\n.view-container.active {\n    display: block;\n}\n\n@keyframes fadeIn {\n    from {\n        opacity: 0;\n        transform: translateY(10px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n/* Dashboard Header */\n.dashboard-header {\n    text-align: center;\n    margin-bottom: 2.5rem;\n}\n\n.header-content h1 {\n    font-size: 2.5rem;\n    margin-bottom: 0.5rem;\n    color: var(--accent-green);\n    font-weight: 700;\n    letter-spacing: 2px;\n}\n\n.header-content .subtitle {\n    font-size: 1.2rem;\n    color: var(--text-secondary);\n    font-weight: 500;\n}\n\n.pulse-icon {\n    display: inline-block;\n    animation: pulse-scale 2s ease-in-out infinite;\n}\n\n@keyframes pulse-scale {\n    0%, 100% {\n        transform: scale(1);\n        filter: drop-shadow(0 0 5px var(--success-glow));\n    }\n    50% {\n        transform: scale(1.05);\n        filter: drop-shadow(0 0 15px var(--success-glow));\n    }\n}\n\n/* Animations */\n.animate-slide-in {\n    animation: slideIn 0.6s ease-out;\n}\n\n@keyframes slideIn {\n    from {\n        opacity: 0;\n        transform: translateX(-30px);\n    }\n    to {\n        opacity: 1;\n        transform: translateX(0);\n    }\n}\n\n.animate-fade-in {\n    animation: fadeInUp 0.6s ease-out;\n}\n\n@keyframes fadeInUp {\n    from {\n        opacity: 0;\n        transform: translateY(20px);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0);\n    }\n}\n\n.container {\n    max-width: 1400px;\n    margin: 0 auto;\n}\n\n/* Theme Toggle Button */\n.theme-toggle {\n    position: fixed;\n    top: 20px;\n    right: 20px;\n    z-index: 10000;\n    background: rgba(15, 15, 15, 0.6);\n    backdrop-filter: blur(20px);\n    -webkit-backdrop-filter: blur(20px);\n    border: 1px solid rgba(57, 255, 20, 0.3);\n    border-radius: 50px;\n    padding: 10px 20px;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    gap: 10px;\n    font-size: 1rem;\n    color: var(--text-primary);\n    transition: all 0.3s ease;\n    box-shadow: 0 4px 20px rgba(57, 255, 20, 0.2);\n    font-weight: 600;\n}\n\n.theme-toggle:hover {\n    background: rgba(15, 15, 15, 0.8);\n    border-color: var(--accent-green);\n    box-shadow: 0 0 30px var(--success-glow);\n    transform: translateY(-2px);\n}\n\n.theme-toggle .icon {\n    font-size: 1.2rem;\n}\n\n/* Threat Ticker */\n.threat-ticker-container {\n    background: var(--bg-secondary);\n    border: 2px solid var(--accent-green);\n    border-radius: 8px;\n    padding: 12px;\n    margin-bottom: 2rem;\n    display: flex;\n    align-items: center;\n    gap: 16px;\n    overflow: hidden;\n    box-shadow: 0 2px 8px var(--success-glow);\n}\n\n.ticker-label {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    padding: 8px 16px;\n    background: linear-gradient(135deg, #ff4757, #ff6348);\n    border-radius: 6px;\n    font-weight: 700;\n    font-size: 0.75rem;\n    color: #fff;\n    white-space: nowrap;\n    box-shadow: 0 2px 8px rgba(255, 71, 87, 0.4);\n}\n\n.ticker-label i {\n    animation: pulse-broadcast 2s infinite;\n}\n\n@keyframes pulse-broadcast {\n    0%, 100% { opacity: 1; transform: scale(1); }\n    50% { opacity: 0.6; transform: scale(0.9); }\n}\n\n.threat-ticker {\n    flex: 1;\n    overflow: hidden;\n    position: relative;\n}\n\n.ticker-content {\n    display: flex;\n    gap: 40px;\n    white-space: nowrap;\n    animation: scroll-ticker 30s linear infinite;\n}\n\n.ticker-content:hover {\n    animation-play-state: paused;\n}\n\n@keyframes scroll-ticker {\n    0% { transform: translateX(0); }\n    100% { transform: translateX(-50%); }\n}\n\n.ticker-item {\n    color: #e0e0e0;\n    font-size: 0.9rem;\n    display: inline-flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.ticker-item i {\n    font-size: 0.5rem;\n    animation: blink 1.5s infinite;\n}\n\n@keyframes blink {\n    0%, 100% { opacity: 1; }\n    50% { opacity: 0.3; }\n}\n\n/* Notification System */\n.notification-container {\n    position: fixed;\n    top: 20px;\n    right: 20px;\n    z-index: 10000;\n    display: flex;\n    flex-direction: column;\n    gap: 12px;\n    max-width: 400px;\n}\n\n.threat-notification {\n    background: rgba(30, 30, 30, 0.98);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-left: 4px solid #ff4757;\n    border-radius: 8px;\n    padding: 16px;\n    display: flex;\n    gap: 12px;\n    align-items: flex-start;\n    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.5);\n    transform: translateX(450px);\n    opacity: 0;\n    transition: all 0.3s ease-out;\n}\n\n.threat-notification.show {\n    transform: translateX(0);\n    opacity: 1;\n}\n\n.notification-icon {\n    font-size: 1.5rem;\n    flex-shrink: 0;\n}\n\n.notification-content {\n    flex: 1;\n}\n\n.notification-title {\n    font-size: 0.95rem;\n    color: #e0e0e0;\n    margin-bottom: 4px;\n}\n\n.notification-title strong {\n    text-transform: uppercase;\n    font-weight: 800;\n}\n\n.notification-details {\n    font-size: 0.85rem;\n    color: #b0b0b0;\n    margin-bottom: 6px;\n}\n\n.notification-meta {\n    font-size: 0.75rem;\n    color: #888;\n    display: flex;\n    align-items: center;\n    gap: 6px;\n}\n\n.notification-close {\n    cursor: pointer;\n    color: #666;\n    transition: color 0.2s;\n    font-size: 0.9rem;\n}\n\n.notification-close:hover {\n    color: #e0e0e0;\n}\n\n/* Stat Card Pulse Animation */\n.stat-pulse {\n    animation: stat-pulse-animation 0.6s ease-out;\n}\n\n@keyframes stat-pulse-animation {\n    0% { transform: scale(1); }\n    50% { transform: scale(1.05); box-shadow: 0 8px 24px rgba(90, 156, 248, 0.4); }\n    100% { transform: scale(1); }\n}\n\nh1 {\n    font-size: 2.5rem;\n    color: #5a9cf8;\n    margin-bottom: 0.5rem;\n}\n\n.subtitle {\n    color: #888;\n    font-size: 1.1rem;\n}\n\n.stats-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n    gap: 1.5rem;\n    margin-bottom: 3rem;\n}\n\n.stat-card {\n    background: var(--bg-card);\n    border: 2px solid var(--border-color);\n    border-radius: 12px;\n    padding: 1.5rem;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 0.8rem;\n    position: relative;\n    overflow: hidden;\n    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);\n}\n\n.stat-card::before {\n    content: '';\n    position: absolute;\n    top: -50%;\n    left: -50%;\n    width: 200%;\n    height: 200%;\n    background: radial-gradient(circle, var(--accent-green) 0%, transparent 70%);\n    opacity: 0;\n    transition: opacity 0.4s ease;\n}\n\n.stat-card:hover::before {\n    opacity: 0.05;\n}\n\n.stat-card:hover {\n    transform: translateY(-5px) scale(1.02);\n    border-color: var(--accent-green);\n    box-shadow: 0 10px 30px var(--success-glow);\n}\n\n.stat-card i {\n    font-size: 2.5rem;\n    opacity: 0.8;\n    transition: all 0.3s ease;\n}\n\n.stat-card:hover i {\n    transform: scale(1.1) rotateY(180deg);\n    opacity: 1;\n}\n\n.stat-number {\n    font-size: 2.5rem;\n    font-weight: 700;\n    transition: all 0.3s ease;\n}\n\n.stat-card:hover .stat-number {\n    transform: scale(1.1);\n    text-shadow: 0 0 20px currentColor;\n}\n\n.stat-label {\n    font-size: 0.9rem;\n    color: var(--text-secondary);\n    font-weight: 600;\n}\n\n.stat-glow {\n    position: absolute;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    height: 3px;\n    background: linear-gradient(90deg, transparent, var(--accent-green), transparent);\n    opacity: 0;\n    transition: opacity 0.4s ease;\n}\n\n.stat-card:hover .stat-glow {\n    opacity: 1;\n    animation: glowSlide 2s ease-in-out infinite;\n}\n\n@keyframes glowSlide {\n    0%, 100% {\n        transform: translateX(-100%);\n    }\n    50% {\n        transform: translateX(100%);\n    }\n}\n\n.stat-card.malware {\n    border-color: rgba(255, 59, 59, 0.3);\n}\n\n.stat-card.malware i,\n.stat-card.malware .stat-number {\n    color: var(--accent-red);\n}\n\n.stat-card.malware:hover {\n    border-color: var(--accent-red);\n    box-shadow: 0 10px 30px var(--danger-glow);\n}\n\n.stat-card.suspicious {\n    border-color: rgba(255, 215, 0, 0.3);\n}\n\n.stat-card.suspicious i,\n.stat-card.suspicious .stat-number {\n    color: var(--accent-yellow);\n}\n\n.stat-card.suspicious:hover {\n    border-color: var(--accent-yellow);\n    box-shadow: 0 10px 30px var(--warning-glow);\n}\n\n.stat-card.benign i,\n.stat-card.benign .stat-number,\n.stat-card.info i,\n.stat-card.info .stat-number {\n    color: var(--accent-green);\n}\n\n/* Analytics View */\n.analytics-header {\n    display: flex;\n    align-items: center;\n    gap: 2rem;\n    margin-bottom: 2.5rem;\n}\n\n.back-btn {\n    background: var(--bg-card);\n    border: 2px solid var(--accent-green);\n    color: var(--accent-green);\n    padding: 0.8rem 1.5rem;\n    border-radius: 8px;\n    font-size: 1rem;\n    font-weight: 600;\n    cursor: pointer;\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    transition: all 0.3s ease;\n}\n\n.back-btn:hover {\n    background: var(--accent-green);\n    color: var(--bg-primary);\n    transform: translateX(-5px);\n    box-shadow: 0 5px 20px var(--success-glow);\n}\n\n.analytics-header h1 {\n    font-size: 2rem;\n    color: var(--accent-green);\n    font-weight: 700;\n}\n\n.analytics-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));\n    gap: 2rem;\n    max-height: calc(100vh - 200px);\n    overflow-y: auto;\n    padding-right: 1rem;\n    grid-auto-flow: dense;\n}\n\n/* Panel size classes for flexible tiling */\n.analytics-panel.panel-small {\n    grid-column: span 1;\n}\n\n.analytics-panel.panel-medium {\n    grid-column: span 1;\n}\n\n.analytics-panel.panel-large {\n    grid-column: span 2;\n}\n\n@media (max-width: 1400px) {\n    .analytics-grid {\n        grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));\n    }\n    \n    .analytics-panel.panel-large {\n        grid-column: span 1;\n    }\n}\n\n.analytics-grid::-webkit-scrollbar {\n    width: 8px;\n}\n\n.analytics-grid::-webkit-scrollbar-track {\n    background: var(--bg-secondary);\n    border-radius: 4px;\n}\n\n.analytics-grid::-webkit-scrollbar-thumb {\n    background: var(--accent-green);\n    border-radius: 4px;\n}\n\n.analytics-grid::-webkit-scrollbar-thumb:hover {\n    background: var(--accent-green-dim);\n}\n\n.analytics-panel {\n    animation: slideInPanel 0.5s ease-out;\n    animation-fill-mode: backwards;\n}\n\n.analytics-panel:nth-child(1) { animation-delay: 0.05s; }\n.analytics-panel:nth-child(2) { animation-delay: 0.1s; }\n.analytics-panel:nth-child(3) { animation-delay: 0.15s; }\n.analytics-panel:nth-child(4) { animation-delay: 0.2s; }\n.analytics-panel:nth-child(5) { animation-delay: 0.25s; }\n.analytics-panel:nth-child(6) { animation-delay: 0.3s; }\n\n@keyframes slideInPanel {\n    from {\n        opacity: 0;\n        transform: translateY(30px) scale(0.95);\n    }\n    to {\n        opacity: 1;\n        transform: translateY(0) scale(1);\n    }\n}\n\n/* Advanced Analytics Grid for Mini Charts */\n.advanced-analytics-grid {\n    background: rgba(15, 15, 15, 0.5);\n    backdrop-filter: blur(10px);\n    border: 1px solid rgba(57, 255, 20, 0.2);\n    border-radius: 12px;\n    padding: 1.5rem;\n}\n\n.mini-charts-grid {\n    display: grid;\n    grid-template-columns: repeat(2, 1fr);\n    gap: 1.5rem;\n    margin-top: 1rem;\n}\n\n.mini-chart-container {\n    background: rgba(10, 10, 10, 0.6);\n    border: 1px solid rgba(57, 255, 20, 0.15);\n    border-radius: 8px;\n    padding: 1rem;\n}\n\n.mini-chart-container h3 {\n    color: var(--accent-green);\n    font-size: 0.95rem;\n    margin: 0 0 0.75rem 0;\n    font-weight: 600;\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n}\n\n.mini-chart-container h3 i {\n    font-size: 0.9rem;\n}\n\n@media (max-width: 1200px) {\n    .mini-charts-grid {\n        grid-template-columns: 1fr;\n    }\n}\n\n/* Emerging Threat Intelligence Panel */\n.eti-container {\n    background: linear-gradient(135deg, rgba(255, 71, 87, 0.1) 0%, rgba(255, 165, 2, 0.1) 100%);\n    border: 2px solid rgba(255, 71, 87, 0.3);\n    border-radius: 12px;\n    padding: 24px;\n    margin-bottom: 3rem;\n    box-shadow: 0 4px 16px rgba(255, 71, 87, 0.2);\n}\n\n.eti-header {\n    margin-bottom: 24px;\n}\n\n.eti-header h2 {\n    margin: 0 0 8px 0;\n    font-size: 1.8rem;\n    color: #ff6b6b;\n    text-shadow: 0 2px 4px rgba(255, 71, 87, 0.3);\n}\n\n.eti-header h2 i {\n    color: #ff4757;\n    margin-right: 10px;\n    animation: pulse 2s infinite;\n}\n\n@keyframes pulse {\n    0%, 100% { opacity: 1; }\n    50% { opacity: 0.6; }\n}\n\n.eti-subtitle {\n    color: #b0b0b0;\n    font-size: 0.95rem;\n    margin: 8px 0 16px 0;\n}\n\n.eti-summary {\n    display: flex;\n    gap: 12px;\n    flex-wrap: wrap;\n}\n\n.eti-badge {\n    background: rgba(90, 156, 248, 0.2);\n    border: 1px solid rgba(90, 156, 248, 0.4);\n    color: #5a9cf8;\n    padding: 6px 14px;\n    border-radius: 20px;\n    font-size: 0.85rem;\n    font-weight: 600;\n}\n\n.eti-badge.recent {\n    background: rgba(255, 71, 87, 0.2);\n    border-color: rgba(255, 71, 87, 0.4);\n    color: #ff6b6b;\n}\n\n.eti-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));\n    gap: 20px;\n}\n\n.eti-panel {\n    background: rgba(0, 0, 0, 0.3);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: 10px;\n    padding: 18px;\n    transition: transform 0.3s, box-shadow 0.3s;\n}\n\n.eti-panel:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);\n}\n\n.eti-panel h3 {\n    margin: 0 0 6px 0;\n    font-size: 1.1rem;\n    color: #e0e0e0;\n}\n\n.eti-panel h3 i {\n    color: #ffa502;\n    margin-right: 8px;\n}\n\n.eti-subtitle-small {\n    color: #888;\n    font-size: 0.8rem;\n    margin-bottom: 14px;\n}\n\n.eti-list {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n}\n\n.eti-item {\n    display: flex;\n    gap: 12px;\n    background: rgba(255, 255, 255, 0.03);\n    border: 1px solid rgba(255, 255, 255, 0.08);\n    border-radius: 8px;\n    padding: 12px;\n    transition: all 0.3s;\n}\n\n.eti-item:hover {\n    background: rgba(255, 255, 255, 0.06);\n    border-color: rgba(255, 165, 2, 0.4);\n    transform: translateX(4px);\n}\n\n.eti-rank {\n    flex-shrink: 0;\n    width: 32px;\n    height: 32px;\n    background: linear-gradient(135deg, #ff6b6b, #ffa502);\n    border-radius: 50%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-weight: bold;\n    font-size: 1rem;\n    color: #fff;\n    box-shadow: 0 2px 8px rgba(255, 107, 107, 0.4);\n}\n\n.eti-item[data-rank=\"1\"] .eti-rank {\n    background: linear-gradient(135deg, #ff4757, #ff6348);\n    transform: scale(1.1);\n}\n\n.eti-content {\n    flex: 1;\n    min-width: 0;\n}\n\n.eti-name {\n    font-weight: 600;\n    color: #e0e0e0;\n    font-size: 0.95rem;\n    margin-bottom: 4px;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n}\n\n.eti-meta {\n    display: flex;\n    gap: 8px;\n    flex-wrap: wrap;\n    align-items: center;\n}\n\n.eti-count {\n    color: #888;\n    font-size: 0.8rem;\n}\n\n.eti-recent-badge {\n    background: rgba(255, 71, 87, 0.2);\n    border: 1px solid rgba(255, 71, 87, 0.4);\n    color: #ff6b6b;\n    padding: 2px 8px;\n    border-radius: 10px;\n    font-size: 0.75rem;\n    font-weight: 600;\n}\n\n.eti-agent-badge {\n    background: rgba(90, 156, 248, 0.2);\n    border: 1px solid rgba(90, 156, 248, 0.4);\n    color: #5a9cf8;\n    padding: 2px 8px;\n    border-radius: 10px;\n    font-size: 0.75rem;\n    font-weight: 600;\n}\n\n.eti-details {\n    margin-top: 6px;\n    color: #999;\n    font-size: 0.75rem;\n    font-style: italic;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n}\n\n.eti-empty {\n    text-align: center;\n    color: #666;\n    padding: 20px;\n    font-style: italic;\n}\n\n/* Threat Modeler */\n.modeler-container {\n    background: linear-gradient(135deg, rgba(90, 156, 248, 0.1) 0%, rgba(38, 222, 129, 0.1) 100%);\n    border: 2px solid rgba(90, 156, 248, 0.3);\n    border-radius: 12px;\n    padding: 24px;\n    margin-bottom: 3rem;\n    box-shadow: 0 4px 16px rgba(90, 156, 248, 0.2);\n}\n\n.modeler-header {\n    margin-bottom: 24px;\n}\n\n.modeler-header h2 {\n    margin: 0 0 8px 0;\n    font-size: 1.8rem;\n    color: #5a9cf8;\n}\n\n.modeler-header h2 i {\n    color: #26de81;\n    margin-right: 10px;\n}\n\n.modeler-subtitle {\n    color: #b0b0b0;\n    font-size: 0.95rem;\n    margin: 0;\n}\n\n.modeler-grid {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 24px;\n}\n\n@media (max-width: 1024px) {\n    .modeler-grid {\n        grid-template-columns: 1fr;\n    }\n}\n\n.modeler-builder,\n.modeler-results {\n    background: rgba(0, 0, 0, 0.3);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: 10px;\n    padding: 20px;\n}\n\n.modeler-builder h3,\n.modeler-results h3 {\n    margin: 0 0 20px 0;\n    font-size: 1.2rem;\n    color: #e0e0e0;\n    border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n    padding-bottom: 10px;\n}\n\n.modeler-builder h3 i {\n    color: #26de81;\n    margin-right: 8px;\n}\n\n.modeler-results h3 i {\n    color: #5a9cf8;\n    margin-right: 8px;\n}\n\n.modeler-field {\n    margin-bottom: 20px;\n}\n\n.modeler-field label {\n    display: block;\n    color: #b0b0b0;\n    font-size: 0.9rem;\n    margin-bottom: 6px;\n    font-weight: 600;\n}\n\n.modeler-select {\n    width: 100%;\n    background: rgba(255, 255, 255, 0.05);\n    border: 1px solid rgba(255, 255, 255, 0.2);\n    border-radius: 6px;\n    color: #e0e0e0;\n    padding: 10px;\n    font-size: 0.9rem;\n    font-family: inherit;\n    cursor: pointer;\n    transition: all 0.3s;\n}\n\n.modeler-select:focus {\n    outline: none;\n    border-color: #5a9cf8;\n    background: rgba(90, 156, 248, 0.1);\n}\n\n.modeler-select option {\n    background: #1a1a2e;\n    color: #e0e0e0;\n    padding: 8px;\n}\n\n.modeler-hint {\n    display: block;\n    color: #666;\n    font-size: 0.75rem;\n    margin-top: 4px;\n    font-style: italic;\n}\n\n.modeler-analyze-btn {\n    width: 100%;\n    background: linear-gradient(135deg, #26de81, #20bf6b);\n    border: none;\n    color: #fff;\n    padding: 14px 24px;\n    border-radius: 8px;\n    font-size: 1rem;\n    font-weight: 700;\n    cursor: pointer;\n    transition: all 0.3s;\n    box-shadow: 0 4px 12px rgba(38, 222, 129, 0.3);\n}\n\n.modeler-analyze-btn:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 6px 16px rgba(38, 222, 129, 0.4);\n}\n\n.modeler-analyze-btn i {\n    margin-right: 8px;\n}\n\n.modeler-output {\n    min-height: 400px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n\n.modeler-placeholder {\n    text-align: center;\n    color: #666;\n}\n\n.modeler-placeholder i {\n    font-size: 3rem;\n    margin-bottom: 16px;\n    opacity: 0.5;\n}\n\n.modeler-placeholder p {\n    font-size: 0.95rem;\n}\n\n.modeler-loading {\n    text-align: center;\n    color: #5a9cf8;\n}\n\n.modeler-loading i {\n    font-size: 3rem;\n    margin-bottom: 16px;\n}\n\n.modeler-error {\n    text-align: center;\n    color: #ff4757;\n}\n\n.modeler-error i {\n    font-size: 3rem;\n    margin-bottom: 16px;\n}\n\n.prediction-result {\n    width: 100%;\n}\n\n.prediction-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 24px;\n    padding: 20px;\n    background: rgba(255, 255, 255, 0.05);\n    border-radius: 8px;\n}\n\n.prediction-badge {\n    padding: 12px 24px;\n    border-radius: 8px;\n    font-size: 1.3rem;\n    font-weight: 800;\n    color: #fff;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n}\n\n.prediction-confidence {\n    text-align: right;\n}\n\n.confidence-label {\n    color: #888;\n    font-size: 0.8rem;\n    margin-bottom: 4px;\n}\n\n.confidence-value {\n    color: #5a9cf8;\n    font-size: 2rem;\n    font-weight: 800;\n}\n\n.prediction-family {\n    padding: 16px;\n    background: rgba(255, 71, 87, 0.1);\n    border-left: 4px solid #ff4757;\n    border-radius: 6px;\n    margin-bottom: 20px;\n    color: #e0e0e0;\n}\n\n.family-name {\n    color: #ff6b6b;\n    font-weight: 700;\n    font-size: 1.1rem;\n    margin-left: 8px;\n}\n\n.prediction-section {\n    margin-bottom: 20px;\n}\n\n.prediction-section h4 {\n    color: #5a9cf8;\n    font-size: 1rem;\n    margin: 0 0 12px 0;\n    border-bottom: 1px solid rgba(90, 156, 248, 0.3);\n    padding-bottom: 6px;\n}\n\n.analysis-item {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    padding: 8px 0;\n    color: #b0b0b0;\n    font-size: 0.9rem;\n}\n\n.analysis-item i {\n    color: #ffa502;\n    width: 20px;\n}\n\n.indicator-group {\n    margin-bottom: 16px;\n}\n\n.indicator-group strong {\n    display: block;\n    color: #e0e0e0;\n    margin-bottom: 8px;\n    font-size: 0.9rem;\n}\n\n.indicator-list {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 8px;\n}\n\n.indicator-tag {\n    padding: 6px 12px;\n    border-radius: 6px;\n    font-size: 0.8rem;\n    font-weight: 600;\n    font-family: 'Courier New', monospace;\n}\n\n.api-tag {\n    background: rgba(255, 165, 2, 0.2);\n    border: 1px solid rgba(255, 165, 2, 0.4);\n    color: #ffa502;\n}\n\n.string-tag {\n    background: rgba(255, 71, 87, 0.2);\n    border: 1px solid rgba(255, 71, 87, 0.4);\n    color: #ff6b6b;\n}\n\n.prediction-footer {\n    margin-top: 20px;\n    padding: 12px;\n    background: rgba(90, 156, 248, 0.1);\n    border-radius: 6px;\n    color: #5a9cf8;\n    font-size: 0.85rem;\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.scans-container {\n    background: var(--bg-card);\n    border: 2px solid var(--border-color);\n    border-radius: 12px;\n    padding: 2rem;\n    transition: all 0.3s ease;\n}\n\n.scans-container:hover {\n    border-color: var(--accent-green);\n    box-shadow: 0 5px 20px var(--shadow-color);\n}\n\n.scans-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 2rem;\n}\n\n.scans-header h2 {\n    color: #5a9cf8;\n}\n\n.refresh-btn {\n    background: #5a9cf8;\n    color: white;\n    border: none;\n    padding: 0.75rem 1.5rem;\n    border-radius: 8px;\n    cursor: pointer;\n    font-size: 1rem;\n    transition: background 0.2s;\n}\n\n.refresh-btn:hover {\n    background: #4a8ce8;\n}\n\n.scans-table {\n    width: 100%;\n    border-collapse: collapse;\n}\n\n.scans-table th {\n    text-align: left;\n    padding: 1rem;\n    background: rgba(255, 255, 255, 0.05);\n    color: #5a9cf8;\n    font-weight: 600;\n}\n\n.scans-table td {\n    padding: 1rem;\n    border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n}\n\n.scans-table tr:hover {\n    background: rgba(255, 255, 255, 0.03);\n}\n\n.badge {\n    display: inline-block;\n    padding: 0.3rem 0.8rem;\n    border-radius: 6px;\n    font-size: 0.85rem;\n    font-weight: 600;\n}\n\n.badge.malware { background: #ff4757; color: white; }\n.badge.suspicious { background: #ffa502; color: white; }\n.badge.benign { background: #26de81; color: white; }\n.badge.non-pe { background: #4b5563; color: #fff; }\n\n.hash {\n    font-family: 'Courier New', monospace;\n    font-size: 0.85rem;\n    color: #888;\n}\n\n.empty-state {\n    text-align: center;\n    padding: 3rem;\n    color: #666;\n}\n\n.empty-state i {\n    font-size: 4rem;\n    margin-bottom: 1rem;\n    opacity: 0.3;\n}\n\n/* NEW: Chart Container Styles */\n.chart-container {\n    background: rgba(255, 255, 255, 0.05);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: 12px;\n    padding: 2rem;\n    margin-top: 2rem;\n}\n\n.chart-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 2rem;\n}\n\n.chart-header h2 {\n    color: var(--accent-green);\n    margin: 0;\n}\n\n.chart-subtitle {\n    font-size: 0.85rem;\n    color: var(--text-secondary);\n    margin: 0.5rem 0 0 0;\n    font-weight: normal;\n}\n\n.chart-controls {\n    display: flex;\n    gap: 0.5rem;\n}\n\n.chart-btn {\n    background: rgba(255, 255, 255, 0.05);\n    color: #888;\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    padding: 0.5rem 1rem;\n    border-radius: 6px;\n    cursor: pointer;\n    font-size: 0.9rem;\n    transition: all 0.2s;\n}\n\n.chart-btn:hover {\n    background: rgba(255, 255, 255, 0.1);\n    color: #e0e0e0;\n}\n\n.chart-btn.active {\n    background: #5a9cf8;\n    color: white;\n    border-color: #5a9cf8;\n}\n\n#dailyScansChart {\n    max-height: 400px;\n}\n\n@media (max-width: 1024px) {\n    .analytics-grid {\n        grid-template-columns: 1fr;\n        gap: 1.5rem;\n    }\n    \n    .analytics-panel.panel-small,\n    .analytics-panel.panel-large {\n        grid-column: span 1;\n    }\n    \n    .graphs-preview {\n        width: 400px;\n    }\n}\n\n@media (max-width: 768px) {\n    .main-content {\n        margin-left: 0;\n        padding: 1rem;\n    }\n    \n    .side-panel {\n        width: 50px;\n    }\n    \n    .panel-logo-icon {\n        width: 40px;\n        height: 40px;\n        font-size: 1.5rem;\n    }\n    \n    .graphs-preview {\n        left: 50px;\n        width: calc(100vw - 50px);\n        border-radius: 0;\n    }\n    \n    .dashboard-header h1 {\n        font-size: 1.8rem;\n    }\n    \n    .stats-grid {\n        grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));\n        gap: 1rem;\n    }\n    \n    .chart-header {\n        flex-direction: column;\n        gap: 1rem;\n        align-items: flex-start;\n    }\n    \n    .chart-controls {\n        width: 100%;\n        justify-content: stretch;\n    }\n    \n    .chart-btn {\n        flex: 1;\n    }\n    \n    .map-view-toggle {\n        width: 100%;\n        justify-content: stretch;\n    }\n    \n    .map-btn {\n        flex: 1;\n        font-size: 0.8rem;\n        padding: 0.4rem 0.6rem;\n    }\n    \n    .geo-context-panel {\n        flex-direction: column;\n    }\n    \n    .context-stat {\n        width: 100%;\n    }\n    \n    .map-timeline-control {\n        flex-direction: column;\n        gap: 0.5rem;\n    }\n    \n    .timeline-info {\n        text-align: center;\n    }\n    \n    .analytics-header {\n        flex-direction: column;\n        align-items: flex-start;\n    }\n}\n\n/* Map Container */\n.map-container {\n    background: var(--bg-card);\n    border-radius: 12px;\n    padding: 24px;\n    box-shadow: 0 4px 12px var(--shadow-color);\n    border: 2px solid var(--border-color);\n    transition: all 0.3s ease;\n    min-height: 600px;\n}\n\n.map-container:hover {\n    border-color: var(--accent-green);\n    box-shadow: 0 8px 24px var(--shadow-color), 0 0 20px var(--success-glow);\n}\n\n#worldMap {\n    width: 100%;\n    height: 500px;\n    border-radius: 8px;\n    margin-bottom: 15px;\n    background: var(--bg-secondary);\n    border: 1px solid var(--border-color);\n    z-index: 1;\n    position: relative;\n}\n\n.map-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 20px;\n    flex-wrap: wrap;\n    gap: 16px;\n}\n\n.map-header h2 {\n    margin: 0;\n    font-size: 1.5rem;\n    color: var(--accent-green);\n    text-shadow: 0 0 10px var(--success-glow);\n}\n\n.map-header h2 i {\n    color: var(--accent-green);\n    margin-right: 8px;\n}\n\n.map-controls {\n    display: flex;\n    gap: 20px;\n    align-items: center;\n    flex-wrap: wrap;\n}\n\n.map-view-toggle {\n    display: flex;\n    gap: 8px;\n    background: var(--bg-secondary);\n    padding: 4px;\n    border-radius: 8px;\n    border: 1px solid var(--border-color);\n}\n\n.map-btn {\n    background: transparent;\n    border: none;\n    padding: 8px 16px;\n    border-radius: 6px;\n    cursor: pointer;\n    color: var(--text-secondary);\n    font-size: 0.9rem;\n    font-weight: 600;\n    transition: all 0.2s ease;\n    display: flex;\n    align-items: center;\n    gap: 6px;\n}\n\n.map-btn:hover {\n    background: var(--bg-hover);\n    color: var(--text-primary);\n}\n\n.map-btn.active {\n    background: var(--accent-green);\n    color: var(--bg-primary);\n    box-shadow: 0 0 10px var(--success-glow);\n}\n\n.map-btn i {\n    font-size: 1rem;\n}\n\n.map-legend {\n    display: flex;\n    gap: 20px;\n    flex-wrap: wrap;\n}\n\n.legend-item {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    font-size: 0.9rem;\n    color: var(--text-secondary);\n}\n\n.legend-dot {\n    width: 12px;\n    height: 12px;\n    border-radius: 50%;\n    display: inline-block;\n    box-shadow: 0 0 6px currentColor;\n}\n\n.malware-dot {\n    background-color: var(--accent-red);\n}\n\n.suspicious-dot {\n    background-color: var(--accent-yellow);\n}\n\n.benign-dot {\n    background-color: var(--accent-green);\n}\n\n.geo-context-panel {\n    display: flex;\n    justify-content: space-around;\n    gap: 20px;\n    padding: 15px;\n    background: var(--bg-secondary);\n    border-radius: 8px;\n    margin-bottom: 15px;\n    border: 1px solid var(--border-color);\n}\n\n.context-stat {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 5px;\n}\n\n.context-label {\n    font-size: 0.85rem;\n    color: var(--text-secondary);\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.context-value {\n    font-size: 1.5rem;\n    font-weight: 700;\n    color: var(--accent-green);\n    text-shadow: 0 0 10px var(--success-glow);\n}\n\n.context-value.threat-count {\n    color: var(--accent-red);\n    text-shadow: 0 0 10px var(--danger-glow);\n}\n\n.map-timeline-control {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 12px;\n    background: var(--bg-secondary);\n    border-radius: 8px;\n    margin-top: 15px;\n    border: 1px solid var(--border-color);\n}\n\n.timeline-btn {\n    background: linear-gradient(135deg, var(--accent-green) 0%, var(--accent-green-dim) 100%);\n    color: var(--bg-primary);\n    border: none;\n    padding: 10px 20px;\n    border-radius: 6px;\n    cursor: pointer;\n    font-size: 0.95rem;\n    font-weight: 600;\n    transition: all 0.2s ease;\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    box-shadow: 0 4px 12px var(--success-glow);\n}\n\n.timeline-btn:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 6px 16px var(--success-glow);\n    filter: brightness(1.1);\n}\n\n.timeline-btn i {\n    font-size: 1rem;\n}\n\n.timeline-info {\n    color: var(--text-secondary);\n    font-size: 0.9rem;\n    font-style: italic;\n}\n\n#worldMap {\n    background: var(--bg-secondary);\n    border: 2px solid var(--border-color);\n}\n\n/* Leaflet popup customization for theme */\n.leaflet-popup-content-wrapper {\n    background: var(--bg-card) !important;\n    color: var(--text-primary) !important;\n    border: 2px solid var(--accent-green) !important;\n    box-shadow: 0 4px 15px var(--shadow-color) !important;\n    border-radius: 8px !important;\n}\n\n.leaflet-popup-tip {\n    background: var(--bg-card) !important;\n}\n\n.leaflet-popup-content h3 {\n    color: var(--accent-green) !important;\n}\n\n.leaflet-popup-content button {\n    background: var(--accent-green) !important;\n    color: var(--bg-primary) !important;\n    border: none !important;\n    padding: 8px 16px !important;\n    border-radius: 6px !important;\n    cursor: pointer !important;\n    font-weight: 600 !important;\n    transition: all 0.2s ease !important;\n}\n\n.leaflet-popup-content button:hover {\n    transform: translateY(-2px) !important;\n    box-shadow: 0 4px 12px var(--success-glow) !important;\n}\n\n/* Correlation Graph */\n.correlation-container {\n    background: rgba(255, 255, 255, 0.03);\n    border-radius: 12px;\n    padding: 24px;\n    margin-top: 24px;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n}\n\n.correlation-header {\n    margin-bottom: 20px;\n}\n\n.correlation-header h2 {\n    margin: 0 0 8px 0;\n    font-size: 1.5rem;\n    color: #e0e0e0;\n}\n\n.correlation-header h2 i {\n    color: #5a9cf8;\n    margin-right: 8px;\n}\n\n.correlation-subtitle {\n    color: #888;\n    font-size: 0.9rem;\n    margin: 0;\n}\n\n.graph-controls {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 16px;\n    flex-wrap: wrap;\n    gap: 16px;\n}\n\n.graph-btn {\n    background: rgba(90, 156, 248, 0.2);\n    border: 1px solid rgba(90, 156, 248, 0.4);\n    color: #5a9cf8;\n    padding: 8px 16px;\n    border-radius: 6px;\n    cursor: pointer;\n    font-size: 0.9rem;\n    transition: all 0.3s;\n}\n\n.graph-btn:hover {\n    background: rgba(90, 156, 248, 0.3);\n    border-color: #5a9cf8;\n}\n\n.graph-btn i {\n    margin-right: 6px;\n}\n\n.graph-legend {\n    display: flex;\n    gap: 20px;\n    flex-wrap: wrap;\n}\n\n.node-sample {\n    width: 12px;\n    height: 12px;\n    border-radius: 50%;\n    display: inline-block;\n    border: 2px solid #fff;\n}\n\n.malware-node {\n    background-color: #ff4757;\n}\n\n.agent-node {\n    background-color: #5a9cf8;\n}\n\n.api-node {\n    background-color: #ffa502;\n}\n\n.string-node {\n    background-color: #26de81;\n}\n\n#correlationGraph {\n    width: 100%;\n    min-height: 600px;\n    position: relative;\n    border-radius: 8px;\n    overflow: hidden;\n}\n\n.node-details {\n    position: absolute;\n    right: 24px;\n    top: 120px;\n    background: rgba(30, 30, 30, 0.95);\n    border: 1px solid rgba(90, 156, 248, 0.4);\n    border-radius: 8px;\n    padding: 16px;\n    max-width: 300px;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n    z-index: 1000;\n}\n\n.node-details h3 {\n    margin: 0 0 12px 0;\n    color: #5a9cf8;\n    font-size: 1.1rem;\n    border-bottom: 1px solid rgba(90, 156, 248, 0.3);\n    padding-bottom: 8px;\n}\n\n.node-details p {\n    margin: 8px 0;\n    color: #e0e0e0;\n    font-size: 0.9rem;\n}\n\n.node-details ul {\n    color: #b0b0b0;\n    font-size: 0.85rem;\n}\n\n.node-details li {\n    margin: 4px 0;\n}\n\n/* ========================================\n   LIGHT THEME CONTRAST FIXES\n   ======================================== */\n\n/* Fix 1 & 2: Analytics preview backgrounds - lighter for better green contrast */\n[data-theme=\"light\"] .eti-container {\n    background: linear-gradient(135deg, rgba(255, 71, 87, 0.05) 0%, rgba(255, 165, 2, 0.05) 100%);\n    border-color: rgba(255, 71, 87, 0.2);\n}\n\n[data-theme=\"light\"] .modeler-container {\n    background: linear-gradient(135deg, rgba(90, 156, 248, 0.05) 0%, rgba(38, 222, 129, 0.05) 100%);\n    border-color: rgba(90, 156, 248, 0.2);\n}\n\n/* Fix 3: Theme toggle button text - darker for contrast */\n[data-theme=\"light\"] .theme-toggle {\n    color: #1a1f2e;\n    background: rgba(255, 255, 255, 0.8);\n    border-color: rgba(46, 214, 15, 0.4);\n}\n\n/* Fix 4: Daily Analysis chart - darker labels and grid (handled in JS via CSS vars) */\n[data-theme=\"light\"] {\n    --chart-text-color: #374151;\n    --chart-grid-color: rgba(0, 0, 0, 0.12);\n}\n\n:root {\n    --chart-text-color: #9ca3af;\n    --chart-grid-color: rgba(255, 255, 255, 0.1);\n}\n\n/* Fix 5: Chart container labels - darker in light theme */\n[data-theme=\"light\"] .chart-header h2,\n[data-theme=\"light\"] .chart-header {\n    color: #1a1f2e;\n}\n\n/* Fix 6: Threat Vector Correlation header - darker */\n[data-theme=\"light\"] .correlation-header h2 {\n    color: #1a1f2e;\n}\n\n[data-theme=\"light\"] .correlation-subtitle {\n    color: #4a5568;\n}\n\n/* Fix 7: ETI subtitle and summary - darker for better contrast */\n[data-theme=\"light\"] .eti-subtitle {\n    color: #4a5568;\n}\n\n[data-theme=\"light\"] .eti-summary {\n    color: #374151;\n}\n\n/* Fix 8: Prediction labels in threat modeler - darker */\n[data-theme=\"light\"] .modeler-subtitle {\n    color: #4a5568;\n}\n\n[data-theme=\"light\"] .modeler-field label {\n    color: #374151;\n}\n\n[data-theme=\"light\"] .modeler-hint {\n    color: #6b7280;\n}\n\n/* Fix 9: Analytics preview backgrounds - much lighter for green text visibility */\n[data-theme=\"light\"] .preview-box {\n    background: rgba(255, 255, 255, 0.6);\n    border-color: rgba(46, 214, 15, 0.3);\n}\n\n/* Fix 10: ETI item text - lighter for better readability */\n[data-theme=\"light\"] .eti-count {\n    color: #6b7280;\n}\n\n[data-theme=\"light\"] .eti-details {\n    color: #9ca3af;\n}\n\n[data-theme=\"light\"] .eti-name {\n    color: #1f2937;\n}\n","epoch":71,"telemetryInfo":{}}],["file:///home/trang/localnsv/mAIware-server/public/dashboard.html::request_2d995c41-e4fb-4a32-8754-875cabc8f1e3",{"uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware-server/public/dashboard.html","external":"file:///home/trang/localnsv/mAIware-server/public/dashboard.html","path":"/home/trang/localnsv/mAIware-server/public/dashboard.html","scheme":"file"},"requestId":"request_2d995c41-e4fb-4a32-8754-875cabc8f1e3","content":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>mAIware Server Dashboard</title>\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css\">\n    <link rel=\"stylesheet\" href=\"styles.css?v=3.0\">\n    <!-- Add Chart.js -->\n    <script src=\"https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js\"></script>\n    <!-- Add Leaflet.js for maps -->\n    <link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.9.4/dist/leaflet.css\" />\n    <script src=\"https://unpkg.com/leaflet@1.9.4/dist/leaflet.js\"></script>\n    <!-- Add Leaflet Heatmap Plugin -->\n    <script src=\"https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js\"></script>\n    <!-- Add D3.js for force-directed graph -->\n    <script src=\"https://d3js.org/d3.v7.min.js\"></script>\n    <!-- Add html2canvas for screenshots -->\n    <script src=\"https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js\"></script>\n</head>\n<body>\n    <!-- Theme Toggle Button -->\n    <button class=\"theme-toggle\" id=\"themeToggle\" onclick=\"toggleTheme()\">\n        <span class=\"icon\" id=\"themeIcon\"></span>\n        <span id=\"themeText\">Dark</span>\n    </button>\n\n    <!-- Preview Backdrop -->\n    <div class=\"preview-backdrop\" id=\"previewBackdrop\"></div>\n\n    <!-- Side Navigation Panel -->\n    <div class=\"side-panel\" id=\"sidePanel\">\n        <!-- Logo Icon (always visible) -->\n        <div class=\"panel-icon-strip\">\n            <div class=\"panel-logo-icon\">\n                <i class=\"fas fa-shield-virus\"></i>\n            </div>\n        </div>\n        \n        <!-- Analytics Preview Panel (slides out on hover) -->\n        <div class=\"graphs-preview\" id=\"graphsPreview\">\n            <div class=\"preview-header\">\n                <h3><i class=\"fas fa-chart-line\"></i> Analytics Preview</h3>\n                <p>Click anywhere to view full analytics</p>\n            </div>\n            \n            <!-- Scaled-down live view of analytics -->\n            <div class=\"analytics-miniview\" id=\"analyticsMiniview\" onclick=\"switchView('analytics')\">\n                <div class=\"miniview-preview\">\n                    <div class=\"preview-row\">\n                        <div class=\"preview-box large\">\n                            <div class=\"box-header\">Global Threat Map</div>\n                            <div class=\"box-content map-visual\">\n                                <div class=\"map-dot\" style=\"top: 30%; left: 40%;\"></div>\n                                <div class=\"map-dot\" style=\"top: 60%; left: 70%;\"></div>\n                                <div class=\"map-dot\" style=\"top: 45%; left: 25%;\"></div>\n                            </div>\n                        </div>\n                        <div class=\"preview-box large\">\n                            <div class=\"box-header\">Attack Timeline</div>\n                            <div class=\"box-content chart-visual\">\n                                <div class=\"chart-bar\" style=\"height: 40%;\"></div>\n                                <div class=\"chart-bar\" style=\"height: 70%;\"></div>\n                                <div class=\"chart-bar\" style=\"height: 55%;\"></div>\n                                <div class=\"chart-bar\" style=\"height: 85%;\"></div>\n                            </div>\n                        </div>\n                    </div>\n                    <div class=\"preview-row\">\n                        <div class=\"preview-box\">\n                            <div class=\"box-header\">Top Threats</div>\n                            <div class=\"box-content list-visual\">\n                                <div class=\"list-item\"></div>\n                                <div class=\"list-item\"></div>\n                                <div class=\"list-item\"></div>\n                            </div>\n                        </div>\n                        <div class=\"preview-box\">\n                            <div class=\"box-header\">Correlations</div>\n                            <div class=\"box-content network-visual\">\n                                <div class=\"network-node\" style=\"top: 30%; left: 30%;\"></div>\n                                <div class=\"network-node\" style=\"top: 60%; left: 50%;\"></div>\n                                <div class=\"network-node\" style=\"top: 45%; left: 70%;\"></div>\n                            </div>\n                        </div>\n                        <div class=\"preview-box\">\n                            <div class=\"box-header\">Heatmap</div>\n                            <div class=\"box-content heat-visual\"></div>\n                        </div>\n                    </div>\n                    <div class=\"preview-row\">\n                        <div class=\"preview-box wide\">\n                            <div class=\"box-header\">File Analysis & Distribution</div>\n                            <div class=\"box-content pie-visual\">\n                                <div class=\"pie-chart\"></div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <div class=\"miniview-overlay\">\n                    <i class=\"fas fa-expand-alt\"></i>\n                    <span>Click to view analytics</span>\n                </div>\n            </div>                <!-- Home Navigation Button -->\n                <div class=\"preview-home-nav\" id=\"homeNavBtn\" onclick=\"switchView('dashboard')\">\n                    <i class=\"fas fa-home\"></i>\n                    <span>Back to Dashboard</span>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <div class=\"main-content\" id=\"mainContent\">\n        <!-- DASHBOARD VIEW -->\n        <div class=\"view-container active\" id=\"dashboardView\">\n            <header class=\"dashboard-header\">\n                <div class=\"header-content\">\n                    <h1><i class=\"fas fa-shield-virus pulse-icon\"></i> mAIware Server</h1>\n                    <p class=\"subtitle\">Real-time Malware Analysis Dashboard</p>\n                </div>\n            </header>\n            \n            <!-- Real-time Threat Ticker -->\n            <div class=\"threat-ticker-container animate-slide-in\">\n                <div class=\"ticker-label\">\n                    <i class=\"fas fa-broadcast-tower pulse-icon\"></i>\n                    <span>LIVE THREAT FEED</span>\n                </div>\n                <div class=\"threat-ticker\" id=\"threat-ticker\">\n                    <div class=\"ticker-content\" id=\"ticker-content\">\n                        <span class=\"ticker-item\">System ready - Monitoring for threats...</span>\n                    </div>\n                </div>\n            </div>\n            \n            <!-- Notification Toast Container -->\n            <div id=\"notification-container\" class=\"notification-container\"></div>\n            \n            <!-- Stats Grid -->\n            <div class=\"stats-grid animate-fade-in\" id=\"stats-grid\">\n                <div class=\"stat-card info\">\n                    <i class=\"fas fa-laptop\"></i>\n                    <span class=\"stat-number\" id=\"stat-clients\">0</span>\n                    <span class=\"stat-label\">Active Clients</span>\n                    <div class=\"stat-glow\"></div>\n                </div>\n                <div class=\"stat-card info\">\n                    <i class=\"fas fa-chart-line\"></i>\n                    <span class=\"stat-number\" id=\"stat-total\">0</span>\n                    <span class=\"stat-label\">Total Scans</span>\n                    <div class=\"stat-glow\"></div>\n                </div>\n                <div class=\"stat-card malware\">\n                    <i class=\"fas fa-bug\"></i>\n                    <span class=\"stat-number\" id=\"stat-malware\">0</span>\n                    <span class=\"stat-label\">Malware</span>\n                    <div class=\"stat-glow\"></div>\n                </div>\n                <div class=\"stat-card suspicious\">\n                    <i class=\"fas fa-exclamation-triangle\"></i>\n                    <span class=\"stat-number\" id=\"stat-suspicious\">0</span>\n                    <span class=\"stat-label\">Suspicious</span>\n                    <div class=\"stat-glow\"></div>\n                </div>\n                <div class=\"stat-card benign\">\n                    <i class=\"fas fa-check-circle\"></i>\n                    <span class=\"stat-number\" id=\"stat-benign\">0</span>\n                    <span class=\"stat-label\">Benign</span>\n                    <div class=\"stat-glow\"></div>\n                </div>\n            </div>\n            \n            <!-- Recent Scans -->\n            <div class=\"scans-container animate-fade-in\">\n                <div class=\"scans-header\">\n                    <h2><i class=\"fas fa-list\"></i> Recent Scans</h2>\n                    <button class=\"refresh-btn\" onclick=\"manualRefresh()\">\n                        <i class=\"fas fa-sync-alt\"></i> Refresh\n                    </button>\n                </div>\n                \n                <table class=\"scans-table\">\n                    <thead>\n                        <tr>\n                            <th>Timestamp</th>\n                            <th>Filename</th>\n                            <th>Classification</th>\n                            <th>Client IP</th>\n                            <th>Hash (SHA256)</th>\n                        </tr>\n                    </thead>\n                    <tbody id=\"scans-tbody\">\n                        <tr>\n                            <td colspan=\"5\" class=\"empty-state\">\n                                <i class=\"fas fa-inbox\"></i>\n                                <p>No scans yet. Waiting for clients...</p>\n                            </td>\n                        </tr>\n                    </tbody>\n                </table>\n            </div>\n        </div>\n\n        <!-- ANALYTICS VIEW -->\n        <div class=\"view-container\" id=\"analyticsView\">\n            <div class=\"analytics-header\">\n                <button class=\"back-btn\" onclick=\"switchView('dashboard')\">\n                    <i class=\"fas fa-arrow-left\"></i> Back to Dashboard\n                </button>\n                <h1><i class=\"fas fa-chart-line\"></i> Analytics & Intelligence</h1>\n            </div>\n            \n            <div class=\"analytics-grid\" id=\"analyticsGrid\">\n                \n                <!-- Daily Analysis Chart -->\n                <div class=\"chart-container analytics-panel panel-large\">\n                    <div class=\"chart-header\">\n                        <h2><i class=\"fas fa-chart-line\"></i> Daily Analysis Trends</h2>\n                        <div class=\"chart-controls\">\n                            <button class=\"chart-btn active\" onclick=\"setChartDays(7)\">7 Days</button>\n                            <button class=\"chart-btn\" onclick=\"setChartDays(14)\">14 Days</button>\n                            <button class=\"chart-btn\" onclick=\"setChartDays(30)\">30 Days</button>\n                        </div>\n                    </div>\n                    <canvas id=\"dailyScansChart\"></canvas>\n                </div>\n                    <canvas id=\"dailyScansChart\"></canvas>\n                </div>\n\n                <!-- Geographic Threat Intelligence Map -->\n                <div class=\"map-container analytics-panel panel-large\">\n                    <div class=\"map-header\">\n                        <h2><i class=\"fas fa-globe-americas\"></i> Global Threat Intelligence Map</h2>\n                        <div class=\"map-controls\">\n                            <div class=\"map-view-toggle\">\n                                <button class=\"map-btn active\" data-view=\"markers\" onclick=\"switchMapView('markers')\">\n                                    <i class=\"fas fa-map-marker-alt\"></i> Markers\n                                </button>\n                                <button class=\"map-btn\" data-view=\"heatmap\" onclick=\"switchMapView('heatmap')\">\n                                    <i class=\"fas fa-fire\"></i> Heatmap\n                                </button>\n                                <button class=\"map-btn\" data-view=\"choropleth\" onclick=\"switchMapView('choropleth')\">\n                                    <i class=\"fas fa-globe\"></i> Choropleth\n                                </button>\n                            </div>\n                            <div class=\"map-legend\">\n                                <span class=\"legend-item\"><span class=\"legend-dot malware-dot\"></span> Malware</span>\n                                <span class=\"legend-item\"><span class=\"legend-dot suspicious-dot\"></span> Suspicious</span>\n                                <span class=\"legend-item\"><span class=\"legend-dot benign-dot\"></span> Benign</span>\n                            </div>\n                        </div>\n                    </div>\n                    \n                    <!-- Geographic Context Panel -->\n                    <div class=\"geo-context-panel\" id=\"geoContext\">\n                        <div class=\"context-stat\">\n                            <span class=\"context-label\">Active Regions:</span>\n                            <span class=\"context-value\" id=\"activeRegions\">0</span>\n                        </div>\n                        <div class=\"context-stat\">\n                            <span class=\"context-label\">Hotspot:</span>\n                            <span class=\"context-value\" id=\"topRegion\">None</span>\n                        </div>\n                        <div class=\"context-stat\">\n                            <span class=\"context-label\">Total Threats:</span>\n                            <span class=\"context-value threat-count\" id=\"geoThreatCount\">0</span>\n                        </div>\n                    </div>\n                    \n                    <div id=\"worldMap\" style=\"height: 500px; border-radius: 8px; margin-bottom: 15px;\"></div>\n                    \n                    <!-- Timeline Control -->\n                    <div class=\"map-timeline-control\">\n                        <button class=\"timeline-btn\" onclick=\"replayThreats()\" id=\"replayBtn\">\n                            <i class=\"fas fa-play\"></i> Replay Last 24h\n                        </button>\n                        <div class=\"timeline-info\" id=\"timelineInfo\">\n                            Click replay to see threat propagation over time\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Malware Source Distribution -->\n                <div class=\"chart-container analytics-panel panel-small\">\n                    <div class=\"chart-header\">\n                        <h2><i class=\"fas fa-chart-pie\"></i> Malware Source Distribution</h2>\n                    </div>\n                    <div style=\"max-width: 500px; margin: 0 auto;\">\n                        <canvas id=\"malwareSourceChart\"></canvas>\n                    </div>\n                </div>\n\n                <!-- Graph 2: \"Noisiest\" Agents Over Time -->\n                <div class=\"chart-container analytics-panel panel-large\">\n                    <div class=\"chart-header\">\n                        <h2><i class=\"fas fa-desktop\"></i> \"Noisiest\" Agents Over Time</h2>\n                        <p class=\"chart-subtitle\">Threat detection trends for top 5 high-risk agents</p>\n                    </div>\n                    <div style=\"height: 300px;\">\n                        <canvas id=\"noisyAgentsChart\"></canvas>\n                    </div>\n                </div>\n\n                <!-- Advanced Analytics Grid -->\n                <div class=\"analytics-panel panel-large advanced-analytics-grid\">\n                    <div class=\"chart-header\">\n                        <h2><i class=\"fas fa-chart-area\"></i> Advanced Statistical Analysis</h2>\n                        <p class=\"chart-subtitle\">Deep dive into signature verification, packer usage, AI confidence, and entropy patterns</p>\n                    </div>\n                    \n                    <div class=\"mini-charts-grid\">\n                        <!-- Graph 3: Signature Status vs. Classification -->\n                        <div class=\"mini-chart-container\">\n                            <h3><i class=\"fas fa-certificate\"></i> Signature vs. Classification</h3>\n                            <div style=\"height: 200px;\">\n                                <canvas id=\"signatureClassChart\"></canvas>\n                            </div>\n                        </div>\n\n                        <!-- Graph 4: Packer Usage vs. Classification -->\n                        <div class=\"mini-chart-container\">\n                            <h3><i class=\"fas fa-box\"></i> Packer vs. Classification</h3>\n                            <div style=\"height: 200px;\">\n                                <canvas id=\"packerClassChart\"></canvas>\n                            </div>\n                        </div>\n\n                        <!-- Graph 5: Confidence Score Distribution -->\n                        <div class=\"mini-chart-container\">\n                            <h3><i class=\"fas fa-brain\"></i> AI Confidence Distribution</h3>\n                            <div style=\"height: 200px;\">\n                                <canvas id=\"confidenceHistChart\"></canvas>\n                            </div>\n                        </div>\n\n                        <!-- Graph 6: File Entropy Distribution -->\n                        <div class=\"mini-chart-container\">\n                            <h3><i class=\"fas fa-chart-bar\"></i> Entropy Distribution</h3>\n                            <div style=\"height: 200px;\">\n                                <canvas id=\"entropyBoxChart\"></canvas>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Threat Vector Correlation Explorer -->\n                <div class=\"correlation-container analytics-panel panel-large\">\n                    <div class=\"correlation-header\">\n                        <h2><i class=\"fas fa-project-diagram\"></i> Threat Vector Correlation Explorer</h2>\n                        <p class=\"correlation-subtitle\">Interactive intelligence map showing relationships between malware families, agents, APIs, and indicators</p>\n                    </div>\n                    <div class=\"graph-controls\">\n                        <button class=\"graph-btn\" onclick=\"resetGraph()\"><i class=\"fas fa-sync\"></i> Reset View</button>\n                        <button class=\"graph-btn\" onclick=\"centerGraph()\"><i class=\"fas fa-compress\"></i> Center</button>\n                        <div class=\"graph-legend\">\n                            <span class=\"legend-item\"><span class=\"node-sample malware-node\"></span> Malware Family</span>\n                            <span class=\"legend-item\"><span class=\"node-sample agent-node\"></span> Agent/System</span>\n                            <span class=\"legend-item\"><span class=\"node-sample api-node\"></span> API Call</span>\n                            <span class=\"legend-item\"><span class=\"node-sample string-node\"></span> Suspicious String</span>\n                        </div>\n                    </div>\n                    <div id=\"correlationGraph\"></div>\n                    <div id=\"nodeDetails\" class=\"node-details\" style=\"display: none;\">\n                        <h3 id=\"detailsTitle\"></h3>\n                        <div id=\"detailsContent\"></div>\n                    </div>\n                </div>\n\n                <!-- Emerging Threat Intelligence Panel -->\n                <div class=\"eti-container analytics-panel panel-large\">\n                    <div class=\"eti-header\">\n                        <h2><i class=\"fas fa-exclamation-triangle\"></i> Emerging Threat Intelligence (ETI)</h2>\n                        <p class=\"eti-subtitle\">Real-time actionable intelligence on active threats and indicators of compromise</p>\n                        <div class=\"eti-summary\">\n                            <span class=\"eti-badge\" id=\"eti-total\">0 Total Threats</span>\n                            <span class=\"eti-badge recent\" id=\"eti-recent\">0 Last 24h</span>\n                        </div>\n                    </div>\n                    \n                    <div class=\"eti-grid\">\n                        <div class=\"eti-panel\">\n                            <h3><i class=\"fas fa-virus\"></i> Top Malware Families</h3>\n                            <div class=\"eti-subtitle-small\">Most active malware families detected</div>\n                            <div id=\"eti-malware\" class=\"eti-list\"></div>\n                        </div>\n                        \n                        <div class=\"eti-panel\">\n                            <h3><i class=\"fas fa-code\"></i> Top Suspicious APIs</h3>\n                            <div class=\"eti-subtitle-small\">Most frequently called malicious APIs</div>\n                            <div id=\"eti-apis\" class=\"eti-list\"></div>\n                        </div>\n                        \n                        <div class=\"eti-panel\">\n                            <h3><i class=\"fas fa-terminal\"></i> Top Malicious Strings</h3>\n                            <div class=\"eti-subtitle-small\">Most common IOC strings and commands</div>\n                            <div id=\"eti-strings\" class=\"eti-list\"></div>\n                        </div>\n                        \n                        <div class=\"eti-panel\">\n                            <h3><i class=\"fas fa-shield-alt\"></i> Top Packers/Obfuscators</h3>\n                            <div class=\"eti-subtitle-small\">Most used evasion techniques</div>\n                            <div id=\"eti-packers\" class=\"eti-list\"></div>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Predictive Threat Modeler -->\n                <div class=\"modeler-container analytics-panel panel-large\">\n                    <div class=\"modeler-header\">\n                        <h2><i class=\"fas fa-flask\"></i> Predictive Threat Modeler</h2>\n                        <p class=\"modeler-subtitle\">Build hypothetical malware and predict how mAIware would classify it</p>\n                    </div>\n                    \n                    <div class=\"modeler-grid\">\n                <div class=\"modeler-builder\">\n                    <h3><i class=\"fas fa-cogs\"></i> Threat Configuration</h3>\n                    \n                    <div class=\"modeler-field\">\n                        <label>File Type</label>\n                        <select id=\"model-filetype\" class=\"modeler-select\">\n                            <option>PE32+ (GUI) x86-64</option>\n                            <option>PE32 (Console) Intel 80386</option>\n                            <option>PE32+ DLL x86-64</option>\n                            <option>MSI Installer</option>\n                            <option>PDF Document</option>\n                        </select>\n                    </div>\n                    \n                    <div class=\"modeler-field\">\n                        <label>Packer/Obfuscator</label>\n                        <select id=\"model-packer\" class=\"modeler-select\">\n                            <option>None</option>\n                            <option>UPX</option>\n                            <option>VMProtect</option>\n                            <option>Themida</option>\n                            <option>ASPack</option>\n                            <option>Unknown (High Entropy)</option>\n                        </select>\n                    </div>\n                    \n                    <div class=\"modeler-field\">\n                        <label>Digital Signature</label>\n                        <select id=\"model-signature\" class=\"modeler-select\">\n                            <option>Verified (Microsoft Corporation)</option>\n                            <option>Verified (Google LLC)</option>\n                            <option>Verified (Unknown Publisher)</option>\n                            <option>Not Signed</option>\n                            <option>Expired Certificate</option>\n                            <option>Self-Signed (Untrusted)</option>\n                        </select>\n                    </div>\n                    \n                    <div class=\"modeler-field\">\n                        <label>API Imports (select multiple)</label>\n                        <select id=\"model-apis\" class=\"modeler-select\" multiple size=\"6\">\n                            <option>CreateRemoteThread</option>\n                            <option>WriteProcessMemory</option>\n                            <option>VirtualAllocEx</option>\n                            <option>SetWindowsHookExW</option>\n                            <option>URLDownloadToFileW</option>\n                            <option>WinExec</option>\n                            <option>RegSetValueExW</option>\n                            <option>CryptEncrypt</option>\n                            <option>Socket</option>\n                            <option>ReadFile</option>\n                        </select>\n                        <small class=\"modeler-hint\">Hold Ctrl/Cmd to select multiple</small>\n                    </div>\n                    \n                    <div class=\"modeler-field\">\n                        <label>Suspicious Strings (select multiple)</label>\n                        <select id=\"model-strings\" class=\"modeler-select\" multiple size=\"6\">\n                            <option>http://bad-c2-server.com/payload.dat</option>\n                            <option>keylog.txt</option>\n                            <option>steal_passwords</option>\n                            <option>powershell -enc</option>\n                            <option>vssadmin.exe delete shadows</option>\n                            <option>HOW_TO_DECRYPT.txt</option>\n                            <option>crack</option>\n                            <option>patch</option>\n                            <option>disable_antivirus</option>\n                        </select>\n                        <small class=\"modeler-hint\">Hold Ctrl/Cmd to select multiple</small>\n                    </div>\n                    \n                    <button class=\"modeler-analyze-btn\" onclick=\"analyzeThreatModel()\">\n                        <i class=\"fas fa-brain\"></i> ANALYZE THREAT\n                    </button>\n                </div>\n                \n                <div class=\"modeler-results\">\n                    <h3><i class=\"fas fa-chart-line\"></i> Prediction Results</h3>\n                    <div id=\"modeler-output\" class=\"modeler-output\">\n                        <div class=\"modeler-placeholder\">\n                            <i class=\"fas fa-arrow-left\"></i>\n                            <p>Configure a threat profile and click ANALYZE to see predictions</p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        \n            </div>\n        </div>\n    </div>\n    \n    <script>\n        // Helper function to get CSS variable values dynamically for theming\n        function getCSSVar(varName) {\n            return getComputedStyle(document.documentElement).getPropertyValue(varName).trim();\n        }\n\n        // View Switching System\n        function switchView(viewName) {\n            const views = document.querySelectorAll('.view-container');\n            \n            views.forEach(view => {\n                view.classList.remove('active');\n                if (view.id === `${viewName}View`) {\n                    view.classList.add('active');\n                }\n            });\n            \n            currentView = viewName;\n            \n            // Fix map display when switching to analytics view\n            if (viewName === 'analytics') {\n                setTimeout(() => {\n                    if (worldMap) {\n                        worldMap.invalidateSize();\n                    }\n                    // Capture screenshot for preview after charts have rendered\n                    setTimeout(() => {\n                        createAnalyticsMiniview();\n                    }, 1500);\n                }, 100);\n            }\n            \n            // Close graphs preview when switching views\n            document.getElementById('graphsPreview').classList.remove('show');\n            document.getElementById('previewBackdrop').classList.remove('show');\n        }\n        \n        // Side Panel Hover System\n        const sidePanel = document.getElementById('sidePanel');\n        const graphsPreview = document.getElementById('graphsPreview');\n        const previewBackdrop = document.getElementById('previewBackdrop');\n        const homeNavBtn = document.getElementById('homeNavBtn');\n        let previewTimeout;\n        let previewsRendered = false;\n        let currentView = 'dashboard';\n        \n        // Show preview panel on sidebar hover\n        sidePanel.addEventListener('mouseenter', () => {\n            clearTimeout(previewTimeout);\n            previewTimeout = setTimeout(() => {\n                graphsPreview.classList.add('show');\n                previewBackdrop.classList.add('show');\n                \n                // Show/hide home button based on current view\n                if (currentView === 'analytics') {\n                    homeNavBtn.classList.add('visible');\n                } else {\n                    homeNavBtn.classList.remove('visible');\n                }\n            }, 200);\n        });\n        \n        sidePanel.addEventListener('mouseleave', () => {\n            clearTimeout(previewTimeout);\n            setTimeout(() => {\n                if (!graphsPreview.matches(':hover')) {\n                    graphsPreview.classList.remove('show');\n                    previewBackdrop.classList.remove('show');\n                }\n            }, 100);\n        });\n        \n        // Keep preview open when hovering over it\n        graphsPreview.addEventListener('mouseleave', () => {\n            graphsPreview.classList.remove('show');\n            previewBackdrop.classList.remove('show');\n        });\n        \n        // Close preview when clicking backdrop\n        previewBackdrop.addEventListener('click', () => {\n            graphsPreview.classList.remove('show');\n            previewBackdrop.classList.remove('show');\n        });\n        \n        // Create analytics miniview by taking a screenshot\n        let isCapturingSnapshot = false;\n        let hasInitialSnapshot = false;\n        \n        async function createAnalyticsMiniview() {\n            // Simplified - no actual screenshot, just a visual preview\n            hasInitialSnapshot = true;\n        }\n        \n        // Auto-scroll on hover down in analytics view\n        let scrollInterval;\n        const analyticsGrid = document.getElementById('analyticsGrid');\n        \n        if (analyticsGrid) {\n            analyticsGrid.addEventListener('mousemove', (e) => {\n                const rect = analyticsGrid.getBoundingClientRect();\n                const mouseY = e.clientY - rect.top;\n                const triggerZone = 100; // pixels from bottom\n                \n                if (rect.height - mouseY < triggerZone) {\n                    if (!scrollInterval) {\n                        scrollInterval = setInterval(() => {\n                            analyticsGrid.scrollBy({ top: 2, behavior: 'smooth' });\n                        }, 16);\n                    }\n                } else {\n                    if (scrollInterval) {\n                        clearInterval(scrollInterval);\n                        scrollInterval = null;\n                    }\n                }\n            });\n            \n            analyticsGrid.addEventListener('mouseleave', () => {\n                if (scrollInterval) {\n                    clearInterval(scrollInterval);\n                    scrollInterval = null;\n                }\n            });\n        }\n        \n        // Theme Toggle\n        window.toggleTheme = function() {\n            const html = document.documentElement;\n            const themeIcon = document.getElementById('themeIcon');\n            const themeText = document.getElementById('themeText');\n            \n            const currentTheme = html.getAttribute('data-theme');\n            \n            if (currentTheme === 'light') {\n                html.setAttribute('data-theme', '');\n                themeIcon.textContent = '';\n                themeText.textContent = 'Dark';\n                localStorage.setItem('theme', 'dark');\n            } else {\n                html.setAttribute('data-theme', 'light');\n                themeIcon.textContent = '';\n                themeText.textContent = 'Light';\n                localStorage.setItem('theme', 'light');\n            }\n        };\n        \n        // Load saved theme\n        const savedTheme = localStorage.getItem('theme');\n        if (savedTheme === 'light') {\n            document.documentElement.setAttribute('data-theme', 'light');\n            document.getElementById('themeIcon').textContent = '';\n            document.getElementById('themeText').textContent = 'Light';\n        }\n        \n        let dailyChart = null;\n        let currentChartDays = 30;\n        \n        // Notification and Animation System\n        const notificationQueue = [];\n        let isShowingNotification = false;\n        \n        function showThreatNotification(scan) {\n            const container = document.getElementById('notification-container');\n            \n            const classColor = \n                scan.classification === 'Malware' ? '#ff4757' :\n                scan.classification === 'Suspicious' ? '#ffa502' : '#26de81';\n            \n            const icon = \n                scan.classification === 'Malware' ? 'fa-skull-crossbones' :\n                scan.classification === 'Suspicious' ? 'fa-exclamation-triangle' : 'fa-check-circle';\n            \n            const notification = document.createElement('div');\n            notification.className = 'threat-notification';\n            notification.style.borderLeftColor = classColor;\n            notification.innerHTML = `\n                <div class=\"notification-icon\" style=\"color: ${classColor};\">\n                    <i class=\"fas ${icon}\"></i>\n                </div>\n                <div class=\"notification-content\">\n                    <div class=\"notification-title\">\n                        <strong>${scan.classification}</strong> detected\n                    </div>\n                    <div class=\"notification-details\">\n                        ${scan.detected_filename}\n                        ${scan.malware_family ? ` - ${scan.malware_family}` : ''}\n                    </div>\n                    <div class=\"notification-meta\">\n                        <i class=\"fas fa-desktop\"></i> ${scan.systemInfo?.hostname || scan.clientIp || 'Unknown'}\n                    </div>\n                </div>\n                <div class=\"notification-close\" onclick=\"this.parentElement.remove()\">\n                    <i class=\"fas fa-times\"></i>\n                </div>\n            `;\n            \n            container.appendChild(notification);\n            \n            // Animate in\n            setTimeout(() => notification.classList.add('show'), 10);\n            \n            // Auto-remove after 8 seconds\n            setTimeout(() => {\n                notification.classList.remove('show');\n                setTimeout(() => notification.remove(), 300);\n            }, 8000);\n        }\n        \n        function addToThreatTicker(scan) {\n            const ticker = document.getElementById('ticker-content');\n            const timestamp = new Date(scan.serverTimestamp).toLocaleTimeString();\n            \n            const classColor = \n                scan.classification === 'Malware' ? '#ff4757' :\n                scan.classification === 'Suspicious' ? '#ffa502' : '#26de81';\n            \n            const tickerItem = document.createElement('span');\n            tickerItem.className = 'ticker-item';\n            tickerItem.style.color = classColor;\n            tickerItem.innerHTML = `\n                <i class=\"fas fa-circle\"></i>\n                [${timestamp}] ${scan.classification}: ${scan.detected_filename}\n                ${scan.malware_family ? `(${scan.malware_family})` : ''}\n                on ${scan.systemInfo?.hostname || scan.clientIp || 'Unknown'}\n            `;\n            \n            ticker.appendChild(tickerItem);\n            \n            // Keep only last 10 items\n            while (ticker.children.length > 10) {\n                ticker.removeChild(ticker.firstChild);\n            }\n        }\n        \n        function animateStatCard(elementId, newValue) {\n            const element = document.getElementById(elementId);\n            if (!element) return;\n            \n            const currentValue = parseInt(element.textContent) || 0;\n            if (newValue > currentValue) {\n                // Pulse animation\n                element.parentElement.classList.add('stat-pulse');\n                setTimeout(() => element.parentElement.classList.remove('stat-pulse'), 600);\n                \n                // Animate number increment\n                const duration = 500;\n                const steps = 20;\n                const increment = (newValue - currentValue) / steps;\n                let current = currentValue;\n                let step = 0;\n                \n                const interval = setInterval(() => {\n                    step++;\n                    current += increment;\n                    element.textContent = Math.round(current);\n                    \n                    if (step >= steps) {\n                        element.textContent = newValue;\n                        clearInterval(interval);\n                    }\n                }, duration / steps);\n            } else {\n                element.textContent = newValue;\n            }\n        }\n        \n        async function loadStats() {\n            try {\n                const response = await fetch('/api/stats');\n                const stats = await response.json();\n                \n                animateStatCard('stat-clients', stats.activeClients);\n                animateStatCard('stat-total', stats.totalScans);\n                animateStatCard('stat-malware', stats.malwareCount);\n                animateStatCard('stat-suspicious', stats.suspiciousCount);\n                animateStatCard('stat-benign', stats.benignCount);\n            } catch (error) {\n                console.error('Failed to load stats:', error);\n            }\n        }\n        \n        async function loadScans() {\n            try {\n                const response = await fetch('/api/scans?limit=50');\n                const data = await response.json();\n                \n                const tbody = document.getElementById('scans-tbody');\n                \n                if (data.scans.length === 0) {\n                    tbody.innerHTML = `\n                        <tr>\n                            <td colspan=\"5\" class=\"empty-state\">\n                                <i class=\"fas fa-inbox\"></i>\n                                <p>No scans yet. Waiting for clients...</p>\n                            </td>\n                        </tr>\n                    `;\n                    return;\n                }\n                \n                tbody.innerHTML = data.scans.map(scan => {\n                    const timestamp = new Date(scan.serverTimestamp).toLocaleString();\n                    const hash = scan.file_hashes?.sha256 || 'N/A';\n                    const hashShort = hash.length > 16 ? (hash.substring(0, 16) + '...') : hash;\n                    const isNonPe = scan.is_pe === false;\n                    const classification = isNonPe ? 'Non-PE' : (scan.classification || 'Unknown');\n                    const badgeClass = isNonPe ? 'non-pe' : classification.toLowerCase();\n                    const nonPeTag = isNonPe ? '<span class=\"badge non-pe\" title=\"Non-PE file\">Non-PE</span>' : '';\n                    return `\n                        <tr>\n                            <td>${timestamp}</td>\n                            <td>${scan.detected_filename} ${nonPeTag}</td>\n                            <td><span class=\"badge ${badgeClass}\">${classification}</span></td>\n                            <td>${scan.systemInfo?.ip || scan.clientIp || 'Unknown'}</td>\n                            <td class=\"hash\" title=\"${hash}\">${hashShort}</td>\n                        </tr>\n                    `;\n                }).join('');\n                \n            } catch (error) {\n                console.error('Failed to load scans:', error);\n            }\n        }\n        \n        async function loadDailyChart() {\n            try {\n                const response = await fetch(`/api/daily-scans?days=${currentChartDays}`);\n                const data = await response.json();\n                \n                const ctx = document.getElementById('dailyScansChart');\n                \n                // Destroy existing chart if it exists\n                if (dailyChart) {\n                    dailyChart.destroy();\n                }\n                \n                // Format dates for display (MM/DD)\n                const labels = data.days.map(day => {\n                    const date = new Date(day.date);\n                    return `${date.getMonth() + 1}/${date.getDate()}`;\n                });\n                \n                dailyChart = new Chart(ctx, {\n                    type: 'line',\n                    data: {\n                        labels: labels,\n                        datasets: [\n                            {\n                                label: 'Total Scans',\n                                data: data.days.map(d => d.total),\n                                borderColor: '#5a9cf8',\n                                backgroundColor: 'rgba(90, 156, 248, 0.1)',\n                                fill: true,\n                                tension: 0.4,\n                                borderWidth: 2\n                            },\n                            {\n                                label: 'Malware',\n                                data: data.days.map(d => d.malware),\n                                borderColor: '#ff4757',\n                                backgroundColor: 'rgba(255, 71, 87, 0.1)',\n                                fill: true,\n                                tension: 0.4,\n                                borderWidth: 2\n                            },\n                            {\n                                label: 'Suspicious',\n                                data: data.days.map(d => d.suspicious),\n                                borderColor: '#ffa502',\n                                backgroundColor: 'rgba(255, 165, 2, 0.1)',\n                                fill: true,\n                                tension: 0.4,\n                                borderWidth: 2\n                            },\n                            {\n                                label: 'Benign',\n                                data: data.days.map(d => d.benign),\n                                borderColor: '#26de81',\n                                backgroundColor: 'rgba(38, 222, 129, 0.1)',\n                                fill: true,\n                                tension: 0.4,\n                                borderWidth: 2\n                            }\n                        ]\n                    },\n                    options: {\n                        responsive: true,\n                        maintainAspectRatio: false,\n                        interaction: {\n                            mode: 'index',\n                            intersect: false,\n                        },\n                        plugins: {\n                            legend: {\n                                labels: {\n                                    color: getCSSVar('--chart-text-color') || '#e0e0e0',\n                                    font: { size: 12 }\n                                }\n                            },\n                            tooltip: {\n                                backgroundColor: 'rgba(0, 0, 0, 0.8)',\n                                titleColor: '#fff',\n                                bodyColor: '#e0e0e0',\n                                borderColor: 'rgba(255, 255, 255, 0.1)',\n                                borderWidth: 1\n                            }\n                        },\n                        scales: {\n                            x: {\n                                ticks: { \n                                    color: getCSSVar('--chart-text-color') || '#888',\n                                    maxRotation: 45,\n                                    minRotation: 45\n                                },\n                                grid: { \n                                    color: getCSSVar('--chart-grid-color') || 'rgba(255, 255, 255, 0.05)' \n                                }\n                            },\n                            y: {\n                                beginAtZero: true,\n                                ticks: { \n                                    color: getCSSVar('--chart-text-color') || '#888',\n                                    stepSize: 1\n                                },\n                                grid: { \n                                    color: getCSSVar('--chart-grid-color') || 'rgba(255, 255, 255, 0.05)' \n                                }\n                            }\n                        }\n                    }\n                });\n                \n            } catch (error) {\n                console.error('Failed to load daily chart:', error);\n            }\n        }\n        \n        let worldMap = null;\n        let markerLayer = null;\n        let heatmapLayer = null;\n        let choroplethLayer = null;\n        let mapInitialized = false;\n        let lastGeoDataHash = '';\n        let sourceChart = null;\n        let currentMapView = 'markers';\n        let geoDataCache = null;\n        let replayInterval = null;\n        \n        // Country boundaries for choropleth (simplified)\n        const countryCoordinates = {\n            'United States': { center: [37.0902, -95.7129], weight: 0 },\n            'China': { center: [35.8617, 104.1954], weight: 0 },\n            'United Kingdom': { center: [55.3781, -3.4360], weight: 0 },\n            'Germany': { center: [51.1657, 10.4515], weight: 0 },\n            'France': { center: [46.2276, 2.2137], weight: 0 },\n            'Russia': { center: [61.5240, 105.3188], weight: 0 },\n            'Japan': { center: [36.2048, 138.2529], weight: 0 },\n            'India': { center: [20.5937, 78.9629], weight: 0 },\n            'Brazil': { center: [-14.2350, -51.9253], weight: 0 },\n            'Australia': { center: [-25.2744, 133.7751], weight: 0 }\n        };\n        \n        function initializeMap() {\n            if (mapInitialized) return;\n            \n            try {\n                worldMap = L.map('worldMap', {\n                    zoomControl: true,\n                    scrollWheelZoom: true,\n                    preferCanvas: false,\n                    worldCopyJump: true\n                }).setView([20, 0], 2);\n                \n                // Use dark theme tiles\n                L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {\n                    attribution: '&copy; OpenStreetMap contributors',\n                    subdomains: 'abcd',\n                    maxZoom: 18,\n                    minZoom: 1,\n                    noWrap: false,\n                    bounds: [[-90, -180], [90, 180]]\n                }).addTo(worldMap);\n                \n                markerLayer = L.layerGroup().addTo(worldMap);\n                mapInitialized = true;\n                \n                // Fix map display after initialization\n                setTimeout(() => {\n                    if (worldMap) worldMap.invalidateSize();\n                }, 100);\n            } catch (error) {\n                console.error('Failed to initialize map:', error);\n            }\n        }\n        \n        // Switch between map visualization modes\n        window.switchMapView = function(view) {\n            currentMapView = view;\n            \n            // Update button states\n            document.querySelectorAll('.map-btn').forEach(btn => {\n                btn.classList.remove('active');\n            });\n            document.querySelector(`[data-view=\"${view}\"]`).classList.add('active');\n            \n            // Reload map with new view\n            if (geoDataCache) {\n                renderMapView(geoDataCache);\n            }\n        };\n        \n        // Render different map views\n        function renderMapView(data) {\n            if (!worldMap) return;\n            \n            // Clear all layers\n            if (markerLayer) markerLayer.clearLayers();\n            if (heatmapLayer) {\n                worldMap.removeLayer(heatmapLayer);\n                heatmapLayer = null;\n            }\n            if (choroplethLayer) {\n                worldMap.removeLayer(choroplethLayer);\n                choroplethLayer = null;\n            }\n            \n            switch (currentMapView) {\n                case 'markers':\n                    renderMarkers(data);\n                    break;\n                case 'heatmap':\n                    renderHeatmap(data);\n                    break;\n                case 'choropleth':\n                    renderChoropleth(data);\n                    break;\n            }\n            \n            updateGeoContext(data);\n        }\n        \n        // Render traditional markers\n        function renderMarkers(data) {\n            data.locations.forEach(location => {\n                const { lat, lng, city, country } = location.location;\n                \n                let markerColor = '#26de81'; // benign\n                if (location.malwareCount > 0) {\n                    markerColor = '#ff3b3b'; // malware\n                } else if (location.suspiciousCount > 0) {\n                    markerColor = '#ffd700'; // suspicious\n                }\n                \n                const markerSize = Math.min(24, Math.max(8, 8 + location.totalScans * 2));\n                \n                const marker = L.circleMarker([lat, lng], {\n                    radius: markerSize / 2,\n                    fillColor: markerColor,\n                    color: '#fff',\n                    weight: 2,\n                    opacity: 0.8,\n                    fillOpacity: 0.6\n                });\n                \n                const popupContent = `\n                    <div style=\"color: var(--text-primary); min-width: 200px;\">\n                        <h3 style=\"margin: 0 0 10px 0; color: var(--accent-green); font-size: 1.1rem;\">\n                            <i class=\"fas fa-map-marker-alt\" style=\"color: ${markerColor};\"></i>\n                            ${city}, ${country}\n                        </h3>\n                        <p style=\"margin: 5px 0;\"><strong>IP:</strong> ${location.ip}</p>\n                        <p style=\"margin: 5px 0;\"><strong>Total Scans:</strong> ${location.totalScans}</p>\n                        <div style=\"margin-top: 10px;\">\n                            <div><span style=\"color: #ff3b3b;\"></span> Malware: ${location.malwareCount}</div>\n                            <div><span style=\"color: #ffd700;\"></span> Suspicious: ${location.suspiciousCount}</div>\n                            <div><span style=\"color: #39ff14;\"></span> Benign: ${location.benignCount}</div>\n                        </div>\n                        <button onclick=\"filterByLocation('${country}')\" \n                                style=\"margin-top: 10px; padding: 5px 10px; background: var(--accent-green); \n                                       color: var(--bg-primary); border: none; border-radius: 5px; cursor: pointer;\">\n                            Filter by ${country}\n                        </button>\n                    </div>\n                `;\n                \n                marker.bindPopup(popupContent);\n                marker.addTo(markerLayer);\n                \n                marker.on('mouseover', function() {\n                    this.setStyle({ fillOpacity: 0.9, opacity: 1 });\n                });\n                marker.on('mouseout', function() {\n                    this.setStyle({ fillOpacity: 0.6, opacity: 0.8 });\n                });\n            });\n        }\n        \n        // Render heatmap overlay\n        function renderHeatmap(data) {\n            const heatData = [];\n            \n            data.locations.forEach(location => {\n                const { lat, lng } = location.location;\n                // Weight by threat severity: malware = 1.0, suspicious = 0.5, benign = 0.2\n                const weight = (location.malwareCount * 1.0 + \n                               location.suspiciousCount * 0.5 + \n                               location.benignCount * 0.2) / location.totalScans;\n                \n                // Add multiple points for higher intensity\n                const intensity = Math.ceil(location.totalScans * weight);\n                for (let i = 0; i < intensity; i++) {\n                    heatData.push([lat, lng, weight]);\n                }\n            });\n            \n            heatmapLayer = L.heatLayer(heatData, {\n                radius: 35,\n                blur: 25,\n                maxZoom: 10,\n                max: 1.0,\n                gradient: {\n                    0.0: '#39ff14',  // Green (low threat)\n                    0.3: '#ffd700',  // Yellow\n                    0.6: '#ffa502',  // Orange\n                    0.8: '#ff6348',  // Red\n                    1.0: '#ff3b3b'   // Bright red (high threat)\n                }\n            }).addTo(worldMap);\n        }\n        \n        // Render choropleth (country-level threat shading)\n        function renderChoropleth(data) {\n            // Aggregate threats by country\n            const countryStats = {};\n            data.locations.forEach(location => {\n                const country = location.location.country;\n                if (!countryStats[country]) {\n                    countryStats[country] = { total: 0, malware: 0, suspicious: 0 };\n                }\n                countryStats[country].total += location.totalScans;\n                countryStats[country].malware += location.malwareCount;\n                countryStats[country].suspicious += location.suspiciousCount;\n            });\n            \n            // Find max for normalization\n            const maxThreats = Math.max(...Object.values(countryStats).map(s => \n                s.malware + s.suspicious * 0.5\n            ));\n            \n            // Draw circles for countries with threat data\n            choroplethLayer = L.layerGroup();\n            \n            Object.entries(countryStats).forEach(([country, stats]) => {\n                if (countryCoordinates[country]) {\n                    const threatScore = (stats.malware + stats.suspicious * 0.5) / maxThreats;\n                    \n                    // Color gradient from green to red\n                    let color;\n                    if (threatScore < 0.2) color = '#39ff14';\n                    else if (threatScore < 0.4) color = '#ffd700';\n                    else if (threatScore < 0.6) color = '#ffa502';\n                    else if (threatScore < 0.8) color = '#ff6348';\n                    else color = '#ff3b3b';\n                    \n                    const circle = L.circle(countryCoordinates[country].center, {\n                        color: color,\n                        fillColor: color,\n                        fillOpacity: 0.4,\n                        radius: 500000 * (1 + threatScore * 2),\n                        weight: 2\n                    });\n                    \n                    circle.bindPopup(`\n                        <div style=\"color: var(--text-primary);\">\n                            <h3 style=\"color: var(--accent-green);\">${country}</h3>\n                            <p><strong>Total Threats:</strong> ${stats.total}</p>\n                            <p><strong>Malware:</strong> ${stats.malware}</p>\n                            <p><strong>Suspicious:</strong> ${stats.suspicious}</p>\n                            <p><strong>Threat Level:</strong> ${(threatScore * 100).toFixed(0)}%</p>\n                        </div>\n                    `);\n                    \n                    circle.addTo(choroplethLayer);\n                }\n            });\n            \n            choroplethLayer.addTo(worldMap);\n        }\n        \n        // Update geographic context panel\n        function updateGeoContext(data) {\n            const countries = new Set(data.locations.map(l => l.location.country));\n            document.getElementById('activeRegions').textContent = countries.size;\n            \n            // Find hotspot (country with most threats)\n            const countryThreats = {};\n            data.locations.forEach(loc => {\n                const country = loc.location.country;\n                countryThreats[country] = (countryThreats[country] || 0) + \n                    loc.malwareCount + loc.suspiciousCount;\n            });\n            \n            const hotspot = Object.entries(countryThreats)\n                .sort((a, b) => b[1] - a[1])[0];\n            \n            if (hotspot) {\n                const percentage = ((hotspot[1] / data.locations.reduce((sum, l) => \n                    sum + l.malwareCount + l.suspiciousCount, 0)) * 100).toFixed(0);\n                document.getElementById('topRegion').textContent = \n                    `${hotspot[0]} (${percentage}% of threats)`;\n            }\n            \n            const totalThreats = data.locations.reduce((sum, l) => \n                sum + l.malwareCount + l.suspiciousCount, 0);\n            document.getElementById('geoThreatCount').textContent = totalThreats;\n        }\n        \n        // Filter dashboard by geographic location\n        window.filterByLocation = function(country) {\n            console.log(`Filtering by country: ${country}`);\n            // This would filter the tables and charts - simplified for demo\n            alert(`Geographic filtering activated for ${country}.\\nIn full implementation, this would filter all dashboard data.`);\n        };\n        \n        // Replay threats over last 24 hours\n        window.replayThreats = async function() {\n            const btn = document.getElementById('replayBtn');\n            const info = document.getElementById('timelineInfo');\n            \n            if (replayInterval) {\n                clearInterval(replayInterval);\n                replayInterval = null;\n                btn.innerHTML = '<i class=\"fas fa-play\"></i> Replay Last 24h';\n                info.textContent = 'Replay stopped';\n                if (geoDataCache) renderMapView(geoDataCache);\n                return;\n            }\n            \n            if (!geoDataCache || geoDataCache.locations.length === 0) {\n                info.textContent = 'No data available for replay';\n                return;\n            }\n            \n            btn.innerHTML = '<i class=\"fas fa-stop\"></i> Stop Replay';\n            info.textContent = 'Replaying threat detection timeline...';\n            \n            // Sort locations by timestamp\n            const sortedLocations = [...geoDataCache.locations].sort((a, b) => {\n                const timeA = a.scans[0]?.timestamp || 0;\n                const timeB = b.scans[0]?.timestamp || 0;\n                return new Date(timeA) - new Date(timeB);\n            });\n            \n            if (markerLayer) markerLayer.clearLayers();\n            let index = 0;\n            \n            replayInterval = setInterval(() => {\n                if (index >= sortedLocations.length) {\n                    clearInterval(replayInterval);\n                    replayInterval = null;\n                    btn.innerHTML = '<i class=\"fas fa-play\"></i> Replay Last 24h';\n                    info.textContent = 'Replay complete';\n                    return;\n                }\n                \n                const location = sortedLocations[index];\n                const { lat, lng, city, country } = location.location;\n                \n                let markerColor = location.malwareCount > 0 ? '#ff3b3b' : \n                                 location.suspiciousCount > 0 ? '#ffd700' : '#39ff14';\n                \n                // Animated marker appearance\n                const marker = L.circleMarker([lat, lng], {\n                    radius: 0,\n                    fillColor: markerColor,\n                    color: '#fff',\n                    weight: 2,\n                    opacity: 1,\n                    fillOpacity: 0.8\n                }).addTo(markerLayer);\n                \n                // Animate marker growth\n                let size = 0;\n                const growInterval = setInterval(() => {\n                    size += 2;\n                    if (size >= 12) {\n                        clearInterval(growInterval);\n                        marker.setStyle({ opacity: 0.8, fillOpacity: 0.6 });\n                    }\n                    marker.setRadius(size / 2);\n                }, 50);\n                \n                marker.bindPopup(`\n                    <div style=\"color: var(--text-primary);\">\n                        <strong>${city}, ${country}</strong><br>\n                        ${location.scans[0]?.filename || 'Unknown file'}\n                    </div>\n                `);\n                \n                info.textContent = `Replaying: ${index + 1}/${sortedLocations.length} - ${city}, ${country}`;\n                index++;\n            }, 800); // Show new threat every 800ms\n        };\n        \n        async function loadGeoMap() {\n            try {\n                // Initialize map only once\n                if (!mapInitialized) {\n                    initializeMap();\n                }\n                \n                if (!worldMap) return;\n                \n                const response = await fetch('/api/geo-data');\n                const data = await response.json();\n                \n                // Generate hash of current data to detect changes\n                const currentHash = JSON.stringify(data.locations.map(l => \n                    `${l.ip}-${l.totalScans}-${l.malwareCount}-${l.suspiciousCount}`\n                )).substring(0, 100);\n                \n                // Skip update if data hasn't changed\n                if (currentHash === lastGeoDataHash && markerLayer && markerLayer.getLayers().length > 0) {\n                    return;\n                }\n                lastGeoDataHash = currentHash;\n                \n                // Cache data for replay and other features\n                geoDataCache = data;\n                \n                // Render current view\n                renderMapView(data);\n                \n                console.log(`Map updated with ${data.locations.length} locations in ${currentMapView} mode`);\n                \n            } catch (error) {\n                console.error('Failed to load geo map:', error);\n            }\n        }\n        \n        async function loadMalwareSources() {\n            try {\n                const response = await fetch('/api/malware-sources');\n                const data = await response.json();\n                \n                const ctx = document.getElementById('malwareSourceChart');\n                \n                // Destroy existing chart if it exists\n                if (sourceChart) {\n                    sourceChart.destroy();\n                }\n                \n                const labels = data.sources.map(s => s.source);\n                const counts = data.sources.map(s => s.count);\n                \n                // Color scheme for different sources\n                const colors = [\n                    '#ff6b6b', // Email Attachment - red\n                    '#4ecdc4', // Web Download - teal\n                    '#ffe66d', // USB/External Drive - yellow\n                    '#a8dadc', // Internal Network - light blue\n                    '#95a5a6'  // Unknown - gray\n                ];\n                \n                sourceChart = new Chart(ctx, {\n                    type: 'pie',\n                    data: {\n                        labels: labels,\n                        datasets: [{\n                            data: counts,\n                            backgroundColor: colors,\n                            borderColor: '#1a1a2e',\n                            borderWidth: 2\n                        }]\n                    },\n                    options: {\n                        responsive: true,\n                        maintainAspectRatio: true,\n                        plugins: {\n                            legend: {\n                                position: 'bottom',\n                                labels: {\n                                    color: getCSSVar('--chart-text-color') || '#e0e0e0',\n                                    font: { size: 12 },\n                                    padding: 15\n                                }\n                            },\n                            tooltip: {\n                                backgroundColor: 'rgba(0, 0, 0, 0.8)',\n                                titleColor: '#fff',\n                                bodyColor: '#e0e0e0',\n                                borderColor: 'rgba(255, 255, 255, 0.1)',\n                                borderWidth: 1,\n                                callbacks: {\n                                    label: function(context) {\n                                        const label = context.label || '';\n                                        const value = context.parsed || 0;\n                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);\n                                        const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : 0;\n                                        return `${label}: ${value} (${percentage}%)`;\n                                    }\n                                }\n                            }\n                        }\n                    }\n                });\n                \n            } catch (error) {\n                console.error('Failed to load malware sources:', error);\n            }\n        }\n        \n        // Graph 2: \"Noisiest\" Agents Over Time\n        let noisyAgentsChart = null;\n        async function loadNoisyAgentsChart() {\n            try {\n                const response = await fetch('/api/noisy-agents');\n                const data = await response.json();\n                \n                console.log('Noisy agents data:', data);\n                \n                const ctx = document.getElementById('noisyAgentsChart');\n                if (!ctx) return;\n                \n                if (noisyAgentsChart) noisyAgentsChart.destroy();\n                \n                // Show message if no data\n                if (!data.agents || data.agents.length === 0) {\n                    ctx.parentElement.innerHTML = '<div style=\"padding: 2rem; text-align: center; color: var(--text-secondary);\">No agent data available yet. Start scanning files to see trends.</div>';\n                    return;\n                }\n                \n                const colors = [\n                    '#ff3b3b', '#39ff14', '#ffd700', '#1e90ff', '#ff1493'\n                ];\n                \n                noisyAgentsChart = new Chart(ctx, {\n                    type: 'line',\n                    data: {\n                        labels: data.dates,\n                        datasets: data.agents.map((agent, idx) => ({\n                            label: agent.agentId,\n                            data: agent.counts,\n                            borderColor: colors[idx],\n                            backgroundColor: colors[idx] + '20',\n                            tension: 0.4,\n                            borderWidth: 2,\n                            fill: false\n                        }))\n                    },\n                    options: {\n                        responsive: true,\n                        maintainAspectRatio: false,\n                        plugins: {\n                            legend: {\n                                labels: { color: '#e0e0e0', font: { size: 11 } }\n                            },\n                            tooltip: {\n                                backgroundColor: 'rgba(0, 0, 0, 0.8)',\n                                titleColor: '#fff',\n                                bodyColor: '#e0e0e0'\n                            }\n                        },\n                        scales: {\n                            y: {\n                                beginAtZero: true,\n                                ticks: { color: '#888' },\n                                grid: { color: 'rgba(255, 255, 255, 0.05)' }\n                            },\n                            x: {\n                                ticks: { color: '#888' },\n                                grid: { color: 'rgba(255, 255, 255, 0.05)' }\n                            }\n                        }\n                    }\n                });\n            } catch (error) {\n                console.error('Failed to load noisy agents chart:', error);\n                const ctx = document.getElementById('noisyAgentsChart');\n                if (ctx) {\n                    ctx.parentElement.innerHTML = '<div style=\"padding: 2rem; text-align: center; color: var(--accent-red);\">Error loading chart data</div>';\n                }\n            }\n        }\n        \n        // Graph 3: Signature Status vs. Classification\n        let signatureClassChart = null;\n        async function loadSignatureClassChart() {\n            try {\n                const response = await fetch('/api/signature-classification');\n                const data = await response.json();\n                \n                console.log('Signature classification data:', data);\n                \n                const ctx = document.getElementById('signatureClassChart');\n                if (!ctx) {\n                    console.warn('signatureClassChart canvas not found');\n                    return;\n                }\n                \n                if (signatureClassChart) signatureClassChart.destroy();\n                \n                signatureClassChart = new Chart(ctx, {\n                    type: 'bar',\n                    data: {\n                        labels: ['Benign', 'Suspicious', 'Malware'],\n                        datasets: [\n                            {\n                                label: 'Verified',\n                                data: [data.benign.verified, data.suspicious.verified, data.malware.verified],\n                                backgroundColor: '#39ff14',\n                                stack: 'stack0'\n                            },\n                            {\n                                label: 'Unknown',\n                                data: [data.benign.unknown, data.suspicious.unknown, data.malware.unknown],\n                                backgroundColor: '#ffd700',\n                                stack: 'stack0'\n                            },\n                            {\n                                label: 'Untrusted',\n                                data: [data.benign.untrusted, data.suspicious.untrusted, data.malware.untrusted],\n                                backgroundColor: '#ff3b3b',\n                                stack: 'stack0'\n                            }\n                        ]\n                    },\n                    options: {\n                        responsive: true,\n                        maintainAspectRatio: false,\n                        plugins: {\n                            legend: {\n                                labels: { color: '#e0e0e0', font: { size: 11 } }\n                            },\n                            tooltip: {\n                                backgroundColor: 'rgba(0, 0, 0, 0.8)',\n                                callbacks: {\n                                    label: function(context) {\n                                        const total = context.chart.data.datasets\n                                            .reduce((sum, ds) => sum + ds.data[context.dataIndex], 0);\n                                        const percentage = ((context.parsed.y / total) * 100).toFixed(1);\n                                        return `${context.dataset.label}: ${context.parsed.y} (${percentage}%)`;\n                                    }\n                                }\n                            }\n                        },\n                        scales: {\n                            y: {\n                                stacked: true,\n                                ticks: { color: '#888' },\n                                grid: { color: 'rgba(255, 255, 255, 0.05)' }\n                            },\n                            x: {\n                                stacked: true,\n                                ticks: { color: '#888' },\n                                grid: { display: false }\n                            }\n                        }\n                    }\n                });\n            } catch (error) {\n                console.error('Failed to load signature classification chart:', error);\n                const ctx = document.getElementById('signatureClassChart');\n                if (ctx && ctx.parentElement) {\n                    ctx.parentElement.innerHTML = '<div style=\"padding: 1rem; text-align: center; color: var(--text-secondary); font-size: 0.85rem;\">No data available</div>';\n                }\n            }\n        }\n        \n        // Graph 4: Packer Usage vs. Classification\n        let packerClassChart = null;\n        async function loadPackerClassChart() {\n            try {\n                const response = await fetch('/api/packer-classification');\n                const data = await response.json();\n                \n                console.log('Packer classification data:', data);\n                \n                const ctx = document.getElementById('packerClassChart');\n                if (!ctx) {\n                    console.warn('packerClassChart canvas not found');\n                    return;\n                }\n                \n                if (packerClassChart) packerClassChart.destroy();\n                \n                packerClassChart = new Chart(ctx, {\n                    type: 'bar',\n                    data: {\n                        labels: data.packers,\n                        datasets: [\n                            {\n                                label: 'Benign Files',\n                                data: data.benignCounts,\n                                backgroundColor: '#39ff14'\n                            },\n                            {\n                                label: 'Malware Files',\n                                data: data.malwareCounts,\n                                backgroundColor: '#ff3b3b'\n                            }\n                        ]\n                    },\n                    options: {\n                        responsive: true,\n                        maintainAspectRatio: false,\n                        plugins: {\n                            legend: {\n                                labels: { color: '#e0e0e0', font: { size: 11 } }\n                            },\n                            tooltip: {\n                                backgroundColor: 'rgba(0, 0, 0, 0.8)'\n                            }\n                        },\n                        scales: {\n                            y: {\n                                beginAtZero: true,\n                                ticks: { color: '#888' },\n                                grid: { color: 'rgba(255, 255, 255, 0.05)' }\n                            },\n                            x: {\n                                ticks: { color: '#888' },\n                                grid: { display: false }\n                            }\n                        }\n                    }\n                });\n            } catch (error) {\n                console.error('Failed to load packer classification chart:', error);\n                const ctx = document.getElementById('packerClassChart');\n                if (ctx && ctx.parentElement) {\n                    ctx.parentElement.innerHTML = '<div style=\"padding: 1rem; text-align: center; color: var(--text-secondary); font-size: 0.85rem;\">No data available</div>';\n                }\n            }\n        }\n        \n        // Graph 5: Confidence Score Histogram\n        let confidenceHistChart = null;\n        async function loadConfidenceHistChart() {\n            try {\n                const response = await fetch('/api/confidence-distribution');\n                const data = await response.json();\n                \n                console.log('Confidence distribution data:', data);\n                \n                const ctx = document.getElementById('confidenceHistChart');\n                if (!ctx) {\n                    console.warn('confidenceHistChart canvas not found');\n                    return;\n                }\n                \n                if (confidenceHistChart) confidenceHistChart.destroy();\n                \n                confidenceHistChart = new Chart(ctx, {\n                    type: 'bar',\n                    data: {\n                        labels: data.bins,\n                        datasets: [{\n                            label: 'Scan Count',\n                            data: data.counts,\n                            backgroundColor: '#39ff14',\n                            borderColor: '#2ed60f',\n                            borderWidth: 1\n                        }]\n                    },\n                    options: {\n                        responsive: true,\n                        maintainAspectRatio: false,\n                        plugins: {\n                            legend: {\n                                labels: { color: '#e0e0e0', font: { size: 11 } }\n                            },\n                            tooltip: {\n                                backgroundColor: 'rgba(0, 0, 0, 0.8)'\n                            }\n                        },\n                        scales: {\n                            y: {\n                                beginAtZero: true,\n                                ticks: { color: '#888' },\n                                grid: { color: 'rgba(255, 255, 255, 0.05)' },\n                                title: {\n                                    display: true,\n                                    text: 'Number of Scans',\n                                    color: '#888'\n                                }\n                            },\n                            x: {\n                                ticks: { color: '#888' },\n                                grid: { display: false },\n                                title: {\n                                    display: true,\n                                    text: 'Confidence Score Range',\n                                    color: '#888'\n                                }\n                            }\n                        }\n                    }\n                });\n            } catch (error) {\n                console.error('Failed to load confidence histogram:', error);\n                const ctx = document.getElementById('confidenceHistChart');\n                if (ctx && ctx.parentElement) {\n                    ctx.parentElement.innerHTML = '<div style=\"padding: 1rem; text-align: center; color: var(--text-secondary); font-size: 0.85rem;\">No data available</div>';\n                }\n            }\n        }\n        \n        // Graph 6: File Entropy Distribution (Box Plot simulation)\n        let entropyBoxChart = null;\n        async function loadEntropyBoxChart() {\n            try {\n                const response = await fetch('/api/entropy-distribution');\n                const data = await response.json();\n                \n                console.log('Entropy distribution data:', data);\n                \n                const ctx = document.getElementById('entropyBoxChart');\n                if (!ctx) {\n                    console.warn('entropyBoxChart canvas not found');\n                    return;\n                }\n                \n                if (entropyBoxChart) entropyBoxChart.destroy();\n                \n                // Create violin/box plot effect with multiple bars\n                const benignData = [\n                    data.benign.min,\n                    data.benign.q1,\n                    data.benign.median,\n                    data.benign.q3,\n                    data.benign.max\n                ];\n                \n                const malwareData = [\n                    data.malware.min,\n                    data.malware.q1,\n                    data.malware.median,\n                    data.malware.q3,\n                    data.malware.max\n                ];\n                \n                entropyBoxChart = new Chart(ctx, {\n                    type: 'bar',\n                    data: {\n                        labels: ['Min', 'Q1', 'Median', 'Q3', 'Max'],\n                        datasets: [\n                            {\n                                label: 'Benign Files',\n                                data: benignData,\n                                backgroundColor: '#39ff14',\n                                borderColor: '#2ed60f',\n                                borderWidth: 1\n                            },\n                            {\n                                label: 'Malware Files',\n                                data: malwareData,\n                                backgroundColor: '#ff3b3b',\n                                borderColor: '#cc2f2f',\n                                borderWidth: 1\n                            }\n                        ]\n                    },\n                    options: {\n                        responsive: true,\n                        maintainAspectRatio: false,\n                        plugins: {\n                            legend: {\n                                labels: { color: '#e0e0e0', font: { size: 11 } }\n                            },\n                            tooltip: {\n                                backgroundColor: 'rgba(0, 0, 0, 0.8)',\n                                callbacks: {\n                                    label: function(context) {\n                                        return `${context.dataset.label}: ${context.parsed.y.toFixed(3)}`;\n                                    }\n                                }\n                            }\n                        },\n                        scales: {\n                            y: {\n                                beginAtZero: true,\n                                max: 8.0,\n                                ticks: { color: '#888' },\n                                grid: { color: 'rgba(255, 255, 255, 0.05)' },\n                                title: {\n                                    display: true,\n                                    text: 'Entropy Value',\n                                    color: '#888'\n                                }\n                            },\n                            x: {\n                                ticks: { color: '#888' },\n                                grid: { display: false }\n                            }\n                        }\n                    }\n                });\n            } catch (error) {\n                console.error('Failed to load entropy distribution chart:', error);\n                const ctx = document.getElementById('entropyBoxChart');\n                if (ctx && ctx.parentElement) {\n                    ctx.parentElement.innerHTML = '<div style=\"padding: 1rem; text-align: center; color: var(--text-secondary); font-size: 0.85rem;\">No data available</div>';\n                }\n            }\n        }\n        \n        async function loadEmergingThreats() {\n            try {\n                const response = await fetch('/api/emerging-threats');\n                const data = await response.json();\n                \n                // Update summary badges\n                document.getElementById('eti-total').textContent = \n                    `${data.summary.totalThreats} Total Threats`;\n                document.getElementById('eti-recent').textContent = \n                    `${data.summary.recentThreats} Last 24h`;\n                \n                // Helper to render IOC list\n                const renderIOCList = (items, container) => {\n                    if (items.length === 0) {\n                        container.innerHTML = '<div class=\"eti-empty\">No threats detected</div>';\n                        return;\n                    }\n                    \n                    container.innerHTML = items.map((item, index) => {\n                        const rank = index + 1;\n                        const recentBadge = item.recent > 0 ? \n                            `<span class=\"eti-recent-badge\">${item.recent} recent</span>` : '';\n                        const agentBadge = item.agents > 0 ? \n                            `<span class=\"eti-agent-badge\">${item.agents} agents</span>` : '';\n                        \n                        return `\n                            <div class=\"eti-item\" data-rank=\"${rank}\">\n                                <div class=\"eti-rank\">${rank}</div>\n                                <div class=\"eti-content\">\n                                    <div class=\"eti-name\">${item.name}</div>\n                                    <div class=\"eti-meta\">\n                                        <span class=\"eti-count\">${item.count} occurrences</span>\n                                        ${recentBadge}\n                                        ${agentBadge}\n                                    </div>\n                                    ${item.details && item.details.length > 0 ? `\n                                        <div class=\"eti-details\">\n                                            ${item.details.slice(0, 2).join(', ')}\n                                            ${item.details.length > 2 ? '...' : ''}\n                                        </div>\n                                    ` : ''}\n                                </div>\n                            </div>\n                        `;\n                    }).join('');\n                };\n                \n                // Render each section\n                renderIOCList(data.topMalwareFamilies, document.getElementById('eti-malware'));\n                renderIOCList(data.topSuspiciousAPIs, document.getElementById('eti-apis'));\n                renderIOCList(data.topMaliciousStrings, document.getElementById('eti-strings'));\n                renderIOCList(data.topPackers, document.getElementById('eti-packers'));\n                \n            } catch (error) {\n                console.error('Failed to load emerging threats:', error);\n            }\n        }\n        \n        async function analyzeThreatModel() {\n            try {\n                // Get selected values\n                const fileType = document.getElementById('model-filetype').value;\n                const packer = document.getElementById('model-packer').value;\n                const signature = document.getElementById('model-signature').value;\n                \n                // Get multiple selections\n                const apisSelect = document.getElementById('model-apis');\n                const apiImports = Array.from(apisSelect.selectedOptions).map(opt => opt.value);\n                \n                const stringsSelect = document.getElementById('model-strings');\n                const keyStrings = Array.from(stringsSelect.selectedOptions).map(opt => opt.value);\n                \n                // Validate\n                if (apiImports.length === 0) {\n                    alert('Please select at least one API import');\n                    return;\n                }\n                if (keyStrings.length === 0) {\n                    alert('Please select at least one suspicious string');\n                    return;\n                }\n                \n                // Show loading state\n                const outputDiv = document.getElementById('modeler-output');\n                outputDiv.innerHTML = `\n                    <div class=\"modeler-loading\">\n                        <i class=\"fas fa-spinner fa-spin\"></i>\n                        <p>Analyzing threat profile...</p>\n                    </div>\n                `;\n                \n                // Send to server\n                const response = await fetch('/api/threat-model', {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({\n                        fileType,\n                        packer,\n                        signature,\n                        apiImports,\n                        keyStrings\n                    })\n                });\n                \n                const data = await response.json();\n                \n                if (data.success) {\n                    const result = data.result;\n                    const classColor = \n                        result.classification === 'Malware' ? '#ff4757' :\n                        result.classification === 'Suspicious' ? '#ffa502' : '#26de81';\n                    \n                    outputDiv.innerHTML = `\n                        <div class=\"prediction-result\">\n                            <div class=\"prediction-header\">\n                                <div class=\"prediction-badge\" style=\"background: ${classColor};\">\n                                    ${result.classification.toUpperCase()}\n                                </div>\n                                <div class=\"prediction-confidence\">\n                                    <div class=\"confidence-label\">Confidence Score</div>\n                                    <div class=\"confidence-value\">${(parseFloat(result.confidence_score) * 100).toFixed(1)}%</div>\n                                </div>\n                            </div>\n                            \n                            ${result.malware_family ? `\n                                <div class=\"prediction-family\">\n                                    <strong>Predicted Malware Family:</strong>\n                                    <span class=\"family-name\">${result.malware_family}</span>\n                                </div>\n                            ` : ''}\n                            \n                            <div class=\"prediction-section\">\n                                <h4>Threat Analysis</h4>\n                                <div class=\"analysis-item\">\n                                    <i class=\"fas fa-file\"></i>\n                                    <span><strong>File Type:</strong> ${result.key_findings.file_type}</span>\n                                </div>\n                                <div class=\"analysis-item\">\n                                    <i class=\"fas fa-box\"></i>\n                                    <span><strong>Packer:</strong> ${result.key_findings.packer_detected}</span>\n                                </div>\n                                <div class=\"analysis-item\">\n                                    <i class=\"fas fa-certificate\"></i>\n                                    <span><strong>Signature:</strong> ${result.key_findings.signature.name}</span>\n                                </div>\n                                <div class=\"analysis-item\">\n                                    <i class=\"fas fa-tachometer-alt\"></i>\n                                    <span><strong>Threat Score:</strong> ${result.key_findings.threat_score}/100</span>\n                                </div>\n                            </div>\n                            \n                            <div class=\"prediction-section\">\n                                <h4>Detected Indicators</h4>\n                                <div class=\"indicator-group\">\n                                    <strong>API Imports:</strong>\n                                    <div class=\"indicator-list\">\n                                        ${result.key_findings.api_imports.map(api => \n                                            `<span class=\"indicator-tag api-tag\">${api}</span>`\n                                        ).join('')}\n                                    </div>\n                                </div>\n                                <div class=\"indicator-group\">\n                                    <strong>Suspicious Strings:</strong>\n                                    <div class=\"indicator-list\">\n                                        ${result.key_findings.key_strings.map(str => \n                                            `<span class=\"indicator-tag string-tag\">${str}</span>`\n                                        ).join('')}\n                                    </div>\n                                </div>\n                            </div>\n                            \n                            <div class=\"prediction-footer\">\n                                <i class=\"fas fa-info-circle\"></i>\n                                This analysis has been added to the scan results and will appear in all visualizations.\n                            </div>\n                        </div>\n                    `;\n                } else {\n                    outputDiv.innerHTML = `\n                        <div class=\"modeler-error\">\n                            <i class=\"fas fa-exclamation-circle\"></i>\n                            <p>Analysis failed: ${data.error}</p>\n                        </div>\n                    `;\n                }\n                \n            } catch (error) {\n                console.error('Failed to analyze threat model:', error);\n                document.getElementById('modeler-output').innerHTML = `\n                    <div class=\"modeler-error\">\n                        <i class=\"fas fa-exclamation-circle\"></i>\n                        <p>Analysis failed. Please try again.</p>\n                    </div>\n                `;\n            }\n        }\n        \n        let graphSimulation = null;\n        let graphSvg = null;\n        \n        async function loadCorrelationGraph() {\n            try {\n                const response = await fetch('/api/threat-correlations');\n                const data = await response.json();\n                \n                // Clear existing graph\n                d3.select('#correlationGraph').selectAll('*').remove();\n                \n                const container = document.getElementById('correlationGraph');\n                const width = container.clientWidth;\n                const height = 600;\n                \n                // Create SVG\n                graphSvg = d3.select('#correlationGraph')\n                    .append('svg')\n                    .attr('width', width)\n                    .attr('height', height)\n                    .style('background', '#0a0a0a')\n                    .style('border-radius', '8px');\n                \n                const g = graphSvg.append('g');\n                \n                // Add zoom behavior\n                const zoom = d3.zoom()\n                    .scaleExtent([0.1, 4])\n                    .on('zoom', (event) => {\n                        g.attr('transform', event.transform);\n                    });\n                \n                graphSvg.call(zoom);\n                \n                // Color schemes for different node types\n                const colorMap = {\n                    malware: '#ff4757',\n                    agent: '#5a9cf8',\n                    api: '#ffa502',\n                    string: '#26de81'\n                };\n                \n                // Create force simulation\n                graphSimulation = d3.forceSimulation(data.nodes)\n                    .force('link', d3.forceLink(data.links)\n                        .id(d => d.id)\n                        .distance(d => d.type === 'correlated_with' ? 200 : 100)\n                        .strength(d => d.strength * 0.3))\n                    .force('charge', d3.forceManyBody().strength(-300))\n                    .force('center', d3.forceCenter(width / 2, height / 2))\n                    .force('collision', d3.forceCollide().radius(30));\n                \n                // Draw links\n                const link = g.append('g')\n                    .selectAll('line')\n                    .data(data.links)\n                    .enter()\n                    .append('line')\n                    .attr('stroke', d => {\n                        if (d.type === 'correlated_with') return '#ff6b6b';\n                        if (d.type === 'detected_by') return '#5a9cf8';\n                        if (d.type === 'uses_api') return '#ffa502';\n                        return '#26de81';\n                    })\n                    .attr('stroke-width', d => Math.sqrt(d.strength) + 1)\n                    .attr('stroke-opacity', 0.6);\n                \n                // Draw nodes\n                const node = g.append('g')\n                    .selectAll('circle')\n                    .data(data.nodes)\n                    .enter()\n                    .append('circle')\n                    .attr('r', d => {\n                        if (d.type === 'malware') return 15 + Math.min(d.count * 2, 15);\n                        if (d.type === 'agent') return 12 + Math.min(d.count, 10);\n                        return 8 + Math.min(d.count, 8);\n                    })\n                    .attr('fill', d => colorMap[d.type])\n                    .attr('stroke', '#fff')\n                    .attr('stroke-width', 2)\n                    .style('cursor', 'pointer')\n                    .call(d3.drag()\n                        .on('start', dragstarted)\n                        .on('drag', dragged)\n                        .on('end', dragended))\n                    .on('click', (event, d) => showNodeDetails(d, data))\n                    .on('mouseover', function(event, d) {\n                        d3.select(this)\n                            .transition()\n                            .duration(200)\n                            .attr('stroke-width', 4)\n                            .attr('r', function() {\n                                const currentR = parseFloat(d3.select(this).attr('r'));\n                                return currentR * 1.3;\n                            });\n                    })\n                    .on('mouseout', function(event, d) {\n                        d3.select(this)\n                            .transition()\n                            .duration(200)\n                            .attr('stroke-width', 2)\n                            .attr('r', function() {\n                                if (d.type === 'malware') return 15 + Math.min(d.count * 2, 15);\n                                if (d.type === 'agent') return 12 + Math.min(d.count, 10);\n                                return 8 + Math.min(d.count, 8);\n                            });\n                    });\n                \n                // Add labels\n                const label = g.append('g')\n                    .selectAll('text')\n                    .data(data.nodes)\n                    .enter()\n                    .append('text')\n                    .text(d => d.label.length > 20 ? d.label.substring(0, 20) + '...' : d.label)\n                    .attr('font-size', d => d.type === 'malware' ? '12px' : '10px')\n                    .attr('fill', '#e0e0e0')\n                    .attr('text-anchor', 'middle')\n                    .attr('dy', d => {\n                        if (d.type === 'malware') return 35;\n                        if (d.type === 'agent') return 25;\n                        return 20;\n                    })\n                    .style('pointer-events', 'none')\n                    .style('font-weight', d => d.type === 'malware' ? 'bold' : 'normal');\n                \n                // Update positions on simulation tick\n                graphSimulation.on('tick', () => {\n                    link\n                        .attr('x1', d => d.source.x)\n                        .attr('y1', d => d.source.y)\n                        .attr('x2', d => d.target.x)\n                        .attr('y2', d => d.target.y);\n                    \n                    node\n                        .attr('cx', d => d.x)\n                        .attr('cy', d => d.y);\n                    \n                    label\n                        .attr('x', d => d.x)\n                        .attr('y', d => d.y);\n                });\n                \n                // Drag functions\n                function dragstarted(event, d) {\n                    if (!event.active) graphSimulation.alphaTarget(0.3).restart();\n                    d.fx = d.x;\n                    d.fy = d.y;\n                }\n                \n                function dragged(event, d) {\n                    d.fx = event.x;\n                    d.fy = event.y;\n                }\n                \n                function dragended(event, d) {\n                    if (!event.active) graphSimulation.alphaTarget(0);\n                    d.fx = null;\n                    d.fy = null;\n                }\n                \n                console.log(`Correlation graph loaded: ${data.nodes.length} nodes, ${data.links.length} links`);\n                \n            } catch (error) {\n                console.error('Failed to load correlation graph:', error);\n            }\n        }\n        \n        function showNodeDetails(node, graphData) {\n            const detailsPanel = document.getElementById('nodeDetails');\n            const detailsTitle = document.getElementById('detailsTitle');\n            const detailsContent = document.getElementById('detailsContent');\n            \n            detailsTitle.textContent = node.label;\n            \n            let html = `<p><strong>Type:</strong> ${node.type.toUpperCase()}</p>`;\n            html += `<p><strong>Occurrences:</strong> ${node.count}</p>`;\n            \n            // Find connections\n            const connections = graphData.links.filter(l => \n                l.source.id === node.id || l.target.id === node.id\n            );\n            \n            if (connections.length > 0) {\n                html += `<p><strong>Connections:</strong> ${connections.length}</p>`;\n                html += '<ul style=\"margin: 10px 0; padding-left: 20px;\">';\n                connections.slice(0, 10).forEach(link => {\n                    const otherNode = link.source.id === node.id ? link.target : link.source;\n                    html += `<li>${link.type.replace(/_/g, ' ')}: ${otherNode.label}</li>`;\n                });\n                if (connections.length > 10) {\n                    html += `<li>...and ${connections.length - 10} more</li>`;\n                }\n                html += '</ul>';\n            }\n            \n            if (node.details && node.details.length > 0) {\n                html += '<p><strong>Associated Files:</strong></p>';\n                html += '<ul style=\"margin: 10px 0; padding-left: 20px; max-height: 150px; overflow-y: auto;\">';\n                node.details.slice(0, 10).forEach(file => {\n                    html += `<li>${file}</li>`;\n                });\n                if (node.details.length > 10) {\n                    html += `<li>...and ${node.details.length - 10} more</li>`;\n                }\n                html += '</ul>';\n            }\n            \n            detailsContent.innerHTML = html;\n            detailsPanel.style.display = 'block';\n        }\n        \n        function resetGraph() {\n            if (graphSimulation) {\n                graphSimulation.alpha(1).restart();\n            }\n        }\n        \n        function centerGraph() {\n            if (graphSvg) {\n                graphSvg.transition().duration(750).call(\n                    d3.zoom().transform,\n                    d3.zoomIdentity\n                );\n            }\n        }\n        \n        function setChartDays(days) {\n            currentChartDays = days;\n            \n            // Update button states\n            document.querySelectorAll('.chart-btn').forEach(btn => {\n                btn.classList.remove('active');\n            });\n            event.target.classList.add('active');\n            \n            loadDailyChart();\n        }\n        \n        function loadData() {\n            loadStats();\n            loadScans();\n            loadDailyChart();\n            loadMalwareSources();\n            loadNoisyAgentsChart();\n            loadSignatureClassChart();\n            loadPackerClassChart();\n            loadConfidenceHistChart();\n            loadEntropyBoxChart();\n            loadEmergingThreats();\n            loadCorrelationGraph();\n            loadGeoMap();\n        }\n        \n        function loadDataWithoutMap() {\n            loadStats();\n            loadScans();\n            loadDailyChart();\n            loadMalwareSources();\n            loadNoisyAgentsChart();\n            loadSignatureClassChart();\n            loadPackerClassChart();\n            loadConfidenceHistChart();\n            loadEntropyBoxChart();\n            loadEmergingThreats();\n            loadCorrelationGraph();\n        }\n        \n        // Initial load\n        loadData();\n        \n        // Set up Server-Sent Events for real-time updates\n        const eventSource = new EventSource('/api/events');\n        \n        eventSource.onmessage = function(event) {\n            const data = JSON.parse(event.data);\n            \n            if (data.type === 'connected') {\n                console.log('Connected to server for real-time updates');\n            } else if (data.type === 'new-scan') {\n                console.log('New scan received:', data.scan.detected_filename);\n                \n                // Show notification toast\n                showThreatNotification(data.scan);\n                \n                // Add to threat ticker\n                addToThreatTicker(data.scan);\n                \n                // Reload all data when new scan arrives\n                loadDataWithoutMap();\n                // Update map less frequently (only if it's been more than 10 seconds)\n                if (!window.lastMapUpdate || Date.now() - window.lastMapUpdate > 10000) {\n                    loadGeoMap();\n                    window.lastMapUpdate = Date.now();\n                }\n            }\n        };\n        \n        eventSource.onerror = function(error) {\n            console.error('SSE Error:', error);\n            // Fallback: reload data every 30 seconds if SSE connection fails\n            if (eventSource.readyState === EventSource.CLOSED) {\n                console.log('SSE connection closed, falling back to polling...');\n                setInterval(loadDataWithoutMap, 30000);\n            }\n        };\n        \n        // Manual refresh button functionality\n        window.manualRefresh = function() {\n            loadData();\n        };\n    </script>\n    \n    <!-- Theme Toggle Script -->\n    <script>\n        // Theme Toggle Functionality\n        window.toggleTheme = function() {\n            const html = document.documentElement;\n            const currentTheme = html.getAttribute('data-theme');\n            const newTheme = currentTheme === 'light' ? '' : 'light';\n            \n            if (newTheme) {\n                html.setAttribute('data-theme', newTheme);\n            } else {\n                html.removeAttribute('data-theme');\n            }\n            localStorage.setItem('theme', newTheme || 'dark');\n            \n            // Update button icon and text\n            const themeIcon = document.getElementById('themeIcon');\n            const themeText = document.getElementById('themeText');\n            \n            if (newTheme === 'light') {\n                themeIcon.textContent = '';\n                themeText.textContent = 'Light';\n            } else {\n                themeIcon.textContent = '';\n                themeText.textContent = 'Dark';\n            }\n        };\n        \n        // Load saved theme on page load\n        (function() {\n            const savedTheme = localStorage.getItem('theme') || 'dark';\n            if (savedTheme === 'light') {\n                document.documentElement.setAttribute('data-theme', 'light');\n            }\n            \n            const themeIcon = document.getElementById('themeIcon');\n            const themeText = document.getElementById('themeText');\n            \n            if (savedTheme === 'light') {\n                themeIcon.textContent = '';\n                themeText.textContent = 'Light';\n            } else {\n                themeIcon.textContent = '';\n                themeText.textContent = 'Dark';\n            }\n        })();\n    </script>\n</body>\n</html>","epoch":74,"telemetryInfo":{}}],["file:///home/trang/localnsv/mAIware/script.js::request_020092b9-97e0-43b6-b877-ad5f11664ee1",{"uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/script.js","external":"file:///home/trang/localnsv/mAIware/script.js","path":"/home/trang/localnsv/mAIware/script.js","scheme":"file"},"requestId":"request_020092b9-97e0-43b6-b877-ad5f11664ee1","content":"// --- MOCK DISASSEMBLY DATA ---\n// (We keep this for now, as requested)\nconst mockDisassemblyBenign = [\n    `<span class=\"addr\">0x401000</span> <span class=\"op\">PUSH</span> <span class=\"args\">ebp</span> <span class=\"comment\">; setup stack frame</span>`,\n    `<span class=\"addr\">0x401001</span> <span class=\"op\">MOV</span> <span class=\"args\">ebp, esp</span>`,\n    `<span class=\"addr\">0x401003</span> <span class=\"op\">SUB</span> <span class=\"args\">esp, 48h</span>`,\n    `<span class=\"addr\">0x40100C</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4012A0</span> <span class=\"comment\">; initialize_string</span>`,\n    `<span class=\"addr\">0x401015</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4013F0</span> <span class=\"comment\">; get_user_input</span>`,\n    `<span class=\"addr\">0x40101E</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4015D0</span> <span class=\"comment\">; print_output</span>`,\n    `<span class=\"addr\">0x401028</span> <span class=\"op\">RETN</span>`,\n    `<span class=\"addr\">...</span>`,\n];\nconst mockDisassemblySuspicious = [\n    `<span class=\"addr\">0x401000</span> <span class=\"op\">PUSH</span> <span class=\"args\">ebp</span>`,\n    `<span class=\"addr\">0x401003</span> <span class=\"op\">SUB</span> <span class=\"args\">esp, 80h</span>`,\n    `<span class=\"addr\">0x40100D</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4012A0</span> <span class=\"comment\">; read_file_to_buffer</span>`,\n    `<span class=\"addr\">0x40101B</span> <span class=\"op\">REP</span> <span class=\"op\">MOVSB</span> <span class=\"comment\">; unsafe buffer write</span>`,\n    `<span class=\"addr\">0x401020</span> <span class=\"op\">JGE</span> <span class=\"args\">0x401030</span> <span class=\"comment\">; jump if overflow</span>`,\n    `<span class=\"addr\">0x401028</span> <span class=\"op\">RETN</span>`,\n    `<span class=\"addr\">...</span>`,\n];\nconst mockDisassemblyMalware = [\n    `<span class=\"addr\">0x401000</span> <span class=\"op\">PUSH</span> <span class=\"args\">ebp</span> <span class=\"comment\">; setup stack frame</span>`,\n    `<span class=\"addr\">0x40100B</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4011B0</span> <span class=\"comment\">; kernel32.LoadLibraryA</span>`,\n    `<span class=\"addr\">0x401013</span> <span class=\"op\">PUSH</span> <span class=\"string\">\"CreateRemoteThread\"</span>`,\n    `<span class=\"addr\">0x401019</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4011C0</span> <span class=\"comment\">; kernel32.GetProcAddress</span>`,\n    `<span class=\"addr\">0x401028</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4012F0</span> <span class=\"comment\">; decrypt_payload</span>`,\n    `<span class=\"addr\">0x401034</span> <span class=\"op\">CALL</span> <span class=\"args\">[ebp-24h]</span> <span class=\"comment\">; call CreateRemoteThread</span>`,\n    `<span class=\"addr\">0x401037</span> <span class=\"op\">JMP</span> <span class=\"args\">0x40102D</span> <span class=\"comment\">; loop?</span>`,\n    `<span class=\"addr\">...</span>`,\n];\n\n// --- REMOVED MOCK GRAPH DATA ---\n// const mockGraphSafe = ... (DELETED)\n// const mockGraphSuspicious = ... (DELETED)\n// const mockGraphMalware = ... (DELETED)\n\n// --- ELEMENT REFERENCES ---\nconst initialState = document.getElementById('initial-state');\nconst analyzingState = document.getElementById('analyzing-state');\nconst resultState = document.getElementById('result-state');\n\nconst analyzingFilename = document.getElementById('analyzing-filename');\nconst resultIcon = document.getElementById('result-icon');\nconst resultText = document.getElementById('result-text');\nconst resultFilename = document.getElementById('result-filename');\nconst resultDetails = document.getElementById('result-details');\nconst nonPeResultWrapper = document.getElementById('non-pe-result');\nconst nonPeFilename = document.getElementById('non-pe-filename');\nconst nonPeHashSha256 = document.getElementById('non-pe-hash-sha256');\nconst nonPeHashMd5 = document.getElementById('non-pe-hash-md5');\n\nconst bodyEl = document.body;\nlet animationWrapper = null;\n\nconst disassemblyWrapper = document.getElementById('disassembly-wrapper');\nconst disassemblyCodeEl = document.getElementById('disassembly-code');\nconst disassemblyFilenameEl = document.getElementById('disassembly-filename');\n\n// Analysis Details elements\nconst analysisDetailsWrapper = document.getElementById('analysis-details-wrapper');\nconst progressBarFill = document.getElementById('progress-bar-fill');\nconst scorePercentage = document.getElementById('score-percentage');\nconst detailsReasoning = document.getElementById('details-reasoning'); // We'll reuse this\nconst detailsHashSha256 = document.getElementById('details-hash-sha256');\nconst detailsHashMd5 = document.getElementById('details-hash-md5');\nconst detailsSystemIp = document.getElementById('details-system-ip');\nconst detailsRecommendation = document.getElementById('details-recommendation');\nconst detailsVendor = document.getElementById('details-vendor');\nconst detailsSignature = document.getElementById('details-signature');\nconst fileInternalsWrapper = document.getElementById('file-internals-wrapper');\nconst entropyBarsContainer = document.getElementById('entropy-bars-container');\nconst keyStringsContainer = document.getElementById('key-strings-container');\n\n// History Panel elements\nconst historyBtn = document.getElementById('history-btn');\nconst historyPanel = document.getElementById('history-panel');\nconst historyCloseBtn = document.getElementById('history-close-btn');\nconst historyOverlay = document.getElementById('history-overlay');\nconst historyListEl = document.querySelector('.history-list');\n\n// Scroll Zone elements\nconst scrollZoneTop = document.getElementById('scroll-zone-top');\nconst scrollZoneBottom = document.getElementById('scroll-zone-bottom');\n\n// Graph Panel elements\nconst graphWrapper = document.getElementById('graph-wrapper');\nconst callGraphEl = document.getElementById('call-graph');\n\n// Stats elements\nconst statsWrapper = document.getElementById('stats-wrapper');\n\n\n// --- STATE ---\nlet disassemblyInterval = null;\nlet scrollInterval = null; // For auto-scrolling\nlet currentGraphLines = []; // Renamed from currentLines to avoid conflict\nlet currentFileMetadata = null;\nlet lastScanResult = null;\n\n// 1. Listen for the 'scan-started' message from the backend\nwindow.electronAPI.onScanStarted((filename) => {\n  console.log(`UI: Received scan-started for ${filename}`);\n\n  // 1. Set UI to \"Analyzing\" state\n  initialState.classList.remove('active'); //\n  analyzingState.classList.add('active'); //\n  analyzingFilename.textContent = filename; //\n  disassemblyFilenameEl.textContent = filename; //\n\n  currentFileMetadata = { filename, isPe: true };\n  lastScanResult = null;\n  nonPeResultWrapper.classList.remove('active');\n  bodyEl.classList.remove('is-non-pe');\n\n  // 2. Update body class to show disassembly\n  bodyEl.classList.remove('is-showing-result'); //\n  bodyEl.classList.add('is-analyzing'); //\n  removeAnimationClasses(); //\n  \n  // 3. Populate disassembly with a \"suspicious\" default and start animation\n  // (We don't know the result yet, so we pick one)\n  populateDisassembly(mockDisassemblySuspicious); //\n  startDisassemblyAnimation(); //\n\n  // 4. Clear old results\n  clearResultData();\n});\n\n// 2. Listen for the 'scan-result' message\nwindow.electronAPI.onScanResult((scanResult) => {\n  console.log(\"UI: Received scan-result:\", scanResult);\n\n  clearInterval(disassemblyInterval); //\n  disassemblyInterval = null; //\n\n  bodyEl.classList.remove('is-analyzing'); //\n  bodyEl.classList.add('is-showing-result'); //\n\n  analyzingState.classList.remove('active'); //\n  resultState.classList.add('active'); //\n\n  lastScanResult = scanResult;\n\n  renderScanResult();\n});\n\nwindow.electronAPI.onScanFileMetadata((metadata) => {\n  if (!metadata || typeof metadata !== 'object') {\n    return;\n  }\n\n  currentFileMetadata = metadata;\n\n  if (lastScanResult && metadata.filename === lastScanResult.detected_filename) {\n    renderScanResult();\n  }\n});\n\nfunction renderScanResult() {\n  if (!lastScanResult) {\n    return;\n  }\n\n  const metadataMatches = currentFileMetadata && currentFileMetadata.filename === lastScanResult.detected_filename;\n  const isNonPe = metadataMatches && currentFileMetadata.isPe === false;\n\n  if (isNonPe) {\n    renderNonPeResult(lastScanResult);\n    return;\n  }\n\n  renderPeResult(lastScanResult);\n}\n\nfunction ensureAnimationWrapper() {\n  if (animationWrapper) {\n    return;\n  }\n\n  animationWrapper = document.createElement('div');\n  animationWrapper.className = 'animation-swarm';\n  for (let i = 0; i < 10; i++) {\n    const particle = document.createElement('span');\n    animationWrapper.appendChild(particle);\n  }\n  bodyEl.prepend(animationWrapper);\n}\n\nfunction renderPeResult(scanResult) {\n  removeAnimationClasses();\n  bodyEl.classList.remove('is-non-pe');\n  nonPeResultWrapper.classList.remove('active');\n\n  let resultIconClass = 'fas fa-check-circle'; //\n  let resultMockDisassembly = mockDisassemblyBenign; //\n  let resultBodyClass = 'result-safe-active'; //\n  let resultScannerClass = 'result-safe'; //\n  let resultProgressClass = 'progress-bar-green'; //\n  let resultScoreClass = 'score-green'; //\n  let recommendation = 'You can safely run this file.'; //\n\n  if (scanResult.classification.includes('Malware')) {\n    resultIconClass = 'fas fa-bug';\n    resultMockDisassembly = mockDisassemblyMalware;\n    resultBodyClass = 'result-malware-active'; //\n    resultScannerClass = 'result-malware'; //\n    resultProgressClass = 'progress-bar-red'; //\n    resultScoreClass = 'score-red'; //\n    recommendation = 'DO NOT OPEN. Quarantine this file immediately.'; //\n  } else if (scanResult.classification.includes('Suspicious')) {\n    resultIconClass = 'fas fa-exclamation-triangle'; //\n    resultMockDisassembly = mockDisassemblySuspicious; //\n    resultBodyClass = 'result-suspicious-active'; //\n    resultScannerClass = 'result-suspicious'; //\n    resultProgressClass = 'progress-bar-yellow'; //\n    resultScoreClass = 'score-yellow'; //\n    recommendation = 'Be cautious. Only run if you trust the source.'; //\n  }\n\n  ensureAnimationWrapper();\n  bodyEl.classList.add(resultBodyClass); //\n\n  resultState.className = `scanner-state active ${resultScannerClass}`; //\n  resultIcon.className = `result-icon ${resultIconClass}`; //\n  resultText.textContent = scanResult.classification; //\n\n  let detailsText = `Scanned ${scanResult.detected_filename}.`;\n  if (scanResult.malware_family) {\n    detailsText = `Family: ${scanResult.malware_family}`;\n  }\n  resultDetails.textContent = detailsText;\n  resultFilename.textContent = scanResult.detected_filename; //\n\n  progressBarFill.className = 'progress-bar-fill'; //\n  scorePercentage.className = 'score-percentage'; //\n  progressBarFill.classList.add(resultProgressClass); //\n  const rawConfidence = Number(scanResult.confidence_score);\n  const confidenceValue = Number.isFinite(rawConfidence) ? rawConfidence * 100 : 0;\n  progressBarFill.style.width = `${confidenceValue}%`; //\n  scorePercentage.textContent = `${Math.round(confidenceValue)}%`; //\n  scorePercentage.classList.add(resultScoreClass); //\n\n  detailsReasoning.textContent = `Filetype: ${scanResult.key_findings.file_type}. Packer: ${scanResult.key_findings.packer_detected}.`; //\n  const hashData = scanResult.file_hashes || {};\n  detailsHashSha256.textContent = hashData.sha256 || 'Not available'; //\n  detailsHashMd5.textContent = hashData.md5 || 'Not available'; //\n  updateSystemIpDisplay();\n  detailsRecommendation.textContent = recommendation;\n\n  populateVendor(scanResult.vendor); //\n  populateSignature(scanResult.key_findings.signature); //\n  populateEntropyBars(scanResult.key_findings.section_entropy || []); //\n  populateKeyStrings(scanResult.key_findings.key_strings || [], scanResult.classification); //\n\n  populateDisassembly(resultMockDisassembly); //\n\n  const apiList = scanResult.key_findings.api_imports || [];\n  const graphData = generateGraphData(apiList, scanResult.classification);\n  drawCallGraph(graphData);\n}\n\nfunction renderNonPeResult(scanResult) {\n  removeAnimationClasses();\n  bodyEl.classList.add('is-non-pe');\n  resultState.className = 'scanner-state active';\n  resultIcon.className = 'result-icon fas fa-file';\n  resultText.textContent = '';\n  resultDetails.textContent = '';\n  resultFilename.textContent = '';\n\n  const hashData = scanResult.file_hashes || {};\n  nonPeFilename.textContent = scanResult.detected_filename || '';\n  nonPeHashSha256.textContent = hashData.sha256 || 'Not available';\n  nonPeHashMd5.textContent = hashData.md5 || 'Not available';\n\n  detailsHashSha256.textContent = hashData.sha256 || 'Not available';\n  detailsHashMd5.textContent = hashData.md5 || 'Not available';\n\n  nonPeResultWrapper.classList.add('active');\n\n  callGraphEl.innerHTML = '';\n  currentGraphLines.forEach(line => line.remove());\n  currentGraphLines = [];\n  entropyBarsContainer.innerHTML = '';\n  keyStringsContainer.innerHTML = '';\n}\n\n/**\n * Clears all dynamic result data to prepare for the next scan.\n */\nfunction clearResultData() {\n    // Clear scanner panel\n    resultText.textContent = '';\n    resultDetails.textContent = '';\n    resultFilename.textContent = '';\n    nonPeResultWrapper.classList.remove('active');\n    nonPeFilename.textContent = '';\n    nonPeHashSha256.textContent = '...';\n    nonPeHashMd5.textContent = '...';\n    bodyEl.classList.remove('is-non-pe');\n\n    // Clear analysis panel\n    progressBarFill.style.width = `0%`;\n    scorePercentage.textContent = `0%`;\n    detailsReasoning.textContent = '...';\n    detailsHashSha256.textContent = '...';\n    detailsHashMd5.textContent = '...';\n    if (detailsSystemIp) {\n        detailsSystemIp.textContent = 'Detecting...';\n    }\n    detailsRecommendation.textContent = '...';\n\n    // Clear vendor\n    detailsVendor.innerHTML = `\n        <h4>Vendor Analysis</h4>\n        <div class=\"vendor-info\">\n            <i class=\"fas fa-question-circle\"></i>\n            <span>Scanning...</span>\n        </div>`;\n    \n    // Clear signature\n    detailsSignature.innerHTML = `\n        <h4>Digital Signature</h4>\n        <div class=\"signature-info\">\n            <i class=\"fas fa-question-circle\"></i>\n            <span>Checking...</span>\n        </div>`;\n    \n    // Clear internals\n    entropyBarsContainer.innerHTML = '';\n    keyStringsContainer.innerHTML = '';\n    \n    // Clear graph\n    callGraphEl.innerHTML = '';\n    currentGraphLines.forEach(line => line.remove());\n    currentGraphLines = [];\n}\n\n// --- VENDOR UI FUNCTION (IMPLEMENTED) ---\nfunction populateVendor(vendor) {\n    if (!vendor) return;\n    const icon = vendor.icon || 'fas fa-question-circle'; //\n    const name = vendor.name || 'Unknown'; //\n    detailsVendor.innerHTML = `\n        <h4>Vendor Analysis</h4> <div class=\"vendor-info\"> <i class=\"${icon}\"></i>\n            <span>${name}</span>\n        </div>\n    `;\n}\n\n// --- SIGNATURE UI FUNCTION (IMPLEMENTED) ---\nfunction populateSignature(signature) {\n    if (!signature) return;\n    let icon = signature.icon || 'fas fa-question-circle';\n    let cssClass = `sig-${signature.level || 'unknown'}`; // 'sig-verified', 'sig-untrusted', 'sig-unknown'\n\n    detailsSignature.innerHTML = `\n        <h4>Digital Signature</h4> <div class=\"signature-info ${cssClass}\"> <i class=\"${icon}\"></i>\n            <span>${signature.name}</span>\n        </div>\n    `;\n}\n\n// --- ENTROPY BARS UI FUNCTION (IMPLEMENTED) ---\nfunction populateEntropyBars(sections) {\n    entropyBarsContainer.innerHTML = ''; // Clear old bars\n    if (!sections || sections.length === 0) {\n        entropyBarsContainer.innerHTML = '<p class=\"hash-text\">No PE sections found to analyze.</p>';\n        return;\n    }\n\n    sections.forEach(section => { //\n        const value = section.entropy; //\n        const width = (value / 8.0) * 100; // Entropy is 0-8\n        let cssClass = 'low';\n        \n        if (value > 6.0) cssClass = 'medium';\n        if (value > 7.0) cssClass = 'high';\n        if (value > 7.8) cssClass = 'packed'; // Match style.css\n\n        const row = document.createElement('div');\n        row.className = 'entropy-bar-row';\n        row.innerHTML = `\n            <span class=\"entropy-bar-label\">${section.name}</span> <div class=\"entropy-bar-bg\">\n                <div class=\"entropy-bar-fill ${cssClass}\" style=\"width: ${width}%\">\n                    <span class=\"entropy-bar-value\">${value.toFixed(2)}</span>\n                </div>\n            </div>\n        `;\n        entropyBarsContainer.appendChild(row);\n    });\n}\n\n// --- KEY STRINGS UI FUNCTION (IMPLEMENTED) ---\nfunction populateKeyStrings(strings, classification) {\n    keyStringsContainer.innerHTML = ''; // Clear old strings\n    if (!strings || strings.length === 0) {\n        keyStringsContainer.innerHTML = '<span class=\"key-string-tag\">No notable strings found.</span>';\n        return;\n    }\n    \n    const tagClass = classification.includes('Benign') ? 'benign' : 'suspicious'; //\n\n    strings.forEach(str => { //\n        const tag = document.createElement('span');\n        tag.className = `key-string-tag ${tagClass}`;\n        tag.textContent = str;\n        keyStringsContainer.appendChild(tag);\n    });\n}\n\nfunction updateSystemIpDisplay() {\n    if (!detailsSystemIp || !window.electronAPI || typeof window.electronAPI.getSystemIp !== 'function') {\n        return;\n    }\n\n    detailsSystemIp.textContent = 'Detecting...';\n\n    window.electronAPI.getSystemIp()\n        .then((ip) => {\n            if (!ip) {\n                detailsSystemIp.textContent = 'Unavailable';\n                return;\n            }\n\n            detailsSystemIp.textContent = ip;\n        })\n        .catch(() => {\n            detailsSystemIp.textContent = 'Unavailable';\n        });\n}\n\nfunction removeAnimationClasses() {\n    bodyEl.classList.remove('result-safe-active');\n    bodyEl.classList.remove('result-suspicious-active');\n    bodyEl.classList.remove('result-malware-active');\n}\n\n// --- Disassembly Functions ---\n\nfunction populateDisassembly(codeLines) {\n    disassemblyCodeEl.innerHTML = '';\n    codeLines.forEach((line, index) => {\n        const lineEl = document.createElement('span');\n        lineEl.className = 'disassembly-line';\n        lineEl.id = `line-${index}`;\n        lineEl.innerHTML = line;\n        disassemblyCodeEl.appendChild(lineEl);\n    });\n}\n\nfunction startDisassemblyAnimation() {\n    if (disassemblyInterval) {\n        clearInterval(disassemblyInterval);\n    }\n    let currentLine = 0;\n    const totalLines = disassemblyCodeEl.children.length;\n\n    disassemblyInterval = setInterval(() => {\n        const prevLine = document.querySelector('.disassembly-line.active');\n        if (prevLine) {\n            prevLine.classList.remove('active');\n        }\n\n        const lineEl = document.getElementById(`line-${currentLine}`);\n        if (lineEl) {\n            lineEl.classList.add('active');\n            lineEl.scrollIntoView({\n                behavior: 'smooth',\n                block: 'center',\n                inline: 'nearest'\n            });\n        }\n        currentLine = (currentLine + 1) % totalLines;\n    }, 150);\n}\n\n/**\n * This function was MOVED here from jsonsamples.js\n * Dynamically generates the graph data based on API imports.\n * @param {string[]} apiImports - Array of API names (e.g., ['CreateRemoteThread'])\n * @param {string} classification - 'Benign', 'Suspicious', or 'Malware'\n * @returns {object} A graph object with 'nodes' and 'edges' arrays.\n */\nfunction generateGraphData(apiImports, classification) {\n    let nodes = [];\n    let edges = [];\n    const nodeSpacing = 150;\n    const startY = 100;\n    const startX = 250;\n\n    // 1. Add the Main Entry Point node\n    nodes.push({ \n        id: 'main-entry', \n        label: 'main()', \n        class: 'node-entry', \n        pos: { top: `${startY + (apiImports.length / 2) * (nodeSpacing / 2)}px`, left: '50px' } \n    });\n\n    if (!apiImports || apiImports.length === 0) {\n        // Benign/Empty graph\n        nodes.push({ id: 'benign-1', label: 'ReadFile', class: 'node-std', pos: { top: `${startY}px`, left: `${startX}px` } });\n        nodes.push({ id: 'benign-2', label: 'WriteFile', class: 'node-std', pos: { top: `${startY + nodeSpacing / 2}px`, left: `${startX}px` } });\n        edges.push({ from: 'main-entry', to: 'benign-1', options: { color: '#888' } });\n        edges.push({ from: 'main-entry', to: 'benign-2', options: { color: '#888' } });\n    } else {\n        // Suspicious/Malware graph\n        apiImports.forEach((apiName, index) => {\n            let nodeClass = 'node-api'; // Default\n            let edgeColor = '#888'; // Default\n\n            if (classification === 'Malware') {\n                nodeClass = 'node-malicious';\n                edgeColor = '#e74c3c'; // Malware red\n            } else if (classification === 'Suspicious') {\n                nodeClass = 'node-suspicious';\n                edgeColor = '#f1c40f'; // Suspicious yellow\n            } else {\n                // Benign\n                nodeClass = 'node-std';\n                edgeColor = '#888';\n            }\n\n\n            const nodeId = `api-${index}`;\n            const yPos = startY + (index * (nodeSpacing-50)); // Make them a bit closer\n            const xPos = startX + (index % 2 === 0 ? 0 : 150); // Stagger them\n\n            // Add the API node\n            nodes.push({\n                id: nodeId,\n                label: apiName,\n                class: nodeClass,\n                pos: { top: `${yPos}px`, left: `${xPos}px` }\n            });\n\n            // Add the edge from main\n            edges.push({\n                from: 'main-entry',\n                to: nodeId,\n                options: { color: edgeColor }\n            });\n        });\n    }\n\n    return { nodes, edges };\n}\n\n// --- Graph Drawing ---\nfunction drawCallGraph(graphData) {\n    // 1. Clear previous graph (both nodes and lines)\n    callGraphEl.innerHTML = '';\n    currentGraphLines.forEach(line => line.remove());\n    currentGraphLines = [];\n\n    if (!graphData || !graphData.nodes || !graphData.edges) {\n        console.error(\"Invalid graph data received\", graphData);\n        return;\n    }\n\n    // 2. Create and place all nodes\n    graphData.nodes.forEach(node => {\n        const nodeEl = document.createElement('div');\n        nodeEl.id = node.id;\n        nodeEl.className = `graph-node ${node.class}`;\n        nodeEl.style.top = node.pos.top;\n        nodeEl.style.left = node.pos.left;\n        nodeEl.textContent = node.label;\n        callGraphEl.appendChild(nodeEl);\n    });\n\n    // 3. Draw all edges (must be done *after* nodes are in DOM)\n    // Use a slight timeout to ensure DOM is ready\n    setTimeout(() => {\n        graphData.edges.forEach(edge => {\n            try {\n                const line = new LeaderLine(\n                    document.getElementById(edge.from),\n                    document.getElementById(edge.to),\n                    {\n                        color: edge.options.color,\n                        path: edge.options.path || 'straight',\n                        startSocket: edge.options.startSocket || 'auto',\n                        endSocket: edge.options.endSocket || 'auto',\n                        endPlug: 'arrow1',\n                        size: 3,\n                        endPlugSize: 1.5,\n                    }\n                );\n                currentGraphLines.push(line);\n            } catch(e) {\n                console.error(\"Could not draw line:\", e);\n            }\n        });\n    }, 500); // 500ms timeout to let CSS fade-in finish\n}\n\n\n// --- History Panel Logic ---\nasync function loadHistory() {\n  if (!historyListEl) return;\n  \n  historyListEl.innerHTML = '<li class=\"history-item-loading\">Loading...</li>';\n\n  try {\n    const historyData = await window.electronAPI.getHistory();\n\n    if (!historyData || historyData.length === 0) {\n      historyListEl.innerHTML = '<li class=\"history-item-empty\">No scan history found.</li>';\n      return;\n    }\n\n    historyListEl.innerHTML = '';\n\n    historyData.forEach(scan => {\n      const li = document.createElement('li');\n      li.className = 'history-item';\n\n      // Determine classification icon\n      let statusIcon = 'fas fa-check-circle';\n      let classType = 'safe';\n      if (scan.classification.includes('Malware')) {\n        statusIcon = 'fas fa-bug';\n        classType = 'malware';\n      } else if (scan.classification.includes('Suspicious')) {\n        statusIcon = 'fas fa-exclamation-triangle';\n        classType = 'suspicious';\n      }\n\n      // Determine file type icon based on extension\n      const filename = scan.detected_filename || '';\n      const ext = filename.split('.').pop().toLowerCase();\n      let fileTypeIcon = 'fas fa-file';\n      \n      if (['exe', 'dll', 'sys', 'msi'].includes(ext)) {\n        fileTypeIcon = 'fas fa-cog'; // Executable\n      } else if (['jpg', 'jpeg', 'png', 'gif', 'bmp', 'svg', 'webp'].includes(ext)) {\n        fileTypeIcon = 'fas fa-image'; // Image\n      } else if (['js', 'ts', 'py', 'java', 'cpp', 'c', 'h', 'cs', 'go', 'rs', 'php', 'rb'].includes(ext)) {\n        fileTypeIcon = 'fas fa-code'; // Code\n      } else if (['pdf', 'doc', 'docx', 'txt', 'rtf', 'odt'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-alt'; // Document\n      } else if (['zip', 'rar', '7z', 'tar', 'gz', 'bz2'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-archive'; // Archive\n      } else if (['mp3', 'wav', 'ogg', 'flac', 'aac'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-audio'; // Audio\n      } else if (['mp4', 'avi', 'mkv', 'mov', 'wmv', 'flv'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-video'; // Video\n      } else if (['html', 'htm', 'css', 'xml', 'json'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-code'; // Web file\n      }\n\n      const scanDate = new Date(scan.scanDate).toLocaleString();\n      const hashSha256 = scan.file_hashes?.sha256 || 'N/A';\n      const hashDisplay = hashSha256.substring(0, 16) + '...'; // Show first 16 chars\n\n      li.innerHTML = `\n        <div class=\"history-icon-wrapper\">\n          <div class=\"history-icon ${classType}\">\n            <i class=\"${statusIcon}\"></i>\n          </div>\n          <div class=\"history-file-type\">\n            <i class=\"${fileTypeIcon}\"></i>\n          </div>\n        </div>\n        <div class=\"history-details\">\n          <span class=\"history-filename\" title=\"${filename}\">${filename}</span>\n          <span class=\"history-classification ${classType}\">${scan.classification}</span>\n          <span class=\"history-hash\" title=\"${hashSha256}\">SHA256: ${hashDisplay}</span>\n        </div>\n        <span class=\"history-date\">${scanDate}</span>\n      `;\n      \n      historyListEl.appendChild(li);\n    });\n\n  } catch (err) {\n    console.error('Failed to load history:', err);\n    historyListEl.innerHTML = '<li class=\"history-item-empty\">Error loading history.</li>';\n  }\n}\n\nfunction toggleHistoryPanel() {\n  bodyEl.classList.toggle('is-history-open');\n  \n  // ADD THIS: If we are opening the panel, load the history\n  if (bodyEl.classList.contains('is-history-open')) {\n    loadHistory();\n  }\n}\n\nhistoryBtn.addEventListener('click', (e) => {\n    e.preventDefault();\n    toggleHistoryPanel();\n});\nhistoryCloseBtn.addEventListener('click', toggleHistoryPanel);\nhistoryOverlay.addEventListener('click', toggleHistoryPanel);\n\n\n// --- Auto-scroll Logic ---\nfunction startScrolling(direction) {\n    if (scrollInterval) {\n        clearInterval(scrollInterval);\n    }\n    scrollInterval = setInterval(() => {\n        window.scrollBy(0, direction * 10); // 10 pixels at a time\n    }, 20); // every 20ms\n}\n\nfunction stopScrolling() {\n    clearInterval(scrollInterval);\n    scrollInterval = null;\n}\n\nscrollZoneTop.addEventListener('mouseenter', () => {\n    startScrolling(-1); // Scroll Up\n    scrollZoneTop.classList.add('scrolling');\n});\nscrollZoneTop.addEventListener('mouseleave', () => {\n    stopScrolling();\n    scrollZoneTop.classList.remove('scrolling');\n});\n\nscrollZoneBottom.addEventListener('mouseenter', () => {\n    startScrolling(1); // Scroll Down\n    scrollZoneBottom.classList.add('scrolling');\n});\nscrollZoneBottom.addEventListener('mouseleave', () => {\n    stopScrolling();\n    scrollZoneBottom.classList.remove('scrolling');\n});\n\n\n// --- Chart instances ---\nlet malwareTypesChart = null;\nlet topMalwareChart = null;\n\n// --- Function to create/recreate charts ---\nwindow.recreateCharts = function() {\n    // Check if light theme is active\n    const isLightTheme = document.body.classList.contains('light-theme');\n    \n    // Set colors based on theme\n    const chartLegendColor = isLightTheme ? '#6c757d' : '#e0e0e0';\n    const chartAxesColor = isLightTheme ? '#6c757d' : '#aaa';\n    const chartGridColor = isLightTheme ? '#dee2e6' : '#444444';\n\n    // Destroy existing charts if they exist\n    if (malwareTypesChart) {\n        malwareTypesChart.destroy();\n    }\n    if (topMalwareChart) {\n        topMalwareChart.destroy();\n    }\n\n    // Create Malware Types Chart (Doughnut)\n    const typesCtx = document.getElementById('malwareTypesChart');\n    if (typesCtx) {\n        malwareTypesChart = new Chart(typesCtx, {\n            type: 'doughnut',\n            data: {\n                labels: ['PE (exe/dll)', 'JavaScript', 'VBS', 'Macro', 'Other'],\n                datasets: [{\n                    label: 'Submission Types',\n                    data: [65, 15, 8, 7, 5],\n                    backgroundColor: [\n                        '#007bff', // Blue\n                        '#f1c40f', // Yellow\n                        '#e74c3c', // Red\n                        '#9b59b6', // Purple\n                        '#34495e'  // Gray\n                    ],\n                    borderColor: '#2a2a2e',\n                    borderWidth: 3,\n                }]\n            },\n            options: {\n                responsive: true,\n                plugins: {\n                    legend: {\n                        position: 'right',\n                        labels: {\n                            color: chartLegendColor,\n                            boxWidth: 20\n                        }\n                    }\n                }\n            }\n        });\n    }\n\n    // Create Top Malware Chart (Line)\n    const topMalwareCtx = document.getElementById('topMalwareChart');\n    if (topMalwareCtx) {\n        topMalwareChart = new Chart(topMalwareCtx, {\n            type: 'line',\n            data: {\n                labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5'],\n                datasets: [\n                    {\n                        label: 'Zeus',\n                        data: [120, 150, 130, 180, 160],\n                        borderColor: '#e74c3c',\n                        backgroundColor: '#e74c3c20',\n                        fill: true,\n                        tension: 0.4\n                    },\n                    {\n                        label: 'WannaCry',\n                        data: [80, 90, 110, 100, 130],\n                        borderColor: '#007bff',\n                        backgroundColor: '#007bff20',\n                        fill: true,\n                        tension: 0.4\n                    },\n                    {\n                        label: 'Emotet',\n                        data: [50, 60, 80, 70, 90],\n                        borderColor: '#f1c40f',\n                        backgroundColor: '#f1c40f20',\n                        fill: true,\n                        tension: 0.4\n                    }\n                ]\n            },\n            options: {\n                responsive: true,\n                plugins: {\n                    legend: {\n                        labels: {\n                            color: chartLegendColor\n                        }\n                    }\n                },\n                scales: {\n                    x: {\n                        ticks: { color: chartAxesColor },\n                        grid: { color: chartGridColor + '50' }\n                    },\n                    y: {\n                        ticks: { color: chartAxesColor },\n                        grid: { color: chartGridColor }\n                    }\n                }\n            }\n        });\n    }\n};\n\n// --- Run on Page Load ---\ndocument.addEventListener('DOMContentLoaded', () => {\n    // 1. Animate Stat Cards\n    const statNumbers = document.querySelectorAll('.stat-number');\n    statNumbers.forEach(stat => {\n        const target = +stat.getAttribute('data-target');\n        const duration = 2000;\n        const stepTime = 20;\n        const steps = duration / stepTime;\n        const increment = target / steps;\n        let current = 0;\n\n        const updateCount = () => {\n            current += increment;\n            if (current < target) {\n                stat.textContent = Math.ceil(current).toLocaleString();\n                setTimeout(updateCount, stepTime);\n            } else {\n                stat.textContent = target.toLocaleString();\n            }\n        };\n        updateCount();\n    });\n\n    // 2. Create the charts\n    recreateCharts();\n});\n","epoch":81,"telemetryInfo":{}}],["file:///home/trang/localnsv/mAIware/index.html::request_020092b9-97e0-43b6-b877-ad5f11664ee1",{"uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/index.html","external":"file:///home/trang/localnsv/mAIware/index.html","path":"/home/trang/localnsv/mAIware/index.html","scheme":"file"},"requestId":"request_020092b9-97e0-43b6-b877-ad5f11664ee1","content":"<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>mAIware AI Malware Detection Demo</title>\n    <!-- Font Awesome for icons (which you already had) -->\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css\">\n    <!-- Chart.js for stats (which you already had) -->\n    <script src=\"https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js\"></script>\n    <!-- Link to the CSS file -->\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n\n<body>\n    <nav class=\"top-nav\">\n        <div class=\"logo\"> <i class=\"fas fa-shield-virus\"></i> <span>mAIware</span> </div>\n        <div class=\"nav-links\"> <a href=\"#\" class=\"nav-link\" data-tooltip=\"Login\"><i class=\"fas fa-sign-in-alt\"></i><span class=\"link-text\">Login</span></a> <a href=\"#\" class=\"nav-link\" data-tooltip=\"Sign Up\"><i class=\"fas fa-user-plus\"></i><span class=\"link-text\">Sign Up</span></a> <a href=\"#\" class=\"nav-link\" data-tooltip=\"Community\"><i class=\"fas fa-users\"></i><span class=\"link-text\">Community</span></a> <a href=\"#\" class=\"nav-link\" data-tooltip=\"API Docs\"><i class=\"fas fa-code\"></i><span class=\"link-text\">API</span></a> <a href=\"#\" id=\"history-btn\" class=\"nav-link\" data-tooltip=\"Scan History\"><i class=\"fas fa-history\"></i><span class=\"link-text\">History</span></a> <a href=\"#\" class=\"nav-link\" id=\"theme-toggle\" data-tooltip=\"Toggle Theme\"> <i class=\"fas fa-sun\"></i> </a> </div>\n    </nav>\n\n    <main class=\"main-container\">\n        <!-- Column 1 -->\n        <div class=\"scanner-wrapper\">\n            <!-- Main Scanner Box -->\n            <div class=\"scanner-container\">\n                <h1>AI Malware Detection</h1>\n                <!-- State 1: Initial -->\n                <div id=\"initial-state\" class=\"scanner-state active\">\n                    <p>Watching your Downloads folder for new files...</p>\n                    <div id=\"drop-zone\" class=\"upload-zone\"> <i class=\"upload-icon fas fa-eye\"></i>\n                        <h3>Automatic Scanning Active</h3>\n                        <span>(Download a file to begin)</span>\n                    </div>\n                </div>\n\n                <!-- State 2: Analyzing -->\n                <div id=\"analyzing-state\" class=\"scanner-state\">\n                    <div class=\"analyzing-icon\">\n                        <div class=\"loader\"></div>\n                    </div>\n                    <h3>Analyzing...</h3> <span class=\"filename\" id=\"analyzing-filename\">demo_file.exe</span> </div>\n\n                <!-- State 3: Result -->\n                <div id=\"result-state\" class=\"scanner-state\"> <i class=\"result-icon\" id=\"result-icon\"></i>\n                    <h2 id=\"result-text\"></h2>\n                    <div class=\"filename\" id=\"result-filename\"></div>\n                    <p id=\"result-details\"></p>\n                    <!-- Removed the resetDemo() button as it's automatic now -->\n                </div>\n                <div id=\"non-pe-result\" class=\"scanner-state non-pe-result\">\n                    <div class=\"non-pe-icon\"><i class=\"fas fa-file\"></i></div>\n                    <h2 id=\"non-pe-title\">File is not a Windows PE executable</h2>\n                    <p class=\"filename\" id=\"non-pe-filename\"></p>\n                    <div class=\"non-pe-hash-grid\">\n                        <div class=\"non-pe-hash\">\n                            <h4>SHA256</h4>\n                            <p id=\"non-pe-hash-sha256\">...</p>\n                        </div>\n                        <div class=\"non-pe-hash\">\n                            <h4>MD5</h4>\n                            <p id=\"non-pe-hash-md5\">...</p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Analysis Details (Shows on result) -->\n            <div class=\"analysis-details-container\" id=\"analysis-details-wrapper\">\n                <div class=\"progress-header\">\n                    <h3>Malware Confidence</h3> <span class=\"score-percentage\" id=\"score-percentage\">0%</span> </div>\n                <div class=\"progress-bar-background\">\n                    <div class=\"progress-bar-fill\" id=\"progress-bar-fill\" style=\"width: 0%;\"></div>\n                </div>\n\n                <!-- This grid holds Vendor and Signature -->\n                <div class=\"details-grid\">\n                    <!-- Vendor UI Container -->\n                    <div class=\"details-section\" id=\"details-vendor\">\n                        <h4>Vendor Analysis</h4>\n                        <div class=\"vendor-info\">\n                            <i class=\"fas fa-question-circle\"></i>\n                            <span>Scanning...</span>\n                        </div>\n                    </div>\n                    <!-- Signature UI Container -->\n                    <div class=\"details-section\" id=\"details-signature\">\n                        <h4>Digital Signature</h4>\n                        <div class=\"signature-info\">\n                            <i class=\"fas fa-question-circle\"></i>\n                            <span>Checking...</span>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Reasoning (File Type/Packer) -->\n                <div class=\"details-section\">\n                    <h4>Key Findings</h4>\n                    <p id=\"details-reasoning\">...</p>\n                </div>\n                \n                <div class=\"details-section\">\n                    <h4>SHA256 Hash</h4>\n                    <p class=\"hash-text\" id=\"details-hash-sha256\">...</p>\n                </div>\n\n                <div class=\"details-section\">\n                    <h4>MD5 Hash</h4>\n                    <p class=\"hash-text\" id=\"details-hash-md5\">...</p>\n                </div>\n\n                <div class=\"details-section\">\n                    <h4>System IP</h4>\n                    <p class=\"hash-text\" id=\"details-system-ip\">Detecting...</p>\n                </div>\n\n                <div class=\"details-section\">\n                    <h4>What To Do Next</h4>\n                    <p id=\"details-recommendation\">...</p>\n                </div>\n\n                <div class=\"btn-wrapper\"> <button class=\"btn btn-primary\"><i class=\"fas fa-download\"></i> Download Report</button> <button class=\"btn btn-secondary\"><i class=\"fas fa-flag\"></i> Report False Positive</button> </div>\n            </div>\n        </div>\n\n        <!-- Column 2 -->\n        <div class=\"right-panel-wrapper\">\n            <!-- Stats (Shows on initial) -->\n            <div class=\"stats-wrapper\" id=\"stats-wrapper\">\n                <div class=\"stats-grid\">\n                    <div class=\"stat-card\"> <i class=\"fas fa-virus-slash\"></i>\n                        <div class=\"stat-content\"> <span class=\"stat-number\" data-target=\"14720938\">0</span> <span class=\"stat-label\">Malware Analyzed</span> </div>\n                    </div>\n                    <div class=\"stat-card\"> <i class=\"fas fa-users\"></i>\n                        <div class=\"stat-content\"> <span class=\"stat-number\" data-target=\"82041\">0</span> <span class=\"stat-label\">Active Users</span> </div>\n                    </div>\n                    <div class=\"stat-card\"> <i class=\"fas fa-chart-line\"></i>\n                        <div class=\"stat-content\"> <span class=\"stat-number\" data-target=\"1259024\">0</span> <span class=\"stat-label\">Site Visits (24h)</span> </div>\n                    </div>\n                </div>\n                <div class=\"chart-container-wrapper\">\n                    <div class=\"chart-container\">\n                        <h3>Top 5 Malware Families (30 Days)</h3> <canvas id=\"topMalwareChart\"></canvas> </div>\n                    <div class=\"chart-container\">\n                        <h3>Submission Types</h3> <canvas id=\"malwareTypesChart\"></canvas> </div>\n                </div>\n            </div>\n\n            <!-- Disassembly (Shows on analyzing/result) -->\n            <div class=\"disassembly-wrapper\" id=\"disassembly-wrapper\">\n                <div class=\"disassembly-header\">\n                    <h3>Disassembly: <span id=\"disassembly-filename\"></span></h3>\n                </div>\n                <div class=\"disassembly-code\" id=\"disassembly-code\"> </div>\n            </div>\n\n            <!-- File Internals (Shows on result) -->\n            <div class=\"file-internals-container\" id=\"file-internals-wrapper\">\n                <h3>File Internals</h3>\n                \n                <!-- Entropy UI Container -->\n                <div class=\"details-section\">\n                    <h4>Section Entropy (0=Normal, 8=Packed/Encrypted)</h4>\n                    <div class=\"entropy-bars\" id=\"entropy-bars-container\">\n                        <!-- JS will populate this -->\n                    </div>\n                </div>\n                \n                <!-- Key Strings UI Container -->\n                <div class=\"details-section\">\n                    <h4>Suspicious / Key Strings</h4>\n                    <div class=\"key-strings\" id=\"key-strings-container\">\n                        <!-- JS will populate this -->\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Full Width Row -->\n        <div class=\"graph-wrapper\" id=\"graph-wrapper\">\n            <div class=\"graph-header\">\n                <h3>Dynamic Function Call Graph (Simulation)</h3>\n            </div>\n            <div class=\"call-graph-container\">\n                <div class=\"call-graph\" id=\"call-graph\">\n                    <!-- JS will populate this -->\n                </div>\n            </div>\n        </div>\n    </main>\n\n    <!-- History Panel (Hidden by default) -->\n    <div class=\"history-overlay\" id=\"history-overlay\"></div>\n    <div class=\"history-panel\" id=\"history-panel\">\n        <div class=\"history-header\">\n            <h3>Scan History</h3> <button class=\"history-close-btn\" id=\"history-close-btn\"><i class=\"fas fa-times\"></i></button> </div>\n        <ul class=\"history-list\">\n            <!-- JS would populate this -->\n        </ul>\n    </div>\n\n    <!-- Scroll Zones -->\n    <div class=\"scroll-zone top\" id=\"scroll-zone-top\"><i class=\"fas fa-chevron-up\"></i></div>\n    <div class=\"scroll-zone bottom\" id=\"scroll-zone-bottom\"><i class=\"fas fa-chevron-down\"></i></div>\n    \n    <!-- LeaderLine for graph (which you already had) -->\n    <script src=\"https://cdn.jsdelivr.net/npm/leader-line-new@1.1.9/leader-line.min.js\"></script>\n    <!-- Link to the JS file -->\n    <script src=\"script.js\"></script>\n\n    <script>\n    // Apply saved theme class immediately (before DOMContentLoaded)\n    const savedTheme = localStorage.getItem('theme') || 'dark';\n    if (savedTheme === 'light') {\n        document.body.classList.add('light-theme');\n    }\n    \n    document.addEventListener('DOMContentLoaded', () => {\n        const themeToggleButton = document.getElementById('theme-toggle');\n        const body = document.body;\n        const themeIcon = themeToggleButton.querySelector('i');\n\n        // Set icon based on current theme\n        if (body.classList.contains('light-theme')) {\n            themeIcon.classList.remove('fa-sun');\n            themeIcon.classList.add('fa-moon');\n        }\n\n        // Function to apply the saved theme\n        const applyTheme = (theme) => {\n            if (theme === 'light') {\n                body.classList.add('light-theme');\n                themeIcon.classList.remove('fa-sun');\n                themeIcon.classList.add('fa-moon');\n            } else {\n                body.classList.remove('light-theme');\n                themeIcon.classList.remove('fa-moon');\n                themeIcon.classList.add('fa-sun');\n            }\n            \n            // Recreate charts with updated theme colors\n            if (window.recreateCharts) {\n                window.recreateCharts();\n            }\n        };\n\n        // Add click event for the toggle button\n        themeToggleButton.addEventListener('click', (e) => {\n            e.preventDefault(); // Stop the link from navigating\n            \n            // Check current theme\n            const isLightTheme = body.classList.contains('light-theme');\n            \n            // Set new theme\n            const newTheme = isLightTheme ? 'dark' : 'light';\n            \n            // Apply the new theme\n            applyTheme(newTheme);\n            \n            // Save the new theme to localStorage\n            localStorage.setItem('theme', newTheme);\n        });\n    });\n    </script>\n</body>\n</html>\n","epoch":88,"telemetryInfo":{}}],["file:///home/trang/localnsv/mAIware/style.css::request_020092b9-97e0-43b6-b877-ad5f11664ee1",{"uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/style.css","external":"file:///home/trang/localnsv/mAIware/style.css","path":"/home/trang/localnsv/mAIware/style.css","scheme":"file"},"requestId":"request_020092b9-97e0-43b6-b877-ad5f11664ee1","content":"/* --- Global & Fonts --- */\n:root {\n    /* --- Dark Theme (Default) --- */\n    --bg-dark-1: #121212;\n    --bg-dark-2: #1e1e1e;\n    --bg-dark-3: #2a2a2e;\n    --bg-dark-4: #333333;\n    --border-color: #444444;\n    --text-light: #e0e0e0;\n    --text-medium: #aaa;\n    --text-dark: #888;\n    \n    /* --- Semantic Colors --- */\n    --blue: #007bff;\n    --red: #e74c3c;\n    --yellow: #f1c40f;\n    --green: #2ecc71;\n    \n    /* --- Syntax & Node Colors --- */\n    --syntax-op: #c39eff;\n    --syntax-string: #e6db74;\n    --syntax-const-text: #ffffff; /* Constant white for dark buttons/nodes */\n    --node-bg-entry: #254a25;\n    --node-bg-api: #2a3e4a;\n    --node-bg-suspicious: #4a452a;\n    --node-bg-malicious: #4a2a2a;\n\n    --chart-legend-text: var(--text-light);  /* #e0e0e0 */\n    --chart-axes-text: var(--text-medium);   /* #aaa */\n    --chart-grid-line: var(--border-color);\n}\n\n/* --- Light Theme --- */\n/* Add \".light-theme\" to the <body> tag to activate */\nbody.light-theme {\n    --bg-dark-1: #f8f9fa;     /* Main background */\n    --bg-dark-2: #ffffff;     /* Card background */\n    --bg-dark-3: #e9ecef;     /* Hover/active background */\n    --bg-dark-4: #ced4da;     /* Secondary button background */\n    --border-color: #dee2e6;  /* Border color */\n    --text-light: #212529;    /* Main text */\n    --text-medium: #6c757d;   /* Secondary text */\n    --text-dark: #888;        /* Tertiary text (can stay gray) */\n    \n    /* Semantic colors are unchanged */\n    /* --blue, --red, --yellow, --green */\n    \n    /* --- Light Theme Syntax --- */\n    --syntax-op: #a040ff;       /* Darker purple */\n    --syntax-string: #b8860b;     /* Dark goldenrod */\n    --syntax-const-text: #ffffff; /* Stays white for colored buttons/nodes */\n    \n    /* Node backgrounds are unchanged, they look good on a light BG */\n    --chart-legend-text: var(--text-medium); /* User Request */\n    --chart-axes-text: var(--text-medium);   /* User Request */\n    --chart-grid-line: var(--border-color);\n}\n\n\n/* Apply overflow-x to html as well */\nhtml {\n    overflow-x: hidden;\n    font-size: 16px; /* Ensure base font size */\n}\n\nbody {\n    font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n    background-color: var(--bg-dark-1);\n    color: var(--text-light);\n    margin: 0;\n    padding-top: 60px; /* Make space for fixed top nav */\n    overflow-x: hidden; /* Prevent horizontal scroll */\n    width: 100%;\n    min-height: 100vh;\n}\n\n/* --- Main Grid Container --- */\n.main-container {\n    display: grid;\n    grid-template-columns: 1fr 1fr; /* Simpler 2-column definition */\n    grid-template-rows: auto auto; /* Rows for content and graph */\n    gap: 2rem;\n    padding: 2rem; /* Spacing from nav and screen edges */\n    align-items: start;\n    \n    /* Set max-width on the grid itself */\n    max-width: 1400px; \n    /* Center the whole grid */\n    margin: 0 auto; \n    \n    min-height: calc(100vh - 60px); /* Full height minus nav */\n    box-sizing: border-box;\n    width: 100%;\n}\n\n.scanner-wrapper {\n    grid-column: 1 / 2; /* Span first column */\n    grid-row: 1 / 2;\n    display: flex;\n    flex-direction: column;\n    gap: 1.5rem;\n    width: 100%; /* Fill the column */\n}\n\n.right-panel-wrapper {\n    grid-column: 2 / 3; /* Span second column */\n    grid-row: 1 / 2;\n    display: flex; /* Make it a flex container */\n    flex-direction: column; /* Stack its children vertically */\n    gap: 1.5rem; /* Space between its children */\n    width: 100%; /* Fill the column */\n}\n\n.graph-wrapper {\n    grid-column: 1 / 3; /* Span BOTH columns */\n    grid-row: 2 / 3;\n    width: 100%;\n    /* max-width is now inherited from main-container */\n    justify-self: center; /* Center in the grid area */\n}\n\n\n/* --- Top Navigation --- */\n.top-nav {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    height: 60px;\n    background-color: var(--bg-dark-2);\n    border-bottom: 1px solid var(--border-color);\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 0 2rem;\n    z-index: 1000;\n    box-sizing: border-box;\n}\n\n.top-nav .logo {\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n    font-size: 1.3rem;\n    font-weight: 600;\n    color: var(--text-light);\n}\n\n.top-nav .logo i {\n    color: var(--blue);\n}\n\n.nav-links {\n    display: flex;\n    gap: 0.5rem;\n}\n\n.nav-link {\n    color: var(--text-medium);\n    font-size: 1.25rem;\n    padding: 0.75rem;\n    border-radius: 8px;\n    transition: all 0.2s ease;\n    position: relative;\n    text-decoration: none;\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n}\n\n.nav-link .link-text {\n    font-size: 0.9rem;\n    font-weight: 500;\n    max-width: 0;\n    overflow: hidden;\n    white-space: nowrap;\n    transition: all 0.3s ease;\n}\n\n.nav-link:hover {\n    background-color: var(--bg-dark-3);\n    color: var(--text-light);\n}\n\n.nav-link:hover .link-text {\n    max-width: 80px; /* Expand text on hover */\n    margin-left: 0.25rem;\n}\n\n/* --- Tooltip --- */\n.nav-link:hover::before {\n    content: attr(data-tooltip);\n    position: absolute;\n    bottom: -35px;\n    left: 50%;\n    transform: translateX(-50%);\n    background-color: var(--bg-dark-3);\n    color: var(--text-light);\n    padding: 5px 10px;\n    border-radius: 4px;\n    font-size: 0.8rem;\n    white-space: nowrap;\n    opacity: 0;\n    transition: opacity 0.2s 0.3s; /* Delay tooltip */\n    pointer-events: none;\n}\n.nav-link:hover .link-text {\n    display: none; /* Hide expanded text if tooltip is showing */\n}\n.nav-link:hover:hover::before {\n    opacity: 1;\n}\n\n/* On smaller screens, stack the columns */\n@media (max-width: 1280px) { /* Widened breakpoint */\n    .main-container {\n        grid-template-columns: 1fr; /* Stack columns */\n        padding: 1rem;\n    }\n    .scanner-wrapper, .right-panel-wrapper, .graph-wrapper {\n        grid-column: 1 / 2; /* All in one column */\n        max-width: 100%;\n        justify-self: center;\n    }\n    .right-panel-wrapper {\n        grid-row: 2 / 3;\n    }\n    .graph-wrapper {\n        grid-row: 3 / 4;\n    }\n}\n\n/* Hide link text on very small screens */\n@media (max-width: 768px) {\n    .nav-link .link-text { display: none; }\n    .nav-link:hover .link-text { display: none; }\n    .top-nav { padding: 0 1rem; }\n}\n\n\n/* --- Main Scanner Box --- */\n.scanner-container {\n    width: 100%; /* Ensure it fills its flex parent */\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n    padding: 2.5rem;\n    text-align: center;\n    overflow: hidden;\n    transition: all 0.3s ease;\n    box-sizing: border-box; /* Include padding in width */\n}\n\nh1 {\n    color: var(--text-light);\n    margin-top: 0;\n    margin-bottom: 1rem;\n}\n\n.scanner-container p {\n    color: var(--text-medium);\n    margin-bottom: 2rem;\n    font-size: 1.1rem;\n}\n\n.scanner-state {\n    display: none;\n}\n.scanner-state.active {\n    display: block;\n}\n\n/* --- State 1: Upload --- */\n.upload-zone {\n    border: 2px dashed var(--border-color);\n    border-radius: 8px;\n    padding: 3rem 2rem;\n    cursor: pointer;\n    transition: all 0.3s ease;\n}\n.upload-zone:hover {\n    background-color: var(--bg-dark-3);\n    border-color: var(--blue);\n}\n.upload-icon {\n    font-size: 4rem;\n    color: var(--blue);\n    margin-bottom: 1rem;\n}\n.upload-zone h3 {\n    margin: 0;\n    color: var(--text-light);\n}\n.upload-zone span {\n    color: var(--text-dark);\n}\n\n/* --- State 2: Analyzing --- */\n.analyzing-icon .loader {\n    width: 80px;\n    height: 80px;\n    border: 6px solid var(--bg-dark-4);\n    border-top-color: var(--blue);\n    border-radius: 50%;\n    animation: spin 1s linear infinite;\n    margin: 2rem auto;\n}\n@keyframes spin {\n    to { transform: rotate(360deg); }\n}\n.analyzing-state h3 {\n    color: var(--text-light);\n    margin-bottom: 0.5rem;\n}\n.analyzing-state .filename,\n.result-state .filename {\n    color: var(--text-medium);\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 1.1rem;\n    word-break: break-all;\n}\n\n/* --- State 3: Result --- */\n.result-icon {\n    font-size: 6rem;\n    line-height: 1;\n    margin: 1.5rem 0;\n}\n.result-state h2 {\n    font-size: 2.5rem;\n    margin: 0 0 0.5rem 0;\n}\n.result-malware .result-icon, .result-malware h2 { color: var(--red); }\n.result-suspicious .result-icon, .result-suspicious h2 { color: var(--yellow); }\n.result-safe .result-icon, .result-safe h2 { color: var(--green); }\n.result-state p {\n    font-size: 1rem;\n    margin-bottom: 2rem;\n}\n\n.non-pe-result {\n    display: none;\n    flex-direction: column;\n    align-items: center;\n    gap: 1.5rem;\n    color: var(--text-light);\n    padding: 1rem 0 0 0;\n}\n\n.non-pe-result.active {\n    display: flex;\n}\n\n.non-pe-icon {\n    width: 96px;\n    height: 96px;\n    border-radius: 24px;\n    background: linear-gradient(135deg, rgba(80, 130, 255, 0.2), rgba(80, 130, 255, 0.05));\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 3rem;\n    color: var(--blue);\n}\n\n.non-pe-hash-grid {\n    display: flex;\n    gap: 1.5rem;\n    flex-wrap: wrap;\n    justify-content: center;\n}\n\n.non-pe-hash {\n    min-width: 220px;\n    background: var(--bg-dark-3);\n    padding: 1rem 1.25rem;\n    border-radius: 12px;\n    border: 1px solid rgba(255, 255, 255, 0.05);\n    text-align: left;\n}\n\n.non-pe-hash h4 {\n    margin: 0 0 0.5rem 0;\n    font-size: 0.85rem;\n    text-transform: uppercase;\n    letter-spacing: 0.08rem;\n    color: var(--text-medium);\n}\n\n.non-pe-hash p {\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.9rem;\n    word-break: break-all;\n    color: var(--text-light);\n}\n\nbody.is-non-pe .analysis-details-container,\nbody.is-non-pe #analysis-details-wrapper,\nbody.is-non-pe #disassembly-wrapper,\nbody.is-non-pe #file-internals-wrapper,\nbody.is-non-pe #graph-wrapper {\n    display: none !important;\n}\n\nbody.is-non-pe #result-state {\n    display: none !important;\n}\n\nbody.is-non-pe .non-pe-result {\n    display: flex;\n}\n\n\n/* --- NEW: Stats Dashboard Panel --- */\n.stats-wrapper {\n    display: flex; \n    flex-direction: column;\n    gap: 1.5rem;\n    width: 100%; /* Fill its flex parent */\n    box-sizing: border-box; /* Include padding in width */\n}\n\n/* By default, stats are visible, disassembly is hidden */\n.disassembly-wrapper { display: none; }\n\n/* When analyzing/showing results, hide stats and show disassembly */\nbody.is-analyzing .stats-wrapper,\nbody.is-showing-result .stats-wrapper {\n    display: none;\n}\nbody.is-analyzing .disassembly-wrapper,\nbody.is-showing-result .disassembly-wrapper {\n    display: flex; /* Use flex to match its own styles */\n}\n\n\n.stats-grid {\n    display: flex; \n    flex-direction: column;\n    /* Force stacking */\n    gap: 1.5rem;\n}\n\n.stat-card {\n    display: flex;\n    align-items: center;\n    gap: 1.5rem;\n    background-color: var(--bg-dark-2);\n    padding: 1.5rem;\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n}\n.stat-card i {\n    font-size: 2.5rem;\n    color: var(--blue);\n}\n.stat-content {\n    display: flex;\n    flex-direction: column;\n}\n.stat-number {\n    font-size: 2rem;\n    font-weight: 600;\n    color: var(--text-light);\n    line-height: 1.2;\n}\n.stat-label {\n    font-size: 0.9rem;\n    color: var(--text-medium);\n}\n\n.chart-container-wrapper {\n    display: flex;\n    flex-direction: column;\n    gap: 1.5rem;\n}\n\n.chart-container {\n    background-color: var(--bg-dark-2);\n    padding: 1.5rem;\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    box-sizing: border-box;\n}\n.chart-container h3 {\n    margin-top: 0;\n    margin-bottom: 1.5rem;\n    text-align: center;\n    color: var(--text-light);\n    font-size: 1.1rem;\n}\n\n\n/* --- Disassembly Panel --- */\n.disassembly-wrapper {\n    /* display: none; set by default now */\n    flex-direction: column;\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n    height: 600px; /* Fixed height */\n    max-height: 70vh;\n    opacity: 0;\n    transition: all 0.3s ease;\n    width: 100%;\n    box-sizing: border-box;\n}\n\nbody.is-analyzing .disassembly-wrapper,\nbody.is-showing-result .disassembly-wrapper {\n    opacity: 1;\n}\n\n.disassembly-header {\n    padding: 1rem 1.5rem;\n    border-bottom: 1px solid var(--border-color);\n    background-color: var(--bg-dark-3);\n    border-radius: 12px 12px 0 0;\n}\n.disassembly-header h3 {\n    margin: 0;\n    color: var(--text-light);\n    font-size: 1.1rem;\n    font-family: 'Courier New', Courier, monospace;\n}\n.disassembly-code {\n    flex-grow: 1;\n    overflow-y: auto;\n    padding: 1rem;\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.95rem;\n}\n.disassembly-line {\n    display: block;\n    padding: 2px 1rem;\n    border-radius: 4px;\n    transition: background-color 0.2s ease;\n}\n.disassembly-line.active {\n    background-color: var(--blue);\n    color: var(--syntax-const-text); /* MODIFIED */\n}\n.disassembly-line .addr { color: var(--text-dark); margin-right: 1rem; }\n.disassembly-line .op { color: var(--syntax-op); font-weight: bold; width: 50px; display: inline-block; } /* MODIFIED */\n.disassembly-line .args { color: var(--text-light); }\n.disassembly-line .string { color: var(--syntax-string); } /* MODIFIED */\n.disassembly-line .comment { color: var(--green); margin-left: 1rem; }\n\n\n/* --- Analysis Details Panel --- */\n.analysis-details-container {\n    width: 100%;\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    padding: 2rem;\n    display: none; /* Hidden by default */\n    box-sizing: border-box;\n}\nbody.is-showing-result .analysis-details-container {\n    display: block;\n}\n\n.progress-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 0.75rem;\n}\n.progress-header h3 {\n    margin: 0;\n    font-size: 1.1rem;\n    color: var(--text-light);\n}\n.score-percentage {\n    font-size: 1.2rem;\n    font-weight: 600;\n}\n.score-green { color: var(--green); }\n.score-yellow { color: var(--yellow); }\n.score-red { color: var(--red); }\n\n.progress-bar-background {\n    width: 100%;\n    height: 12px;\n    background-color: var(--bg-dark-3);\n    border-radius: 6px;\n    overflow: hidden;\n    margin-bottom: 1.5rem;\n}\n.progress-bar-fill {\n    height: 100%;\n    width: 0%;\n    border-radius: 6px;\n    transition: width 0.5s ease;\n}\n.progress-bar-green { background-color: var(--green); }\n.progress-bar-yellow { background-color: var(--yellow); }\n.progress-bar-red { background-color: var(--red); }\n\n.details-section {\n    margin-bottom: 1.25rem;\n}\n.details-section h4 {\n    margin: 0 0 0.5rem 0;\n    color: var(--text-medium);\n    font-size: 0.9rem;\n    text-transform: uppercase;\n}\n.details-section p {\n    margin: 0;\n    color: var(--text-light);\n    font-size: 1rem;\n}\n.hash-text {\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.95rem;\n    word-break: break-all;\n}\n\n/* --- Vendor & Signature --- */\n.details-grid {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 1.5rem;\n    margin-bottom: 1.25rem;\n}\n.vendor-info, .signature-info {\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n    font-size: 1rem;\n    font-weight: 500;\n}\n.vendor-info i {\n    font-size: 1.5rem;\n    color: var(--text-medium);\n}\n.signature-info i {\n    font-size: 1.25rem;\n}\n/* Use the levels from datasrcs.js */\n.sig-verified { color: var(--green); }\n.sig-untrusted { color: var(--red); }\n.sig-unknown { color: var(--yellow); }\n\n/* --- File Internals Card --- */\n.file-internals-container {\n    width: 100%;\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    padding: 2rem;\n    display: none; /* Hidden by default */\n    box-sizing: border-box;\n    flex-direction: column;\n    gap: 1.5rem;\n}\nbody.is-showing-result .file-internals-container {\n    display: flex;\n}\n.file-internals-container h3 {\n    margin-top: 0;\n    margin-bottom: 0;\n    color: var(--text-light);\n    font-size: 1.25rem;\n    padding-bottom: 1rem;\n    border-bottom: 1px solid var(--border-color);\n}\n\n/* --- Entropy Bars --- */\n.entropy-bars {\n    display: flex;\n    flex-direction: column;\n    gap: 0.75rem;\n}\n.entropy-bar-row {\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n}\n.entropy-bar-label {\n    width: 60px;\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.9rem;\n    color: var(--text-medium);\n    flex-shrink: 0;\n}\n.entropy-bar-bg {\n    flex-grow: 1;\n    height: 20px;\n    background-color: var(--bg-dark-3);\n    border-radius: 4px;\n    overflow: hidden;\n}\n.entropy-bar-fill {\n    height: 100%;\n    width: 0%; /* Set by JS */\n    background-color: var(--blue);\n    border-radius: 4px;\n    transition: width 0.5s ease;\n    display: flex;\n    justify-content: flex-end;\n    align-items: center;\n    padding-right: 0.5rem;\n    box-sizing: border-box;\n}\n.entropy-bar-value {\n    font-size: 0.8rem;\n    font-weight: bold;\n    color: var(--syntax-const-text); /* MODIFIED */\n    text-shadow: 0 0 3px rgba(0,0,0,0.5);\n}\n/* Color coding for entropy bars */\n.entropy-bar-fill.low { background-color: var(--green); }\n.entropy-bar-fill.medium { background-color: var(--blue); }\n.entropy-bar-fill.high { background-color: var(--yellow); }\n.entropy-bar-fill.packed { background-color: var(--red); }\n\n/* --- Key Strings --- */\n.key-strings {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 0.5rem;\n}\n.key-string-tag {\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.9rem;\n    background-color: var(--bg-dark-3);\n    border: 1px solid var(--border-color);\n    padding: 0.25rem 0.5rem;\n    border-radius: 4px;\n    color: var(--text-light);\n}\n.key-string-tag.suspicious {\n    border-color: var(--red);\n    color: var(--red);\n    background-color: #e74c3c1a;\n}\n.key-string-tag.benign {\n    border-color: var(--green);\n    color: var(--green);\n    background-color: #2ecc711a;\n}\n\n/* --- Buttons --- */\n.btn-wrapper {\n    margin-top: 2rem;\n    display: flex;\n    gap: 1rem;\n}\n.btn {\n    flex-grow: 1; /* Make buttons fill space */\n    background-color: var(--blue);\n    color: var(--syntax-const-text); /* MODIFIED */\n    border: none;\n    padding: 12px 24px;\n    border-radius: 6px;\n    font-size: 1rem;\n    font-weight: bold;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    text-decoration: none;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    gap: 0.5rem;\n}\n.btn:hover {\n    filter: brightness(1.2);\n}\n.btn-primary {\n    background-color: var(--blue);\n}\n.btn-secondary {\n    background-color: var(--bg-dark-4);\n    color: var(--text-light);\n}\n.btn-secondary:hover {\n    background-color: #555;\n}\n.btn i {\n    margin-right: 0.25rem;\n}\n\n\n/* --- Background Particle Animations --- */\n.animation-swarm {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%; \n    height: 100%;\n    z-index: -1;\n    pointer-events: none;\n    overflow: hidden; \n}\n\n/* Base style for each new span particle */\n.animation-swarm span {\n    position: absolute;\n    top: -20px; /* Start off-screen */\n    font-size: 1.5rem;\n    opacity: 0; /* Start invisible */\n    animation: fall 10s linear infinite;\n}\n\n/* The ::before holds the icon content */\n.animation-swarm span::before {\n    content: '';\n    font-family: \"Font Awesome 6 Free\";\n    font-weight: 900;\n    text-shadow: 0 0 5px;\n}\n\n/* Keyframes for falling (starts with opacity) */\n@keyframes fall {\n    0% {\n        transform: translateY(0vh) rotate(0);\n        opacity: 0.3;\n    }\n    100% {\n        transform: translateY(105vh) rotate(360deg);\n        opacity: 0;\n    }\n}\n\n/* Set icon and color based on body class */\nbody.result-safe-active .animation-swarm span::before {\n    content: '\\f132'; /* fa-shield-halved */\n    color: var(--green);\n}\nbody.result-suspicious-active .animation-swarm span::before {\n    content: '\\f071'; /* fa-exclamation-triangle */\n    color: var(--yellow);\n}\nbody.result-malware-active .animation-swarm span::before {\n    content: '\\f188'; /* fa-bug */\n    color: var(--red);\n}\n\n/* Give each particle a unique position and delay --- THIS IS THE FINAL FIX --- */\n/* All values are kept well away from the 90-100% range */\n.animation-swarm span:nth-child(1) { left: 10%; animation-delay: 0s; }\n.animation-swarm span:nth-child(2) { left: 20%; animation-delay: -2s; }\n.animation-swarm span:nth-child(3) { left: 30%; animation-delay: -4s; }\n.animation-swarm span:nth-child(4) { left: 40%; animation-delay: -6s; }\n.animation-swarm span:nth-child(5) { left: 50%; animation-delay: -8s; }\n.animation-swarm span:nth-child(6) { left: 60%; animation-delay: -1s; }\n.animation-swarm span:nth-child(7) { left: 70%; animation-delay: -3s; }\n.animation-swarm span:nth-child(8) { left: 75%; animation-delay: -5s; } /* Was 80% */\n.animation-swarm span:nth-child(9) { left: 15%; animation-delay: -7s; } /* Was 90% */\n.animation-swarm span:nth-child(10) { left: 5%; animation-delay: -9s; }\n\n\n/* --- History Panel --- */\n.history-overlay {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0,0,0,0.5);\n    z-index: 1001;\n    opacity: 0;\n    visibility: hidden;\n    transition: all 0.3s ease;\n}\n.history-panel {\n    position: fixed;\n    top: 0;\n    right: -450px; /* Start off-screen */\n    width: 400px;\n    max-width: 90%;\n    height: 100%;\n    background-color: var(--bg-dark-2);\n    z-index: 1002;\n    transition: all 0.3s ease;\n    display: flex;\n    flex-direction: column;\n}\nbody.is-history-open .history-overlay {\n    opacity: 1;\n    visibility: visible;\n}\nbody.is-history-open .history-panel {\n    right: 0;\n}\n.history-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 1rem 1.5rem;\n    border-bottom: 1px solid var(--border-color);\n}\n.history-header h3 {\n    margin: 0;\n    font-size: 1.2rem;\n}\n.history-close-btn {\n    background: none;\n    border: none;\n    color: var(--text-medium);\n    font-size: 1.5rem;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n.history-close-btn:hover {\n    color: var(--text-light);\n}\n.history-list {\n    list-style: none;\n    padding: 0;\n    margin: 0;\n    overflow-y: auto;\n    flex-grow: 1;\n}\n.history-list li {\n    display: flex;\n    align-items: center;\n    gap: 1rem;\n    padding: 1rem 1.5rem;\n    border-bottom: 1px solid var(--border-color);\n    transition: background-color 0.2s ease;\n}\n\n.history-list li:hover {\n    background-color: var(--bg-dark-3);\n}\n\n.history-item {\n    display: flex;\n    align-items: flex-start;\n    gap: 1rem;\n}\n\n.history-icon-wrapper {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 0.5rem;\n    min-width: 60px;\n}\n\n.history-icon {\n    font-size: 1.8rem;\n    width: 40px;\n    height: 40px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    border-radius: 8px;\n    background-color: var(--bg-dark-3);\n}\n\n.history-icon.safe {\n    color: var(--green);\n    border: 2px solid var(--green);\n}\n\n.history-icon.suspicious {\n    color: var(--yellow);\n    border: 2px solid var(--yellow);\n}\n\n.history-icon.malware {\n    color: var(--red);\n    border: 2px solid var(--red);\n}\n\n.history-file-type {\n    font-size: 1rem;\n    color: var(--text-medium);\n}\n\n.history-details {\n    flex-grow: 1;\n    display: flex;\n    flex-direction: column;\n    gap: 0.5rem;\n    min-width: 0; /* Allow text truncation */\n}\n\n.history-filename {\n    font-weight: 600;\n    color: var(--text-light);\n    font-size: 0.95rem;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.history-classification {\n    font-size: 0.85rem;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.05em;\n}\n\n.history-classification.safe {\n    color: var(--green);\n}\n\n.history-classification.suspicious {\n    color: var(--yellow);\n}\n\n.history-classification.malware {\n    color: var(--red);\n}\n\n.history-hash {\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.75rem;\n    color: var(--text-medium);\n    background-color: var(--bg-dark-3);\n    padding: 0.25rem 0.5rem;\n    border-radius: 4px;\n    word-break: break-all;\n    line-height: 1.4;\n}\n\n.history-date {\n    font-size: 0.8rem;\n    color: var(--text-medium);\n    white-space: nowrap;\n    align-self: flex-start;\n    padding-top: 0.25rem;\n}\n\n.history-item-empty,\n.history-item-loading {\n    color: var(--text-medium);\n    text-align: center;\n    padding: 2rem;\n    font-style: italic;\n}\n\n\n/* --- Hover Scroll Zones --- */\n.scroll-zone {\n    position: fixed;\n    left: 0;\n    width: 100%;\n    height: 80px;\n    z-index: 998;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n}\n.scroll-zone.top { top: 60px; /* Below nav */ }\n.scroll-zone.bottom { bottom: 0; }\n\n.scroll-zone i {\n    font-size: 2rem;\n    color: var(--text-light);\n    opacity: 0;\n    transition: all 0.3s ease;\n    text-shadow: 0 0 15px rgba(0,0,0,0.7);\n}\n.scroll-zone.scrolling i {\n    opacity: 0.3;\n}\n.scroll-zone:hover i {\n    opacity: 0.7;\n}\n\n\n/* --- Graph Panel --- */\n.graph-wrapper {\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n    margin-top: 1rem;\n    display: none; /* Hidden by default */\n    box-sizing: border-box;\n}\nbody.is-showing-result .graph-wrapper {\n    display: block; /* Show with results */\n}\n\n.graph-header {\n    padding: 1rem 1.5rem;\n    border-bottom: 1px solid var(--border-color);\n    background-color: var(--bg-dark-3);\n    border-radius: 12px 12px 0 0;\n}\n.graph-header h3 {\n    margin: 0;\n    color: var(--text-light);\n    font-size: 1.1rem;\n}\n.call-graph-container {\n    overflow: auto; /* Allow scrolling for large graphs */\n}\n.call-graph {\n    flex-grow: 1;\n    overflow: auto;\n    position: relative; /* KEY for node positioning */\n    min-height: 400px;\n    padding: 1rem;\n}\n\n.graph-node {\n    position: absolute;\n    padding: 0.75rem 1.25rem;\n    border-radius: 8px;\n    background-color: var(--bg-dark-3);\n    border: 2px solid var(--border-color);\n    font-family: 'Courier New', Courier, monospace;\n    font-weight: bold;\n    white-space: nowrap;\n    box-shadow: 0 4px 10px rgba(0,0,0,0.3);\n    z-index: 2;\n    text-align: center;\n}\n/* MODIFIED to use variables */\n.node-entry { background-color: var(--node-bg-entry); border-color: var(--green); color: var(--syntax-const-text); }\n.node-std { background-color: var(--bg-dark-3); border-color: var(--border-color); color: var(--text-light); }\n.node-api { background-color: var(--node-bg-api); border-color: var(--blue); color: var(--syntax-const-text); }\n.node-suspicious { background-color: var(--node-bg-suspicious); border-color: var(--yellow); color: var(--syntax-const-text); }\n.node-malicious { background-color: var(--node-bg-malicious); border-color: var(--red); color: var(--syntax-const-text); }\n\n.leader-line {\n    z-index: 1; /* Sit behind nodes */\n    opacity: 0.8;\n}\nbody.light-theme .chart-container {\n    color: var(--text-medium);\n}\n","epoch":91,"telemetryInfo":{}}],["file:///home/trang/localnsv/mAIware/index.html::request_e1cb39fa-c4c3-4d4b-b7e1-a9c3f8c3b4cc",{"uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/index.html","external":"file:///home/trang/localnsv/mAIware/index.html","path":"/home/trang/localnsv/mAIware/index.html","scheme":"file"},"requestId":"request_e1cb39fa-c4c3-4d4b-b7e1-a9c3f8c3b4cc","content":"<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>mAIware AI Malware Detection Demo</title>\n    <!-- Font Awesome for icons (which you already had) -->\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css\">\n    <!-- Chart.js for stats (which you already had) -->\n    <script src=\"https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js\"></script>\n    <!-- Link to the CSS file -->\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n\n<body>\n    <nav class=\"top-nav\">\n        <div class=\"logo\"> <i class=\"fas fa-shield-virus\"></i> <span>mAIware</span> </div>\n        <div class=\"nav-links\"> <a href=\"#\" class=\"nav-link\" data-tooltip=\"Login\"><i class=\"fas fa-sign-in-alt\"></i><span class=\"link-text\">Login</span></a> <a href=\"#\" class=\"nav-link\" data-tooltip=\"Sign Up\"><i class=\"fas fa-user-plus\"></i><span class=\"link-text\">Sign Up</span></a> <a href=\"#\" class=\"nav-link\" data-tooltip=\"Community\"><i class=\"fas fa-users\"></i><span class=\"link-text\">Community</span></a> <a href=\"#\" class=\"nav-link\" data-tooltip=\"API Docs\"><i class=\"fas fa-code\"></i><span class=\"link-text\">API</span></a> <a href=\"#\" id=\"history-btn\" class=\"nav-link\" data-tooltip=\"Scan History\"><i class=\"fas fa-history\"></i><span class=\"link-text\">History</span></a> <a href=\"#\" class=\"nav-link\" id=\"theme-toggle\" data-tooltip=\"Toggle Theme\"> <i class=\"fas fa-sun\"></i> </a> </div>\n    </nav>\n\n    <main class=\"main-container\">\n        <!-- Column 1 -->\n        <div class=\"scanner-wrapper\">\n            <!-- Main Scanner Box -->\n            <div class=\"scanner-container\">\n                <h1>AI Malware Detection</h1>\n                <!-- State 1: Initial -->\n                <div id=\"initial-state\" class=\"scanner-state active\">\n                    <p>Watching your Downloads folder for new files...</p>\n                    <div id=\"drop-zone\" class=\"upload-zone\"> <i class=\"upload-icon fas fa-eye\"></i>\n                        <h3>Automatic Scanning Active</h3>\n                        <span>(Download a file to begin)</span>\n                    </div>\n                </div>\n\n                <!-- State 2: Analyzing -->\n                <div id=\"analyzing-state\" class=\"scanner-state\">\n                    <div class=\"analyzing-icon\">\n                        <div class=\"loader\"></div>\n                    </div>\n                    <h3>Analyzing...</h3> <span class=\"filename\" id=\"analyzing-filename\">demo_file.exe</span> </div>\n\n                <!-- State 3: Result -->\n                <div id=\"result-state\" class=\"scanner-state\"> <i class=\"result-icon\" id=\"result-icon\"></i>\n                    <h2 id=\"result-text\"></h2>\n                    <div class=\"filename\" id=\"result-filename\"></div>\n                    <p id=\"result-details\"></p>\n                    <!-- Removed the resetDemo() button as it's automatic now -->\n                    \n                    <!-- Navigation Controls -->\n                    <div class=\"scan-navigation\">\n                        <button id=\"prev-scan-btn\" class=\"nav-btn\" disabled>\n                            <i class=\"fas fa-chevron-left\"></i> Previous\n                        </button>\n                        <span id=\"nav-info\" class=\"nav-info\">1 of 1</span>\n                        <button id=\"next-scan-btn\" class=\"nav-btn\" disabled>\n                            Next <i class=\"fas fa-chevron-right\"></i>\n                        </button>\n                    </div>\n                </div>\n                <div id=\"non-pe-result\" class=\"scanner-state non-pe-result\">\n                    <div class=\"non-pe-icon\"><i class=\"fas fa-file\"></i></div>\n                    <h2 id=\"non-pe-title\">File is not a Windows PE executable</h2>\n                    <p class=\"filename\" id=\"non-pe-filename\"></p>\n                    <div class=\"non-pe-hash-grid\">\n                        <div class=\"non-pe-hash\">\n                            <h4>SHA256</h4>\n                            <p id=\"non-pe-hash-sha256\">...</p>\n                        </div>\n                        <div class=\"non-pe-hash\">\n                            <h4>MD5</h4>\n                            <p id=\"non-pe-hash-md5\">...</p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Analysis Details (Shows on result) -->\n            <div class=\"analysis-details-container\" id=\"analysis-details-wrapper\">\n                <div class=\"progress-header\">\n                    <h3>Malware Confidence</h3> <span class=\"score-percentage\" id=\"score-percentage\">0%</span> </div>\n                <div class=\"progress-bar-background\">\n                    <div class=\"progress-bar-fill\" id=\"progress-bar-fill\" style=\"width: 0%;\"></div>\n                </div>\n\n                <!-- This grid holds Vendor and Signature -->\n                <div class=\"details-grid\">\n                    <!-- Vendor UI Container -->\n                    <div class=\"details-section\" id=\"details-vendor\">\n                        <h4>Vendor Analysis</h4>\n                        <div class=\"vendor-info\">\n                            <i class=\"fas fa-question-circle\"></i>\n                            <span>Scanning...</span>\n                        </div>\n                    </div>\n                    <!-- Signature UI Container -->\n                    <div class=\"details-section\" id=\"details-signature\">\n                        <h4>Digital Signature</h4>\n                        <div class=\"signature-info\">\n                            <i class=\"fas fa-question-circle\"></i>\n                            <span>Checking...</span>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Reasoning (File Type/Packer) -->\n                <div class=\"details-section\">\n                    <h4>Key Findings</h4>\n                    <p id=\"details-reasoning\">...</p>\n                </div>\n                \n                <div class=\"details-section\">\n                    <h4>SHA256 Hash</h4>\n                    <p class=\"hash-text\" id=\"details-hash-sha256\">...</p>\n                </div>\n\n                <div class=\"details-section\">\n                    <h4>MD5 Hash</h4>\n                    <p class=\"hash-text\" id=\"details-hash-md5\">...</p>\n                </div>\n\n                <div class=\"details-section\">\n                    <h4>System IP</h4>\n                    <p class=\"hash-text\" id=\"details-system-ip\">Detecting...</p>\n                </div>\n\n                <div class=\"details-section\">\n                    <h4>What To Do Next</h4>\n                    <p id=\"details-recommendation\">...</p>\n                </div>\n\n                <div class=\"btn-wrapper\"> <button class=\"btn btn-primary\"><i class=\"fas fa-download\"></i> Download Report</button> <button class=\"btn btn-secondary\"><i class=\"fas fa-flag\"></i> Report False Positive</button> </div>\n            </div>\n        </div>\n\n        <!-- Column 2 -->\n        <div class=\"right-panel-wrapper\">\n            <!-- Stats (Shows on initial) -->\n            <div class=\"stats-wrapper\" id=\"stats-wrapper\">\n                <div class=\"stats-grid\">\n                    <div class=\"stat-card\"> <i class=\"fas fa-virus-slash\"></i>\n                        <div class=\"stat-content\"> <span class=\"stat-number\" data-target=\"14720938\">0</span> <span class=\"stat-label\">Malware Analyzed</span> </div>\n                    </div>\n                    <div class=\"stat-card\"> <i class=\"fas fa-users\"></i>\n                        <div class=\"stat-content\"> <span class=\"stat-number\" data-target=\"82041\">0</span> <span class=\"stat-label\">Active Users</span> </div>\n                    </div>\n                    <div class=\"stat-card\"> <i class=\"fas fa-chart-line\"></i>\n                        <div class=\"stat-content\"> <span class=\"stat-number\" data-target=\"1259024\">0</span> <span class=\"stat-label\">Site Visits (24h)</span> </div>\n                    </div>\n                </div>\n                <div class=\"chart-container-wrapper\">\n                    <div class=\"chart-container\">\n                        <h3>Top 5 Malware Families (30 Days)</h3> <canvas id=\"topMalwareChart\"></canvas> </div>\n                    <div class=\"chart-container\">\n                        <h3>Submission Types</h3> <canvas id=\"malwareTypesChart\"></canvas> </div>\n                </div>\n            </div>\n\n            <!-- Disassembly (Shows on analyzing/result) -->\n            <div class=\"disassembly-wrapper\" id=\"disassembly-wrapper\">\n                <div class=\"disassembly-header\">\n                    <h3>Disassembly: <span id=\"disassembly-filename\"></span></h3>\n                </div>\n                <div class=\"disassembly-code\" id=\"disassembly-code\"> </div>\n            </div>\n\n            <!-- File Internals (Shows on result) -->\n            <div class=\"file-internals-container\" id=\"file-internals-wrapper\">\n                <h3>File Internals</h3>\n                \n                <!-- Entropy UI Container -->\n                <div class=\"details-section\">\n                    <h4>Section Entropy (0=Normal, 8=Packed/Encrypted)</h4>\n                    <div class=\"entropy-bars\" id=\"entropy-bars-container\">\n                        <!-- JS will populate this -->\n                    </div>\n                </div>\n                \n                <!-- Key Strings UI Container -->\n                <div class=\"details-section\">\n                    <h4>Suspicious / Key Strings</h4>\n                    <div class=\"key-strings\" id=\"key-strings-container\">\n                        <!-- JS will populate this -->\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Full Width Row -->\n        <div class=\"graph-wrapper\" id=\"graph-wrapper\">\n            <div class=\"graph-header\">\n                <h3>Dynamic Function Call Graph (Simulation)</h3>\n            </div>\n            <div class=\"call-graph-container\">\n                <div class=\"call-graph\" id=\"call-graph\">\n                    <!-- JS will populate this -->\n                </div>\n            </div>\n        </div>\n    </main>\n\n    <!-- History Panel (Hidden by default) -->\n    <div class=\"history-overlay\" id=\"history-overlay\"></div>\n    <div class=\"history-panel\" id=\"history-panel\">\n        <div class=\"history-header\">\n            <h3>Scan History</h3> <button class=\"history-close-btn\" id=\"history-close-btn\"><i class=\"fas fa-times\"></i></button> </div>\n        <ul class=\"history-list\">\n            <!-- JS would populate this -->\n        </ul>\n    </div>\n\n    <!-- Scroll Zones -->\n    <div class=\"scroll-zone top\" id=\"scroll-zone-top\"><i class=\"fas fa-chevron-up\"></i></div>\n    <div class=\"scroll-zone bottom\" id=\"scroll-zone-bottom\"><i class=\"fas fa-chevron-down\"></i></div>\n    \n    <!-- LeaderLine for graph (which you already had) -->\n    <script src=\"https://cdn.jsdelivr.net/npm/leader-line-new@1.1.9/leader-line.min.js\"></script>\n    <!-- Link to the JS file -->\n    <script src=\"script.js\"></script>\n\n    <script>\n    // Apply saved theme class immediately (before DOMContentLoaded)\n    const savedTheme = localStorage.getItem('theme') || 'dark';\n    if (savedTheme === 'light') {\n        document.body.classList.add('light-theme');\n    }\n    \n    document.addEventListener('DOMContentLoaded', () => {\n        const themeToggleButton = document.getElementById('theme-toggle');\n        const body = document.body;\n        const themeIcon = themeToggleButton.querySelector('i');\n\n        // Set icon based on current theme\n        if (body.classList.contains('light-theme')) {\n            themeIcon.classList.remove('fa-sun');\n            themeIcon.classList.add('fa-moon');\n        }\n\n        // Function to apply the saved theme\n        const applyTheme = (theme) => {\n            if (theme === 'light') {\n                body.classList.add('light-theme');\n                themeIcon.classList.remove('fa-sun');\n                themeIcon.classList.add('fa-moon');\n            } else {\n                body.classList.remove('light-theme');\n                themeIcon.classList.remove('fa-moon');\n                themeIcon.classList.add('fa-sun');\n            }\n            \n            // Recreate charts with updated theme colors\n            if (window.recreateCharts) {\n                window.recreateCharts();\n            }\n        };\n\n        // Add click event for the toggle button\n        themeToggleButton.addEventListener('click', (e) => {\n            e.preventDefault(); // Stop the link from navigating\n            \n            // Check current theme\n            const isLightTheme = body.classList.contains('light-theme');\n            \n            // Set new theme\n            const newTheme = isLightTheme ? 'dark' : 'light';\n            \n            // Apply the new theme\n            applyTheme(newTheme);\n            \n            // Save the new theme to localStorage\n            localStorage.setItem('theme', newTheme);\n        });\n    });\n    </script>\n</body>\n</html>\n","epoch":96,"telemetryInfo":{}}],["file:///home/trang/localnsv/mAIware/script.js::request_e1cb39fa-c4c3-4d4b-b7e1-a9c3f8c3b4cc",{"uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/script.js","external":"file:///home/trang/localnsv/mAIware/script.js","path":"/home/trang/localnsv/mAIware/script.js","scheme":"file"},"requestId":"request_e1cb39fa-c4c3-4d4b-b7e1-a9c3f8c3b4cc","content":"// --- MOCK DISASSEMBLY DATA ---\n// (We keep this for now, as requested)\nconst mockDisassemblyBenign = [\n    `<span class=\"addr\">0x401000</span> <span class=\"op\">PUSH</span> <span class=\"args\">ebp</span> <span class=\"comment\">; setup stack frame</span>`,\n    `<span class=\"addr\">0x401001</span> <span class=\"op\">MOV</span> <span class=\"args\">ebp, esp</span>`,\n    `<span class=\"addr\">0x401003</span> <span class=\"op\">SUB</span> <span class=\"args\">esp, 48h</span>`,\n    `<span class=\"addr\">0x40100C</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4012A0</span> <span class=\"comment\">; initialize_string</span>`,\n    `<span class=\"addr\">0x401015</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4013F0</span> <span class=\"comment\">; get_user_input</span>`,\n    `<span class=\"addr\">0x40101E</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4015D0</span> <span class=\"comment\">; print_output</span>`,\n    `<span class=\"addr\">0x401028</span> <span class=\"op\">RETN</span>`,\n    `<span class=\"addr\">...</span>`,\n];\nconst mockDisassemblySuspicious = [\n    `<span class=\"addr\">0x401000</span> <span class=\"op\">PUSH</span> <span class=\"args\">ebp</span>`,\n    `<span class=\"addr\">0x401003</span> <span class=\"op\">SUB</span> <span class=\"args\">esp, 80h</span>`,\n    `<span class=\"addr\">0x40100D</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4012A0</span> <span class=\"comment\">; read_file_to_buffer</span>`,\n    `<span class=\"addr\">0x40101B</span> <span class=\"op\">REP</span> <span class=\"op\">MOVSB</span> <span class=\"comment\">; unsafe buffer write</span>`,\n    `<span class=\"addr\">0x401020</span> <span class=\"op\">JGE</span> <span class=\"args\">0x401030</span> <span class=\"comment\">; jump if overflow</span>`,\n    `<span class=\"addr\">0x401028</span> <span class=\"op\">RETN</span>`,\n    `<span class=\"addr\">...</span>`,\n];\nconst mockDisassemblyMalware = [\n    `<span class=\"addr\">0x401000</span> <span class=\"op\">PUSH</span> <span class=\"args\">ebp</span> <span class=\"comment\">; setup stack frame</span>`,\n    `<span class=\"addr\">0x40100B</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4011B0</span> <span class=\"comment\">; kernel32.LoadLibraryA</span>`,\n    `<span class=\"addr\">0x401013</span> <span class=\"op\">PUSH</span> <span class=\"string\">\"CreateRemoteThread\"</span>`,\n    `<span class=\"addr\">0x401019</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4011C0</span> <span class=\"comment\">; kernel32.GetProcAddress</span>`,\n    `<span class=\"addr\">0x401028</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4012F0</span> <span class=\"comment\">; decrypt_payload</span>`,\n    `<span class=\"addr\">0x401034</span> <span class=\"op\">CALL</span> <span class=\"args\">[ebp-24h]</span> <span class=\"comment\">; call CreateRemoteThread</span>`,\n    `<span class=\"addr\">0x401037</span> <span class=\"op\">JMP</span> <span class=\"args\">0x40102D</span> <span class=\"comment\">; loop?</span>`,\n    `<span class=\"addr\">...</span>`,\n];\n\n// --- REMOVED MOCK GRAPH DATA ---\n// const mockGraphSafe = ... (DELETED)\n// const mockGraphSuspicious = ... (DELETED)\n// const mockGraphMalware = ... (DELETED)\n\n// --- NAVIGATION STATE ---\nlet scanHistory = [];\nlet currentHistoryIndex = -1;\n\n// --- ELEMENT REFERENCES ---\nconst initialState = document.getElementById('initial-state');\nconst analyzingState = document.getElementById('analyzing-state');\nconst resultState = document.getElementById('result-state');\n\nconst analyzingFilename = document.getElementById('analyzing-filename');\nconst resultIcon = document.getElementById('result-icon');\nconst resultText = document.getElementById('result-text');\nconst resultFilename = document.getElementById('result-filename');\nconst resultDetails = document.getElementById('result-details');\nconst nonPeResultWrapper = document.getElementById('non-pe-result');\nconst nonPeFilename = document.getElementById('non-pe-filename');\nconst nonPeHashSha256 = document.getElementById('non-pe-hash-sha256');\nconst nonPeHashMd5 = document.getElementById('non-pe-hash-md5');\n\nconst bodyEl = document.body;\nlet animationWrapper = null;\n\nconst disassemblyWrapper = document.getElementById('disassembly-wrapper');\nconst disassemblyCodeEl = document.getElementById('disassembly-code');\nconst disassemblyFilenameEl = document.getElementById('disassembly-filename');\n\n// Analysis Details elements\nconst analysisDetailsWrapper = document.getElementById('analysis-details-wrapper');\nconst progressBarFill = document.getElementById('progress-bar-fill');\nconst scorePercentage = document.getElementById('score-percentage');\nconst detailsReasoning = document.getElementById('details-reasoning'); // We'll reuse this\nconst detailsHashSha256 = document.getElementById('details-hash-sha256');\nconst detailsHashMd5 = document.getElementById('details-hash-md5');\nconst detailsSystemIp = document.getElementById('details-system-ip');\nconst detailsRecommendation = document.getElementById('details-recommendation');\nconst detailsVendor = document.getElementById('details-vendor');\nconst detailsSignature = document.getElementById('details-signature');\nconst fileInternalsWrapper = document.getElementById('file-internals-wrapper');\nconst entropyBarsContainer = document.getElementById('entropy-bars-container');\nconst keyStringsContainer = document.getElementById('key-strings-container');\n\n// History Panel elements\nconst historyBtn = document.getElementById('history-btn');\nconst historyPanel = document.getElementById('history-panel');\nconst historyCloseBtn = document.getElementById('history-close-btn');\nconst historyOverlay = document.getElementById('history-overlay');\nconst historyListEl = document.querySelector('.history-list');\n\n// Scroll Zone elements\nconst scrollZoneTop = document.getElementById('scroll-zone-top');\nconst scrollZoneBottom = document.getElementById('scroll-zone-bottom');\n\n// Graph Panel elements\nconst graphWrapper = document.getElementById('graph-wrapper');\nconst callGraphEl = document.getElementById('call-graph');\n\n// Stats elements\nconst statsWrapper = document.getElementById('stats-wrapper');\n\n\n// --- STATE ---\nlet disassemblyInterval = null;\nlet scrollInterval = null; // For auto-scrolling\nlet currentGraphLines = []; // Renamed from currentLines to avoid conflict\nlet currentFileMetadata = null;\nlet lastScanResult = null;\n\n// 1. Listen for the 'scan-started' message from the backend\nwindow.electronAPI.onScanStarted((filename) => {\n  console.log(`UI: Received scan-started for ${filename}`);\n\n  // 1. Set UI to \"Analyzing\" state\n  initialState.classList.remove('active'); //\n  analyzingState.classList.add('active'); //\n  analyzingFilename.textContent = filename; //\n  disassemblyFilenameEl.textContent = filename; //\n\n  currentFileMetadata = { filename, isPe: true };\n  lastScanResult = null;\n  nonPeResultWrapper.classList.remove('active');\n  bodyEl.classList.remove('is-non-pe');\n\n  // 2. Update body class to show disassembly\n  bodyEl.classList.remove('is-showing-result'); //\n  bodyEl.classList.add('is-analyzing'); //\n  removeAnimationClasses(); //\n  \n  // 3. Populate disassembly with a \"suspicious\" default and start animation\n  // (We don't know the result yet, so we pick one)\n  populateDisassembly(mockDisassemblySuspicious); //\n  startDisassemblyAnimation(); //\n\n  // 4. Clear old results\n  clearResultData();\n});\n\n// 2. Listen for the 'scan-result' message\nwindow.electronAPI.onScanResult((scanResult) => {\n  console.log(\"UI: Received scan-result:\", scanResult);\n\n  clearInterval(disassemblyInterval); //\n  disassemblyInterval = null; //\n\n  bodyEl.classList.remove('is-analyzing'); //\n  bodyEl.classList.add('is-showing-result'); //\n\n  analyzingState.classList.remove('active'); //\n  resultState.classList.add('active'); //\n\n  // Add to history\n  scanHistory.push(scanResult);\n  currentHistoryIndex = scanHistory.length - 1;\n  \n  lastScanResult = scanResult;\n\n  renderScanResult();\n  updateNavigationButtons();\n});\n\nwindow.electronAPI.onScanFileMetadata((metadata) => {\n  if (!metadata || typeof metadata !== 'object') {\n    return;\n  }\n\n  currentFileMetadata = metadata;\n\n  if (lastScanResult && metadata.filename === lastScanResult.detected_filename) {\n    renderScanResult();\n  }\n});\n\nfunction renderScanResult() {\n  if (!lastScanResult) {\n    return;\n  }\n\n  const metadataMatches = currentFileMetadata && currentFileMetadata.filename === lastScanResult.detected_filename;\n  const isNonPe = metadataMatches && currentFileMetadata.isPe === false;\n\n  if (isNonPe) {\n    renderNonPeResult(lastScanResult);\n    return;\n  }\n\n  renderPeResult(lastScanResult);\n}\n\nfunction ensureAnimationWrapper() {\n  if (animationWrapper) {\n    return;\n  }\n\n  animationWrapper = document.createElement('div');\n  animationWrapper.className = 'animation-swarm';\n  for (let i = 0; i < 10; i++) {\n    const particle = document.createElement('span');\n    animationWrapper.appendChild(particle);\n  }\n  bodyEl.prepend(animationWrapper);\n}\n\nfunction renderPeResult(scanResult) {\n  removeAnimationClasses();\n  bodyEl.classList.remove('is-non-pe');\n  nonPeResultWrapper.classList.remove('active');\n\n  let resultIconClass = 'fas fa-check-circle'; //\n  let resultMockDisassembly = mockDisassemblyBenign; //\n  let resultBodyClass = 'result-safe-active'; //\n  let resultScannerClass = 'result-safe'; //\n  let resultProgressClass = 'progress-bar-green'; //\n  let resultScoreClass = 'score-green'; //\n  let recommendation = 'You can safely run this file.'; //\n\n  if (scanResult.classification.includes('Malware')) {\n    resultIconClass = 'fas fa-bug';\n    resultMockDisassembly = mockDisassemblyMalware;\n    resultBodyClass = 'result-malware-active'; //\n    resultScannerClass = 'result-malware'; //\n    resultProgressClass = 'progress-bar-red'; //\n    resultScoreClass = 'score-red'; //\n    recommendation = 'DO NOT OPEN. Quarantine this file immediately.'; //\n  } else if (scanResult.classification.includes('Suspicious')) {\n    resultIconClass = 'fas fa-exclamation-triangle'; //\n    resultMockDisassembly = mockDisassemblySuspicious; //\n    resultBodyClass = 'result-suspicious-active'; //\n    resultScannerClass = 'result-suspicious'; //\n    resultProgressClass = 'progress-bar-yellow'; //\n    resultScoreClass = 'score-yellow'; //\n    recommendation = 'Be cautious. Only run if you trust the source.'; //\n  }\n\n  ensureAnimationWrapper();\n  bodyEl.classList.add(resultBodyClass); //\n\n  resultState.className = `scanner-state active ${resultScannerClass}`; //\n  resultIcon.className = `result-icon ${resultIconClass}`; //\n  resultText.textContent = scanResult.classification; //\n\n  let detailsText = `Scanned ${scanResult.detected_filename}.`;\n  if (scanResult.malware_family) {\n    detailsText = `Family: ${scanResult.malware_family}`;\n  }\n  resultDetails.textContent = detailsText;\n  resultFilename.textContent = scanResult.detected_filename; //\n\n  progressBarFill.className = 'progress-bar-fill'; //\n  scorePercentage.className = 'score-percentage'; //\n  progressBarFill.classList.add(resultProgressClass); //\n  const rawConfidence = Number(scanResult.confidence_score);\n  const confidenceValue = Number.isFinite(rawConfidence) ? rawConfidence * 100 : 0;\n  progressBarFill.style.width = `${confidenceValue}%`; //\n  scorePercentage.textContent = `${Math.round(confidenceValue)}%`; //\n  scorePercentage.classList.add(resultScoreClass); //\n\n  detailsReasoning.textContent = `Filetype: ${scanResult.key_findings.file_type}. Packer: ${scanResult.key_findings.packer_detected}.`; //\n  const hashData = scanResult.file_hashes || {};\n  detailsHashSha256.textContent = hashData.sha256 || 'Not available'; //\n  detailsHashMd5.textContent = hashData.md5 || 'Not available'; //\n  updateSystemIpDisplay();\n  detailsRecommendation.textContent = recommendation;\n\n  populateVendor(scanResult.vendor); //\n  populateSignature(scanResult.key_findings.signature); //\n  populateEntropyBars(scanResult.key_findings.section_entropy || []); //\n  populateKeyStrings(scanResult.key_findings.key_strings || [], scanResult.classification); //\n\n  populateDisassembly(resultMockDisassembly); //\n\n  const apiList = scanResult.key_findings.api_imports || [];\n  const graphData = generateGraphData(apiList, scanResult.classification);\n  drawCallGraph(graphData);\n}\n\nfunction renderNonPeResult(scanResult) {\n  removeAnimationClasses();\n  bodyEl.classList.add('is-non-pe');\n  resultState.className = 'scanner-state active';\n  resultIcon.className = 'result-icon fas fa-file';\n  resultText.textContent = '';\n  resultDetails.textContent = '';\n  resultFilename.textContent = '';\n\n  const hashData = scanResult.file_hashes || {};\n  nonPeFilename.textContent = scanResult.detected_filename || '';\n  nonPeHashSha256.textContent = hashData.sha256 || 'Not available';\n  nonPeHashMd5.textContent = hashData.md5 || 'Not available';\n\n  detailsHashSha256.textContent = hashData.sha256 || 'Not available';\n  detailsHashMd5.textContent = hashData.md5 || 'Not available';\n\n  nonPeResultWrapper.classList.add('active');\n\n  callGraphEl.innerHTML = '';\n  currentGraphLines.forEach(line => line.remove());\n  currentGraphLines = [];\n  entropyBarsContainer.innerHTML = '';\n  keyStringsContainer.innerHTML = '';\n}\n\n/**\n * Clears all dynamic result data to prepare for the next scan.\n */\nfunction clearResultData() {\n    // Clear scanner panel\n    resultText.textContent = '';\n    resultDetails.textContent = '';\n    resultFilename.textContent = '';\n    nonPeResultWrapper.classList.remove('active');\n    nonPeFilename.textContent = '';\n    nonPeHashSha256.textContent = '...';\n    nonPeHashMd5.textContent = '...';\n    bodyEl.classList.remove('is-non-pe');\n\n    // Clear analysis panel\n    progressBarFill.style.width = `0%`;\n    scorePercentage.textContent = `0%`;\n    detailsReasoning.textContent = '...';\n    detailsHashSha256.textContent = '...';\n    detailsHashMd5.textContent = '...';\n    if (detailsSystemIp) {\n        detailsSystemIp.textContent = 'Detecting...';\n    }\n    detailsRecommendation.textContent = '...';\n\n    // Clear vendor\n    detailsVendor.innerHTML = `\n        <h4>Vendor Analysis</h4>\n        <div class=\"vendor-info\">\n            <i class=\"fas fa-question-circle\"></i>\n            <span>Scanning...</span>\n        </div>`;\n    \n    // Clear signature\n    detailsSignature.innerHTML = `\n        <h4>Digital Signature</h4>\n        <div class=\"signature-info\">\n            <i class=\"fas fa-question-circle\"></i>\n            <span>Checking...</span>\n        </div>`;\n    \n    // Clear internals\n    entropyBarsContainer.innerHTML = '';\n    keyStringsContainer.innerHTML = '';\n    \n    // Clear graph\n    callGraphEl.innerHTML = '';\n    currentGraphLines.forEach(line => line.remove());\n    currentGraphLines = [];\n}\n\n// --- VENDOR UI FUNCTION (IMPLEMENTED) ---\nfunction populateVendor(vendor) {\n    if (!vendor) return;\n    const icon = vendor.icon || 'fas fa-question-circle'; //\n    const name = vendor.name || 'Unknown'; //\n    detailsVendor.innerHTML = `\n        <h4>Vendor Analysis</h4> <div class=\"vendor-info\"> <i class=\"${icon}\"></i>\n            <span>${name}</span>\n        </div>\n    `;\n}\n\n// --- SIGNATURE UI FUNCTION (IMPLEMENTED) ---\nfunction populateSignature(signature) {\n    if (!signature) return;\n    let icon = signature.icon || 'fas fa-question-circle';\n    let cssClass = `sig-${signature.level || 'unknown'}`; // 'sig-verified', 'sig-untrusted', 'sig-unknown'\n\n    detailsSignature.innerHTML = `\n        <h4>Digital Signature</h4> <div class=\"signature-info ${cssClass}\"> <i class=\"${icon}\"></i>\n            <span>${signature.name}</span>\n        </div>\n    `;\n}\n\n// --- ENTROPY BARS UI FUNCTION (IMPLEMENTED) ---\nfunction populateEntropyBars(sections) {\n    entropyBarsContainer.innerHTML = ''; // Clear old bars\n    if (!sections || sections.length === 0) {\n        entropyBarsContainer.innerHTML = '<p class=\"hash-text\">No PE sections found to analyze.</p>';\n        return;\n    }\n\n    sections.forEach(section => { //\n        const value = section.entropy; //\n        const width = (value / 8.0) * 100; // Entropy is 0-8\n        let cssClass = 'low';\n        \n        if (value > 6.0) cssClass = 'medium';\n        if (value > 7.0) cssClass = 'high';\n        if (value > 7.8) cssClass = 'packed'; // Match style.css\n\n        const row = document.createElement('div');\n        row.className = 'entropy-bar-row';\n        row.innerHTML = `\n            <span class=\"entropy-bar-label\">${section.name}</span> <div class=\"entropy-bar-bg\">\n                <div class=\"entropy-bar-fill ${cssClass}\" style=\"width: ${width}%\">\n                    <span class=\"entropy-bar-value\">${value.toFixed(2)}</span>\n                </div>\n            </div>\n        `;\n        entropyBarsContainer.appendChild(row);\n    });\n}\n\n// --- KEY STRINGS UI FUNCTION (IMPLEMENTED) ---\nfunction populateKeyStrings(strings, classification) {\n    keyStringsContainer.innerHTML = ''; // Clear old strings\n    if (!strings || strings.length === 0) {\n        keyStringsContainer.innerHTML = '<span class=\"key-string-tag\">No notable strings found.</span>';\n        return;\n    }\n    \n    const tagClass = classification.includes('Benign') ? 'benign' : 'suspicious'; //\n\n    strings.forEach(str => { //\n        const tag = document.createElement('span');\n        tag.className = `key-string-tag ${tagClass}`;\n        tag.textContent = str;\n        keyStringsContainer.appendChild(tag);\n    });\n}\n\nfunction updateSystemIpDisplay() {\n    if (!detailsSystemIp || !window.electronAPI || typeof window.electronAPI.getSystemIp !== 'function') {\n        return;\n    }\n\n    detailsSystemIp.textContent = 'Detecting...';\n\n    window.electronAPI.getSystemIp()\n        .then((ip) => {\n            if (!ip) {\n                detailsSystemIp.textContent = 'Unavailable';\n                return;\n            }\n\n            detailsSystemIp.textContent = ip;\n        })\n        .catch(() => {\n            detailsSystemIp.textContent = 'Unavailable';\n        });\n}\n\nfunction removeAnimationClasses() {\n    bodyEl.classList.remove('result-safe-active');\n    bodyEl.classList.remove('result-suspicious-active');\n    bodyEl.classList.remove('result-malware-active');\n}\n\n// --- Disassembly Functions ---\n\nfunction populateDisassembly(codeLines) {\n    disassemblyCodeEl.innerHTML = '';\n    codeLines.forEach((line, index) => {\n        const lineEl = document.createElement('span');\n        lineEl.className = 'disassembly-line';\n        lineEl.id = `line-${index}`;\n        lineEl.innerHTML = line;\n        disassemblyCodeEl.appendChild(lineEl);\n    });\n}\n\nfunction startDisassemblyAnimation() {\n    if (disassemblyInterval) {\n        clearInterval(disassemblyInterval);\n    }\n    let currentLine = 0;\n    const totalLines = disassemblyCodeEl.children.length;\n\n    disassemblyInterval = setInterval(() => {\n        const prevLine = document.querySelector('.disassembly-line.active');\n        if (prevLine) {\n            prevLine.classList.remove('active');\n        }\n\n        const lineEl = document.getElementById(`line-${currentLine}`);\n        if (lineEl) {\n            lineEl.classList.add('active');\n            lineEl.scrollIntoView({\n                behavior: 'smooth',\n                block: 'center',\n                inline: 'nearest'\n            });\n        }\n        currentLine = (currentLine + 1) % totalLines;\n    }, 150);\n}\n\n/**\n * This function was MOVED here from jsonsamples.js\n * Dynamically generates the graph data based on API imports.\n * @param {string[]} apiImports - Array of API names (e.g., ['CreateRemoteThread'])\n * @param {string} classification - 'Benign', 'Suspicious', or 'Malware'\n * @returns {object} A graph object with 'nodes' and 'edges' arrays.\n */\nfunction generateGraphData(apiImports, classification) {\n    let nodes = [];\n    let edges = [];\n    const nodeSpacing = 150;\n    const startY = 100;\n    const startX = 250;\n\n    // 1. Add the Main Entry Point node\n    nodes.push({ \n        id: 'main-entry', \n        label: 'main()', \n        class: 'node-entry', \n        pos: { top: `${startY + (apiImports.length / 2) * (nodeSpacing / 2)}px`, left: '50px' } \n    });\n\n    if (!apiImports || apiImports.length === 0) {\n        // Benign/Empty graph\n        nodes.push({ id: 'benign-1', label: 'ReadFile', class: 'node-std', pos: { top: `${startY}px`, left: `${startX}px` } });\n        nodes.push({ id: 'benign-2', label: 'WriteFile', class: 'node-std', pos: { top: `${startY + nodeSpacing / 2}px`, left: `${startX}px` } });\n        edges.push({ from: 'main-entry', to: 'benign-1', options: { color: '#888' } });\n        edges.push({ from: 'main-entry', to: 'benign-2', options: { color: '#888' } });\n    } else {\n        // Suspicious/Malware graph\n        apiImports.forEach((apiName, index) => {\n            let nodeClass = 'node-api'; // Default\n            let edgeColor = '#888'; // Default\n\n            if (classification === 'Malware') {\n                nodeClass = 'node-malicious';\n                edgeColor = '#e74c3c'; // Malware red\n            } else if (classification === 'Suspicious') {\n                nodeClass = 'node-suspicious';\n                edgeColor = '#f1c40f'; // Suspicious yellow\n            } else {\n                // Benign\n                nodeClass = 'node-std';\n                edgeColor = '#888';\n            }\n\n\n            const nodeId = `api-${index}`;\n            const yPos = startY + (index * (nodeSpacing-50)); // Make them a bit closer\n            const xPos = startX + (index % 2 === 0 ? 0 : 150); // Stagger them\n\n            // Add the API node\n            nodes.push({\n                id: nodeId,\n                label: apiName,\n                class: nodeClass,\n                pos: { top: `${yPos}px`, left: `${xPos}px` }\n            });\n\n            // Add the edge from main\n            edges.push({\n                from: 'main-entry',\n                to: nodeId,\n                options: { color: edgeColor }\n            });\n        });\n    }\n\n    return { nodes, edges };\n}\n\n// --- Graph Drawing ---\nfunction drawCallGraph(graphData) {\n    // 1. Clear previous graph (both nodes and lines)\n    callGraphEl.innerHTML = '';\n    currentGraphLines.forEach(line => line.remove());\n    currentGraphLines = [];\n\n    if (!graphData || !graphData.nodes || !graphData.edges) {\n        console.error(\"Invalid graph data received\", graphData);\n        return;\n    }\n\n    // 2. Create and place all nodes\n    graphData.nodes.forEach(node => {\n        const nodeEl = document.createElement('div');\n        nodeEl.id = node.id;\n        nodeEl.className = `graph-node ${node.class}`;\n        nodeEl.style.top = node.pos.top;\n        nodeEl.style.left = node.pos.left;\n        nodeEl.textContent = node.label;\n        callGraphEl.appendChild(nodeEl);\n    });\n\n    // 3. Draw all edges (must be done *after* nodes are in DOM)\n    // Use a slight timeout to ensure DOM is ready\n    setTimeout(() => {\n        graphData.edges.forEach(edge => {\n            try {\n                const line = new LeaderLine(\n                    document.getElementById(edge.from),\n                    document.getElementById(edge.to),\n                    {\n                        color: edge.options.color,\n                        path: edge.options.path || 'straight',\n                        startSocket: edge.options.startSocket || 'auto',\n                        endSocket: edge.options.endSocket || 'auto',\n                        endPlug: 'arrow1',\n                        size: 3,\n                        endPlugSize: 1.5,\n                    }\n                );\n                currentGraphLines.push(line);\n            } catch(e) {\n                console.error(\"Could not draw line:\", e);\n            }\n        });\n    }, 500); // 500ms timeout to let CSS fade-in finish\n}\n\n\n// --- History Panel Logic ---\nasync function loadHistory() {\n  if (!historyListEl) return;\n  \n  historyListEl.innerHTML = '<li class=\"history-item-loading\">Loading...</li>';\n\n  try {\n    const historyData = await window.electronAPI.getHistory();\n\n    if (!historyData || historyData.length === 0) {\n      historyListEl.innerHTML = '<li class=\"history-item-empty\">No scan history found.</li>';\n      return;\n    }\n\n    historyListEl.innerHTML = '';\n\n    historyData.forEach(scan => {\n      const li = document.createElement('li');\n      li.className = 'history-item';\n\n      // Determine classification icon\n      let statusIcon = 'fas fa-check-circle';\n      let classType = 'safe';\n      if (scan.classification.includes('Malware')) {\n        statusIcon = 'fas fa-bug';\n        classType = 'malware';\n      } else if (scan.classification.includes('Suspicious')) {\n        statusIcon = 'fas fa-exclamation-triangle';\n        classType = 'suspicious';\n      }\n\n      // Determine file type icon based on extension\n      const filename = scan.detected_filename || '';\n      const ext = filename.split('.').pop().toLowerCase();\n      let fileTypeIcon = 'fas fa-file';\n      \n      if (['exe', 'dll', 'sys', 'msi'].includes(ext)) {\n        fileTypeIcon = 'fas fa-cog'; // Executable\n      } else if (['jpg', 'jpeg', 'png', 'gif', 'bmp', 'svg', 'webp'].includes(ext)) {\n        fileTypeIcon = 'fas fa-image'; // Image\n      } else if (['js', 'ts', 'py', 'java', 'cpp', 'c', 'h', 'cs', 'go', 'rs', 'php', 'rb'].includes(ext)) {\n        fileTypeIcon = 'fas fa-code'; // Code\n      } else if (['pdf', 'doc', 'docx', 'txt', 'rtf', 'odt'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-alt'; // Document\n      } else if (['zip', 'rar', '7z', 'tar', 'gz', 'bz2'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-archive'; // Archive\n      } else if (['mp3', 'wav', 'ogg', 'flac', 'aac'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-audio'; // Audio\n      } else if (['mp4', 'avi', 'mkv', 'mov', 'wmv', 'flv'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-video'; // Video\n      } else if (['html', 'htm', 'css', 'xml', 'json'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-code'; // Web file\n      }\n\n      const scanDate = new Date(scan.scanDate).toLocaleString();\n      const hashSha256 = scan.file_hashes?.sha256 || 'N/A';\n      const hashDisplay = hashSha256.substring(0, 16) + '...'; // Show first 16 chars\n\n      li.innerHTML = `\n        <div class=\"history-icon-wrapper\">\n          <div class=\"history-icon ${classType}\">\n            <i class=\"${statusIcon}\"></i>\n          </div>\n          <div class=\"history-file-type\">\n            <i class=\"${fileTypeIcon}\"></i>\n          </div>\n        </div>\n        <div class=\"history-details\">\n          <span class=\"history-filename\" title=\"${filename}\">${filename}</span>\n          <span class=\"history-classification ${classType}\">${scan.classification}</span>\n          <span class=\"history-hash\" title=\"${hashSha256}\">SHA256: ${hashDisplay}</span>\n        </div>\n        <span class=\"history-date\">${scanDate}</span>\n      `;\n      \n      historyListEl.appendChild(li);\n    });\n\n  } catch (err) {\n    console.error('Failed to load history:', err);\n    historyListEl.innerHTML = '<li class=\"history-item-empty\">Error loading history.</li>';\n  }\n}\n\nfunction toggleHistoryPanel() {\n  bodyEl.classList.toggle('is-history-open');\n  \n  // ADD THIS: If we are opening the panel, load the history\n  if (bodyEl.classList.contains('is-history-open')) {\n    loadHistory();\n  }\n}\n\nhistoryBtn.addEventListener('click', (e) => {\n    e.preventDefault();\n    toggleHistoryPanel();\n});\nhistoryCloseBtn.addEventListener('click', toggleHistoryPanel);\nhistoryOverlay.addEventListener('click', toggleHistoryPanel);\n\n\n// --- Auto-scroll Logic ---\nfunction startScrolling(direction) {\n    if (scrollInterval) {\n        clearInterval(scrollInterval);\n    }\n    scrollInterval = setInterval(() => {\n        window.scrollBy(0, direction * 10); // 10 pixels at a time\n    }, 20); // every 20ms\n}\n\nfunction stopScrolling() {\n    clearInterval(scrollInterval);\n    scrollInterval = null;\n}\n\nscrollZoneTop.addEventListener('mouseenter', () => {\n    startScrolling(-1); // Scroll Up\n    scrollZoneTop.classList.add('scrolling');\n});\nscrollZoneTop.addEventListener('mouseleave', () => {\n    stopScrolling();\n    scrollZoneTop.classList.remove('scrolling');\n});\n\nscrollZoneBottom.addEventListener('mouseenter', () => {\n    startScrolling(1); // Scroll Down\n    scrollZoneBottom.classList.add('scrolling');\n});\nscrollZoneBottom.addEventListener('mouseleave', () => {\n    stopScrolling();\n    scrollZoneBottom.classList.remove('scrolling');\n});\n\n\n// --- Chart instances ---\nlet malwareTypesChart = null;\nlet topMalwareChart = null;\n\n// --- Function to create/recreate charts ---\nwindow.recreateCharts = function() {\n    // Check if light theme is active\n    const isLightTheme = document.body.classList.contains('light-theme');\n    \n    // Set colors based on theme\n    const chartLegendColor = isLightTheme ? '#6c757d' : '#e0e0e0';\n    const chartAxesColor = isLightTheme ? '#6c757d' : '#aaa';\n    const chartGridColor = isLightTheme ? '#dee2e6' : '#444444';\n\n    // Destroy existing charts if they exist\n    if (malwareTypesChart) {\n        malwareTypesChart.destroy();\n    }\n    if (topMalwareChart) {\n        topMalwareChart.destroy();\n    }\n\n    // Create Malware Types Chart (Doughnut)\n    const typesCtx = document.getElementById('malwareTypesChart');\n    if (typesCtx) {\n        malwareTypesChart = new Chart(typesCtx, {\n            type: 'doughnut',\n            data: {\n                labels: ['PE (exe/dll)', 'JavaScript', 'VBS', 'Macro', 'Other'],\n                datasets: [{\n                    label: 'Submission Types',\n                    data: [65, 15, 8, 7, 5],\n                    backgroundColor: [\n                        '#007bff', // Blue\n                        '#f1c40f', // Yellow\n                        '#e74c3c', // Red\n                        '#9b59b6', // Purple\n                        '#34495e'  // Gray\n                    ],\n                    borderColor: '#2a2a2e',\n                    borderWidth: 3,\n                }]\n            },\n            options: {\n                responsive: true,\n                plugins: {\n                    legend: {\n                        position: 'right',\n                        labels: {\n                            color: chartLegendColor,\n                            boxWidth: 20\n                        }\n                    }\n                }\n            }\n        });\n    }\n\n    // Create Top Malware Chart (Line)\n    const topMalwareCtx = document.getElementById('topMalwareChart');\n    if (topMalwareCtx) {\n        topMalwareChart = new Chart(topMalwareCtx, {\n            type: 'line',\n            data: {\n                labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5'],\n                datasets: [\n                    {\n                        label: 'Zeus',\n                        data: [120, 150, 130, 180, 160],\n                        borderColor: '#e74c3c',\n                        backgroundColor: '#e74c3c20',\n                        fill: true,\n                        tension: 0.4\n                    },\n                    {\n                        label: 'WannaCry',\n                        data: [80, 90, 110, 100, 130],\n                        borderColor: '#007bff',\n                        backgroundColor: '#007bff20',\n                        fill: true,\n                        tension: 0.4\n                    },\n                    {\n                        label: 'Emotet',\n                        data: [50, 60, 80, 70, 90],\n                        borderColor: '#f1c40f',\n                        backgroundColor: '#f1c40f20',\n                        fill: true,\n                        tension: 0.4\n                    }\n                ]\n            },\n            options: {\n                responsive: true,\n                plugins: {\n                    legend: {\n                        labels: {\n                            color: chartLegendColor\n                        }\n                    }\n                },\n                scales: {\n                    x: {\n                        ticks: { color: chartAxesColor },\n                        grid: { color: chartGridColor + '50' }\n                    },\n                    y: {\n                        ticks: { color: chartAxesColor },\n                        grid: { color: chartGridColor }\n                    }\n                }\n            }\n        });\n    }\n};\n\n// --- NAVIGATION FUNCTIONS ---\nfunction updateNavigationButtons() {\n    const prevBtn = document.getElementById('prev-scan-btn');\n    const nextBtn = document.getElementById('next-scan-btn');\n    const navInfo = document.getElementById('nav-info');\n    \n    if (!prevBtn || !nextBtn) return;\n    \n    // Disable/enable buttons based on position\n    prevBtn.disabled = currentHistoryIndex <= 0;\n    nextBtn.disabled = currentHistoryIndex >= scanHistory.length - 1;\n    \n    // Update info text\n    if (navInfo && scanHistory.length > 0) {\n        navInfo.textContent = `${currentHistoryIndex + 1} of ${scanHistory.length}`;\n    }\n}\n\nfunction showPreviousScan() {\n    if (currentHistoryIndex > 0) {\n        currentHistoryIndex--;\n        lastScanResult = scanHistory[currentHistoryIndex];\n        renderScanResult();\n        updateNavigationButtons();\n    }\n}\n\nfunction showNextScan() {\n    if (currentHistoryIndex < scanHistory.length - 1) {\n        currentHistoryIndex++;\n        lastScanResult = scanHistory[currentHistoryIndex];\n        renderScanResult();\n        updateNavigationButtons();\n    }\n}\n\n// Initialize history from electron-store on load\nasync function initializeScanHistory() {\n    try {\n        const storedHistory = await window.electronAPI.getHistory();\n        if (storedHistory && Array.isArray(storedHistory)) {\n            scanHistory = storedHistory;\n            currentHistoryIndex = scanHistory.length - 1;\n        }\n    } catch (error) {\n        console.error('Failed to load scan history:', error);\n    }\n}\n\n// --- Run on Page Load ---\ndocument.addEventListener('DOMContentLoaded', () => {\n    // 1. Animate Stat Cards\n    const statNumbers = document.querySelectorAll('.stat-number');\n    statNumbers.forEach(stat => {\n        const target = +stat.getAttribute('data-target');\n        const duration = 2000;\n        const stepTime = 20;\n        const steps = duration / stepTime;\n        const increment = target / steps;\n        let current = 0;\n\n        const updateCount = () => {\n            current += increment;\n            if (current < target) {\n                stat.textContent = Math.ceil(current).toLocaleString();\n                setTimeout(updateCount, stepTime);\n            } else {\n                stat.textContent = target.toLocaleString();\n            }\n        };\n        updateCount();\n    });\n\n    // 2. Create the charts\n    recreateCharts();\n    \n    // 3. Initialize scan history\n    initializeScanHistory();\n    \n    // 4. Setup navigation button handlers\n    const prevBtn = document.getElementById('prev-scan-btn');\n    const nextBtn = document.getElementById('next-scan-btn');\n    if (prevBtn) prevBtn.addEventListener('click', showPreviousScan);\n    if (nextBtn) nextBtn.addEventListener('click', showNextScan);\n});\n","epoch":97,"telemetryInfo":{}}],["file:///home/trang/localnsv/mAIware/style.css::request_e1cb39fa-c4c3-4d4b-b7e1-a9c3f8c3b4cc",{"uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/style.css","external":"file:///home/trang/localnsv/mAIware/style.css","path":"/home/trang/localnsv/mAIware/style.css","scheme":"file"},"requestId":"request_e1cb39fa-c4c3-4d4b-b7e1-a9c3f8c3b4cc","content":"/* --- Global & Fonts --- */\n:root {\n    /* --- Dark Theme (Default) --- */\n    --bg-dark-1: #121212;\n    --bg-dark-2: #1e1e1e;\n    --bg-dark-3: #2a2a2e;\n    --bg-dark-4: #333333;\n    --border-color: #444444;\n    --text-light: #e0e0e0;\n    --text-medium: #aaa;\n    --text-dark: #888;\n    \n    /* --- Semantic Colors --- */\n    --blue: #007bff;\n    --red: #e74c3c;\n    --yellow: #f1c40f;\n    --green: #2ecc71;\n    \n    /* --- Syntax & Node Colors --- */\n    --syntax-op: #c39eff;\n    --syntax-string: #e6db74;\n    --syntax-const-text: #ffffff; /* Constant white for dark buttons/nodes */\n    --node-bg-entry: #254a25;\n    --node-bg-api: #2a3e4a;\n    --node-bg-suspicious: #4a452a;\n    --node-bg-malicious: #4a2a2a;\n\n    --chart-legend-text: var(--text-light);  /* #e0e0e0 */\n    --chart-axes-text: var(--text-medium);   /* #aaa */\n    --chart-grid-line: var(--border-color);\n}\n\n/* --- Light Theme --- */\n/* Add \".light-theme\" to the <body> tag to activate */\nbody.light-theme {\n    --bg-dark-1: #f8f9fa;     /* Main background */\n    --bg-dark-2: #ffffff;     /* Card background */\n    --bg-dark-3: #e9ecef;     /* Hover/active background */\n    --bg-dark-4: #ced4da;     /* Secondary button background */\n    --border-color: #dee2e6;  /* Border color */\n    --text-light: #212529;    /* Main text */\n    --text-medium: #6c757d;   /* Secondary text */\n    --text-dark: #888;        /* Tertiary text (can stay gray) */\n    \n    /* Semantic colors are unchanged */\n    /* --blue, --red, --yellow, --green */\n    \n    /* --- Light Theme Syntax --- */\n    --syntax-op: #a040ff;       /* Darker purple */\n    --syntax-string: #b8860b;     /* Dark goldenrod */\n    --syntax-const-text: #ffffff; /* Stays white for colored buttons/nodes */\n    \n    /* Node backgrounds are unchanged, they look good on a light BG */\n    --chart-legend-text: var(--text-medium); /* User Request */\n    --chart-axes-text: var(--text-medium);   /* User Request */\n    --chart-grid-line: var(--border-color);\n}\n\n\n/* Apply overflow-x to html as well */\nhtml {\n    overflow-x: hidden;\n    font-size: 16px; /* Ensure base font size */\n}\n\nbody {\n    font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n    background-color: var(--bg-dark-1);\n    color: var(--text-light);\n    margin: 0;\n    padding-top: 60px; /* Make space for fixed top nav */\n    overflow-x: hidden; /* Prevent horizontal scroll */\n    width: 100%;\n    min-height: 100vh;\n}\n\n/* --- Main Grid Container --- */\n.main-container {\n    display: grid;\n    grid-template-columns: 1fr 1fr; /* Simpler 2-column definition */\n    grid-template-rows: auto auto; /* Rows for content and graph */\n    gap: 2rem;\n    padding: 2rem; /* Spacing from nav and screen edges */\n    align-items: start;\n    \n    /* Set max-width on the grid itself */\n    max-width: 1400px; \n    /* Center the whole grid */\n    margin: 0 auto; \n    \n    min-height: calc(100vh - 60px); /* Full height minus nav */\n    box-sizing: border-box;\n    width: 100%;\n}\n\n.scanner-wrapper {\n    grid-column: 1 / 2; /* Span first column */\n    grid-row: 1 / 2;\n    display: flex;\n    flex-direction: column;\n    gap: 1.5rem;\n    width: 100%; /* Fill the column */\n}\n\n.right-panel-wrapper {\n    grid-column: 2 / 3; /* Span second column */\n    grid-row: 1 / 2;\n    display: flex; /* Make it a flex container */\n    flex-direction: column; /* Stack its children vertically */\n    gap: 1.5rem; /* Space between its children */\n    width: 100%; /* Fill the column */\n}\n\n.graph-wrapper {\n    grid-column: 1 / 3; /* Span BOTH columns */\n    grid-row: 2 / 3;\n    width: 100%;\n    /* max-width is now inherited from main-container */\n    justify-self: center; /* Center in the grid area */\n}\n\n\n/* --- Top Navigation --- */\n.top-nav {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    height: 60px;\n    background-color: var(--bg-dark-2);\n    border-bottom: 1px solid var(--border-color);\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 0 2rem;\n    z-index: 1000;\n    box-sizing: border-box;\n}\n\n.top-nav .logo {\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n    font-size: 1.3rem;\n    font-weight: 600;\n    color: var(--text-light);\n}\n\n.top-nav .logo i {\n    color: var(--blue);\n}\n\n.nav-links {\n    display: flex;\n    gap: 0.5rem;\n}\n\n.nav-link {\n    color: var(--text-medium);\n    font-size: 1.25rem;\n    padding: 0.75rem;\n    border-radius: 8px;\n    transition: all 0.2s ease;\n    position: relative;\n    text-decoration: none;\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n}\n\n.nav-link .link-text {\n    font-size: 0.9rem;\n    font-weight: 500;\n    max-width: 0;\n    overflow: hidden;\n    white-space: nowrap;\n    transition: all 0.3s ease;\n}\n\n.nav-link:hover {\n    background-color: var(--bg-dark-3);\n    color: var(--text-light);\n}\n\n.nav-link:hover .link-text {\n    max-width: 80px; /* Expand text on hover */\n    margin-left: 0.25rem;\n}\n\n/* --- Tooltip --- */\n.nav-link:hover::before {\n    content: attr(data-tooltip);\n    position: absolute;\n    bottom: -35px;\n    left: 50%;\n    transform: translateX(-50%);\n    background-color: var(--bg-dark-3);\n    color: var(--text-light);\n    padding: 5px 10px;\n    border-radius: 4px;\n    font-size: 0.8rem;\n    white-space: nowrap;\n    opacity: 0;\n    transition: opacity 0.2s 0.3s; /* Delay tooltip */\n    pointer-events: none;\n}\n.nav-link:hover .link-text {\n    display: none; /* Hide expanded text if tooltip is showing */\n}\n.nav-link:hover:hover::before {\n    opacity: 1;\n}\n\n/* On smaller screens, stack the columns */\n@media (max-width: 1280px) { /* Widened breakpoint */\n    .main-container {\n        grid-template-columns: 1fr; /* Stack columns */\n        padding: 1rem;\n    }\n    .scanner-wrapper, .right-panel-wrapper, .graph-wrapper {\n        grid-column: 1 / 2; /* All in one column */\n        max-width: 100%;\n        justify-self: center;\n    }\n    .right-panel-wrapper {\n        grid-row: 2 / 3;\n    }\n    .graph-wrapper {\n        grid-row: 3 / 4;\n    }\n}\n\n/* Hide link text on very small screens */\n@media (max-width: 768px) {\n    .nav-link .link-text { display: none; }\n    .nav-link:hover .link-text { display: none; }\n    .top-nav { padding: 0 1rem; }\n}\n\n\n/* --- Main Scanner Box --- */\n.scanner-container {\n    width: 100%; /* Ensure it fills its flex parent */\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n    padding: 2.5rem;\n    text-align: center;\n    overflow: hidden;\n    transition: all 0.3s ease;\n    box-sizing: border-box; /* Include padding in width */\n}\n\nh1 {\n    color: var(--text-light);\n    margin-top: 0;\n    margin-bottom: 1rem;\n}\n\n.scanner-container p {\n    color: var(--text-medium);\n    margin-bottom: 2rem;\n    font-size: 1.1rem;\n}\n\n.scanner-state {\n    display: none;\n}\n.scanner-state.active {\n    display: block;\n}\n\n/* --- State 1: Upload --- */\n.upload-zone {\n    border: 2px dashed var(--border-color);\n    border-radius: 8px;\n    padding: 3rem 2rem;\n    cursor: pointer;\n    transition: all 0.3s ease;\n}\n.upload-zone:hover {\n    background-color: var(--bg-dark-3);\n    border-color: var(--blue);\n}\n.upload-icon {\n    font-size: 4rem;\n    color: var(--blue);\n    margin-bottom: 1rem;\n}\n.upload-zone h3 {\n    margin: 0;\n    color: var(--text-light);\n}\n.upload-zone span {\n    color: var(--text-dark);\n}\n\n/* --- State 2: Analyzing --- */\n.analyzing-icon .loader {\n    width: 80px;\n    height: 80px;\n    border: 6px solid var(--bg-dark-4);\n    border-top-color: var(--blue);\n    border-radius: 50%;\n    animation: spin 1s linear infinite;\n    margin: 2rem auto;\n}\n@keyframes spin {\n    to { transform: rotate(360deg); }\n}\n.analyzing-state h3 {\n    color: var(--text-light);\n    margin-bottom: 0.5rem;\n}\n.analyzing-state .filename,\n.result-state .filename {\n    color: var(--text-medium);\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 1.1rem;\n    word-break: break-all;\n}\n\n/* --- State 3: Result --- */\n.result-icon {\n    font-size: 6rem;\n    line-height: 1;\n    margin: 1.5rem 0;\n}\n.result-state h2 {\n    font-size: 2.5rem;\n    margin: 0 0 0.5rem 0;\n}\n.result-malware .result-icon, .result-malware h2 { color: var(--red); }\n.result-suspicious .result-icon, .result-suspicious h2 { color: var(--yellow); }\n.result-safe .result-icon, .result-safe h2 { color: var(--green); }\n.result-state p {\n    font-size: 1rem;\n    margin-bottom: 2rem;\n}\n\n/* --- Scan Navigation Controls --- */\n.scan-navigation {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 1.5rem;\n    margin-top: 1.5rem;\n    padding-top: 1.5rem;\n    border-top: 1px solid rgba(255, 255, 255, 0.1);\n}\n\n.nav-btn {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    padding: 0.75rem 1.5rem;\n    background: linear-gradient(135deg, var(--primary), var(--secondary));\n    color: white;\n    border: none;\n    border-radius: 8px;\n    font-size: 1rem;\n    font-weight: 600;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);\n}\n\n.nav-btn:hover:not(:disabled) {\n    transform: translateY(-2px);\n    box-shadow: 0 6px 20px rgba(139, 92, 246, 0.5);\n}\n\n.nav-btn:active:not(:disabled) {\n    transform: translateY(0);\n}\n\n.nav-btn:disabled {\n    background: rgba(255, 255, 255, 0.1);\n    color: rgba(255, 255, 255, 0.3);\n    cursor: not-allowed;\n    box-shadow: none;\n}\n\n.nav-info {\n    color: var(--text-medium);\n    font-size: 0.95rem;\n    font-weight: 500;\n    min-width: 80px;\n    text-align: center;\n}\n\n.non-pe-result {\n    display: none;\n    flex-direction: column;\n    align-items: center;\n    gap: 1.5rem;\n    color: var(--text-light);\n    padding: 1rem 0 0 0;\n}\n\n.non-pe-result.active {\n    display: flex;\n}\n\n.non-pe-icon {\n    width: 96px;\n    height: 96px;\n    border-radius: 24px;\n    background: linear-gradient(135deg, rgba(80, 130, 255, 0.2), rgba(80, 130, 255, 0.05));\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 3rem;\n    color: var(--blue);\n}\n\n.non-pe-hash-grid {\n    display: flex;\n    gap: 1.5rem;\n    flex-wrap: wrap;\n    justify-content: center;\n}\n\n.non-pe-hash {\n    min-width: 220px;\n    background: var(--bg-dark-3);\n    padding: 1rem 1.25rem;\n    border-radius: 12px;\n    border: 1px solid rgba(255, 255, 255, 0.05);\n    text-align: left;\n}\n\n.non-pe-hash h4 {\n    margin: 0 0 0.5rem 0;\n    font-size: 0.85rem;\n    text-transform: uppercase;\n    letter-spacing: 0.08rem;\n    color: var(--text-medium);\n}\n\n.non-pe-hash p {\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.9rem;\n    word-break: break-all;\n    color: var(--text-light);\n}\n\nbody.is-non-pe .analysis-details-container,\nbody.is-non-pe #analysis-details-wrapper,\nbody.is-non-pe #disassembly-wrapper,\nbody.is-non-pe #file-internals-wrapper,\nbody.is-non-pe #graph-wrapper {\n    display: none !important;\n}\n\nbody.is-non-pe #result-state {\n    display: none !important;\n}\n\nbody.is-non-pe .non-pe-result {\n    display: flex;\n}\n\n\n/* --- NEW: Stats Dashboard Panel --- */\n.stats-wrapper {\n    display: flex; \n    flex-direction: column;\n    gap: 1.5rem;\n    width: 100%; /* Fill its flex parent */\n    box-sizing: border-box; /* Include padding in width */\n}\n\n/* By default, stats are visible, disassembly is hidden */\n.disassembly-wrapper { display: none; }\n\n/* When analyzing/showing results, hide stats and show disassembly */\nbody.is-analyzing .stats-wrapper,\nbody.is-showing-result .stats-wrapper {\n    display: none;\n}\nbody.is-analyzing .disassembly-wrapper,\nbody.is-showing-result .disassembly-wrapper {\n    display: flex; /* Use flex to match its own styles */\n}\n\n\n.stats-grid {\n    display: flex; \n    flex-direction: column;\n    /* Force stacking */\n    gap: 1.5rem;\n}\n\n.stat-card {\n    display: flex;\n    align-items: center;\n    gap: 1.5rem;\n    background-color: var(--bg-dark-2);\n    padding: 1.5rem;\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n}\n.stat-card i {\n    font-size: 2.5rem;\n    color: var(--blue);\n}\n.stat-content {\n    display: flex;\n    flex-direction: column;\n}\n.stat-number {\n    font-size: 2rem;\n    font-weight: 600;\n    color: var(--text-light);\n    line-height: 1.2;\n}\n.stat-label {\n    font-size: 0.9rem;\n    color: var(--text-medium);\n}\n\n.chart-container-wrapper {\n    display: flex;\n    flex-direction: column;\n    gap: 1.5rem;\n}\n\n.chart-container {\n    background-color: var(--bg-dark-2);\n    padding: 1.5rem;\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    box-sizing: border-box;\n}\n.chart-container h3 {\n    margin-top: 0;\n    margin-bottom: 1.5rem;\n    text-align: center;\n    color: var(--text-light);\n    font-size: 1.1rem;\n}\n\n\n/* --- Disassembly Panel --- */\n.disassembly-wrapper {\n    /* display: none; set by default now */\n    flex-direction: column;\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n    height: 600px; /* Fixed height */\n    max-height: 70vh;\n    opacity: 0;\n    transition: all 0.3s ease;\n    width: 100%;\n    box-sizing: border-box;\n}\n\nbody.is-analyzing .disassembly-wrapper,\nbody.is-showing-result .disassembly-wrapper {\n    opacity: 1;\n}\n\n.disassembly-header {\n    padding: 1rem 1.5rem;\n    border-bottom: 1px solid var(--border-color);\n    background-color: var(--bg-dark-3);\n    border-radius: 12px 12px 0 0;\n}\n.disassembly-header h3 {\n    margin: 0;\n    color: var(--text-light);\n    font-size: 1.1rem;\n    font-family: 'Courier New', Courier, monospace;\n}\n.disassembly-code {\n    flex-grow: 1;\n    overflow-y: auto;\n    padding: 1rem;\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.95rem;\n}\n.disassembly-line {\n    display: block;\n    padding: 2px 1rem;\n    border-radius: 4px;\n    transition: background-color 0.2s ease;\n}\n.disassembly-line.active {\n    background-color: var(--blue);\n    color: var(--syntax-const-text); /* MODIFIED */\n}\n.disassembly-line .addr { color: var(--text-dark); margin-right: 1rem; }\n.disassembly-line .op { color: var(--syntax-op); font-weight: bold; width: 50px; display: inline-block; } /* MODIFIED */\n.disassembly-line .args { color: var(--text-light); }\n.disassembly-line .string { color: var(--syntax-string); } /* MODIFIED */\n.disassembly-line .comment { color: var(--green); margin-left: 1rem; }\n\n\n/* --- Analysis Details Panel --- */\n.analysis-details-container {\n    width: 100%;\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    padding: 2rem;\n    display: none; /* Hidden by default */\n    box-sizing: border-box;\n}\nbody.is-showing-result .analysis-details-container {\n    display: block;\n}\n\n.progress-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 0.75rem;\n}\n.progress-header h3 {\n    margin: 0;\n    font-size: 1.1rem;\n    color: var(--text-light);\n}\n.score-percentage {\n    font-size: 1.2rem;\n    font-weight: 600;\n}\n.score-green { color: var(--green); }\n.score-yellow { color: var(--yellow); }\n.score-red { color: var(--red); }\n\n.progress-bar-background {\n    width: 100%;\n    height: 12px;\n    background-color: var(--bg-dark-3);\n    border-radius: 6px;\n    overflow: hidden;\n    margin-bottom: 1.5rem;\n}\n.progress-bar-fill {\n    height: 100%;\n    width: 0%;\n    border-radius: 6px;\n    transition: width 0.5s ease;\n}\n.progress-bar-green { background-color: var(--green); }\n.progress-bar-yellow { background-color: var(--yellow); }\n.progress-bar-red { background-color: var(--red); }\n\n.details-section {\n    margin-bottom: 1.25rem;\n}\n.details-section h4 {\n    margin: 0 0 0.5rem 0;\n    color: var(--text-medium);\n    font-size: 0.9rem;\n    text-transform: uppercase;\n}\n.details-section p {\n    margin: 0;\n    color: var(--text-light);\n    font-size: 1rem;\n}\n.hash-text {\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.95rem;\n    word-break: break-all;\n}\n\n/* --- Vendor & Signature --- */\n.details-grid {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 1.5rem;\n    margin-bottom: 1.25rem;\n}\n.vendor-info, .signature-info {\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n    font-size: 1rem;\n    font-weight: 500;\n}\n.vendor-info i {\n    font-size: 1.5rem;\n    color: var(--text-medium);\n}\n.signature-info i {\n    font-size: 1.25rem;\n}\n/* Use the levels from datasrcs.js */\n.sig-verified { color: var(--green); }\n.sig-untrusted { color: var(--red); }\n.sig-unknown { color: var(--yellow); }\n\n/* --- File Internals Card --- */\n.file-internals-container {\n    width: 100%;\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    padding: 2rem;\n    display: none; /* Hidden by default */\n    box-sizing: border-box;\n    flex-direction: column;\n    gap: 1.5rem;\n}\nbody.is-showing-result .file-internals-container {\n    display: flex;\n}\n.file-internals-container h3 {\n    margin-top: 0;\n    margin-bottom: 0;\n    color: var(--text-light);\n    font-size: 1.25rem;\n    padding-bottom: 1rem;\n    border-bottom: 1px solid var(--border-color);\n}\n\n/* --- Entropy Bars --- */\n.entropy-bars {\n    display: flex;\n    flex-direction: column;\n    gap: 0.75rem;\n}\n.entropy-bar-row {\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n}\n.entropy-bar-label {\n    width: 60px;\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.9rem;\n    color: var(--text-medium);\n    flex-shrink: 0;\n}\n.entropy-bar-bg {\n    flex-grow: 1;\n    height: 20px;\n    background-color: var(--bg-dark-3);\n    border-radius: 4px;\n    overflow: hidden;\n}\n.entropy-bar-fill {\n    height: 100%;\n    width: 0%; /* Set by JS */\n    background-color: var(--blue);\n    border-radius: 4px;\n    transition: width 0.5s ease;\n    display: flex;\n    justify-content: flex-end;\n    align-items: center;\n    padding-right: 0.5rem;\n    box-sizing: border-box;\n}\n.entropy-bar-value {\n    font-size: 0.8rem;\n    font-weight: bold;\n    color: var(--syntax-const-text); /* MODIFIED */\n    text-shadow: 0 0 3px rgba(0,0,0,0.5);\n}\n/* Color coding for entropy bars */\n.entropy-bar-fill.low { background-color: var(--green); }\n.entropy-bar-fill.medium { background-color: var(--blue); }\n.entropy-bar-fill.high { background-color: var(--yellow); }\n.entropy-bar-fill.packed { background-color: var(--red); }\n\n/* --- Key Strings --- */\n.key-strings {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 0.5rem;\n}\n.key-string-tag {\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.9rem;\n    background-color: var(--bg-dark-3);\n    border: 1px solid var(--border-color);\n    padding: 0.25rem 0.5rem;\n    border-radius: 4px;\n    color: var(--text-light);\n}\n.key-string-tag.suspicious {\n    border-color: var(--red);\n    color: var(--red);\n    background-color: #e74c3c1a;\n}\n.key-string-tag.benign {\n    border-color: var(--green);\n    color: var(--green);\n    background-color: #2ecc711a;\n}\n\n/* --- Buttons --- */\n.btn-wrapper {\n    margin-top: 2rem;\n    display: flex;\n    gap: 1rem;\n}\n.btn {\n    flex-grow: 1; /* Make buttons fill space */\n    background-color: var(--blue);\n    color: var(--syntax-const-text); /* MODIFIED */\n    border: none;\n    padding: 12px 24px;\n    border-radius: 6px;\n    font-size: 1rem;\n    font-weight: bold;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    text-decoration: none;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    gap: 0.5rem;\n}\n.btn:hover {\n    filter: brightness(1.2);\n}\n.btn-primary {\n    background-color: var(--blue);\n}\n.btn-secondary {\n    background-color: var(--bg-dark-4);\n    color: var(--text-light);\n}\n.btn-secondary:hover {\n    background-color: #555;\n}\n.btn i {\n    margin-right: 0.25rem;\n}\n\n\n/* --- Background Particle Animations --- */\n.animation-swarm {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%; \n    height: 100%;\n    z-index: -1;\n    pointer-events: none;\n    overflow: hidden; \n}\n\n/* Base style for each new span particle */\n.animation-swarm span {\n    position: absolute;\n    top: -20px; /* Start off-screen */\n    font-size: 1.5rem;\n    opacity: 0; /* Start invisible */\n    animation: fall 10s linear infinite;\n}\n\n/* The ::before holds the icon content */\n.animation-swarm span::before {\n    content: '';\n    font-family: \"Font Awesome 6 Free\";\n    font-weight: 900;\n    text-shadow: 0 0 5px;\n}\n\n/* Keyframes for falling (starts with opacity) */\n@keyframes fall {\n    0% {\n        transform: translateY(0vh) rotate(0);\n        opacity: 0.3;\n    }\n    100% {\n        transform: translateY(105vh) rotate(360deg);\n        opacity: 0;\n    }\n}\n\n/* Set icon and color based on body class */\nbody.result-safe-active .animation-swarm span::before {\n    content: '\\f132'; /* fa-shield-halved */\n    color: var(--green);\n}\nbody.result-suspicious-active .animation-swarm span::before {\n    content: '\\f071'; /* fa-exclamation-triangle */\n    color: var(--yellow);\n}\nbody.result-malware-active .animation-swarm span::before {\n    content: '\\f188'; /* fa-bug */\n    color: var(--red);\n}\n\n/* Give each particle a unique position and delay --- THIS IS THE FINAL FIX --- */\n/* All values are kept well away from the 90-100% range */\n.animation-swarm span:nth-child(1) { left: 10%; animation-delay: 0s; }\n.animation-swarm span:nth-child(2) { left: 20%; animation-delay: -2s; }\n.animation-swarm span:nth-child(3) { left: 30%; animation-delay: -4s; }\n.animation-swarm span:nth-child(4) { left: 40%; animation-delay: -6s; }\n.animation-swarm span:nth-child(5) { left: 50%; animation-delay: -8s; }\n.animation-swarm span:nth-child(6) { left: 60%; animation-delay: -1s; }\n.animation-swarm span:nth-child(7) { left: 70%; animation-delay: -3s; }\n.animation-swarm span:nth-child(8) { left: 75%; animation-delay: -5s; } /* Was 80% */\n.animation-swarm span:nth-child(9) { left: 15%; animation-delay: -7s; } /* Was 90% */\n.animation-swarm span:nth-child(10) { left: 5%; animation-delay: -9s; }\n\n\n/* --- History Panel --- */\n.history-overlay {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0,0,0,0.5);\n    z-index: 1001;\n    opacity: 0;\n    visibility: hidden;\n    transition: all 0.3s ease;\n}\n.history-panel {\n    position: fixed;\n    top: 0;\n    right: -450px; /* Start off-screen */\n    width: 400px;\n    max-width: 90%;\n    height: 100%;\n    background-color: var(--bg-dark-2);\n    z-index: 1002;\n    transition: all 0.3s ease;\n    display: flex;\n    flex-direction: column;\n}\nbody.is-history-open .history-overlay {\n    opacity: 1;\n    visibility: visible;\n}\nbody.is-history-open .history-panel {\n    right: 0;\n}\n.history-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 1rem 1.5rem;\n    border-bottom: 1px solid var(--border-color);\n}\n.history-header h3 {\n    margin: 0;\n    font-size: 1.2rem;\n}\n.history-close-btn {\n    background: none;\n    border: none;\n    color: var(--text-medium);\n    font-size: 1.5rem;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n.history-close-btn:hover {\n    color: var(--text-light);\n}\n.history-list {\n    list-style: none;\n    padding: 0;\n    margin: 0;\n    overflow-y: auto;\n    flex-grow: 1;\n}\n.history-list li {\n    display: flex;\n    align-items: center;\n    gap: 1rem;\n    padding: 1rem 1.5rem;\n    border-bottom: 1px solid var(--border-color);\n    transition: background-color 0.2s ease;\n}\n\n.history-list li:hover {\n    background-color: var(--bg-dark-3);\n}\n\n.history-item {\n    display: flex;\n    align-items: flex-start;\n    gap: 1rem;\n}\n\n.history-icon-wrapper {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 0.5rem;\n    min-width: 60px;\n}\n\n.history-icon {\n    font-size: 1.8rem;\n    width: 40px;\n    height: 40px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    border-radius: 8px;\n    background-color: var(--bg-dark-3);\n}\n\n.history-icon.safe {\n    color: var(--green);\n    border: 2px solid var(--green);\n}\n\n.history-icon.suspicious {\n    color: var(--yellow);\n    border: 2px solid var(--yellow);\n}\n\n.history-icon.malware {\n    color: var(--red);\n    border: 2px solid var(--red);\n}\n\n.history-file-type {\n    font-size: 1rem;\n    color: var(--text-medium);\n}\n\n.history-details {\n    flex-grow: 1;\n    display: flex;\n    flex-direction: column;\n    gap: 0.5rem;\n    min-width: 0; /* Allow text truncation */\n}\n\n.history-filename {\n    font-weight: 600;\n    color: var(--text-light);\n    font-size: 0.95rem;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.history-classification {\n    font-size: 0.85rem;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.05em;\n}\n\n.history-classification.safe {\n    color: var(--green);\n}\n\n.history-classification.suspicious {\n    color: var(--yellow);\n}\n\n.history-classification.malware {\n    color: var(--red);\n}\n\n.history-hash {\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.75rem;\n    color: var(--text-medium);\n    background-color: var(--bg-dark-3);\n    padding: 0.25rem 0.5rem;\n    border-radius: 4px;\n    word-break: break-all;\n    line-height: 1.4;\n}\n\n.history-date {\n    font-size: 0.8rem;\n    color: var(--text-medium);\n    white-space: nowrap;\n    align-self: flex-start;\n    padding-top: 0.25rem;\n}\n\n.history-item-empty,\n.history-item-loading {\n    color: var(--text-medium);\n    text-align: center;\n    padding: 2rem;\n    font-style: italic;\n}\n\n\n/* --- Hover Scroll Zones --- */\n.scroll-zone {\n    position: fixed;\n    left: 0;\n    width: 100%;\n    height: 80px;\n    z-index: 998;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n}\n.scroll-zone.top { top: 60px; /* Below nav */ }\n.scroll-zone.bottom { bottom: 0; }\n\n.scroll-zone i {\n    font-size: 2rem;\n    color: var(--text-light);\n    opacity: 0;\n    transition: all 0.3s ease;\n    text-shadow: 0 0 15px rgba(0,0,0,0.7);\n}\n.scroll-zone.scrolling i {\n    opacity: 0.3;\n}\n.scroll-zone:hover i {\n    opacity: 0.7;\n}\n\n\n/* --- Graph Panel --- */\n.graph-wrapper {\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n    margin-top: 1rem;\n    display: none; /* Hidden by default */\n    box-sizing: border-box;\n}\nbody.is-showing-result .graph-wrapper {\n    display: block; /* Show with results */\n}\n\n.graph-header {\n    padding: 1rem 1.5rem;\n    border-bottom: 1px solid var(--border-color);\n    background-color: var(--bg-dark-3);\n    border-radius: 12px 12px 0 0;\n}\n.graph-header h3 {\n    margin: 0;\n    color: var(--text-light);\n    font-size: 1.1rem;\n}\n.call-graph-container {\n    overflow: auto; /* Allow scrolling for large graphs */\n}\n.call-graph {\n    flex-grow: 1;\n    overflow: auto;\n    position: relative; /* KEY for node positioning */\n    min-height: 400px;\n    padding: 1rem;\n}\n\n.graph-node {\n    position: absolute;\n    padding: 0.75rem 1.25rem;\n    border-radius: 8px;\n    background-color: var(--bg-dark-3);\n    border: 2px solid var(--border-color);\n    font-family: 'Courier New', Courier, monospace;\n    font-weight: bold;\n    white-space: nowrap;\n    box-shadow: 0 4px 10px rgba(0,0,0,0.3);\n    z-index: 2;\n    text-align: center;\n}\n/* MODIFIED to use variables */\n.node-entry { background-color: var(--node-bg-entry); border-color: var(--green); color: var(--syntax-const-text); }\n.node-std { background-color: var(--bg-dark-3); border-color: var(--border-color); color: var(--text-light); }\n.node-api { background-color: var(--node-bg-api); border-color: var(--blue); color: var(--syntax-const-text); }\n.node-suspicious { background-color: var(--node-bg-suspicious); border-color: var(--yellow); color: var(--syntax-const-text); }\n.node-malicious { background-color: var(--node-bg-malicious); border-color: var(--red); color: var(--syntax-const-text); }\n\n.leader-line {\n    z-index: 1; /* Sit behind nodes */\n    opacity: 0.8;\n}\nbody.light-theme .chart-container {\n    color: var(--text-medium);\n}\n","epoch":102,"telemetryInfo":{}}],["file:///home/trang/localnsv/mAIware/style.css::request_e07a7772-968a-477e-a954-72eb3513ede7",{"uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/style.css","external":"file:///home/trang/localnsv/mAIware/style.css","path":"/home/trang/localnsv/mAIware/style.css","scheme":"file"},"requestId":"request_e07a7772-968a-477e-a954-72eb3513ede7","content":"/* --- Global & Fonts --- */\n:root {\n    /* --- Dark Theme (Default) --- */\n    --bg-dark-1: #121212;\n    --bg-dark-2: #1e1e1e;\n    --bg-dark-3: #2a2a2e;\n    --bg-dark-4: #333333;\n    --border-color: #444444;\n    --text-light: #e0e0e0;\n    --text-medium: #aaa;\n    --text-dark: #888;\n    \n    /* --- Semantic Colors --- */\n    --blue: #007bff;\n    --red: #e74c3c;\n    --yellow: #f1c40f;\n    --green: #2ecc71;\n    \n    /* --- Syntax & Node Colors --- */\n    --syntax-op: #c39eff;\n    --syntax-string: #e6db74;\n    --syntax-const-text: #ffffff; /* Constant white for dark buttons/nodes */\n    --node-bg-entry: #254a25;\n    --node-bg-api: #2a3e4a;\n    --node-bg-suspicious: #4a452a;\n    --node-bg-malicious: #4a2a2a;\n\n    --chart-legend-text: var(--text-light);  /* #e0e0e0 */\n    --chart-axes-text: var(--text-medium);   /* #aaa */\n    --chart-grid-line: var(--border-color);\n}\n\n/* --- Light Theme --- */\n/* Add \".light-theme\" to the <body> tag to activate */\nbody.light-theme {\n    --bg-dark-1: #f8f9fa;     /* Main background */\n    --bg-dark-2: #ffffff;     /* Card background */\n    --bg-dark-3: #e9ecef;     /* Hover/active background */\n    --bg-dark-4: #ced4da;     /* Secondary button background */\n    --border-color: #dee2e6;  /* Border color */\n    --text-light: #212529;    /* Main text */\n    --text-medium: #6c757d;   /* Secondary text */\n    --text-dark: #888;        /* Tertiary text (can stay gray) */\n    \n    /* Semantic colors are unchanged */\n    /* --blue, --red, --yellow, --green */\n    \n    /* --- Light Theme Syntax --- */\n    --syntax-op: #a040ff;       /* Darker purple */\n    --syntax-string: #b8860b;     /* Dark goldenrod */\n    --syntax-const-text: #ffffff; /* Stays white for colored buttons/nodes */\n    \n    /* Node backgrounds are unchanged, they look good on a light BG */\n    --chart-legend-text: var(--text-medium); /* User Request */\n    --chart-axes-text: var(--text-medium);   /* User Request */\n    --chart-grid-line: var(--border-color);\n}\n\n\n/* Apply overflow-x to html as well */\nhtml {\n    overflow-x: hidden;\n    font-size: 16px; /* Ensure base font size */\n}\n\nbody {\n    font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n    background-color: var(--bg-dark-1);\n    color: var(--text-light);\n    margin: 0;\n    padding-top: 60px; /* Make space for fixed top nav */\n    overflow-x: hidden; /* Prevent horizontal scroll */\n    width: 100%;\n    min-height: 100vh;\n}\n\n/* --- Main Grid Container --- */\n.main-container {\n    display: grid;\n    grid-template-columns: 1fr 1fr; /* Simpler 2-column definition */\n    grid-template-rows: auto auto; /* Rows for content and graph */\n    gap: 2rem;\n    padding: 2rem; /* Spacing from nav and screen edges */\n    align-items: start;\n    \n    /* Set max-width on the grid itself */\n    max-width: 1400px; \n    /* Center the whole grid */\n    margin: 0 auto; \n    \n    min-height: calc(100vh - 60px); /* Full height minus nav */\n    box-sizing: border-box;\n    width: 100%;\n}\n\n.scanner-wrapper {\n    grid-column: 1 / 2; /* Span first column */\n    grid-row: 1 / 2;\n    display: flex;\n    flex-direction: column;\n    gap: 1.5rem;\n    width: 100%; /* Fill the column */\n}\n\n.right-panel-wrapper {\n    grid-column: 2 / 3; /* Span second column */\n    grid-row: 1 / 2;\n    display: flex; /* Make it a flex container */\n    flex-direction: column; /* Stack its children vertically */\n    gap: 1.5rem; /* Space between its children */\n    width: 100%; /* Fill the column */\n}\n\n.graph-wrapper {\n    grid-column: 1 / 3; /* Span BOTH columns */\n    grid-row: 2 / 3;\n    width: 100%;\n    /* max-width is now inherited from main-container */\n    justify-self: center; /* Center in the grid area */\n}\n\n\n/* --- Top Navigation --- */\n.top-nav {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    height: 60px;\n    background-color: var(--bg-dark-2);\n    border-bottom: 1px solid var(--border-color);\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 0 2rem;\n    z-index: 1000;\n    box-sizing: border-box;\n}\n\n.top-nav .logo {\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n    font-size: 1.3rem;\n    font-weight: 600;\n    color: var(--text-light);\n}\n\n.top-nav .logo i {\n    color: var(--blue);\n}\n\n.nav-links {\n    display: flex;\n    gap: 0.5rem;\n}\n\n.nav-link {\n    color: var(--text-medium);\n    font-size: 1.25rem;\n    padding: 0.75rem;\n    border-radius: 8px;\n    transition: all 0.2s ease;\n    position: relative;\n    text-decoration: none;\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n}\n\n.nav-link .link-text {\n    font-size: 0.9rem;\n    font-weight: 500;\n    max-width: 0;\n    overflow: hidden;\n    white-space: nowrap;\n    transition: all 0.3s ease;\n}\n\n.nav-link:hover {\n    background-color: var(--bg-dark-3);\n    color: var(--text-light);\n}\n\n.nav-link:hover .link-text {\n    max-width: 80px; /* Expand text on hover */\n    margin-left: 0.25rem;\n}\n\n/* --- Tooltip --- */\n.nav-link:hover::before {\n    content: attr(data-tooltip);\n    position: absolute;\n    bottom: -35px;\n    left: 50%;\n    transform: translateX(-50%);\n    background-color: var(--bg-dark-3);\n    color: var(--text-light);\n    padding: 5px 10px;\n    border-radius: 4px;\n    font-size: 0.8rem;\n    white-space: nowrap;\n    opacity: 0;\n    transition: opacity 0.2s 0.3s; /* Delay tooltip */\n    pointer-events: none;\n}\n.nav-link:hover .link-text {\n    display: none; /* Hide expanded text if tooltip is showing */\n}\n.nav-link:hover:hover::before {\n    opacity: 1;\n}\n\n/* On smaller screens, stack the columns */\n@media (max-width: 1280px) { /* Widened breakpoint */\n    .main-container {\n        grid-template-columns: 1fr; /* Stack columns */\n        padding: 1rem;\n    }\n    .scanner-wrapper, .right-panel-wrapper, .graph-wrapper {\n        grid-column: 1 / 2; /* All in one column */\n        max-width: 100%;\n        justify-self: center;\n    }\n    .right-panel-wrapper {\n        grid-row: 2 / 3;\n    }\n    .graph-wrapper {\n        grid-row: 3 / 4;\n    }\n}\n\n/* Hide link text on very small screens */\n@media (max-width: 768px) {\n    .nav-link .link-text { display: none; }\n    .nav-link:hover .link-text { display: none; }\n    .top-nav { padding: 0 1rem; }\n}\n\n\n/* --- Main Scanner Box --- */\n.scanner-container {\n    width: 100%; /* Ensure it fills its flex parent */\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n    padding: 2.5rem;\n    text-align: center;\n    overflow: hidden;\n    transition: all 0.3s ease;\n    box-sizing: border-box; /* Include padding in width */\n}\n\nh1 {\n    color: var(--text-light);\n    margin-top: 0;\n    margin-bottom: 1rem;\n}\n\n.scanner-container p {\n    color: var(--text-medium);\n    margin-bottom: 2rem;\n    font-size: 1.1rem;\n}\n\n.scanner-state {\n    display: none;\n}\n.scanner-state.active {\n    display: block;\n}\n\n/* --- State 1: Upload --- */\n.upload-zone {\n    border: 2px dashed var(--border-color);\n    border-radius: 8px;\n    padding: 3rem 2rem;\n    cursor: pointer;\n    transition: all 0.3s ease;\n}\n.upload-zone:hover {\n    background-color: var(--bg-dark-3);\n    border-color: var(--blue);\n}\n.upload-icon {\n    font-size: 4rem;\n    color: var(--blue);\n    margin-bottom: 1rem;\n}\n.upload-zone h3 {\n    margin: 0;\n    color: var(--text-light);\n}\n.upload-zone span {\n    color: var(--text-dark);\n}\n\n/* --- State 2: Analyzing --- */\n.analyzing-icon .loader {\n    width: 80px;\n    height: 80px;\n    border: 6px solid var(--bg-dark-4);\n    border-top-color: var(--blue);\n    border-radius: 50%;\n    animation: spin 1s linear infinite;\n    margin: 2rem auto;\n}\n@keyframes spin {\n    to { transform: rotate(360deg); }\n}\n.analyzing-state h3 {\n    color: var(--text-light);\n    margin-bottom: 0.5rem;\n}\n.analyzing-state .filename,\n.result-state .filename {\n    color: var(--text-medium);\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 1.1rem;\n    word-break: break-all;\n}\n\n/* --- State 3: Result --- */\n.result-icon {\n    font-size: 6rem;\n    line-height: 1;\n    margin: 1.5rem 0;\n}\n.result-state h2 {\n    font-size: 2.5rem;\n    margin: 0 0 0.5rem 0;\n}\n.result-malware .result-icon, .result-malware h2 { color: var(--red); }\n.result-suspicious .result-icon, .result-suspicious h2 { color: var(--yellow); }\n.result-safe .result-icon, .result-safe h2 { color: var(--green); }\n.result-state p {\n    font-size: 1rem;\n    margin-bottom: 2rem;\n}\n\n/* --- Scan Navigation Controls --- */\n.scan-navigation {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 1.5rem;\n    margin-top: 1.5rem;\n    padding-top: 1.5rem;\n    border-top: 1px solid rgba(255, 255, 255, 0.1);\n}\n\n.nav-btn {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    padding: 0.75rem 1.5rem;\n    background: linear-gradient(135deg, var(--primary), var(--secondary));\n    color: white;\n    border: none;\n    border-radius: 8px;\n    font-size: 1rem;\n    font-weight: 600;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);\n}\n\n.nav-btn:hover:not(:disabled) {\n    transform: translateY(-2px);\n    box-shadow: 0 6px 20px rgba(139, 92, 246, 0.5);\n}\n\n.nav-btn:active:not(:disabled) {\n    transform: translateY(0);\n}\n\n.nav-btn:disabled {\n    background: rgba(255, 255, 255, 0.1);\n    color: rgba(255, 255, 255, 0.3);\n    cursor: not-allowed;\n    box-shadow: none;\n}\n\n.nav-info {\n    color: var(--text-medium);\n    font-size: 0.95rem;\n    font-weight: 500;\n    min-width: 80px;\n    text-align: center;\n}\n\n.non-pe-result {\n    display: none;\n    flex-direction: column;\n    align-items: center;\n    gap: 1.5rem;\n    color: var(--text-light);\n    padding: 1rem 0 0 0;\n}\n\n.non-pe-result.active {\n    display: flex;\n}\n\n.non-pe-icon {\n    width: 96px;\n    height: 96px;\n    border-radius: 24px;\n    background: linear-gradient(135deg, rgba(80, 130, 255, 0.2), rgba(80, 130, 255, 0.05));\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 3rem;\n    color: var(--blue);\n}\n\n.non-pe-hash-grid {\n    display: flex;\n    gap: 1.5rem;\n    flex-wrap: wrap;\n    justify-content: center;\n}\n\n.non-pe-hash {\n    min-width: 220px;\n    background: var(--bg-dark-3);\n    padding: 1rem 1.25rem;\n    border-radius: 12px;\n    border: 1px solid rgba(255, 255, 255, 0.05);\n    text-align: left;\n}\n\n.non-pe-hash h4 {\n    margin: 0 0 0.5rem 0;\n    font-size: 0.85rem;\n    text-transform: uppercase;\n    letter-spacing: 0.08rem;\n    color: var(--text-medium);\n}\n\n.non-pe-hash p {\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.9rem;\n    word-break: break-all;\n    color: var(--text-light);\n}\n\nbody.is-non-pe .analysis-details-container,\nbody.is-non-pe #analysis-details-wrapper,\nbody.is-non-pe #disassembly-wrapper,\nbody.is-non-pe #file-internals-wrapper,\nbody.is-non-pe #graph-wrapper {\n    display: none !important;\n}\n\nbody.is-non-pe #result-state {\n    display: none !important;\n}\n\nbody.is-non-pe .non-pe-result {\n    display: flex;\n}\n\n\n/* --- NEW: Stats Dashboard Panel --- */\n.stats-wrapper {\n    display: flex; \n    flex-direction: column;\n    gap: 1.5rem;\n    width: 100%; /* Fill its flex parent */\n    box-sizing: border-box; /* Include padding in width */\n}\n\n/* By default, stats are visible, disassembly is hidden */\n.disassembly-wrapper { display: none; }\n\n/* When analyzing/showing results, hide stats and show disassembly */\nbody.is-analyzing .stats-wrapper,\nbody.is-showing-result .stats-wrapper {\n    display: none;\n}\nbody.is-analyzing .disassembly-wrapper,\nbody.is-showing-result .disassembly-wrapper {\n    display: flex; /* Use flex to match its own styles */\n}\n\n\n.stats-grid {\n    display: flex; \n    flex-direction: column;\n    /* Force stacking */\n    gap: 1.5rem;\n}\n\n.stat-card {\n    display: flex;\n    align-items: center;\n    gap: 1.5rem;\n    background-color: var(--bg-dark-2);\n    padding: 1.5rem;\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n}\n.stat-card i {\n    font-size: 2.5rem;\n    color: var(--blue);\n}\n.stat-content {\n    display: flex;\n    flex-direction: column;\n}\n.stat-number {\n    font-size: 2rem;\n    font-weight: 600;\n    color: var(--text-light);\n    line-height: 1.2;\n}\n.stat-label {\n    font-size: 0.9rem;\n    color: var(--text-medium);\n}\n\n.chart-container-wrapper {\n    display: flex;\n    flex-direction: column;\n    gap: 1.5rem;\n}\n\n.chart-container {\n    background-color: var(--bg-dark-2);\n    padding: 1.5rem;\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    box-sizing: border-box;\n}\n.chart-container h3 {\n    margin-top: 0;\n    margin-bottom: 1.5rem;\n    text-align: center;\n    color: var(--text-light);\n    font-size: 1.1rem;\n}\n\n\n/* --- Disassembly Panel --- */\n.disassembly-wrapper {\n    /* display: none; set by default now */\n    flex-direction: column;\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n    height: 600px; /* Fixed height */\n    max-height: 70vh;\n    opacity: 0;\n    transition: all 0.3s ease;\n    width: 100%;\n    box-sizing: border-box;\n}\n\nbody.is-analyzing .disassembly-wrapper,\nbody.is-showing-result .disassembly-wrapper {\n    opacity: 1;\n}\n\n.disassembly-header {\n    padding: 1rem 1.5rem;\n    border-bottom: 1px solid var(--border-color);\n    background-color: var(--bg-dark-3);\n    border-radius: 12px 12px 0 0;\n}\n.disassembly-header h3 {\n    margin: 0;\n    color: var(--text-light);\n    font-size: 1.1rem;\n    font-family: 'Courier New', Courier, monospace;\n}\n.disassembly-code {\n    flex-grow: 1;\n    overflow-y: auto;\n    padding: 1rem;\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.95rem;\n}\n.disassembly-line {\n    display: block;\n    padding: 2px 1rem;\n    border-radius: 4px;\n    transition: background-color 0.2s ease;\n}\n.disassembly-line.active {\n    background-color: var(--blue);\n    color: var(--syntax-const-text); /* MODIFIED */\n}\n.disassembly-line .addr { color: var(--text-dark); margin-right: 1rem; }\n.disassembly-line .op { color: var(--syntax-op); font-weight: bold; width: 50px; display: inline-block; } /* MODIFIED */\n.disassembly-line .args { color: var(--text-light); }\n.disassembly-line .string { color: var(--syntax-string); } /* MODIFIED */\n.disassembly-line .comment { color: var(--green); margin-left: 1rem; }\n\n\n/* --- Analysis Details Panel --- */\n.analysis-details-container {\n    width: 100%;\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    padding: 2rem;\n    display: none; /* Hidden by default */\n    box-sizing: border-box;\n}\nbody.is-showing-result .analysis-details-container {\n    display: block;\n}\n\n.progress-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 0.75rem;\n}\n.progress-header h3 {\n    margin: 0;\n    font-size: 1.1rem;\n    color: var(--text-light);\n}\n.score-percentage {\n    font-size: 1.2rem;\n    font-weight: 600;\n}\n.score-green { color: var(--green); }\n.score-yellow { color: var(--yellow); }\n.score-red { color: var(--red); }\n\n.progress-bar-background {\n    width: 100%;\n    height: 12px;\n    background-color: var(--bg-dark-3);\n    border-radius: 6px;\n    overflow: hidden;\n    margin-bottom: 1.5rem;\n}\n.progress-bar-fill {\n    height: 100%;\n    width: 0%;\n    border-radius: 6px;\n    transition: width 0.5s ease;\n}\n.progress-bar-green { background-color: var(--green); }\n.progress-bar-yellow { background-color: var(--yellow); }\n.progress-bar-red { background-color: var(--red); }\n\n.details-section {\n    margin-bottom: 1.25rem;\n}\n.details-section h4 {\n    margin: 0 0 0.5rem 0;\n    color: var(--text-medium);\n    font-size: 0.9rem;\n    text-transform: uppercase;\n}\n.details-section p {\n    margin: 0;\n    color: var(--text-light);\n    font-size: 1rem;\n}\n.hash-text {\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.95rem;\n    word-break: break-all;\n}\n\n/* --- Vendor & Signature --- */\n.details-grid {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 1.5rem;\n    margin-bottom: 1.25rem;\n}\n.vendor-info, .signature-info {\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n    font-size: 1rem;\n    font-weight: 500;\n}\n.vendor-info i {\n    font-size: 1.5rem;\n    color: var(--text-medium);\n}\n.signature-info i {\n    font-size: 1.25rem;\n}\n/* Use the levels from datasrcs.js */\n.sig-verified { color: var(--green); }\n.sig-untrusted { color: var(--red); }\n.sig-unknown { color: var(--yellow); }\n\n/* --- File Internals Card --- */\n.file-internals-container {\n    width: 100%;\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    padding: 2rem;\n    display: none; /* Hidden by default */\n    box-sizing: border-box;\n    flex-direction: column;\n    gap: 1.5rem;\n}\nbody.is-showing-result .file-internals-container {\n    display: flex;\n}\n.file-internals-container h3 {\n    margin-top: 0;\n    margin-bottom: 0;\n    color: var(--text-light);\n    font-size: 1.25rem;\n    padding-bottom: 1rem;\n    border-bottom: 1px solid var(--border-color);\n}\n\n/* --- Entropy Bars --- */\n.entropy-bars {\n    display: flex;\n    flex-direction: column;\n    gap: 0.75rem;\n}\n.entropy-bar-row {\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n}\n.entropy-bar-label {\n    width: 60px;\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.9rem;\n    color: var(--text-medium);\n    flex-shrink: 0;\n}\n.entropy-bar-bg {\n    flex-grow: 1;\n    height: 20px;\n    background-color: var(--bg-dark-3);\n    border-radius: 4px;\n    overflow: hidden;\n}\n.entropy-bar-fill {\n    height: 100%;\n    width: 0%; /* Set by JS */\n    background-color: var(--blue);\n    border-radius: 4px;\n    transition: width 0.5s ease;\n    display: flex;\n    justify-content: flex-end;\n    align-items: center;\n    padding-right: 0.5rem;\n    box-sizing: border-box;\n}\n.entropy-bar-value {\n    font-size: 0.8rem;\n    font-weight: bold;\n    color: var(--syntax-const-text); /* MODIFIED */\n    text-shadow: 0 0 3px rgba(0,0,0,0.5);\n}\n/* Color coding for entropy bars */\n.entropy-bar-fill.low { background-color: var(--green); }\n.entropy-bar-fill.medium { background-color: var(--blue); }\n.entropy-bar-fill.high { background-color: var(--yellow); }\n.entropy-bar-fill.packed { background-color: var(--red); }\n\n/* --- Key Strings --- */\n.key-strings {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 0.5rem;\n}\n.key-string-tag {\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.9rem;\n    background-color: var(--bg-dark-3);\n    border: 1px solid var(--border-color);\n    padding: 0.25rem 0.5rem;\n    border-radius: 4px;\n    color: var(--text-light);\n}\n.key-string-tag.suspicious {\n    border-color: var(--red);\n    color: var(--red);\n    background-color: #e74c3c1a;\n}\n.key-string-tag.benign {\n    border-color: var(--green);\n    color: var(--green);\n    background-color: #2ecc711a;\n}\n\n/* --- Buttons --- */\n.btn-wrapper {\n    margin-top: 2rem;\n    display: flex;\n    gap: 1rem;\n}\n.btn {\n    flex-grow: 1; /* Make buttons fill space */\n    background-color: var(--blue);\n    color: var(--syntax-const-text); /* MODIFIED */\n    border: none;\n    padding: 12px 24px;\n    border-radius: 6px;\n    font-size: 1rem;\n    font-weight: bold;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    text-decoration: none;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    gap: 0.5rem;\n}\n.btn:hover {\n    filter: brightness(1.2);\n}\n.btn-primary {\n    background-color: var(--blue);\n}\n.btn-secondary {\n    background-color: var(--bg-dark-4);\n    color: var(--text-light);\n}\n.btn-secondary:hover {\n    background-color: #555;\n}\n.btn i {\n    margin-right: 0.25rem;\n}\n\n\n/* --- Background Particle Animations --- */\n.animation-swarm {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%; \n    height: 100%;\n    z-index: -1;\n    pointer-events: none;\n    overflow: hidden; \n}\n\n/* Base style for each new span particle */\n.animation-swarm span {\n    position: absolute;\n    top: -20px; /* Start off-screen */\n    font-size: 1.5rem;\n    opacity: 0; /* Start invisible */\n    animation: fall 10s linear infinite;\n}\n\n/* The ::before holds the icon content */\n.animation-swarm span::before {\n    content: '';\n    font-family: \"Font Awesome 6 Free\";\n    font-weight: 900;\n    text-shadow: 0 0 5px;\n}\n\n/* Keyframes for falling (starts with opacity) */\n@keyframes fall {\n    0% {\n        transform: translateY(0vh) rotate(0);\n        opacity: 0.3;\n    }\n    100% {\n        transform: translateY(105vh) rotate(360deg);\n        opacity: 0;\n    }\n}\n\n/* Set icon and color based on body class */\nbody.result-safe-active .animation-swarm span::before {\n    content: '\\f132'; /* fa-shield-halved */\n    color: var(--green);\n}\nbody.result-suspicious-active .animation-swarm span::before {\n    content: '\\f071'; /* fa-exclamation-triangle */\n    color: var(--yellow);\n}\nbody.result-malware-active .animation-swarm span::before {\n    content: '\\f188'; /* fa-bug */\n    color: var(--red);\n}\n\n/* Give each particle a unique position and delay --- THIS IS THE FINAL FIX --- */\n/* All values are kept well away from the 90-100% range */\n.animation-swarm span:nth-child(1) { left: 10%; animation-delay: 0s; }\n.animation-swarm span:nth-child(2) { left: 20%; animation-delay: -2s; }\n.animation-swarm span:nth-child(3) { left: 30%; animation-delay: -4s; }\n.animation-swarm span:nth-child(4) { left: 40%; animation-delay: -6s; }\n.animation-swarm span:nth-child(5) { left: 50%; animation-delay: -8s; }\n.animation-swarm span:nth-child(6) { left: 60%; animation-delay: -1s; }\n.animation-swarm span:nth-child(7) { left: 70%; animation-delay: -3s; }\n.animation-swarm span:nth-child(8) { left: 75%; animation-delay: -5s; } /* Was 80% */\n.animation-swarm span:nth-child(9) { left: 15%; animation-delay: -7s; } /* Was 90% */\n.animation-swarm span:nth-child(10) { left: 5%; animation-delay: -9s; }\n\n\n/* --- History Panel --- */\n.history-overlay {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0,0,0,0.5);\n    z-index: 1001;\n    opacity: 0;\n    visibility: hidden;\n    transition: all 0.3s ease;\n}\n.history-panel {\n    position: fixed;\n    top: 0;\n    right: -450px; /* Start off-screen */\n    width: 400px;\n    max-width: 90%;\n    height: 100%;\n    background-color: var(--bg-dark-2);\n    z-index: 1002;\n    transition: all 0.3s ease;\n    display: flex;\n    flex-direction: column;\n}\nbody.is-history-open .history-overlay {\n    opacity: 1;\n    visibility: visible;\n}\nbody.is-history-open .history-panel {\n    right: 0;\n}\n.history-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 1rem 1.5rem;\n    border-bottom: 1px solid var(--border-color);\n}\n.history-header h3 {\n    margin: 0;\n    font-size: 1.2rem;\n}\n.history-close-btn {\n    background: none;\n    border: none;\n    color: var(--text-medium);\n    font-size: 1.5rem;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n.history-close-btn:hover {\n    color: var(--text-light);\n}\n.history-list {\n    list-style: none;\n    padding: 0;\n    margin: 0;\n    overflow-y: auto;\n    flex-grow: 1;\n}\n.history-list li {\n    display: flex;\n    align-items: center;\n    gap: 1rem;\n    padding: 1rem 1.5rem;\n    border-bottom: 1px solid var(--border-color);\n    transition: background-color 0.2s ease;\n}\n\n.history-list li:hover {\n    background-color: var(--bg-dark-3);\n}\n\n.history-item {\n    display: flex;\n    align-items: flex-start;\n    gap: 1rem;\n}\n\n.history-icon-wrapper {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 0.5rem;\n    min-width: 60px;\n}\n\n.history-icon {\n    font-size: 1.8rem;\n    width: 40px;\n    height: 40px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    border-radius: 8px;\n    background-color: var(--bg-dark-3);\n}\n\n.history-icon.safe {\n    color: var(--green);\n    border: 2px solid var(--green);\n}\n\n.history-icon.suspicious {\n    color: var(--yellow);\n    border: 2px solid var(--yellow);\n}\n\n.history-icon.malware {\n    color: var(--red);\n    border: 2px solid var(--red);\n}\n\n.history-file-type {\n    font-size: 1rem;\n    color: var(--text-medium);\n}\n\n.history-details {\n    flex-grow: 1;\n    display: flex;\n    flex-direction: column;\n    gap: 0.5rem;\n    min-width: 0; /* Allow text truncation */\n}\n\n.history-filename {\n    font-weight: 600;\n    color: var(--text-light);\n    font-size: 0.95rem;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.history-classification {\n    font-size: 0.85rem;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.05em;\n}\n\n.history-classification.safe {\n    color: var(--green);\n}\n\n.history-classification.suspicious {\n    color: var(--yellow);\n}\n\n.history-classification.malware {\n    color: var(--red);\n}\n\n.history-hash {\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.75rem;\n    color: var(--text-medium);\n    background-color: var(--bg-dark-3);\n    padding: 0.25rem 0.5rem;\n    border-radius: 4px;\n    word-break: break-all;\n    line-height: 1.4;\n}\n\n.history-date {\n    font-size: 0.8rem;\n    color: var(--text-medium);\n    white-space: nowrap;\n    align-self: flex-start;\n    padding-top: 0.25rem;\n}\n\n.history-item-empty,\n.history-item-loading {\n    color: var(--text-medium);\n    text-align: center;\n    padding: 2rem;\n    font-style: italic;\n}\n\n\n/* --- Hover Scroll Zones --- */\n.scroll-zone {\n    position: fixed;\n    left: 0;\n    width: 100%;\n    height: 80px;\n    z-index: 998;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n}\n.scroll-zone.top { top: 60px; /* Below nav */ }\n.scroll-zone.bottom { bottom: 0; }\n\n.scroll-zone i {\n    font-size: 2rem;\n    color: var(--text-light);\n    opacity: 0;\n    transition: all 0.3s ease;\n    text-shadow: 0 0 15px rgba(0,0,0,0.7);\n}\n.scroll-zone.scrolling i {\n    opacity: 0.3;\n}\n.scroll-zone:hover i {\n    opacity: 0.7;\n}\n\n\n/* --- Graph Panel --- */\n.graph-wrapper {\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n    margin-top: 1rem;\n    display: none; /* Hidden by default */\n    box-sizing: border-box;\n}\nbody.is-showing-result .graph-wrapper {\n    display: block; /* Show with results */\n}\n\n.graph-header {\n    padding: 1rem 1.5rem;\n    border-bottom: 1px solid var(--border-color);\n    background-color: var(--bg-dark-3);\n    border-radius: 12px 12px 0 0;\n}\n.graph-header h3 {\n    margin: 0;\n    color: var(--text-light);\n    font-size: 1.1rem;\n}\n.call-graph-container {\n    overflow: auto; /* Allow scrolling for large graphs */\n}\n.call-graph {\n    flex-grow: 1;\n    overflow: auto;\n    position: relative; /* KEY for node positioning */\n    min-height: 400px;\n    padding: 1rem;\n}\n\n.graph-node {\n    position: absolute;\n    padding: 0.75rem 1.25rem;\n    border-radius: 8px;\n    background-color: var(--bg-dark-3);\n    border: 2px solid var(--border-color);\n    font-family: 'Courier New', Courier, monospace;\n    font-weight: bold;\n    white-space: nowrap;\n    box-shadow: 0 4px 10px rgba(0,0,0,0.3);\n    z-index: 2;\n    text-align: center;\n}\n/* MODIFIED to use variables */\n.node-entry { background-color: var(--node-bg-entry); border-color: var(--green); color: var(--syntax-const-text); }\n.node-std { background-color: var(--bg-dark-3); border-color: var(--border-color); color: var(--text-light); }\n.node-api { background-color: var(--node-bg-api); border-color: var(--blue); color: var(--syntax-const-text); }\n.node-suspicious { background-color: var(--node-bg-suspicious); border-color: var(--yellow); color: var(--syntax-const-text); }\n.node-malicious { background-color: var(--node-bg-malicious); border-color: var(--red); color: var(--syntax-const-text); }\n\n.leader-line {\n    z-index: 1; /* Sit behind nodes */\n    opacity: 0.8;\n}\nbody.light-theme .chart-container {\n    color: var(--text-medium);\n}\n\n/* Light theme navigation buttons */\nbody.light-theme .nav-btn {\n    background: linear-gradient(135deg, var(--primary), var(--secondary));\n    color: white;\n    box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);\n}\n\nbody.light-theme .nav-btn:hover:not(:disabled) {\n    box-shadow: 0 6px 20px rgba(139, 92, 246, 0.6);\n}\n\nbody.light-theme .nav-btn:disabled {\n    background: var(--bg-dark-3);\n    color: var(--text-dark);\n    box-shadow: none;\n}\n\nbody.light-theme .nav-info {\n    color: var(--text-light);\n    font-weight: 600;\n}\n\nbody.light-theme .scan-navigation {\n    border-top-color: var(--border-color);\n}\n","epoch":107,"telemetryInfo":{}}],["file:///home/trang/localnsv/mAIware/index.html::request_e07a7772-968a-477e-a954-72eb3513ede7",{"uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/index.html","external":"file:///home/trang/localnsv/mAIware/index.html","path":"/home/trang/localnsv/mAIware/index.html","scheme":"file"},"requestId":"request_e07a7772-968a-477e-a954-72eb3513ede7","content":"<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>mAIware AI Malware Detection Demo</title>\n    <!-- Font Awesome for icons (which you already had) -->\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css\">\n    <!-- Chart.js for stats (which you already had) -->\n    <script src=\"https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js\"></script>\n    <!-- Link to the CSS file -->\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n\n<body>\n    <nav class=\"top-nav\">\n        <div class=\"logo\"> <i class=\"fas fa-shield-virus\"></i> <span>mAIware</span> </div>\n        <div class=\"nav-links\"> <a href=\"#\" class=\"nav-link\" data-tooltip=\"Login\"><i class=\"fas fa-sign-in-alt\"></i><span class=\"link-text\">Login</span></a> <a href=\"#\" class=\"nav-link\" data-tooltip=\"Sign Up\"><i class=\"fas fa-user-plus\"></i><span class=\"link-text\">Sign Up</span></a> <a href=\"#\" class=\"nav-link\" data-tooltip=\"Community\"><i class=\"fas fa-users\"></i><span class=\"link-text\">Community</span></a> <a href=\"#\" class=\"nav-link\" data-tooltip=\"API Docs\"><i class=\"fas fa-code\"></i><span class=\"link-text\">API</span></a> <a href=\"#\" id=\"history-btn\" class=\"nav-link\" data-tooltip=\"Scan History\"><i class=\"fas fa-history\"></i><span class=\"link-text\">History</span></a> <a href=\"#\" class=\"nav-link\" id=\"theme-toggle\" data-tooltip=\"Toggle Theme\"> <i class=\"fas fa-sun\"></i> </a> </div>\n    </nav>\n\n    <main class=\"main-container\">\n        <!-- Column 1 -->\n        <div class=\"scanner-wrapper\">\n            <!-- Main Scanner Box -->\n            <div class=\"scanner-container\">\n                <h1>AI Malware Detection</h1>\n                <!-- State 1: Initial -->\n                <div id=\"initial-state\" class=\"scanner-state active\">\n                    <p>Watching your Downloads folder for new files...</p>\n                    <div id=\"drop-zone\" class=\"upload-zone\"> <i class=\"upload-icon fas fa-eye\"></i>\n                        <h3>Automatic Scanning Active</h3>\n                        <span>(Download a file to begin)</span>\n                    </div>\n                </div>\n\n                <!-- State 2: Analyzing -->\n                <div id=\"analyzing-state\" class=\"scanner-state\">\n                    <div class=\"analyzing-icon\">\n                        <div class=\"loader\"></div>\n                    </div>\n                    <h3>Analyzing...</h3> <span class=\"filename\" id=\"analyzing-filename\">demo_file.exe</span> </div>\n\n                <!-- State 3: Result -->\n                <div id=\"result-state\" class=\"scanner-state\"> <i class=\"result-icon\" id=\"result-icon\"></i>\n                    <h2 id=\"result-text\"></h2>\n                    <div class=\"filename\" id=\"result-filename\"></div>\n                    <p id=\"result-details\"></p>\n                    <!-- Removed the resetDemo() button as it's automatic now -->\n                    \n                    <!-- Navigation Controls -->\n                    <div class=\"scan-navigation\">\n                        <button id=\"prev-scan-btn\" class=\"nav-btn\" disabled>\n                            <i class=\"fas fa-chevron-left\"></i> Previous\n                        </button>\n                        <span id=\"nav-info\" class=\"nav-info\">1 of 1</span>\n                        <button id=\"next-scan-btn\" class=\"nav-btn\" disabled>\n                            Next <i class=\"fas fa-chevron-right\"></i>\n                        </button>\n                    </div>\n                </div>\n                <div id=\"non-pe-result\" class=\"scanner-state non-pe-result\">\n                    <div class=\"non-pe-icon\"><i class=\"fas fa-file\"></i></div>\n                    <h2 id=\"non-pe-title\">File is not a Windows PE executable</h2>\n                    <p class=\"filename\" id=\"non-pe-filename\"></p>\n                    <div class=\"non-pe-hash-grid\">\n                        <div class=\"non-pe-hash\">\n                            <h4>SHA256</h4>\n                            <p id=\"non-pe-hash-sha256\">...</p>\n                        </div>\n                        <div class=\"non-pe-hash\">\n                            <h4>MD5</h4>\n                            <p id=\"non-pe-hash-md5\">...</p>\n                        </div>\n                    </div>\n                    \n                    <!-- Navigation Controls for Non-PE files -->\n                    <div class=\"scan-navigation\">\n                        <button id=\"prev-scan-btn-nonpe\" class=\"nav-btn\" disabled>\n                            <i class=\"fas fa-chevron-left\"></i> Previous\n                        </button>\n                        <span id=\"nav-info-nonpe\" class=\"nav-info\">1 of 1</span>\n                        <button id=\"next-scan-btn-nonpe\" class=\"nav-btn\" disabled>\n                            Next <i class=\"fas fa-chevron-right\"></i>\n                        </button>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Analysis Details (Shows on result) -->\n            <div class=\"analysis-details-container\" id=\"analysis-details-wrapper\">\n                <div class=\"progress-header\">\n                    <h3>Malware Confidence</h3> <span class=\"score-percentage\" id=\"score-percentage\">0%</span> </div>\n                <div class=\"progress-bar-background\">\n                    <div class=\"progress-bar-fill\" id=\"progress-bar-fill\" style=\"width: 0%;\"></div>\n                </div>\n\n                <!-- This grid holds Vendor and Signature -->\n                <div class=\"details-grid\">\n                    <!-- Vendor UI Container -->\n                    <div class=\"details-section\" id=\"details-vendor\">\n                        <h4>Vendor Analysis</h4>\n                        <div class=\"vendor-info\">\n                            <i class=\"fas fa-question-circle\"></i>\n                            <span>Scanning...</span>\n                        </div>\n                    </div>\n                    <!-- Signature UI Container -->\n                    <div class=\"details-section\" id=\"details-signature\">\n                        <h4>Digital Signature</h4>\n                        <div class=\"signature-info\">\n                            <i class=\"fas fa-question-circle\"></i>\n                            <span>Checking...</span>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Reasoning (File Type/Packer) -->\n                <div class=\"details-section\">\n                    <h4>Key Findings</h4>\n                    <p id=\"details-reasoning\">...</p>\n                </div>\n                \n                <div class=\"details-section\">\n                    <h4>SHA256 Hash</h4>\n                    <p class=\"hash-text\" id=\"details-hash-sha256\">...</p>\n                </div>\n\n                <div class=\"details-section\">\n                    <h4>MD5 Hash</h4>\n                    <p class=\"hash-text\" id=\"details-hash-md5\">...</p>\n                </div>\n\n                <div class=\"details-section\">\n                    <h4>System IP</h4>\n                    <p class=\"hash-text\" id=\"details-system-ip\">Detecting...</p>\n                </div>\n\n                <div class=\"details-section\">\n                    <h4>What To Do Next</h4>\n                    <p id=\"details-recommendation\">...</p>\n                </div>\n\n                <div class=\"btn-wrapper\"> <button class=\"btn btn-primary\"><i class=\"fas fa-download\"></i> Download Report</button> <button class=\"btn btn-secondary\"><i class=\"fas fa-flag\"></i> Report False Positive</button> </div>\n            </div>\n        </div>\n\n        <!-- Column 2 -->\n        <div class=\"right-panel-wrapper\">\n            <!-- Stats (Shows on initial) -->\n            <div class=\"stats-wrapper\" id=\"stats-wrapper\">\n                <div class=\"stats-grid\">\n                    <div class=\"stat-card\"> <i class=\"fas fa-virus-slash\"></i>\n                        <div class=\"stat-content\"> <span class=\"stat-number\" data-target=\"14720938\">0</span> <span class=\"stat-label\">Malware Analyzed</span> </div>\n                    </div>\n                    <div class=\"stat-card\"> <i class=\"fas fa-users\"></i>\n                        <div class=\"stat-content\"> <span class=\"stat-number\" data-target=\"82041\">0</span> <span class=\"stat-label\">Active Users</span> </div>\n                    </div>\n                    <div class=\"stat-card\"> <i class=\"fas fa-chart-line\"></i>\n                        <div class=\"stat-content\"> <span class=\"stat-number\" data-target=\"1259024\">0</span> <span class=\"stat-label\">Site Visits (24h)</span> </div>\n                    </div>\n                </div>\n                <div class=\"chart-container-wrapper\">\n                    <div class=\"chart-container\">\n                        <h3>Top 5 Malware Families (30 Days)</h3> <canvas id=\"topMalwareChart\"></canvas> </div>\n                    <div class=\"chart-container\">\n                        <h3>Submission Types</h3> <canvas id=\"malwareTypesChart\"></canvas> </div>\n                </div>\n            </div>\n\n            <!-- Disassembly (Shows on analyzing/result) -->\n            <div class=\"disassembly-wrapper\" id=\"disassembly-wrapper\">\n                <div class=\"disassembly-header\">\n                    <h3>Disassembly: <span id=\"disassembly-filename\"></span></h3>\n                </div>\n                <div class=\"disassembly-code\" id=\"disassembly-code\"> </div>\n            </div>\n\n            <!-- File Internals (Shows on result) -->\n            <div class=\"file-internals-container\" id=\"file-internals-wrapper\">\n                <h3>File Internals</h3>\n                \n                <!-- Entropy UI Container -->\n                <div class=\"details-section\">\n                    <h4>Section Entropy (0=Normal, 8=Packed/Encrypted)</h4>\n                    <div class=\"entropy-bars\" id=\"entropy-bars-container\">\n                        <!-- JS will populate this -->\n                    </div>\n                </div>\n                \n                <!-- Key Strings UI Container -->\n                <div class=\"details-section\">\n                    <h4>Suspicious / Key Strings</h4>\n                    <div class=\"key-strings\" id=\"key-strings-container\">\n                        <!-- JS will populate this -->\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Full Width Row -->\n        <div class=\"graph-wrapper\" id=\"graph-wrapper\">\n            <div class=\"graph-header\">\n                <h3>Dynamic Function Call Graph (Simulation)</h3>\n            </div>\n            <div class=\"call-graph-container\">\n                <div class=\"call-graph\" id=\"call-graph\">\n                    <!-- JS will populate this -->\n                </div>\n            </div>\n        </div>\n    </main>\n\n    <!-- History Panel (Hidden by default) -->\n    <div class=\"history-overlay\" id=\"history-overlay\"></div>\n    <div class=\"history-panel\" id=\"history-panel\">\n        <div class=\"history-header\">\n            <h3>Scan History</h3> <button class=\"history-close-btn\" id=\"history-close-btn\"><i class=\"fas fa-times\"></i></button> </div>\n        <ul class=\"history-list\">\n            <!-- JS would populate this -->\n        </ul>\n    </div>\n\n    <!-- Scroll Zones -->\n    <div class=\"scroll-zone top\" id=\"scroll-zone-top\"><i class=\"fas fa-chevron-up\"></i></div>\n    <div class=\"scroll-zone bottom\" id=\"scroll-zone-bottom\"><i class=\"fas fa-chevron-down\"></i></div>\n    \n    <!-- LeaderLine for graph (which you already had) -->\n    <script src=\"https://cdn.jsdelivr.net/npm/leader-line-new@1.1.9/leader-line.min.js\"></script>\n    <!-- Link to the JS file -->\n    <script src=\"script.js\"></script>\n\n    <script>\n    // Apply saved theme class immediately (before DOMContentLoaded)\n    const savedTheme = localStorage.getItem('theme') || 'dark';\n    if (savedTheme === 'light') {\n        document.body.classList.add('light-theme');\n    }\n    \n    document.addEventListener('DOMContentLoaded', () => {\n        const themeToggleButton = document.getElementById('theme-toggle');\n        const body = document.body;\n        const themeIcon = themeToggleButton.querySelector('i');\n\n        // Set icon based on current theme\n        if (body.classList.contains('light-theme')) {\n            themeIcon.classList.remove('fa-sun');\n            themeIcon.classList.add('fa-moon');\n        }\n\n        // Function to apply the saved theme\n        const applyTheme = (theme) => {\n            if (theme === 'light') {\n                body.classList.add('light-theme');\n                themeIcon.classList.remove('fa-sun');\n                themeIcon.classList.add('fa-moon');\n            } else {\n                body.classList.remove('light-theme');\n                themeIcon.classList.remove('fa-moon');\n                themeIcon.classList.add('fa-sun');\n            }\n            \n            // Recreate charts with updated theme colors\n            if (window.recreateCharts) {\n                window.recreateCharts();\n            }\n        };\n\n        // Add click event for the toggle button\n        themeToggleButton.addEventListener('click', (e) => {\n            e.preventDefault(); // Stop the link from navigating\n            \n            // Check current theme\n            const isLightTheme = body.classList.contains('light-theme');\n            \n            // Set new theme\n            const newTheme = isLightTheme ? 'dark' : 'light';\n            \n            // Apply the new theme\n            applyTheme(newTheme);\n            \n            // Save the new theme to localStorage\n            localStorage.setItem('theme', newTheme);\n        });\n    });\n    </script>\n</body>\n</html>\n","epoch":108,"telemetryInfo":{}}],["file:///home/trang/localnsv/mAIware/script.js::request_e07a7772-968a-477e-a954-72eb3513ede7",{"uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/script.js","external":"file:///home/trang/localnsv/mAIware/script.js","path":"/home/trang/localnsv/mAIware/script.js","scheme":"file"},"requestId":"request_e07a7772-968a-477e-a954-72eb3513ede7","content":"// --- MOCK DISASSEMBLY DATA ---\n// (We keep this for now, as requested)\nconst mockDisassemblyBenign = [\n    `<span class=\"addr\">0x401000</span> <span class=\"op\">PUSH</span> <span class=\"args\">ebp</span> <span class=\"comment\">; setup stack frame</span>`,\n    `<span class=\"addr\">0x401001</span> <span class=\"op\">MOV</span> <span class=\"args\">ebp, esp</span>`,\n    `<span class=\"addr\">0x401003</span> <span class=\"op\">SUB</span> <span class=\"args\">esp, 48h</span>`,\n    `<span class=\"addr\">0x40100C</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4012A0</span> <span class=\"comment\">; initialize_string</span>`,\n    `<span class=\"addr\">0x401015</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4013F0</span> <span class=\"comment\">; get_user_input</span>`,\n    `<span class=\"addr\">0x40101E</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4015D0</span> <span class=\"comment\">; print_output</span>`,\n    `<span class=\"addr\">0x401028</span> <span class=\"op\">RETN</span>`,\n    `<span class=\"addr\">...</span>`,\n];\nconst mockDisassemblySuspicious = [\n    `<span class=\"addr\">0x401000</span> <span class=\"op\">PUSH</span> <span class=\"args\">ebp</span>`,\n    `<span class=\"addr\">0x401003</span> <span class=\"op\">SUB</span> <span class=\"args\">esp, 80h</span>`,\n    `<span class=\"addr\">0x40100D</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4012A0</span> <span class=\"comment\">; read_file_to_buffer</span>`,\n    `<span class=\"addr\">0x40101B</span> <span class=\"op\">REP</span> <span class=\"op\">MOVSB</span> <span class=\"comment\">; unsafe buffer write</span>`,\n    `<span class=\"addr\">0x401020</span> <span class=\"op\">JGE</span> <span class=\"args\">0x401030</span> <span class=\"comment\">; jump if overflow</span>`,\n    `<span class=\"addr\">0x401028</span> <span class=\"op\">RETN</span>`,\n    `<span class=\"addr\">...</span>`,\n];\nconst mockDisassemblyMalware = [\n    `<span class=\"addr\">0x401000</span> <span class=\"op\">PUSH</span> <span class=\"args\">ebp</span> <span class=\"comment\">; setup stack frame</span>`,\n    `<span class=\"addr\">0x40100B</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4011B0</span> <span class=\"comment\">; kernel32.LoadLibraryA</span>`,\n    `<span class=\"addr\">0x401013</span> <span class=\"op\">PUSH</span> <span class=\"string\">\"CreateRemoteThread\"</span>`,\n    `<span class=\"addr\">0x401019</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4011C0</span> <span class=\"comment\">; kernel32.GetProcAddress</span>`,\n    `<span class=\"addr\">0x401028</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4012F0</span> <span class=\"comment\">; decrypt_payload</span>`,\n    `<span class=\"addr\">0x401034</span> <span class=\"op\">CALL</span> <span class=\"args\">[ebp-24h]</span> <span class=\"comment\">; call CreateRemoteThread</span>`,\n    `<span class=\"addr\">0x401037</span> <span class=\"op\">JMP</span> <span class=\"args\">0x40102D</span> <span class=\"comment\">; loop?</span>`,\n    `<span class=\"addr\">...</span>`,\n];\n\n// --- REMOVED MOCK GRAPH DATA ---\n// const mockGraphSafe = ... (DELETED)\n// const mockGraphSuspicious = ... (DELETED)\n// const mockGraphMalware = ... (DELETED)\n\n// --- NAVIGATION STATE ---\nlet scanHistory = [];\nlet currentHistoryIndex = -1;\n\n// --- ELEMENT REFERENCES ---\nconst initialState = document.getElementById('initial-state');\nconst analyzingState = document.getElementById('analyzing-state');\nconst resultState = document.getElementById('result-state');\n\nconst analyzingFilename = document.getElementById('analyzing-filename');\nconst resultIcon = document.getElementById('result-icon');\nconst resultText = document.getElementById('result-text');\nconst resultFilename = document.getElementById('result-filename');\nconst resultDetails = document.getElementById('result-details');\nconst nonPeResultWrapper = document.getElementById('non-pe-result');\nconst nonPeFilename = document.getElementById('non-pe-filename');\nconst nonPeHashSha256 = document.getElementById('non-pe-hash-sha256');\nconst nonPeHashMd5 = document.getElementById('non-pe-hash-md5');\n\nconst bodyEl = document.body;\nlet animationWrapper = null;\n\nconst disassemblyWrapper = document.getElementById('disassembly-wrapper');\nconst disassemblyCodeEl = document.getElementById('disassembly-code');\nconst disassemblyFilenameEl = document.getElementById('disassembly-filename');\n\n// Analysis Details elements\nconst analysisDetailsWrapper = document.getElementById('analysis-details-wrapper');\nconst progressBarFill = document.getElementById('progress-bar-fill');\nconst scorePercentage = document.getElementById('score-percentage');\nconst detailsReasoning = document.getElementById('details-reasoning'); // We'll reuse this\nconst detailsHashSha256 = document.getElementById('details-hash-sha256');\nconst detailsHashMd5 = document.getElementById('details-hash-md5');\nconst detailsSystemIp = document.getElementById('details-system-ip');\nconst detailsRecommendation = document.getElementById('details-recommendation');\nconst detailsVendor = document.getElementById('details-vendor');\nconst detailsSignature = document.getElementById('details-signature');\nconst fileInternalsWrapper = document.getElementById('file-internals-wrapper');\nconst entropyBarsContainer = document.getElementById('entropy-bars-container');\nconst keyStringsContainer = document.getElementById('key-strings-container');\n\n// History Panel elements\nconst historyBtn = document.getElementById('history-btn');\nconst historyPanel = document.getElementById('history-panel');\nconst historyCloseBtn = document.getElementById('history-close-btn');\nconst historyOverlay = document.getElementById('history-overlay');\nconst historyListEl = document.querySelector('.history-list');\n\n// Scroll Zone elements\nconst scrollZoneTop = document.getElementById('scroll-zone-top');\nconst scrollZoneBottom = document.getElementById('scroll-zone-bottom');\n\n// Graph Panel elements\nconst graphWrapper = document.getElementById('graph-wrapper');\nconst callGraphEl = document.getElementById('call-graph');\n\n// Stats elements\nconst statsWrapper = document.getElementById('stats-wrapper');\n\n\n// --- STATE ---\nlet disassemblyInterval = null;\nlet scrollInterval = null; // For auto-scrolling\nlet currentGraphLines = []; // Renamed from currentLines to avoid conflict\nlet currentFileMetadata = null;\nlet lastScanResult = null;\n\n// 1. Listen for the 'scan-started' message from the backend\nwindow.electronAPI.onScanStarted((filename) => {\n  console.log(`UI: Received scan-started for ${filename}`);\n\n  // 1. Set UI to \"Analyzing\" state\n  initialState.classList.remove('active'); //\n  analyzingState.classList.add('active'); //\n  analyzingFilename.textContent = filename; //\n  disassemblyFilenameEl.textContent = filename; //\n\n  currentFileMetadata = { filename, isPe: true };\n  lastScanResult = null;\n  nonPeResultWrapper.classList.remove('active');\n  bodyEl.classList.remove('is-non-pe');\n\n  // 2. Update body class to show disassembly\n  bodyEl.classList.remove('is-showing-result'); //\n  bodyEl.classList.add('is-analyzing'); //\n  removeAnimationClasses(); //\n  \n  // 3. Populate disassembly with a \"suspicious\" default and start animation\n  // (We don't know the result yet, so we pick one)\n  populateDisassembly(mockDisassemblySuspicious); //\n  startDisassemblyAnimation(); //\n\n  // 4. Clear old results\n  clearResultData();\n});\n\n// 2. Listen for the 'scan-result' message\nwindow.electronAPI.onScanResult((scanResult) => {\n  console.log(\"UI: Received scan-result:\", scanResult);\n\n  clearInterval(disassemblyInterval); //\n  disassemblyInterval = null; //\n\n  bodyEl.classList.remove('is-analyzing'); //\n  bodyEl.classList.add('is-showing-result'); //\n\n  analyzingState.classList.remove('active'); //\n  resultState.classList.add('active'); //\n\n  // Add to history\n  scanHistory.push(scanResult);\n  currentHistoryIndex = scanHistory.length - 1;\n  \n  lastScanResult = scanResult;\n\n  renderScanResult();\n  updateNavigationButtons();\n});\n\nwindow.electronAPI.onScanFileMetadata((metadata) => {\n  if (!metadata || typeof metadata !== 'object') {\n    return;\n  }\n\n  currentFileMetadata = metadata;\n\n  if (lastScanResult && metadata.filename === lastScanResult.detected_filename) {\n    renderScanResult();\n  }\n});\n\nfunction renderScanResult() {\n  if (!lastScanResult) {\n    return;\n  }\n\n  const metadataMatches = currentFileMetadata && currentFileMetadata.filename === lastScanResult.detected_filename;\n  const isNonPe = metadataMatches && currentFileMetadata.isPe === false;\n\n  if (isNonPe) {\n    renderNonPeResult(lastScanResult);\n    return;\n  }\n\n  renderPeResult(lastScanResult);\n}\n\nfunction ensureAnimationWrapper() {\n  if (animationWrapper) {\n    return;\n  }\n\n  animationWrapper = document.createElement('div');\n  animationWrapper.className = 'animation-swarm';\n  for (let i = 0; i < 10; i++) {\n    const particle = document.createElement('span');\n    animationWrapper.appendChild(particle);\n  }\n  bodyEl.prepend(animationWrapper);\n}\n\nfunction renderPeResult(scanResult) {\n  removeAnimationClasses();\n  bodyEl.classList.remove('is-non-pe');\n  nonPeResultWrapper.classList.remove('active');\n\n  let resultIconClass = 'fas fa-check-circle'; //\n  let resultMockDisassembly = mockDisassemblyBenign; //\n  let resultBodyClass = 'result-safe-active'; //\n  let resultScannerClass = 'result-safe'; //\n  let resultProgressClass = 'progress-bar-green'; //\n  let resultScoreClass = 'score-green'; //\n  let recommendation = 'You can safely run this file.'; //\n\n  if (scanResult.classification.includes('Malware')) {\n    resultIconClass = 'fas fa-bug';\n    resultMockDisassembly = mockDisassemblyMalware;\n    resultBodyClass = 'result-malware-active'; //\n    resultScannerClass = 'result-malware'; //\n    resultProgressClass = 'progress-bar-red'; //\n    resultScoreClass = 'score-red'; //\n    recommendation = 'DO NOT OPEN. Quarantine this file immediately.'; //\n  } else if (scanResult.classification.includes('Suspicious')) {\n    resultIconClass = 'fas fa-exclamation-triangle'; //\n    resultMockDisassembly = mockDisassemblySuspicious; //\n    resultBodyClass = 'result-suspicious-active'; //\n    resultScannerClass = 'result-suspicious'; //\n    resultProgressClass = 'progress-bar-yellow'; //\n    resultScoreClass = 'score-yellow'; //\n    recommendation = 'Be cautious. Only run if you trust the source.'; //\n  }\n\n  ensureAnimationWrapper();\n  bodyEl.classList.add(resultBodyClass); //\n\n  resultState.className = `scanner-state active ${resultScannerClass}`; //\n  resultIcon.className = `result-icon ${resultIconClass}`; //\n  resultText.textContent = scanResult.classification; //\n\n  let detailsText = `Scanned ${scanResult.detected_filename}.`;\n  if (scanResult.malware_family) {\n    detailsText = `Family: ${scanResult.malware_family}`;\n  }\n  resultDetails.textContent = detailsText;\n  resultFilename.textContent = scanResult.detected_filename; //\n\n  progressBarFill.className = 'progress-bar-fill'; //\n  scorePercentage.className = 'score-percentage'; //\n  progressBarFill.classList.add(resultProgressClass); //\n  const rawConfidence = Number(scanResult.confidence_score);\n  const confidenceValue = Number.isFinite(rawConfidence) ? rawConfidence * 100 : 0;\n  progressBarFill.style.width = `${confidenceValue}%`; //\n  scorePercentage.textContent = `${Math.round(confidenceValue)}%`; //\n  scorePercentage.classList.add(resultScoreClass); //\n\n  detailsReasoning.textContent = `Filetype: ${scanResult.key_findings.file_type}. Packer: ${scanResult.key_findings.packer_detected}.`; //\n  const hashData = scanResult.file_hashes || {};\n  detailsHashSha256.textContent = hashData.sha256 || 'Not available'; //\n  detailsHashMd5.textContent = hashData.md5 || 'Not available'; //\n  updateSystemIpDisplay();\n  detailsRecommendation.textContent = recommendation;\n\n  populateVendor(scanResult.vendor); //\n  populateSignature(scanResult.key_findings.signature); //\n  populateEntropyBars(scanResult.key_findings.section_entropy || []); //\n  populateKeyStrings(scanResult.key_findings.key_strings || [], scanResult.classification); //\n\n  populateDisassembly(resultMockDisassembly); //\n\n  const apiList = scanResult.key_findings.api_imports || [];\n  const graphData = generateGraphData(apiList, scanResult.classification);\n  drawCallGraph(graphData);\n}\n\nfunction renderNonPeResult(scanResult) {\n  removeAnimationClasses();\n  bodyEl.classList.add('is-non-pe');\n  resultState.className = 'scanner-state active';\n  resultIcon.className = 'result-icon fas fa-file';\n  resultText.textContent = '';\n  resultDetails.textContent = '';\n  resultFilename.textContent = '';\n\n  const hashData = scanResult.file_hashes || {};\n  nonPeFilename.textContent = scanResult.detected_filename || '';\n  nonPeHashSha256.textContent = hashData.sha256 || 'Not available';\n  nonPeHashMd5.textContent = hashData.md5 || 'Not available';\n\n  detailsHashSha256.textContent = hashData.sha256 || 'Not available';\n  detailsHashMd5.textContent = hashData.md5 || 'Not available';\n\n  nonPeResultWrapper.classList.add('active');\n\n  callGraphEl.innerHTML = '';\n  currentGraphLines.forEach(line => line.remove());\n  currentGraphLines = [];\n  entropyBarsContainer.innerHTML = '';\n  keyStringsContainer.innerHTML = '';\n}\n\n/**\n * Clears all dynamic result data to prepare for the next scan.\n */\nfunction clearResultData() {\n    // Clear scanner panel\n    resultText.textContent = '';\n    resultDetails.textContent = '';\n    resultFilename.textContent = '';\n    nonPeResultWrapper.classList.remove('active');\n    nonPeFilename.textContent = '';\n    nonPeHashSha256.textContent = '...';\n    nonPeHashMd5.textContent = '...';\n    bodyEl.classList.remove('is-non-pe');\n\n    // Clear analysis panel\n    progressBarFill.style.width = `0%`;\n    scorePercentage.textContent = `0%`;\n    detailsReasoning.textContent = '...';\n    detailsHashSha256.textContent = '...';\n    detailsHashMd5.textContent = '...';\n    if (detailsSystemIp) {\n        detailsSystemIp.textContent = 'Detecting...';\n    }\n    detailsRecommendation.textContent = '...';\n\n    // Clear vendor\n    detailsVendor.innerHTML = `\n        <h4>Vendor Analysis</h4>\n        <div class=\"vendor-info\">\n            <i class=\"fas fa-question-circle\"></i>\n            <span>Scanning...</span>\n        </div>`;\n    \n    // Clear signature\n    detailsSignature.innerHTML = `\n        <h4>Digital Signature</h4>\n        <div class=\"signature-info\">\n            <i class=\"fas fa-question-circle\"></i>\n            <span>Checking...</span>\n        </div>`;\n    \n    // Clear internals\n    entropyBarsContainer.innerHTML = '';\n    keyStringsContainer.innerHTML = '';\n    \n    // Clear graph\n    callGraphEl.innerHTML = '';\n    currentGraphLines.forEach(line => line.remove());\n    currentGraphLines = [];\n}\n\n// --- VENDOR UI FUNCTION (IMPLEMENTED) ---\nfunction populateVendor(vendor) {\n    if (!vendor) return;\n    const icon = vendor.icon || 'fas fa-question-circle'; //\n    const name = vendor.name || 'Unknown'; //\n    detailsVendor.innerHTML = `\n        <h4>Vendor Analysis</h4> <div class=\"vendor-info\"> <i class=\"${icon}\"></i>\n            <span>${name}</span>\n        </div>\n    `;\n}\n\n// --- SIGNATURE UI FUNCTION (IMPLEMENTED) ---\nfunction populateSignature(signature) {\n    if (!signature) return;\n    let icon = signature.icon || 'fas fa-question-circle';\n    let cssClass = `sig-${signature.level || 'unknown'}`; // 'sig-verified', 'sig-untrusted', 'sig-unknown'\n\n    detailsSignature.innerHTML = `\n        <h4>Digital Signature</h4> <div class=\"signature-info ${cssClass}\"> <i class=\"${icon}\"></i>\n            <span>${signature.name}</span>\n        </div>\n    `;\n}\n\n// --- ENTROPY BARS UI FUNCTION (IMPLEMENTED) ---\nfunction populateEntropyBars(sections) {\n    entropyBarsContainer.innerHTML = ''; // Clear old bars\n    if (!sections || sections.length === 0) {\n        entropyBarsContainer.innerHTML = '<p class=\"hash-text\">No PE sections found to analyze.</p>';\n        return;\n    }\n\n    sections.forEach(section => { //\n        const value = section.entropy; //\n        const width = (value / 8.0) * 100; // Entropy is 0-8\n        let cssClass = 'low';\n        \n        if (value > 6.0) cssClass = 'medium';\n        if (value > 7.0) cssClass = 'high';\n        if (value > 7.8) cssClass = 'packed'; // Match style.css\n\n        const row = document.createElement('div');\n        row.className = 'entropy-bar-row';\n        row.innerHTML = `\n            <span class=\"entropy-bar-label\">${section.name}</span> <div class=\"entropy-bar-bg\">\n                <div class=\"entropy-bar-fill ${cssClass}\" style=\"width: ${width}%\">\n                    <span class=\"entropy-bar-value\">${value.toFixed(2)}</span>\n                </div>\n            </div>\n        `;\n        entropyBarsContainer.appendChild(row);\n    });\n}\n\n// --- KEY STRINGS UI FUNCTION (IMPLEMENTED) ---\nfunction populateKeyStrings(strings, classification) {\n    keyStringsContainer.innerHTML = ''; // Clear old strings\n    if (!strings || strings.length === 0) {\n        keyStringsContainer.innerHTML = '<span class=\"key-string-tag\">No notable strings found.</span>';\n        return;\n    }\n    \n    const tagClass = classification.includes('Benign') ? 'benign' : 'suspicious'; //\n\n    strings.forEach(str => { //\n        const tag = document.createElement('span');\n        tag.className = `key-string-tag ${tagClass}`;\n        tag.textContent = str;\n        keyStringsContainer.appendChild(tag);\n    });\n}\n\nfunction updateSystemIpDisplay() {\n    if (!detailsSystemIp || !window.electronAPI || typeof window.electronAPI.getSystemIp !== 'function') {\n        return;\n    }\n\n    detailsSystemIp.textContent = 'Detecting...';\n\n    window.electronAPI.getSystemIp()\n        .then((ip) => {\n            if (!ip) {\n                detailsSystemIp.textContent = 'Unavailable';\n                return;\n            }\n\n            detailsSystemIp.textContent = ip;\n        })\n        .catch(() => {\n            detailsSystemIp.textContent = 'Unavailable';\n        });\n}\n\nfunction removeAnimationClasses() {\n    bodyEl.classList.remove('result-safe-active');\n    bodyEl.classList.remove('result-suspicious-active');\n    bodyEl.classList.remove('result-malware-active');\n}\n\n// --- Disassembly Functions ---\n\nfunction populateDisassembly(codeLines) {\n    disassemblyCodeEl.innerHTML = '';\n    codeLines.forEach((line, index) => {\n        const lineEl = document.createElement('span');\n        lineEl.className = 'disassembly-line';\n        lineEl.id = `line-${index}`;\n        lineEl.innerHTML = line;\n        disassemblyCodeEl.appendChild(lineEl);\n    });\n}\n\nfunction startDisassemblyAnimation() {\n    if (disassemblyInterval) {\n        clearInterval(disassemblyInterval);\n    }\n    let currentLine = 0;\n    const totalLines = disassemblyCodeEl.children.length;\n\n    disassemblyInterval = setInterval(() => {\n        const prevLine = document.querySelector('.disassembly-line.active');\n        if (prevLine) {\n            prevLine.classList.remove('active');\n        }\n\n        const lineEl = document.getElementById(`line-${currentLine}`);\n        if (lineEl) {\n            lineEl.classList.add('active');\n            lineEl.scrollIntoView({\n                behavior: 'smooth',\n                block: 'center',\n                inline: 'nearest'\n            });\n        }\n        currentLine = (currentLine + 1) % totalLines;\n    }, 150);\n}\n\n/**\n * This function was MOVED here from jsonsamples.js\n * Dynamically generates the graph data based on API imports.\n * @param {string[]} apiImports - Array of API names (e.g., ['CreateRemoteThread'])\n * @param {string} classification - 'Benign', 'Suspicious', or 'Malware'\n * @returns {object} A graph object with 'nodes' and 'edges' arrays.\n */\nfunction generateGraphData(apiImports, classification) {\n    let nodes = [];\n    let edges = [];\n    const nodeSpacing = 150;\n    const startY = 100;\n    const startX = 250;\n\n    // 1. Add the Main Entry Point node\n    nodes.push({ \n        id: 'main-entry', \n        label: 'main()', \n        class: 'node-entry', \n        pos: { top: `${startY + (apiImports.length / 2) * (nodeSpacing / 2)}px`, left: '50px' } \n    });\n\n    if (!apiImports || apiImports.length === 0) {\n        // Benign/Empty graph\n        nodes.push({ id: 'benign-1', label: 'ReadFile', class: 'node-std', pos: { top: `${startY}px`, left: `${startX}px` } });\n        nodes.push({ id: 'benign-2', label: 'WriteFile', class: 'node-std', pos: { top: `${startY + nodeSpacing / 2}px`, left: `${startX}px` } });\n        edges.push({ from: 'main-entry', to: 'benign-1', options: { color: '#888' } });\n        edges.push({ from: 'main-entry', to: 'benign-2', options: { color: '#888' } });\n    } else {\n        // Suspicious/Malware graph\n        apiImports.forEach((apiName, index) => {\n            let nodeClass = 'node-api'; // Default\n            let edgeColor = '#888'; // Default\n\n            if (classification === 'Malware') {\n                nodeClass = 'node-malicious';\n                edgeColor = '#e74c3c'; // Malware red\n            } else if (classification === 'Suspicious') {\n                nodeClass = 'node-suspicious';\n                edgeColor = '#f1c40f'; // Suspicious yellow\n            } else {\n                // Benign\n                nodeClass = 'node-std';\n                edgeColor = '#888';\n            }\n\n\n            const nodeId = `api-${index}`;\n            const yPos = startY + (index * (nodeSpacing-50)); // Make them a bit closer\n            const xPos = startX + (index % 2 === 0 ? 0 : 150); // Stagger them\n\n            // Add the API node\n            nodes.push({\n                id: nodeId,\n                label: apiName,\n                class: nodeClass,\n                pos: { top: `${yPos}px`, left: `${xPos}px` }\n            });\n\n            // Add the edge from main\n            edges.push({\n                from: 'main-entry',\n                to: nodeId,\n                options: { color: edgeColor }\n            });\n        });\n    }\n\n    return { nodes, edges };\n}\n\n// --- Graph Drawing ---\nfunction drawCallGraph(graphData) {\n    // 1. Clear previous graph (both nodes and lines)\n    callGraphEl.innerHTML = '';\n    currentGraphLines.forEach(line => line.remove());\n    currentGraphLines = [];\n\n    if (!graphData || !graphData.nodes || !graphData.edges) {\n        console.error(\"Invalid graph data received\", graphData);\n        return;\n    }\n\n    // 2. Create and place all nodes\n    graphData.nodes.forEach(node => {\n        const nodeEl = document.createElement('div');\n        nodeEl.id = node.id;\n        nodeEl.className = `graph-node ${node.class}`;\n        nodeEl.style.top = node.pos.top;\n        nodeEl.style.left = node.pos.left;\n        nodeEl.textContent = node.label;\n        callGraphEl.appendChild(nodeEl);\n    });\n\n    // 3. Draw all edges (must be done *after* nodes are in DOM)\n    // Use a slight timeout to ensure DOM is ready\n    setTimeout(() => {\n        graphData.edges.forEach(edge => {\n            try {\n                const line = new LeaderLine(\n                    document.getElementById(edge.from),\n                    document.getElementById(edge.to),\n                    {\n                        color: edge.options.color,\n                        path: edge.options.path || 'straight',\n                        startSocket: edge.options.startSocket || 'auto',\n                        endSocket: edge.options.endSocket || 'auto',\n                        endPlug: 'arrow1',\n                        size: 3,\n                        endPlugSize: 1.5,\n                    }\n                );\n                currentGraphLines.push(line);\n            } catch(e) {\n                console.error(\"Could not draw line:\", e);\n            }\n        });\n    }, 500); // 500ms timeout to let CSS fade-in finish\n}\n\n\n// --- History Panel Logic ---\nasync function loadHistory() {\n  if (!historyListEl) return;\n  \n  historyListEl.innerHTML = '<li class=\"history-item-loading\">Loading...</li>';\n\n  try {\n    const historyData = await window.electronAPI.getHistory();\n\n    if (!historyData || historyData.length === 0) {\n      historyListEl.innerHTML = '<li class=\"history-item-empty\">No scan history found.</li>';\n      return;\n    }\n\n    historyListEl.innerHTML = '';\n\n    historyData.forEach(scan => {\n      const li = document.createElement('li');\n      li.className = 'history-item';\n\n      // Determine classification icon\n      let statusIcon = 'fas fa-check-circle';\n      let classType = 'safe';\n      if (scan.classification.includes('Malware')) {\n        statusIcon = 'fas fa-bug';\n        classType = 'malware';\n      } else if (scan.classification.includes('Suspicious')) {\n        statusIcon = 'fas fa-exclamation-triangle';\n        classType = 'suspicious';\n      }\n\n      // Determine file type icon based on extension\n      const filename = scan.detected_filename || '';\n      const ext = filename.split('.').pop().toLowerCase();\n      let fileTypeIcon = 'fas fa-file';\n      \n      if (['exe', 'dll', 'sys', 'msi'].includes(ext)) {\n        fileTypeIcon = 'fas fa-cog'; // Executable\n      } else if (['jpg', 'jpeg', 'png', 'gif', 'bmp', 'svg', 'webp'].includes(ext)) {\n        fileTypeIcon = 'fas fa-image'; // Image\n      } else if (['js', 'ts', 'py', 'java', 'cpp', 'c', 'h', 'cs', 'go', 'rs', 'php', 'rb'].includes(ext)) {\n        fileTypeIcon = 'fas fa-code'; // Code\n      } else if (['pdf', 'doc', 'docx', 'txt', 'rtf', 'odt'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-alt'; // Document\n      } else if (['zip', 'rar', '7z', 'tar', 'gz', 'bz2'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-archive'; // Archive\n      } else if (['mp3', 'wav', 'ogg', 'flac', 'aac'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-audio'; // Audio\n      } else if (['mp4', 'avi', 'mkv', 'mov', 'wmv', 'flv'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-video'; // Video\n      } else if (['html', 'htm', 'css', 'xml', 'json'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-code'; // Web file\n      }\n\n      const scanDate = new Date(scan.scanDate).toLocaleString();\n      const hashSha256 = scan.file_hashes?.sha256 || 'N/A';\n      const hashDisplay = hashSha256.substring(0, 16) + '...'; // Show first 16 chars\n\n      li.innerHTML = `\n        <div class=\"history-icon-wrapper\">\n          <div class=\"history-icon ${classType}\">\n            <i class=\"${statusIcon}\"></i>\n          </div>\n          <div class=\"history-file-type\">\n            <i class=\"${fileTypeIcon}\"></i>\n          </div>\n        </div>\n        <div class=\"history-details\">\n          <span class=\"history-filename\" title=\"${filename}\">${filename}</span>\n          <span class=\"history-classification ${classType}\">${scan.classification}</span>\n          <span class=\"history-hash\" title=\"${hashSha256}\">SHA256: ${hashDisplay}</span>\n        </div>\n        <span class=\"history-date\">${scanDate}</span>\n      `;\n      \n      historyListEl.appendChild(li);\n    });\n\n  } catch (err) {\n    console.error('Failed to load history:', err);\n    historyListEl.innerHTML = '<li class=\"history-item-empty\">Error loading history.</li>';\n  }\n}\n\nfunction toggleHistoryPanel() {\n  bodyEl.classList.toggle('is-history-open');\n  \n  // ADD THIS: If we are opening the panel, load the history\n  if (bodyEl.classList.contains('is-history-open')) {\n    loadHistory();\n  }\n}\n\nhistoryBtn.addEventListener('click', (e) => {\n    e.preventDefault();\n    toggleHistoryPanel();\n});\nhistoryCloseBtn.addEventListener('click', toggleHistoryPanel);\nhistoryOverlay.addEventListener('click', toggleHistoryPanel);\n\n\n// --- Auto-scroll Logic ---\nfunction startScrolling(direction) {\n    if (scrollInterval) {\n        clearInterval(scrollInterval);\n    }\n    scrollInterval = setInterval(() => {\n        window.scrollBy(0, direction * 10); // 10 pixels at a time\n    }, 20); // every 20ms\n}\n\nfunction stopScrolling() {\n    clearInterval(scrollInterval);\n    scrollInterval = null;\n}\n\nscrollZoneTop.addEventListener('mouseenter', () => {\n    startScrolling(-1); // Scroll Up\n    scrollZoneTop.classList.add('scrolling');\n});\nscrollZoneTop.addEventListener('mouseleave', () => {\n    stopScrolling();\n    scrollZoneTop.classList.remove('scrolling');\n});\n\nscrollZoneBottom.addEventListener('mouseenter', () => {\n    startScrolling(1); // Scroll Down\n    scrollZoneBottom.classList.add('scrolling');\n});\nscrollZoneBottom.addEventListener('mouseleave', () => {\n    stopScrolling();\n    scrollZoneBottom.classList.remove('scrolling');\n});\n\n\n// --- Chart instances ---\nlet malwareTypesChart = null;\nlet topMalwareChart = null;\n\n// --- Function to create/recreate charts ---\nwindow.recreateCharts = function() {\n    // Check if light theme is active\n    const isLightTheme = document.body.classList.contains('light-theme');\n    \n    // Set colors based on theme\n    const chartLegendColor = isLightTheme ? '#6c757d' : '#e0e0e0';\n    const chartAxesColor = isLightTheme ? '#6c757d' : '#aaa';\n    const chartGridColor = isLightTheme ? '#dee2e6' : '#444444';\n\n    // Destroy existing charts if they exist\n    if (malwareTypesChart) {\n        malwareTypesChart.destroy();\n    }\n    if (topMalwareChart) {\n        topMalwareChart.destroy();\n    }\n\n    // Create Malware Types Chart (Doughnut)\n    const typesCtx = document.getElementById('malwareTypesChart');\n    if (typesCtx) {\n        malwareTypesChart = new Chart(typesCtx, {\n            type: 'doughnut',\n            data: {\n                labels: ['PE (exe/dll)', 'JavaScript', 'VBS', 'Macro', 'Other'],\n                datasets: [{\n                    label: 'Submission Types',\n                    data: [65, 15, 8, 7, 5],\n                    backgroundColor: [\n                        '#007bff', // Blue\n                        '#f1c40f', // Yellow\n                        '#e74c3c', // Red\n                        '#9b59b6', // Purple\n                        '#34495e'  // Gray\n                    ],\n                    borderColor: '#2a2a2e',\n                    borderWidth: 3,\n                }]\n            },\n            options: {\n                responsive: true,\n                plugins: {\n                    legend: {\n                        position: 'right',\n                        labels: {\n                            color: chartLegendColor,\n                            boxWidth: 20\n                        }\n                    }\n                }\n            }\n        });\n    }\n\n    // Create Top Malware Chart (Line)\n    const topMalwareCtx = document.getElementById('topMalwareChart');\n    if (topMalwareCtx) {\n        topMalwareChart = new Chart(topMalwareCtx, {\n            type: 'line',\n            data: {\n                labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5'],\n                datasets: [\n                    {\n                        label: 'Zeus',\n                        data: [120, 150, 130, 180, 160],\n                        borderColor: '#e74c3c',\n                        backgroundColor: '#e74c3c20',\n                        fill: true,\n                        tension: 0.4\n                    },\n                    {\n                        label: 'WannaCry',\n                        data: [80, 90, 110, 100, 130],\n                        borderColor: '#007bff',\n                        backgroundColor: '#007bff20',\n                        fill: true,\n                        tension: 0.4\n                    },\n                    {\n                        label: 'Emotet',\n                        data: [50, 60, 80, 70, 90],\n                        borderColor: '#f1c40f',\n                        backgroundColor: '#f1c40f20',\n                        fill: true,\n                        tension: 0.4\n                    }\n                ]\n            },\n            options: {\n                responsive: true,\n                plugins: {\n                    legend: {\n                        labels: {\n                            color: chartLegendColor\n                        }\n                    }\n                },\n                scales: {\n                    x: {\n                        ticks: { color: chartAxesColor },\n                        grid: { color: chartGridColor + '50' }\n                    },\n                    y: {\n                        ticks: { color: chartAxesColor },\n                        grid: { color: chartGridColor }\n                    }\n                }\n            }\n        });\n    }\n};\n\n// --- NAVIGATION FUNCTIONS ---\nfunction updateNavigationButtons() {\n    // PE result buttons\n    const prevBtn = document.getElementById('prev-scan-btn');\n    const nextBtn = document.getElementById('next-scan-btn');\n    const navInfo = document.getElementById('nav-info');\n    \n    // Non-PE result buttons\n    const prevBtnNonPe = document.getElementById('prev-scan-btn-nonpe');\n    const nextBtnNonPe = document.getElementById('next-scan-btn-nonpe');\n    const navInfoNonPe = document.getElementById('nav-info-nonpe');\n    \n    const buttonsExist = (prevBtn && nextBtn) || (prevBtnNonPe && nextBtnNonPe);\n    if (!buttonsExist) return;\n    \n    // Update both sets of buttons\n    const buttons = [\n        { prev: prevBtn, next: nextBtn, info: navInfo },\n        { prev: prevBtnNonPe, next: nextBtnNonPe, info: navInfoNonPe }\n    ];\n    \n    buttons.forEach(set => {\n        if (set.prev && set.next) {\n            set.prev.disabled = currentHistoryIndex <= 0;\n            set.next.disabled = currentHistoryIndex >= scanHistory.length - 1;\n            \n            if (set.info && scanHistory.length > 0) {\n                set.info.textContent = `${currentHistoryIndex + 1} of ${scanHistory.length}`;\n            }\n        }\n    });\n}\n\nfunction showPreviousScan() {\n    if (currentHistoryIndex > 0) {\n        currentHistoryIndex--;\n        lastScanResult = scanHistory[currentHistoryIndex];\n        renderScanResult();\n        updateNavigationButtons();\n    }\n}\n\nfunction showNextScan() {\n    if (currentHistoryIndex < scanHistory.length - 1) {\n        currentHistoryIndex++;\n        lastScanResult = scanHistory[currentHistoryIndex];\n        renderScanResult();\n        updateNavigationButtons();\n    }\n}\n\n// Initialize history from electron-store on load\nasync function initializeScanHistory() {\n    try {\n        const storedHistory = await window.electronAPI.getHistory();\n        if (storedHistory && Array.isArray(storedHistory)) {\n            scanHistory = storedHistory;\n            currentHistoryIndex = scanHistory.length - 1;\n        }\n    } catch (error) {\n        console.error('Failed to load scan history:', error);\n    }\n}\n\n// --- Run on Page Load ---\ndocument.addEventListener('DOMContentLoaded', () => {\n    // 1. Animate Stat Cards\n    const statNumbers = document.querySelectorAll('.stat-number');\n    statNumbers.forEach(stat => {\n        const target = +stat.getAttribute('data-target');\n        const duration = 2000;\n        const stepTime = 20;\n        const steps = duration / stepTime;\n        const increment = target / steps;\n        let current = 0;\n\n        const updateCount = () => {\n            current += increment;\n            if (current < target) {\n                stat.textContent = Math.ceil(current).toLocaleString();\n                setTimeout(updateCount, stepTime);\n            } else {\n                stat.textContent = target.toLocaleString();\n            }\n        };\n        updateCount();\n    });\n\n    // 2. Create the charts\n    recreateCharts();\n    \n    // 3. Initialize scan history\n    initializeScanHistory();\n    \n    // 4. Setup navigation button handlers for both PE and non-PE results\n    const prevBtn = document.getElementById('prev-scan-btn');\n    const nextBtn = document.getElementById('next-scan-btn');\n    const prevBtnNonPe = document.getElementById('prev-scan-btn-nonpe');\n    const nextBtnNonPe = document.getElementById('next-scan-btn-nonpe');\n    \n    if (prevBtn) prevBtn.addEventListener('click', showPreviousScan);\n    if (nextBtn) nextBtn.addEventListener('click', showNextScan);\n    if (prevBtnNonPe) prevBtnNonPe.addEventListener('click', showPreviousScan);\n    if (nextBtnNonPe) nextBtnNonPe.addEventListener('click', showNextScan);\n});\n","epoch":115,"telemetryInfo":{}}],["file:///home/trang/localnsv/mAIware/style.css::request_2898cd94-7697-4906-9e9b-0165db937240",{"uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/style.css","external":"file:///home/trang/localnsv/mAIware/style.css","path":"/home/trang/localnsv/mAIware/style.css","scheme":"file"},"requestId":"request_2898cd94-7697-4906-9e9b-0165db937240","content":"/* --- Global & Fonts --- */\n:root {\n    /* --- Dark Theme (Default) --- */\n    --bg-dark-1: #121212;\n    --bg-dark-2: #1e1e1e;\n    --bg-dark-3: #2a2a2e;\n    --bg-dark-4: #333333;\n    --border-color: #444444;\n    --text-light: #e0e0e0;\n    --text-medium: #aaa;\n    --text-dark: #888;\n    \n    /* --- Semantic Colors --- */\n    --blue: #007bff;\n    --red: #e74c3c;\n    --yellow: #f1c40f;\n    --green: #2ecc71;\n    \n    /* --- Syntax & Node Colors --- */\n    --syntax-op: #c39eff;\n    --syntax-string: #e6db74;\n    --syntax-const-text: #ffffff; /* Constant white for dark buttons/nodes */\n    --node-bg-entry: #254a25;\n    --node-bg-api: #2a3e4a;\n    --node-bg-suspicious: #4a452a;\n    --node-bg-malicious: #4a2a2a;\n\n    --chart-legend-text: var(--text-light);  /* #e0e0e0 */\n    --chart-axes-text: var(--text-medium);   /* #aaa */\n    --chart-grid-line: var(--border-color);\n}\n\n/* --- Light Theme --- */\n/* Add \".light-theme\" to the <body> tag to activate */\nbody.light-theme {\n    --bg-dark-1: #f8f9fa;     /* Main background */\n    --bg-dark-2: #ffffff;     /* Card background */\n    --bg-dark-3: #e9ecef;     /* Hover/active background */\n    --bg-dark-4: #ced4da;     /* Secondary button background */\n    --border-color: #dee2e6;  /* Border color */\n    --text-light: #212529;    /* Main text */\n    --text-medium: #6c757d;   /* Secondary text */\n    --text-dark: #888;        /* Tertiary text (can stay gray) */\n    \n    /* Semantic colors are unchanged */\n    /* --blue, --red, --yellow, --green */\n    \n    /* --- Light Theme Syntax --- */\n    --syntax-op: #a040ff;       /* Darker purple */\n    --syntax-string: #b8860b;     /* Dark goldenrod */\n    --syntax-const-text: #ffffff; /* Stays white for colored buttons/nodes */\n    \n    /* Node backgrounds are unchanged, they look good on a light BG */\n    --chart-legend-text: var(--text-medium); /* User Request */\n    --chart-axes-text: var(--text-medium);   /* User Request */\n    --chart-grid-line: var(--border-color);\n}\n\n\n/* Apply overflow-x to html as well */\nhtml {\n    overflow-x: hidden;\n    font-size: 16px; /* Ensure base font size */\n}\n\nbody {\n    font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n    background-color: var(--bg-dark-1);\n    color: var(--text-light);\n    margin: 0;\n    padding-top: 60px; /* Make space for fixed top nav */\n    overflow-x: hidden; /* Prevent horizontal scroll */\n    width: 100%;\n    min-height: 100vh;\n}\n\n/* --- Main Grid Container --- */\n.main-container {\n    display: grid;\n    grid-template-columns: 1fr 1fr; /* Simpler 2-column definition */\n    grid-template-rows: auto auto; /* Rows for content and graph */\n    gap: 2rem;\n    padding: 2rem; /* Spacing from nav and screen edges */\n    align-items: start;\n    \n    /* Set max-width on the grid itself */\n    max-width: 1400px; \n    /* Center the whole grid */\n    margin: 0 auto; \n    \n    min-height: calc(100vh - 60px); /* Full height minus nav */\n    box-sizing: border-box;\n    width: 100%;\n}\n\n.scanner-wrapper {\n    grid-column: 1 / 2; /* Span first column */\n    grid-row: 1 / 2;\n    display: flex;\n    flex-direction: column;\n    gap: 1.5rem;\n    width: 100%; /* Fill the column */\n}\n\n.right-panel-wrapper {\n    grid-column: 2 / 3; /* Span second column */\n    grid-row: 1 / 2;\n    display: flex; /* Make it a flex container */\n    flex-direction: column; /* Stack its children vertically */\n    gap: 1.5rem; /* Space between its children */\n    width: 100%; /* Fill the column */\n}\n\n.graph-wrapper {\n    grid-column: 1 / 3; /* Span BOTH columns */\n    grid-row: 2 / 3;\n    width: 100%;\n    /* max-width is now inherited from main-container */\n    justify-self: center; /* Center in the grid area */\n}\n\n\n/* --- Top Navigation --- */\n.top-nav {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    height: 60px;\n    background-color: var(--bg-dark-2);\n    border-bottom: 1px solid var(--border-color);\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 0 2rem;\n    z-index: 1000;\n    box-sizing: border-box;\n}\n\n.top-nav .logo {\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n    font-size: 1.3rem;\n    font-weight: 600;\n    color: var(--text-light);\n}\n\n.top-nav .logo i {\n    color: var(--blue);\n}\n\n.nav-links {\n    display: flex;\n    gap: 0.5rem;\n}\n\n.nav-link {\n    color: var(--text-medium);\n    font-size: 1.25rem;\n    padding: 0.75rem;\n    border-radius: 8px;\n    transition: all 0.2s ease;\n    position: relative;\n    text-decoration: none;\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n}\n\n.nav-link .link-text {\n    font-size: 0.9rem;\n    font-weight: 500;\n    max-width: 0;\n    overflow: hidden;\n    white-space: nowrap;\n    transition: all 0.3s ease;\n}\n\n.nav-link:hover {\n    background-color: var(--bg-dark-3);\n    color: var(--text-light);\n}\n\n.nav-link:hover .link-text {\n    max-width: 80px; /* Expand text on hover */\n    margin-left: 0.25rem;\n}\n\n/* --- Tooltip --- */\n.nav-link:hover::before {\n    content: attr(data-tooltip);\n    position: absolute;\n    bottom: -35px;\n    left: 50%;\n    transform: translateX(-50%);\n    background-color: var(--bg-dark-3);\n    color: var(--text-light);\n    padding: 5px 10px;\n    border-radius: 4px;\n    font-size: 0.8rem;\n    white-space: nowrap;\n    opacity: 0;\n    transition: opacity 0.2s 0.3s; /* Delay tooltip */\n    pointer-events: none;\n}\n.nav-link:hover .link-text {\n    display: none; /* Hide expanded text if tooltip is showing */\n}\n.nav-link:hover:hover::before {\n    opacity: 1;\n}\n\n/* On smaller screens, stack the columns */\n@media (max-width: 1280px) { /* Widened breakpoint */\n    .main-container {\n        grid-template-columns: 1fr; /* Stack columns */\n        padding: 1rem;\n    }\n    .scanner-wrapper, .right-panel-wrapper, .graph-wrapper {\n        grid-column: 1 / 2; /* All in one column */\n        max-width: 100%;\n        justify-self: center;\n    }\n    .right-panel-wrapper {\n        grid-row: 2 / 3;\n    }\n    .graph-wrapper {\n        grid-row: 3 / 4;\n    }\n}\n\n/* Hide link text on very small screens */\n@media (max-width: 768px) {\n    .nav-link .link-text { display: none; }\n    .nav-link:hover .link-text { display: none; }\n    .top-nav { padding: 0 1rem; }\n}\n\n\n/* --- Main Scanner Box --- */\n.scanner-container {\n    width: 100%; /* Ensure it fills its flex parent */\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n    padding: 2.5rem;\n    text-align: center;\n    overflow: hidden;\n    transition: all 0.3s ease;\n    box-sizing: border-box; /* Include padding in width */\n}\n\nh1 {\n    color: var(--text-light);\n    margin-top: 0;\n    margin-bottom: 1rem;\n}\n\n.scanner-container p {\n    color: var(--text-medium);\n    margin-bottom: 2rem;\n    font-size: 1.1rem;\n}\n\n.scanner-state {\n    display: none;\n}\n.scanner-state.active {\n    display: block;\n}\n\n/* --- State 1: Upload --- */\n.upload-zone {\n    border: 2px dashed var(--border-color);\n    border-radius: 8px;\n    padding: 3rem 2rem;\n    cursor: pointer;\n    transition: all 0.3s ease;\n}\n.upload-zone:hover {\n    background-color: var(--bg-dark-3);\n    border-color: var(--blue);\n}\n.upload-icon {\n    font-size: 4rem;\n    color: var(--blue);\n    margin-bottom: 1rem;\n}\n.upload-zone h3 {\n    margin: 0;\n    color: var(--text-light);\n}\n.upload-zone span {\n    color: var(--text-dark);\n}\n\n/* --- State 2: Analyzing --- */\n.analyzing-icon .loader {\n    width: 80px;\n    height: 80px;\n    border: 6px solid var(--bg-dark-4);\n    border-top-color: var(--blue);\n    border-radius: 50%;\n    animation: spin 1s linear infinite;\n    margin: 2rem auto;\n}\n@keyframes spin {\n    to { transform: rotate(360deg); }\n}\n.analyzing-state h3 {\n    color: var(--text-light);\n    margin-bottom: 0.5rem;\n}\n.analyzing-state .filename,\n.result-state .filename {\n    color: var(--text-medium);\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 1.1rem;\n    word-break: break-all;\n}\n\n/* --- State 3: Result --- */\n.result-icon {\n    font-size: 6rem;\n    line-height: 1;\n    margin: 1.5rem 0;\n}\n.result-state h2 {\n    font-size: 2.5rem;\n    margin: 0 0 0.5rem 0;\n}\n.result-malware .result-icon, .result-malware h2 { color: var(--red); }\n.result-suspicious .result-icon, .result-suspicious h2 { color: var(--yellow); }\n.result-safe .result-icon, .result-safe h2 { color: var(--green); }\n.result-state p {\n    font-size: 1rem;\n    margin-bottom: 2rem;\n}\n\n/* --- Scan Navigation Controls --- */\n.scan-navigation {\n    display: none;\n    align-items: center;\n    justify-content: center;\n    gap: 1.5rem;\n    margin: 1.5rem 0;\n    padding: 1rem;\n    background: rgba(255, 255, 255, 0.03);\n    border-radius: 8px;\n}\n\n.scan-navigation-top {\n    display: flex;\n}\n\n/* Show navigation when results are displayed */\nbody.is-showing-result .scan-navigation-top,\nbody.is-non-pe .scan-navigation-top {\n    display: flex;\n}\n\n.nav-btn {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    padding: 0.75rem 1.5rem;\n    background: linear-gradient(135deg, var(--primary), var(--secondary));\n    color: white;\n    border: none;\n    border-radius: 8px;\n    font-size: 1rem;\n    font-weight: 600;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);\n}\n\n.nav-btn:hover:not(:disabled) {\n    transform: translateY(-2px);\n    box-shadow: 0 6px 20px rgba(139, 92, 246, 0.5);\n}\n\n.nav-btn:active:not(:disabled) {\n    transform: translateY(0);\n}\n\n.nav-btn:disabled {\n    background: rgba(255, 255, 255, 0.1);\n    color: rgba(255, 255, 255, 0.3);\n    cursor: not-allowed;\n    box-shadow: none;\n}\n\n.nav-info {\n    color: var(--text-medium);\n    font-size: 0.95rem;\n    font-weight: 500;\n    min-width: 80px;\n    text-align: center;\n}\n\n.non-pe-result {\n    display: none;\n    flex-direction: column;\n    align-items: center;\n    gap: 1.5rem;\n    color: var(--text-light);\n    padding: 1rem 0 0 0;\n}\n\n.non-pe-result.active {\n    display: flex;\n}\n\n.non-pe-icon {\n    width: 96px;\n    height: 96px;\n    border-radius: 24px;\n    background: linear-gradient(135deg, rgba(80, 130, 255, 0.2), rgba(80, 130, 255, 0.05));\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 3rem;\n    color: var(--blue);\n}\n\n.non-pe-hash-grid {\n    display: flex;\n    gap: 1.5rem;\n    flex-wrap: wrap;\n    justify-content: center;\n}\n\n.non-pe-hash {\n    min-width: 220px;\n    background: var(--bg-dark-3);\n    padding: 1rem 1.25rem;\n    border-radius: 12px;\n    border: 1px solid rgba(255, 255, 255, 0.05);\n    text-align: left;\n}\n\n.non-pe-hash h4 {\n    margin: 0 0 0.5rem 0;\n    font-size: 0.85rem;\n    text-transform: uppercase;\n    letter-spacing: 0.08rem;\n    color: var(--text-medium);\n}\n\n.non-pe-hash p {\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.9rem;\n    word-break: break-all;\n    color: var(--text-light);\n}\n\nbody.is-non-pe .analysis-details-container,\nbody.is-non-pe #analysis-details-wrapper,\nbody.is-non-pe #disassembly-wrapper,\nbody.is-non-pe #file-internals-wrapper,\nbody.is-non-pe #graph-wrapper {\n    display: none !important;\n}\n\nbody.is-non-pe #result-state {\n    display: none !important;\n}\n\nbody.is-non-pe .non-pe-result {\n    display: flex;\n}\n\n\n/* --- NEW: Stats Dashboard Panel --- */\n.stats-wrapper {\n    display: flex; \n    flex-direction: column;\n    gap: 1.5rem;\n    width: 100%; /* Fill its flex parent */\n    box-sizing: border-box; /* Include padding in width */\n}\n\n/* By default, stats are visible, disassembly is hidden */\n.disassembly-wrapper { display: none; }\n\n/* When analyzing/showing results, hide stats and show disassembly */\nbody.is-analyzing .stats-wrapper,\nbody.is-showing-result .stats-wrapper {\n    display: none;\n}\nbody.is-analyzing .disassembly-wrapper,\nbody.is-showing-result .disassembly-wrapper {\n    display: flex; /* Use flex to match its own styles */\n}\n\n\n.stats-grid {\n    display: flex; \n    flex-direction: column;\n    /* Force stacking */\n    gap: 1.5rem;\n}\n\n.stat-card {\n    display: flex;\n    align-items: center;\n    gap: 1.5rem;\n    background-color: var(--bg-dark-2);\n    padding: 1.5rem;\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n}\n.stat-card i {\n    font-size: 2.5rem;\n    color: var(--blue);\n}\n.stat-content {\n    display: flex;\n    flex-direction: column;\n}\n.stat-number {\n    font-size: 2rem;\n    font-weight: 600;\n    color: var(--text-light);\n    line-height: 1.2;\n}\n.stat-label {\n    font-size: 0.9rem;\n    color: var(--text-medium);\n}\n\n.chart-container-wrapper {\n    display: flex;\n    flex-direction: column;\n    gap: 1.5rem;\n}\n\n.chart-container {\n    background-color: var(--bg-dark-2);\n    padding: 1.5rem;\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    box-sizing: border-box;\n}\n.chart-container h3 {\n    margin-top: 0;\n    margin-bottom: 1.5rem;\n    text-align: center;\n    color: var(--text-light);\n    font-size: 1.1rem;\n}\n\n\n/* --- Disassembly Panel --- */\n.disassembly-wrapper {\n    /* display: none; set by default now */\n    flex-direction: column;\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n    height: 600px; /* Fixed height */\n    max-height: 70vh;\n    opacity: 0;\n    transition: all 0.3s ease;\n    width: 100%;\n    box-sizing: border-box;\n}\n\nbody.is-analyzing .disassembly-wrapper,\nbody.is-showing-result .disassembly-wrapper {\n    opacity: 1;\n}\n\n.disassembly-header {\n    padding: 1rem 1.5rem;\n    border-bottom: 1px solid var(--border-color);\n    background-color: var(--bg-dark-3);\n    border-radius: 12px 12px 0 0;\n}\n.disassembly-header h3 {\n    margin: 0;\n    color: var(--text-light);\n    font-size: 1.1rem;\n    font-family: 'Courier New', Courier, monospace;\n}\n.disassembly-code {\n    flex-grow: 1;\n    overflow-y: auto;\n    padding: 1rem;\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.95rem;\n}\n.disassembly-line {\n    display: block;\n    padding: 2px 1rem;\n    border-radius: 4px;\n    transition: background-color 0.2s ease;\n}\n.disassembly-line.active {\n    background-color: var(--blue);\n    color: var(--syntax-const-text); /* MODIFIED */\n}\n.disassembly-line .addr { color: var(--text-dark); margin-right: 1rem; }\n.disassembly-line .op { color: var(--syntax-op); font-weight: bold; width: 50px; display: inline-block; } /* MODIFIED */\n.disassembly-line .args { color: var(--text-light); }\n.disassembly-line .string { color: var(--syntax-string); } /* MODIFIED */\n.disassembly-line .comment { color: var(--green); margin-left: 1rem; }\n\n\n/* --- Analysis Details Panel --- */\n.analysis-details-container {\n    width: 100%;\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    padding: 2rem;\n    display: none; /* Hidden by default */\n    box-sizing: border-box;\n}\nbody.is-showing-result .analysis-details-container {\n    display: block;\n}\n\n.progress-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 0.75rem;\n}\n.progress-header h3 {\n    margin: 0;\n    font-size: 1.1rem;\n    color: var(--text-light);\n}\n.score-percentage {\n    font-size: 1.2rem;\n    font-weight: 600;\n}\n.score-green { color: var(--green); }\n.score-yellow { color: var(--yellow); }\n.score-red { color: var(--red); }\n\n.progress-bar-background {\n    width: 100%;\n    height: 12px;\n    background-color: var(--bg-dark-3);\n    border-radius: 6px;\n    overflow: hidden;\n    margin-bottom: 1.5rem;\n}\n.progress-bar-fill {\n    height: 100%;\n    width: 0%;\n    border-radius: 6px;\n    transition: width 0.5s ease;\n}\n.progress-bar-green { background-color: var(--green); }\n.progress-bar-yellow { background-color: var(--yellow); }\n.progress-bar-red { background-color: var(--red); }\n\n.details-section {\n    margin-bottom: 1.25rem;\n}\n.details-section h4 {\n    margin: 0 0 0.5rem 0;\n    color: var(--text-medium);\n    font-size: 0.9rem;\n    text-transform: uppercase;\n}\n.details-section p {\n    margin: 0;\n    color: var(--text-light);\n    font-size: 1rem;\n}\n.hash-text {\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.95rem;\n    word-break: break-all;\n}\n\n/* --- Vendor & Signature --- */\n.details-grid {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 1.5rem;\n    margin-bottom: 1.25rem;\n}\n.vendor-info, .signature-info {\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n    font-size: 1rem;\n    font-weight: 500;\n}\n.vendor-info i {\n    font-size: 1.5rem;\n    color: var(--text-medium);\n}\n.signature-info i {\n    font-size: 1.25rem;\n}\n/* Use the levels from datasrcs.js */\n.sig-verified { color: var(--green); }\n.sig-untrusted { color: var(--red); }\n.sig-unknown { color: var(--yellow); }\n\n/* --- File Internals Card --- */\n.file-internals-container {\n    width: 100%;\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    padding: 2rem;\n    display: none; /* Hidden by default */\n    box-sizing: border-box;\n    flex-direction: column;\n    gap: 1.5rem;\n}\nbody.is-showing-result .file-internals-container {\n    display: flex;\n}\n.file-internals-container h3 {\n    margin-top: 0;\n    margin-bottom: 0;\n    color: var(--text-light);\n    font-size: 1.25rem;\n    padding-bottom: 1rem;\n    border-bottom: 1px solid var(--border-color);\n}\n\n/* --- Entropy Bars --- */\n.entropy-bars {\n    display: flex;\n    flex-direction: column;\n    gap: 0.75rem;\n}\n.entropy-bar-row {\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n}\n.entropy-bar-label {\n    width: 60px;\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.9rem;\n    color: var(--text-medium);\n    flex-shrink: 0;\n}\n.entropy-bar-bg {\n    flex-grow: 1;\n    height: 20px;\n    background-color: var(--bg-dark-3);\n    border-radius: 4px;\n    overflow: hidden;\n}\n.entropy-bar-fill {\n    height: 100%;\n    width: 0%; /* Set by JS */\n    background-color: var(--blue);\n    border-radius: 4px;\n    transition: width 0.5s ease;\n    display: flex;\n    justify-content: flex-end;\n    align-items: center;\n    padding-right: 0.5rem;\n    box-sizing: border-box;\n}\n.entropy-bar-value {\n    font-size: 0.8rem;\n    font-weight: bold;\n    color: var(--syntax-const-text); /* MODIFIED */\n    text-shadow: 0 0 3px rgba(0,0,0,0.5);\n}\n/* Color coding for entropy bars */\n.entropy-bar-fill.low { background-color: var(--green); }\n.entropy-bar-fill.medium { background-color: var(--blue); }\n.entropy-bar-fill.high { background-color: var(--yellow); }\n.entropy-bar-fill.packed { background-color: var(--red); }\n\n/* --- Key Strings --- */\n.key-strings {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 0.5rem;\n}\n.key-string-tag {\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.9rem;\n    background-color: var(--bg-dark-3);\n    border: 1px solid var(--border-color);\n    padding: 0.25rem 0.5rem;\n    border-radius: 4px;\n    color: var(--text-light);\n}\n.key-string-tag.suspicious {\n    border-color: var(--red);\n    color: var(--red);\n    background-color: #e74c3c1a;\n}\n.key-string-tag.benign {\n    border-color: var(--green);\n    color: var(--green);\n    background-color: #2ecc711a;\n}\n\n/* --- Buttons --- */\n.btn-wrapper {\n    margin-top: 2rem;\n    display: flex;\n    gap: 1rem;\n}\n.btn {\n    flex-grow: 1; /* Make buttons fill space */\n    background-color: var(--blue);\n    color: var(--syntax-const-text); /* MODIFIED */\n    border: none;\n    padding: 12px 24px;\n    border-radius: 6px;\n    font-size: 1rem;\n    font-weight: bold;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    text-decoration: none;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    gap: 0.5rem;\n}\n.btn:hover {\n    filter: brightness(1.2);\n}\n.btn-primary {\n    background-color: var(--blue);\n}\n.btn-secondary {\n    background-color: var(--bg-dark-4);\n    color: var(--text-light);\n}\n.btn-secondary:hover {\n    background-color: #555;\n}\n.btn i {\n    margin-right: 0.25rem;\n}\n\n\n/* --- Background Particle Animations --- */\n.animation-swarm {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%; \n    height: 100%;\n    z-index: -1;\n    pointer-events: none;\n    overflow: hidden; \n}\n\n/* Base style for each new span particle */\n.animation-swarm span {\n    position: absolute;\n    top: -20px; /* Start off-screen */\n    font-size: 1.5rem;\n    opacity: 0; /* Start invisible */\n    animation: fall 10s linear infinite;\n}\n\n/* The ::before holds the icon content */\n.animation-swarm span::before {\n    content: '';\n    font-family: \"Font Awesome 6 Free\";\n    font-weight: 900;\n    text-shadow: 0 0 5px;\n}\n\n/* Keyframes for falling (starts with opacity) */\n@keyframes fall {\n    0% {\n        transform: translateY(0vh) rotate(0);\n        opacity: 0.3;\n    }\n    100% {\n        transform: translateY(105vh) rotate(360deg);\n        opacity: 0;\n    }\n}\n\n/* Set icon and color based on body class */\nbody.result-safe-active .animation-swarm span::before {\n    content: '\\f132'; /* fa-shield-halved */\n    color: var(--green);\n}\nbody.result-suspicious-active .animation-swarm span::before {\n    content: '\\f071'; /* fa-exclamation-triangle */\n    color: var(--yellow);\n}\nbody.result-malware-active .animation-swarm span::before {\n    content: '\\f188'; /* fa-bug */\n    color: var(--red);\n}\n\n/* Give each particle a unique position and delay --- THIS IS THE FINAL FIX --- */\n/* All values are kept well away from the 90-100% range */\n.animation-swarm span:nth-child(1) { left: 10%; animation-delay: 0s; }\n.animation-swarm span:nth-child(2) { left: 20%; animation-delay: -2s; }\n.animation-swarm span:nth-child(3) { left: 30%; animation-delay: -4s; }\n.animation-swarm span:nth-child(4) { left: 40%; animation-delay: -6s; }\n.animation-swarm span:nth-child(5) { left: 50%; animation-delay: -8s; }\n.animation-swarm span:nth-child(6) { left: 60%; animation-delay: -1s; }\n.animation-swarm span:nth-child(7) { left: 70%; animation-delay: -3s; }\n.animation-swarm span:nth-child(8) { left: 75%; animation-delay: -5s; } /* Was 80% */\n.animation-swarm span:nth-child(9) { left: 15%; animation-delay: -7s; } /* Was 90% */\n.animation-swarm span:nth-child(10) { left: 5%; animation-delay: -9s; }\n\n\n/* --- History Panel --- */\n.history-overlay {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0,0,0,0.5);\n    z-index: 1001;\n    opacity: 0;\n    visibility: hidden;\n    transition: all 0.3s ease;\n}\n.history-panel {\n    position: fixed;\n    top: 0;\n    right: -450px; /* Start off-screen */\n    width: 400px;\n    max-width: 90%;\n    height: 100%;\n    background-color: var(--bg-dark-2);\n    z-index: 1002;\n    transition: all 0.3s ease;\n    display: flex;\n    flex-direction: column;\n}\nbody.is-history-open .history-overlay {\n    opacity: 1;\n    visibility: visible;\n}\nbody.is-history-open .history-panel {\n    right: 0;\n}\n.history-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 1rem 1.5rem;\n    border-bottom: 1px solid var(--border-color);\n}\n.history-header h3 {\n    margin: 0;\n    font-size: 1.2rem;\n}\n.history-close-btn {\n    background: none;\n    border: none;\n    color: var(--text-medium);\n    font-size: 1.5rem;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n.history-close-btn:hover {\n    color: var(--text-light);\n}\n.history-list {\n    list-style: none;\n    padding: 0;\n    margin: 0;\n    overflow-y: auto;\n    flex-grow: 1;\n}\n.history-list li {\n    display: flex;\n    align-items: center;\n    gap: 1rem;\n    padding: 1rem 1.5rem;\n    border-bottom: 1px solid var(--border-color);\n    transition: background-color 0.2s ease;\n}\n\n.history-list li:hover {\n    background-color: var(--bg-dark-3);\n}\n\n.history-item {\n    display: flex;\n    align-items: flex-start;\n    gap: 1rem;\n}\n\n.history-icon-wrapper {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 0.5rem;\n    min-width: 60px;\n}\n\n.history-icon {\n    font-size: 1.8rem;\n    width: 40px;\n    height: 40px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    border-radius: 8px;\n    background-color: var(--bg-dark-3);\n}\n\n.history-icon.safe {\n    color: var(--green);\n    border: 2px solid var(--green);\n}\n\n.history-icon.suspicious {\n    color: var(--yellow);\n    border: 2px solid var(--yellow);\n}\n\n.history-icon.malware {\n    color: var(--red);\n    border: 2px solid var(--red);\n}\n\n.history-file-type {\n    font-size: 1rem;\n    color: var(--text-medium);\n}\n\n.history-details {\n    flex-grow: 1;\n    display: flex;\n    flex-direction: column;\n    gap: 0.5rem;\n    min-width: 0; /* Allow text truncation */\n}\n\n.history-filename {\n    font-weight: 600;\n    color: var(--text-light);\n    font-size: 0.95rem;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.history-classification {\n    font-size: 0.85rem;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.05em;\n}\n\n.history-classification.safe {\n    color: var(--green);\n}\n\n.history-classification.suspicious {\n    color: var(--yellow);\n}\n\n.history-classification.malware {\n    color: var(--red);\n}\n\n.history-hash {\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.75rem;\n    color: var(--text-medium);\n    background-color: var(--bg-dark-3);\n    padding: 0.25rem 0.5rem;\n    border-radius: 4px;\n    word-break: break-all;\n    line-height: 1.4;\n}\n\n.history-date {\n    font-size: 0.8rem;\n    color: var(--text-medium);\n    white-space: nowrap;\n    align-self: flex-start;\n    padding-top: 0.25rem;\n}\n\n.history-item-empty,\n.history-item-loading {\n    color: var(--text-medium);\n    text-align: center;\n    padding: 2rem;\n    font-style: italic;\n}\n\n\n/* --- Hover Scroll Zones --- */\n.scroll-zone {\n    position: fixed;\n    left: 0;\n    width: 100%;\n    height: 80px;\n    z-index: 998;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n}\n.scroll-zone.top { top: 60px; /* Below nav */ }\n.scroll-zone.bottom { bottom: 0; }\n\n.scroll-zone i {\n    font-size: 2rem;\n    color: var(--text-light);\n    opacity: 0;\n    transition: all 0.3s ease;\n    text-shadow: 0 0 15px rgba(0,0,0,0.7);\n}\n.scroll-zone.scrolling i {\n    opacity: 0.3;\n}\n.scroll-zone:hover i {\n    opacity: 0.7;\n}\n\n\n/* --- Graph Panel --- */\n.graph-wrapper {\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n    margin-top: 1rem;\n    display: none; /* Hidden by default */\n    box-sizing: border-box;\n}\nbody.is-showing-result .graph-wrapper {\n    display: block; /* Show with results */\n}\n\n.graph-header {\n    padding: 1rem 1.5rem;\n    border-bottom: 1px solid var(--border-color);\n    background-color: var(--bg-dark-3);\n    border-radius: 12px 12px 0 0;\n}\n.graph-header h3 {\n    margin: 0;\n    color: var(--text-light);\n    font-size: 1.1rem;\n}\n.call-graph-container {\n    overflow: auto; /* Allow scrolling for large graphs */\n}\n.call-graph {\n    flex-grow: 1;\n    overflow: auto;\n    position: relative; /* KEY for node positioning */\n    min-height: 400px;\n    padding: 1rem;\n}\n\n.graph-node {\n    position: absolute;\n    padding: 0.75rem 1.25rem;\n    border-radius: 8px;\n    background-color: var(--bg-dark-3);\n    border: 2px solid var(--border-color);\n    font-family: 'Courier New', Courier, monospace;\n    font-weight: bold;\n    white-space: nowrap;\n    box-shadow: 0 4px 10px rgba(0,0,0,0.3);\n    z-index: 2;\n    text-align: center;\n}\n/* MODIFIED to use variables */\n.node-entry { background-color: var(--node-bg-entry); border-color: var(--green); color: var(--syntax-const-text); }\n.node-std { background-color: var(--bg-dark-3); border-color: var(--border-color); color: var(--text-light); }\n.node-api { background-color: var(--node-bg-api); border-color: var(--blue); color: var(--syntax-const-text); }\n.node-suspicious { background-color: var(--node-bg-suspicious); border-color: var(--yellow); color: var(--syntax-const-text); }\n.node-malicious { background-color: var(--node-bg-malicious); border-color: var(--red); color: var(--syntax-const-text); }\n\n.leader-line {\n    z-index: 1; /* Sit behind nodes */\n    opacity: 0.8;\n}\nbody.light-theme .chart-container {\n    color: var(--text-medium);\n}\n\n/* Light theme navigation buttons */\nbody.light-theme .nav-btn {\n    background: linear-gradient(135deg, var(--primary), var(--secondary));\n    color: white;\n    box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);\n}\n\nbody.light-theme .nav-btn:hover:not(:disabled) {\n    box-shadow: 0 6px 20px rgba(139, 92, 246, 0.6);\n}\n\nbody.light-theme .nav-btn:disabled {\n    background: var(--bg-dark-3) !important;\n    color: var(--text-dark) !important;\n    box-shadow: none !important;\n}\n\nbody.light-theme .nav-info {\n    color: var(--text-light);\n    font-weight: 600;\n}\n\nbody.light-theme .scan-navigation {\n    border-top-color: var(--border-color);\n}\n","epoch":121,"telemetryInfo":{}}],["file:///home/trang/localnsv/mAIware/style.css::request_48c060e3-68ea-41a9-b274-6b28227135f7",{"uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/style.css","external":"file:///home/trang/localnsv/mAIware/style.css","path":"/home/trang/localnsv/mAIware/style.css","scheme":"file"},"requestId":"request_48c060e3-68ea-41a9-b274-6b28227135f7","content":"/* --- Global & Fonts --- */\n:root {\n    /* --- Dark Theme (Default) --- */\n    --bg-dark-1: #121212;\n    --bg-dark-2: #1e1e1e;\n    --bg-dark-3: #2a2a2e;\n    --bg-dark-4: #333333;\n    --border-color: #444444;\n    --text-light: #e0e0e0;\n    --text-medium: #aaa;\n    --text-dark: #888;\n    \n    /* --- Semantic Colors --- */\n    --blue: #007bff;\n    --red: #e74c3c;\n    --yellow: #f1c40f;\n    --green: #2ecc71;\n    \n    /* --- Syntax & Node Colors --- */\n    --syntax-op: #c39eff;\n    --syntax-string: #e6db74;\n    --syntax-const-text: #ffffff; /* Constant white for dark buttons/nodes */\n    --node-bg-entry: #254a25;\n    --node-bg-api: #2a3e4a;\n    --node-bg-suspicious: #4a452a;\n    --node-bg-malicious: #4a2a2a;\n\n    --chart-legend-text: var(--text-light);  /* #e0e0e0 */\n    --chart-axes-text: var(--text-medium);   /* #aaa */\n    --chart-grid-line: var(--border-color);\n}\n\n/* --- Light Theme --- */\n/* Add \".light-theme\" to the <body> tag to activate */\nbody.light-theme {\n    --bg-dark-1: #f8f9fa;     /* Main background */\n    --bg-dark-2: #ffffff;     /* Card background */\n    --bg-dark-3: #e9ecef;     /* Hover/active background */\n    --bg-dark-4: #ced4da;     /* Secondary button background */\n    --border-color: #dee2e6;  /* Border color */\n    --text-light: #212529;    /* Main text */\n    --text-medium: #6c757d;   /* Secondary text */\n    --text-dark: #888;        /* Tertiary text (can stay gray) */\n    \n    /* Semantic colors are unchanged */\n    /* --blue, --red, --yellow, --green */\n    \n    /* --- Light Theme Syntax --- */\n    --syntax-op: #a040ff;       /* Darker purple */\n    --syntax-string: #b8860b;     /* Dark goldenrod */\n    --syntax-const-text: #ffffff; /* Stays white for colored buttons/nodes */\n    \n    /* Node backgrounds are unchanged, they look good on a light BG */\n    --chart-legend-text: var(--text-medium); /* User Request */\n    --chart-axes-text: var(--text-medium);   /* User Request */\n    --chart-grid-line: var(--border-color);\n}\n\n\n/* Apply overflow-x to html as well */\nhtml {\n    overflow-x: hidden;\n    font-size: 16px; /* Ensure base font size */\n}\n\nbody {\n    font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n    background-color: var(--bg-dark-1);\n    color: var(--text-light);\n    margin: 0;\n    padding-top: 60px; /* Make space for fixed top nav */\n    overflow-x: hidden; /* Prevent horizontal scroll */\n    width: 100%;\n    min-height: 100vh;\n}\n\n/* --- Main Grid Container --- */\n.main-container {\n    display: grid;\n    grid-template-columns: 1fr 1fr; /* Simpler 2-column definition */\n    grid-template-rows: auto auto; /* Rows for content and graph */\n    gap: 2rem;\n    padding: 2rem; /* Spacing from nav and screen edges */\n    align-items: start;\n    \n    /* Set max-width on the grid itself */\n    max-width: 1400px; \n    /* Center the whole grid */\n    margin: 0 auto; \n    \n    min-height: calc(100vh - 60px); /* Full height minus nav */\n    box-sizing: border-box;\n    width: 100%;\n}\n\n.scanner-wrapper {\n    grid-column: 1 / 2; /* Span first column */\n    grid-row: 1 / 2;\n    display: flex;\n    flex-direction: column;\n    gap: 1.5rem;\n    width: 100%; /* Fill the column */\n}\n\n.right-panel-wrapper {\n    grid-column: 2 / 3; /* Span second column */\n    grid-row: 1 / 2;\n    display: flex; /* Make it a flex container */\n    flex-direction: column; /* Stack its children vertically */\n    gap: 1.5rem; /* Space between its children */\n    width: 100%; /* Fill the column */\n}\n\n.graph-wrapper {\n    grid-column: 1 / 3; /* Span BOTH columns */\n    grid-row: 2 / 3;\n    width: 100%;\n    /* max-width is now inherited from main-container */\n    justify-self: center; /* Center in the grid area */\n}\n\n\n/* --- Top Navigation --- */\n.top-nav {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    height: 60px;\n    background-color: var(--bg-dark-2);\n    border-bottom: 1px solid var(--border-color);\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 0 2rem;\n    z-index: 1000;\n    box-sizing: border-box;\n}\n\n.top-nav .logo {\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n    font-size: 1.3rem;\n    font-weight: 600;\n    color: var(--text-light);\n}\n\n.top-nav .logo i {\n    color: var(--blue);\n}\n\n.nav-links {\n    display: flex;\n    gap: 0.5rem;\n}\n\n.nav-link {\n    color: var(--text-medium);\n    font-size: 1.25rem;\n    padding: 0.75rem;\n    border-radius: 8px;\n    transition: all 0.2s ease;\n    position: relative;\n    text-decoration: none;\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n}\n\n.nav-link .link-text {\n    font-size: 0.9rem;\n    font-weight: 500;\n    max-width: 0;\n    overflow: hidden;\n    white-space: nowrap;\n    transition: all 0.3s ease;\n}\n\n.nav-link:hover {\n    background-color: var(--bg-dark-3);\n    color: var(--text-light);\n}\n\n.nav-link:hover .link-text {\n    max-width: 80px; /* Expand text on hover */\n    margin-left: 0.25rem;\n}\n\n/* --- Tooltip --- */\n.nav-link:hover::before {\n    content: attr(data-tooltip);\n    position: absolute;\n    bottom: -35px;\n    left: 50%;\n    transform: translateX(-50%);\n    background-color: var(--bg-dark-3);\n    color: var(--text-light);\n    padding: 5px 10px;\n    border-radius: 4px;\n    font-size: 0.8rem;\n    white-space: nowrap;\n    opacity: 0;\n    transition: opacity 0.2s 0.3s; /* Delay tooltip */\n    pointer-events: none;\n}\n.nav-link:hover .link-text {\n    display: none; /* Hide expanded text if tooltip is showing */\n}\n.nav-link:hover:hover::before {\n    opacity: 1;\n}\n\n/* On smaller screens, stack the columns */\n@media (max-width: 1280px) { /* Widened breakpoint */\n    .main-container {\n        grid-template-columns: 1fr; /* Stack columns */\n        padding: 1rem;\n    }\n    .scanner-wrapper, .right-panel-wrapper, .graph-wrapper {\n        grid-column: 1 / 2; /* All in one column */\n        max-width: 100%;\n        justify-self: center;\n    }\n    .right-panel-wrapper {\n        grid-row: 2 / 3;\n    }\n    .graph-wrapper {\n        grid-row: 3 / 4;\n    }\n}\n\n/* Hide link text on very small screens */\n@media (max-width: 768px) {\n    .nav-link .link-text { display: none; }\n    .nav-link:hover .link-text { display: none; }\n    .top-nav { padding: 0 1rem; }\n}\n\n\n/* --- Main Scanner Box --- */\n.scanner-container {\n    width: 100%; /* Ensure it fills its flex parent */\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n    padding: 2.5rem;\n    text-align: center;\n    overflow: hidden;\n    transition: all 0.3s ease;\n    box-sizing: border-box; /* Include padding in width */\n}\n\nh1 {\n    color: var(--text-light);\n    margin-top: 0;\n    margin-bottom: 1rem;\n}\n\n.scanner-container p {\n    color: var(--text-medium);\n    margin-bottom: 2rem;\n    font-size: 1.1rem;\n}\n\n.scanner-state {\n    display: none;\n}\n.scanner-state.active {\n    display: block;\n}\n\n/* --- State 1: Upload --- */\n.upload-zone {\n    border: 2px dashed var(--border-color);\n    border-radius: 8px;\n    padding: 3rem 2rem;\n    cursor: pointer;\n    transition: all 0.3s ease;\n}\n.upload-zone:hover {\n    background-color: var(--bg-dark-3);\n    border-color: var(--blue);\n}\n.upload-icon {\n    font-size: 4rem;\n    color: var(--blue);\n    margin-bottom: 1rem;\n}\n.upload-zone h3 {\n    margin: 0;\n    color: var(--text-light);\n}\n.upload-zone span {\n    color: var(--text-dark);\n}\n\n/* --- State 2: Analyzing --- */\n.analyzing-icon .loader {\n    width: 80px;\n    height: 80px;\n    border: 6px solid var(--bg-dark-4);\n    border-top-color: var(--blue);\n    border-radius: 50%;\n    animation: spin 1s linear infinite;\n    margin: 2rem auto;\n}\n@keyframes spin {\n    to { transform: rotate(360deg); }\n}\n.analyzing-state h3 {\n    color: var(--text-light);\n    margin-bottom: 0.5rem;\n}\n.analyzing-state .filename,\n.result-state .filename {\n    color: var(--text-medium);\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 1.1rem;\n    word-break: break-all;\n}\n\n/* --- State 3: Result --- */\n.result-icon {\n    font-size: 6rem;\n    line-height: 1;\n    margin: 1.5rem 0;\n}\n.result-state h2 {\n    font-size: 2.5rem;\n    margin: 0 0 0.5rem 0;\n}\n.result-malware .result-icon, .result-malware h2 { color: var(--red); }\n.result-suspicious .result-icon, .result-suspicious h2 { color: var(--yellow); }\n.result-safe .result-icon, .result-safe h2 { color: var(--green); }\n.result-state p {\n    font-size: 1rem;\n    margin-bottom: 2rem;\n}\n\n/* --- Scan Navigation Controls --- */\n.scan-navigation {\n    display: none;\n    align-items: center;\n    justify-content: center;\n    gap: 1.5rem;\n    margin: 1.5rem 0;\n    padding: 1rem;\n    background: rgba(255, 255, 255, 0.03);\n    border-radius: 8px;\n}\n\n.scan-navigation-top {\n    display: flex;\n}\n\n/* Show navigation when results are displayed */\nbody.is-showing-result .scan-navigation-top,\nbody.is-non-pe .scan-navigation-top {\n    display: flex;\n}\n\n.nav-btn {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    padding: 0.75rem 1.5rem;\n    background: linear-gradient(135deg, var(--primary), var(--secondary));\n    color: white;\n    border: none;\n    border-radius: 8px;\n    font-size: 1rem;\n    font-weight: 600;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);\n}\n\n.nav-btn:hover:not(:disabled) {\n    transform: translateY(-2px);\n    box-shadow: 0 6px 20px rgba(139, 92, 246, 0.5);\n}\n\n.nav-btn:active:not(:disabled) {\n    transform: translateY(0);\n}\n\n.nav-btn:disabled {\n    background: rgba(255, 255, 255, 0.1) !important;\n    color: rgba(255, 255, 255, 0.3) !important;\n    cursor: not-allowed;\n    box-shadow: none !important;\n}\n\n.nav-info {\n    color: var(--text-medium);\n    font-size: 0.95rem;\n    font-weight: 500;\n    min-width: 80px;\n    text-align: center;\n}\n\n.non-pe-result {\n    display: none;\n    flex-direction: column;\n    align-items: center;\n    gap: 1.5rem;\n    color: var(--text-light);\n    padding: 1rem 0 0 0;\n}\n\n.non-pe-result.active {\n    display: flex;\n}\n\n.non-pe-icon {\n    width: 96px;\n    height: 96px;\n    border-radius: 24px;\n    background: linear-gradient(135deg, rgba(80, 130, 255, 0.2), rgba(80, 130, 255, 0.05));\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 3rem;\n    color: var(--blue);\n}\n\n.non-pe-hash-grid {\n    display: flex;\n    gap: 1.5rem;\n    flex-wrap: wrap;\n    justify-content: center;\n}\n\n.non-pe-hash {\n    min-width: 220px;\n    background: var(--bg-dark-3);\n    padding: 1rem 1.25rem;\n    border-radius: 12px;\n    border: 1px solid rgba(255, 255, 255, 0.05);\n    text-align: left;\n}\n\n.non-pe-hash h4 {\n    margin: 0 0 0.5rem 0;\n    font-size: 0.85rem;\n    text-transform: uppercase;\n    letter-spacing: 0.08rem;\n    color: var(--text-medium);\n}\n\n.non-pe-hash p {\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.9rem;\n    word-break: break-all;\n    color: var(--text-light);\n}\n\nbody.is-non-pe .analysis-details-container,\nbody.is-non-pe #analysis-details-wrapper,\nbody.is-non-pe #disassembly-wrapper,\nbody.is-non-pe #file-internals-wrapper,\nbody.is-non-pe #graph-wrapper {\n    display: none !important;\n}\n\nbody.is-non-pe #result-state {\n    display: none !important;\n}\n\nbody.is-non-pe .non-pe-result {\n    display: flex;\n}\n\n\n/* --- NEW: Stats Dashboard Panel --- */\n.stats-wrapper {\n    display: flex; \n    flex-direction: column;\n    gap: 1.5rem;\n    width: 100%; /* Fill its flex parent */\n    box-sizing: border-box; /* Include padding in width */\n}\n\n/* By default, stats are visible, disassembly is hidden */\n.disassembly-wrapper { display: none; }\n\n/* When analyzing/showing results, hide stats and show disassembly */\nbody.is-analyzing .stats-wrapper,\nbody.is-showing-result .stats-wrapper {\n    display: none;\n}\nbody.is-analyzing .disassembly-wrapper,\nbody.is-showing-result .disassembly-wrapper {\n    display: flex; /* Use flex to match its own styles */\n}\n\n\n.stats-grid {\n    display: flex; \n    flex-direction: column;\n    /* Force stacking */\n    gap: 1.5rem;\n}\n\n.stat-card {\n    display: flex;\n    align-items: center;\n    gap: 1.5rem;\n    background-color: var(--bg-dark-2);\n    padding: 1.5rem;\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n}\n.stat-card i {\n    font-size: 2.5rem;\n    color: var(--blue);\n}\n.stat-content {\n    display: flex;\n    flex-direction: column;\n}\n.stat-number {\n    font-size: 2rem;\n    font-weight: 600;\n    color: var(--text-light);\n    line-height: 1.2;\n}\n.stat-label {\n    font-size: 0.9rem;\n    color: var(--text-medium);\n}\n\n.chart-container-wrapper {\n    display: flex;\n    flex-direction: column;\n    gap: 1.5rem;\n}\n\n.chart-container {\n    background-color: var(--bg-dark-2);\n    padding: 1.5rem;\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    box-sizing: border-box;\n}\n.chart-container h3 {\n    margin-top: 0;\n    margin-bottom: 1.5rem;\n    text-align: center;\n    color: var(--text-light);\n    font-size: 1.1rem;\n}\n\n\n/* --- Disassembly Panel --- */\n.disassembly-wrapper {\n    /* display: none; set by default now */\n    flex-direction: column;\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n    height: 600px; /* Fixed height */\n    max-height: 70vh;\n    opacity: 0;\n    transition: all 0.3s ease;\n    width: 100%;\n    box-sizing: border-box;\n}\n\nbody.is-analyzing .disassembly-wrapper,\nbody.is-showing-result .disassembly-wrapper {\n    opacity: 1;\n}\n\n.disassembly-header {\n    padding: 1rem 1.5rem;\n    border-bottom: 1px solid var(--border-color);\n    background-color: var(--bg-dark-3);\n    border-radius: 12px 12px 0 0;\n}\n.disassembly-header h3 {\n    margin: 0;\n    color: var(--text-light);\n    font-size: 1.1rem;\n    font-family: 'Courier New', Courier, monospace;\n}\n.disassembly-code {\n    flex-grow: 1;\n    overflow-y: auto;\n    padding: 1rem;\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.95rem;\n}\n.disassembly-line {\n    display: block;\n    padding: 2px 1rem;\n    border-radius: 4px;\n    transition: background-color 0.2s ease;\n}\n.disassembly-line.active {\n    background-color: var(--blue);\n    color: var(--syntax-const-text); /* MODIFIED */\n}\n.disassembly-line .addr { color: var(--text-dark); margin-right: 1rem; }\n.disassembly-line .op { color: var(--syntax-op); font-weight: bold; width: 50px; display: inline-block; } /* MODIFIED */\n.disassembly-line .args { color: var(--text-light); }\n.disassembly-line .string { color: var(--syntax-string); } /* MODIFIED */\n.disassembly-line .comment { color: var(--green); margin-left: 1rem; }\n\n\n/* --- Analysis Details Panel --- */\n.analysis-details-container {\n    width: 100%;\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    padding: 2rem;\n    display: none; /* Hidden by default */\n    box-sizing: border-box;\n}\nbody.is-showing-result .analysis-details-container {\n    display: block;\n}\n\n.progress-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 0.75rem;\n}\n.progress-header h3 {\n    margin: 0;\n    font-size: 1.1rem;\n    color: var(--text-light);\n}\n.score-percentage {\n    font-size: 1.2rem;\n    font-weight: 600;\n}\n.score-green { color: var(--green); }\n.score-yellow { color: var(--yellow); }\n.score-red { color: var(--red); }\n\n.progress-bar-background {\n    width: 100%;\n    height: 12px;\n    background-color: var(--bg-dark-3);\n    border-radius: 6px;\n    overflow: hidden;\n    margin-bottom: 1.5rem;\n}\n.progress-bar-fill {\n    height: 100%;\n    width: 0%;\n    border-radius: 6px;\n    transition: width 0.5s ease;\n}\n.progress-bar-green { background-color: var(--green); }\n.progress-bar-yellow { background-color: var(--yellow); }\n.progress-bar-red { background-color: var(--red); }\n\n.details-section {\n    margin-bottom: 1.25rem;\n}\n.details-section h4 {\n    margin: 0 0 0.5rem 0;\n    color: var(--text-medium);\n    font-size: 0.9rem;\n    text-transform: uppercase;\n}\n.details-section p {\n    margin: 0;\n    color: var(--text-light);\n    font-size: 1rem;\n}\n.hash-text {\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.95rem;\n    word-break: break-all;\n}\n\n/* --- Vendor & Signature --- */\n.details-grid {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 1.5rem;\n    margin-bottom: 1.25rem;\n}\n.vendor-info, .signature-info {\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n    font-size: 1rem;\n    font-weight: 500;\n}\n.vendor-info i {\n    font-size: 1.5rem;\n    color: var(--text-medium);\n}\n.signature-info i {\n    font-size: 1.25rem;\n}\n/* Use the levels from datasrcs.js */\n.sig-verified { color: var(--green); }\n.sig-untrusted { color: var(--red); }\n.sig-unknown { color: var(--yellow); }\n\n/* --- File Internals Card --- */\n.file-internals-container {\n    width: 100%;\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    padding: 2rem;\n    display: none; /* Hidden by default */\n    box-sizing: border-box;\n    flex-direction: column;\n    gap: 1.5rem;\n}\nbody.is-showing-result .file-internals-container {\n    display: flex;\n}\n.file-internals-container h3 {\n    margin-top: 0;\n    margin-bottom: 0;\n    color: var(--text-light);\n    font-size: 1.25rem;\n    padding-bottom: 1rem;\n    border-bottom: 1px solid var(--border-color);\n}\n\n/* --- Entropy Bars --- */\n.entropy-bars {\n    display: flex;\n    flex-direction: column;\n    gap: 0.75rem;\n}\n.entropy-bar-row {\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n}\n.entropy-bar-label {\n    width: 60px;\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.9rem;\n    color: var(--text-medium);\n    flex-shrink: 0;\n}\n.entropy-bar-bg {\n    flex-grow: 1;\n    height: 20px;\n    background-color: var(--bg-dark-3);\n    border-radius: 4px;\n    overflow: hidden;\n}\n.entropy-bar-fill {\n    height: 100%;\n    width: 0%; /* Set by JS */\n    background-color: var(--blue);\n    border-radius: 4px;\n    transition: width 0.5s ease;\n    display: flex;\n    justify-content: flex-end;\n    align-items: center;\n    padding-right: 0.5rem;\n    box-sizing: border-box;\n}\n.entropy-bar-value {\n    font-size: 0.8rem;\n    font-weight: bold;\n    color: var(--syntax-const-text); /* MODIFIED */\n    text-shadow: 0 0 3px rgba(0,0,0,0.5);\n}\n/* Color coding for entropy bars */\n.entropy-bar-fill.low { background-color: var(--green); }\n.entropy-bar-fill.medium { background-color: var(--blue); }\n.entropy-bar-fill.high { background-color: var(--yellow); }\n.entropy-bar-fill.packed { background-color: var(--red); }\n\n/* --- Key Strings --- */\n.key-strings {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 0.5rem;\n}\n.key-string-tag {\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.9rem;\n    background-color: var(--bg-dark-3);\n    border: 1px solid var(--border-color);\n    padding: 0.25rem 0.5rem;\n    border-radius: 4px;\n    color: var(--text-light);\n}\n.key-string-tag.suspicious {\n    border-color: var(--red);\n    color: var(--red);\n    background-color: #e74c3c1a;\n}\n.key-string-tag.benign {\n    border-color: var(--green);\n    color: var(--green);\n    background-color: #2ecc711a;\n}\n\n/* --- Buttons --- */\n.btn-wrapper {\n    margin-top: 2rem;\n    display: flex;\n    gap: 1rem;\n}\n.btn {\n    flex-grow: 1; /* Make buttons fill space */\n    background-color: var(--blue);\n    color: var(--syntax-const-text); /* MODIFIED */\n    border: none;\n    padding: 12px 24px;\n    border-radius: 6px;\n    font-size: 1rem;\n    font-weight: bold;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    text-decoration: none;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    gap: 0.5rem;\n}\n.btn:hover {\n    filter: brightness(1.2);\n}\n.btn-primary {\n    background-color: var(--blue);\n}\n.btn-secondary {\n    background-color: var(--bg-dark-4);\n    color: var(--text-light);\n}\n.btn-secondary:hover {\n    background-color: #555;\n}\n.btn i {\n    margin-right: 0.25rem;\n}\n\n\n/* --- Background Particle Animations --- */\n.animation-swarm {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%; \n    height: 100%;\n    z-index: -1;\n    pointer-events: none;\n    overflow: hidden; \n}\n\n/* Base style for each new span particle */\n.animation-swarm span {\n    position: absolute;\n    top: -20px; /* Start off-screen */\n    font-size: 1.5rem;\n    opacity: 0; /* Start invisible */\n    animation: fall 10s linear infinite;\n}\n\n/* The ::before holds the icon content */\n.animation-swarm span::before {\n    content: '';\n    font-family: \"Font Awesome 6 Free\";\n    font-weight: 900;\n    text-shadow: 0 0 5px;\n}\n\n/* Keyframes for falling (starts with opacity) */\n@keyframes fall {\n    0% {\n        transform: translateY(0vh) rotate(0);\n        opacity: 0.3;\n    }\n    100% {\n        transform: translateY(105vh) rotate(360deg);\n        opacity: 0;\n    }\n}\n\n/* Set icon and color based on body class */\nbody.result-safe-active .animation-swarm span::before {\n    content: '\\f132'; /* fa-shield-halved */\n    color: var(--green);\n}\nbody.result-suspicious-active .animation-swarm span::before {\n    content: '\\f071'; /* fa-exclamation-triangle */\n    color: var(--yellow);\n}\nbody.result-malware-active .animation-swarm span::before {\n    content: '\\f188'; /* fa-bug */\n    color: var(--red);\n}\n\n/* Give each particle a unique position and delay --- THIS IS THE FINAL FIX --- */\n/* All values are kept well away from the 90-100% range */\n.animation-swarm span:nth-child(1) { left: 10%; animation-delay: 0s; }\n.animation-swarm span:nth-child(2) { left: 20%; animation-delay: -2s; }\n.animation-swarm span:nth-child(3) { left: 30%; animation-delay: -4s; }\n.animation-swarm span:nth-child(4) { left: 40%; animation-delay: -6s; }\n.animation-swarm span:nth-child(5) { left: 50%; animation-delay: -8s; }\n.animation-swarm span:nth-child(6) { left: 60%; animation-delay: -1s; }\n.animation-swarm span:nth-child(7) { left: 70%; animation-delay: -3s; }\n.animation-swarm span:nth-child(8) { left: 75%; animation-delay: -5s; } /* Was 80% */\n.animation-swarm span:nth-child(9) { left: 15%; animation-delay: -7s; } /* Was 90% */\n.animation-swarm span:nth-child(10) { left: 5%; animation-delay: -9s; }\n\n\n/* --- History Panel --- */\n.history-overlay {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0,0,0,0.5);\n    z-index: 1001;\n    opacity: 0;\n    visibility: hidden;\n    transition: all 0.3s ease;\n}\n.history-panel {\n    position: fixed;\n    top: 0;\n    right: -450px; /* Start off-screen */\n    width: 400px;\n    max-width: 90%;\n    height: 100%;\n    background-color: var(--bg-dark-2);\n    z-index: 1002;\n    transition: all 0.3s ease;\n    display: flex;\n    flex-direction: column;\n}\nbody.is-history-open .history-overlay {\n    opacity: 1;\n    visibility: visible;\n}\nbody.is-history-open .history-panel {\n    right: 0;\n}\n.history-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 1rem 1.5rem;\n    border-bottom: 1px solid var(--border-color);\n}\n.history-header h3 {\n    margin: 0;\n    font-size: 1.2rem;\n}\n.history-close-btn {\n    background: none;\n    border: none;\n    color: var(--text-medium);\n    font-size: 1.5rem;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n.history-close-btn:hover {\n    color: var(--text-light);\n}\n.history-list {\n    list-style: none;\n    padding: 0;\n    margin: 0;\n    overflow-y: auto;\n    flex-grow: 1;\n}\n.history-list li {\n    display: flex;\n    align-items: center;\n    gap: 1rem;\n    padding: 1rem 1.5rem;\n    border-bottom: 1px solid var(--border-color);\n    transition: background-color 0.2s ease;\n}\n\n.history-list li:hover {\n    background-color: var(--bg-dark-3);\n}\n\n.history-item {\n    display: flex;\n    align-items: flex-start;\n    gap: 1rem;\n}\n\n.history-icon-wrapper {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 0.5rem;\n    min-width: 60px;\n}\n\n.history-icon {\n    font-size: 1.8rem;\n    width: 40px;\n    height: 40px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    border-radius: 8px;\n    background-color: var(--bg-dark-3);\n}\n\n.history-icon.safe {\n    color: var(--green);\n    border: 2px solid var(--green);\n}\n\n.history-icon.suspicious {\n    color: var(--yellow);\n    border: 2px solid var(--yellow);\n}\n\n.history-icon.malware {\n    color: var(--red);\n    border: 2px solid var(--red);\n}\n\n.history-file-type {\n    font-size: 1rem;\n    color: var(--text-medium);\n}\n\n.history-details {\n    flex-grow: 1;\n    display: flex;\n    flex-direction: column;\n    gap: 0.5rem;\n    min-width: 0; /* Allow text truncation */\n}\n\n.history-filename {\n    font-weight: 600;\n    color: var(--text-light);\n    font-size: 0.95rem;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.history-classification {\n    font-size: 0.85rem;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.05em;\n}\n\n.history-classification.safe {\n    color: var(--green);\n}\n\n.history-classification.suspicious {\n    color: var(--yellow);\n}\n\n.history-classification.malware {\n    color: var(--red);\n}\n\n.history-hash {\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.75rem;\n    color: var(--text-medium);\n    background-color: var(--bg-dark-3);\n    padding: 0.25rem 0.5rem;\n    border-radius: 4px;\n    word-break: break-all;\n    line-height: 1.4;\n}\n\n.history-date {\n    font-size: 0.8rem;\n    color: var(--text-medium);\n    white-space: nowrap;\n    align-self: flex-start;\n    padding-top: 0.25rem;\n}\n\n.history-item-empty,\n.history-item-loading {\n    color: var(--text-medium);\n    text-align: center;\n    padding: 2rem;\n    font-style: italic;\n}\n\n\n/* --- Hover Scroll Zones --- */\n.scroll-zone {\n    position: fixed;\n    left: 0;\n    width: 100%;\n    height: 80px;\n    z-index: 998;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n}\n.scroll-zone.top { top: 60px; /* Below nav */ }\n.scroll-zone.bottom { bottom: 0; }\n\n.scroll-zone i {\n    font-size: 2rem;\n    color: var(--text-light);\n    opacity: 0;\n    transition: all 0.3s ease;\n    text-shadow: 0 0 15px rgba(0,0,0,0.7);\n}\n.scroll-zone.scrolling i {\n    opacity: 0.3;\n}\n.scroll-zone:hover i {\n    opacity: 0.7;\n}\n\n\n/* --- Graph Panel --- */\n.graph-wrapper {\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n    margin-top: 1rem;\n    display: none; /* Hidden by default */\n    box-sizing: border-box;\n}\nbody.is-showing-result .graph-wrapper {\n    display: block; /* Show with results */\n}\n\n.graph-header {\n    padding: 1rem 1.5rem;\n    border-bottom: 1px solid var(--border-color);\n    background-color: var(--bg-dark-3);\n    border-radius: 12px 12px 0 0;\n}\n.graph-header h3 {\n    margin: 0;\n    color: var(--text-light);\n    font-size: 1.1rem;\n}\n.call-graph-container {\n    overflow: auto; /* Allow scrolling for large graphs */\n}\n.call-graph {\n    flex-grow: 1;\n    overflow: auto;\n    position: relative; /* KEY for node positioning */\n    min-height: 400px;\n    padding: 1rem;\n}\n\n.graph-node {\n    position: absolute;\n    padding: 0.75rem 1.25rem;\n    border-radius: 8px;\n    background-color: var(--bg-dark-3);\n    border: 2px solid var(--border-color);\n    font-family: 'Courier New', Courier, monospace;\n    font-weight: bold;\n    white-space: nowrap;\n    box-shadow: 0 4px 10px rgba(0,0,0,0.3);\n    z-index: 2;\n    text-align: center;\n}\n/* MODIFIED to use variables */\n.node-entry { background-color: var(--node-bg-entry); border-color: var(--green); color: var(--syntax-const-text); }\n.node-std { background-color: var(--bg-dark-3); border-color: var(--border-color); color: var(--text-light); }\n.node-api { background-color: var(--node-bg-api); border-color: var(--blue); color: var(--syntax-const-text); }\n.node-suspicious { background-color: var(--node-bg-suspicious); border-color: var(--yellow); color: var(--syntax-const-text); }\n.node-malicious { background-color: var(--node-bg-malicious); border-color: var(--red); color: var(--syntax-const-text); }\n\n.leader-line {\n    z-index: 1; /* Sit behind nodes */\n    opacity: 0.8;\n}\nbody.light-theme .chart-container {\n    color: var(--text-medium);\n}\n\n/* Light theme navigation buttons */\nbody.light-theme .nav-btn {\n    background: linear-gradient(135deg, var(--primary), var(--secondary));\n    color: white;\n    box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);\n}\n\nbody.light-theme .nav-btn:hover:not(:disabled) {\n    box-shadow: 0 6px 20px rgba(139, 92, 246, 0.6);\n}\n\nbody.light-theme .nav-btn:disabled {\n    background: var(--bg-dark-3) !important;\n    color: var(--text-dark) !important;\n    box-shadow: none !important;\n}\n\nbody.light-theme .nav-info {\n    color: var(--text-light);\n    font-weight: 600;\n}\n\nbody.light-theme .scan-navigation {\n    border-top-color: var(--border-color);\n}\n","epoch":125,"telemetryInfo":{}}],["file:///home/trang/localnsv/mAIware/style.css::request_f66fcc2f-7600-4c3d-b58a-9a70f85ff99e",{"uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/style.css","external":"file:///home/trang/localnsv/mAIware/style.css","path":"/home/trang/localnsv/mAIware/style.css","scheme":"file"},"requestId":"request_f66fcc2f-7600-4c3d-b58a-9a70f85ff99e","content":"/* --- Global & Fonts --- */\n:root {\n    /* --- Dark Theme (Default) --- */\n    --bg-dark-1: #121212;\n    --bg-dark-2: #1e1e1e;\n    --bg-dark-3: #2a2a2e;\n    --bg-dark-4: #333333;\n    --border-color: #444444;\n    --text-light: #e0e0e0;\n    --text-medium: #aaa;\n    --text-dark: #888;\n    \n    /* --- Semantic Colors --- */\n    --blue: #007bff;\n    --red: #e74c3c;\n    --yellow: #f1c40f;\n    --green: #2ecc71;\n    \n    /* --- Syntax & Node Colors --- */\n    --syntax-op: #c39eff;\n    --syntax-string: #e6db74;\n    --syntax-const-text: #ffffff; /* Constant white for dark buttons/nodes */\n    --node-bg-entry: #254a25;\n    --node-bg-api: #2a3e4a;\n    --node-bg-suspicious: #4a452a;\n    --node-bg-malicious: #4a2a2a;\n\n    --chart-legend-text: var(--text-light);  /* #e0e0e0 */\n    --chart-axes-text: var(--text-medium);   /* #aaa */\n    --chart-grid-line: var(--border-color);\n}\n\n/* --- Light Theme --- */\n/* Add \".light-theme\" to the <body> tag to activate */\nbody.light-theme {\n    --bg-dark-1: #f8f9fa;     /* Main background */\n    --bg-dark-2: #ffffff;     /* Card background */\n    --bg-dark-3: #e9ecef;     /* Hover/active background */\n    --bg-dark-4: #ced4da;     /* Secondary button background */\n    --border-color: #dee2e6;  /* Border color */\n    --text-light: #212529;    /* Main text */\n    --text-medium: #6c757d;   /* Secondary text */\n    --text-dark: #888;        /* Tertiary text (can stay gray) */\n    \n    /* Semantic colors are unchanged */\n    /* --blue, --red, --yellow, --green */\n    \n    /* --- Light Theme Syntax --- */\n    --syntax-op: #a040ff;       /* Darker purple */\n    --syntax-string: #b8860b;     /* Dark goldenrod */\n    --syntax-const-text: #ffffff; /* Stays white for colored buttons/nodes */\n    \n    /* Node backgrounds are unchanged, they look good on a light BG */\n    --chart-legend-text: var(--text-medium); /* User Request */\n    --chart-axes-text: var(--text-medium);   /* User Request */\n    --chart-grid-line: var(--border-color);\n}\n\n\n/* Apply overflow-x to html as well */\nhtml {\n    overflow-x: hidden;\n    font-size: 16px; /* Ensure base font size */\n}\n\nbody {\n    font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n    background-color: var(--bg-dark-1);\n    color: var(--text-light);\n    margin: 0;\n    padding-top: 60px; /* Make space for fixed top nav */\n    overflow-x: hidden; /* Prevent horizontal scroll */\n    width: 100%;\n    min-height: 100vh;\n}\n\n/* --- Main Grid Container --- */\n.main-container {\n    display: grid;\n    grid-template-columns: 1fr 1fr; /* Simpler 2-column definition */\n    grid-template-rows: auto auto; /* Rows for content and graph */\n    gap: 2rem;\n    padding: 2rem; /* Spacing from nav and screen edges */\n    align-items: start;\n    \n    /* Set max-width on the grid itself */\n    max-width: 1400px; \n    /* Center the whole grid */\n    margin: 0 auto; \n    \n    min-height: calc(100vh - 60px); /* Full height minus nav */\n    box-sizing: border-box;\n    width: 100%;\n}\n\n.scanner-wrapper {\n    grid-column: 1 / 2; /* Span first column */\n    grid-row: 1 / 2;\n    display: flex;\n    flex-direction: column;\n    gap: 1.5rem;\n    width: 100%; /* Fill the column */\n}\n\n.right-panel-wrapper {\n    grid-column: 2 / 3; /* Span second column */\n    grid-row: 1 / 2;\n    display: flex; /* Make it a flex container */\n    flex-direction: column; /* Stack its children vertically */\n    gap: 1.5rem; /* Space between its children */\n    width: 100%; /* Fill the column */\n}\n\n.graph-wrapper {\n    grid-column: 1 / 3; /* Span BOTH columns */\n    grid-row: 2 / 3;\n    width: 100%;\n    /* max-width is now inherited from main-container */\n    justify-self: center; /* Center in the grid area */\n}\n\n\n/* --- Top Navigation --- */\n.top-nav {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    height: 60px;\n    background-color: var(--bg-dark-2);\n    border-bottom: 1px solid var(--border-color);\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 0 2rem;\n    z-index: 1000;\n    box-sizing: border-box;\n}\n\n.top-nav .logo {\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n    font-size: 1.3rem;\n    font-weight: 600;\n    color: var(--text-light);\n}\n\n.top-nav .logo i {\n    color: var(--blue);\n}\n\n.nav-links {\n    display: flex;\n    gap: 0.5rem;\n}\n\n.nav-link {\n    color: var(--text-medium);\n    font-size: 1.25rem;\n    padding: 0.75rem;\n    border-radius: 8px;\n    transition: all 0.2s ease;\n    position: relative;\n    text-decoration: none;\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n}\n\n.nav-link .link-text {\n    font-size: 0.9rem;\n    font-weight: 500;\n    max-width: 0;\n    overflow: hidden;\n    white-space: nowrap;\n    transition: all 0.3s ease;\n}\n\n.nav-link:hover {\n    background-color: var(--bg-dark-3);\n    color: var(--text-light);\n}\n\n.nav-link:hover .link-text {\n    max-width: 80px; /* Expand text on hover */\n    margin-left: 0.25rem;\n}\n\n/* --- Tooltip --- */\n.nav-link:hover::before {\n    content: attr(data-tooltip);\n    position: absolute;\n    bottom: -35px;\n    left: 50%;\n    transform: translateX(-50%);\n    background-color: var(--bg-dark-3);\n    color: var(--text-light);\n    padding: 5px 10px;\n    border-radius: 4px;\n    font-size: 0.8rem;\n    white-space: nowrap;\n    opacity: 0;\n    transition: opacity 0.2s 0.3s; /* Delay tooltip */\n    pointer-events: none;\n}\n.nav-link:hover .link-text {\n    display: none; /* Hide expanded text if tooltip is showing */\n}\n.nav-link:hover:hover::before {\n    opacity: 1;\n}\n\n/* On smaller screens, stack the columns */\n@media (max-width: 1280px) { /* Widened breakpoint */\n    .main-container {\n        grid-template-columns: 1fr; /* Stack columns */\n        padding: 1rem;\n    }\n    .scanner-wrapper, .right-panel-wrapper, .graph-wrapper {\n        grid-column: 1 / 2; /* All in one column */\n        max-width: 100%;\n        justify-self: center;\n    }\n    .right-panel-wrapper {\n        grid-row: 2 / 3;\n    }\n    .graph-wrapper {\n        grid-row: 3 / 4;\n    }\n}\n\n/* Hide link text on very small screens */\n@media (max-width: 768px) {\n    .nav-link .link-text { display: none; }\n    .nav-link:hover .link-text { display: none; }\n    .top-nav { padding: 0 1rem; }\n}\n\n\n/* --- Main Scanner Box --- */\n.scanner-container {\n    width: 100%; /* Ensure it fills its flex parent */\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n    padding: 2.5rem;\n    text-align: center;\n    overflow: hidden;\n    transition: all 0.3s ease;\n    box-sizing: border-box; /* Include padding in width */\n}\n\nh1 {\n    color: var(--text-light);\n    margin-top: 0;\n    margin-bottom: 1rem;\n}\n\n.scanner-container p {\n    color: var(--text-medium);\n    margin-bottom: 2rem;\n    font-size: 1.1rem;\n}\n\n.scanner-state {\n    display: none;\n}\n.scanner-state.active {\n    display: block;\n}\n\n/* --- State 1: Upload --- */\n.upload-zone {\n    border: 2px dashed var(--border-color);\n    border-radius: 8px;\n    padding: 3rem 2rem;\n    cursor: pointer;\n    transition: all 0.3s ease;\n}\n.upload-zone:hover {\n    background-color: var(--bg-dark-3);\n    border-color: var(--blue);\n}\n.upload-icon {\n    font-size: 4rem;\n    color: var(--blue);\n    margin-bottom: 1rem;\n}\n.upload-zone h3 {\n    margin: 0;\n    color: var(--text-light);\n}\n.upload-zone span {\n    color: var(--text-dark);\n}\n\n/* --- State 2: Analyzing --- */\n.analyzing-icon .loader {\n    width: 80px;\n    height: 80px;\n    border: 6px solid var(--bg-dark-4);\n    border-top-color: var(--blue);\n    border-radius: 50%;\n    animation: spin 1s linear infinite;\n    margin: 2rem auto;\n}\n@keyframes spin {\n    to { transform: rotate(360deg); }\n}\n.analyzing-state h3 {\n    color: var(--text-light);\n    margin-bottom: 0.5rem;\n}\n.analyzing-state .filename,\n.result-state .filename {\n    color: var(--text-medium);\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 1.1rem;\n    word-break: break-all;\n}\n\n/* --- State 3: Result --- */\n.result-icon {\n    font-size: 6rem;\n    line-height: 1;\n    margin: 1.5rem 0;\n}\n.result-state h2 {\n    font-size: 2.5rem;\n    margin: 0 0 0.5rem 0;\n}\n.result-malware .result-icon, .result-malware h2 { color: var(--red); }\n.result-suspicious .result-icon, .result-suspicious h2 { color: var(--yellow); }\n.result-safe .result-icon, .result-safe h2 { color: var(--green); }\n.result-state p {\n    font-size: 1rem;\n    margin-bottom: 2rem;\n}\n\n/* --- Scan Navigation Controls --- */\n.scan-navigation {\n    display: none;\n    align-items: center;\n    justify-content: center;\n    gap: 1.5rem;\n    margin: 1.5rem 0;\n    padding: 1rem;\n    background: rgba(255, 255, 255, 0.03);\n    border-radius: 8px;\n}\n\n/* Show navigation only when results are displayed */\nbody.is-showing-result .scan-navigation,\nbody.is-non-pe .scan-navigation {\n    display: flex;\n}\n\n.nav-btn {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    padding: 0.75rem 1.5rem;\n    background: linear-gradient(135deg, var(--primary), var(--secondary));\n    color: white;\n    border: none;\n    border-radius: 8px;\n    font-size: 1rem;\n    font-weight: 600;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);\n}\n\n.nav-btn:hover:not(:disabled) {\n    transform: translateY(-2px);\n    box-shadow: 0 6px 20px rgba(139, 92, 246, 0.5);\n}\n\n.nav-btn:active:not(:disabled) {\n    transform: translateY(0);\n}\n\n.nav-btn:disabled {\n    background: rgba(255, 255, 255, 0.1) !important;\n    color: rgba(255, 255, 255, 0.3) !important;\n    cursor: not-allowed;\n    box-shadow: none !important;\n}\n\n.nav-info {\n    color: var(--text-medium);\n    font-size: 0.95rem;\n    font-weight: 500;\n    min-width: 80px;\n    text-align: center;\n}\n\n.non-pe-result {\n    display: none;\n    flex-direction: column;\n    align-items: center;\n    gap: 1.5rem;\n    color: var(--text-light);\n    padding: 1rem 0 0 0;\n}\n\n.non-pe-result.active {\n    display: flex;\n}\n\n.non-pe-icon {\n    width: 96px;\n    height: 96px;\n    border-radius: 24px;\n    background: linear-gradient(135deg, rgba(80, 130, 255, 0.2), rgba(80, 130, 255, 0.05));\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 3rem;\n    color: var(--blue);\n}\n\n.non-pe-hash-grid {\n    display: flex;\n    gap: 1.5rem;\n    flex-wrap: wrap;\n    justify-content: center;\n}\n\n.non-pe-hash {\n    min-width: 220px;\n    background: var(--bg-dark-3);\n    padding: 1rem 1.25rem;\n    border-radius: 12px;\n    border: 1px solid rgba(255, 255, 255, 0.05);\n    text-align: left;\n}\n\n.non-pe-hash h4 {\n    margin: 0 0 0.5rem 0;\n    font-size: 0.85rem;\n    text-transform: uppercase;\n    letter-spacing: 0.08rem;\n    color: var(--text-medium);\n}\n\n.non-pe-hash p {\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.9rem;\n    word-break: break-all;\n    color: var(--text-light);\n}\n\nbody.is-non-pe .analysis-details-container,\nbody.is-non-pe #analysis-details-wrapper,\nbody.is-non-pe #disassembly-wrapper,\nbody.is-non-pe #file-internals-wrapper,\nbody.is-non-pe #graph-wrapper {\n    display: none !important;\n}\n\nbody.is-non-pe #result-state {\n    display: none !important;\n}\n\nbody.is-non-pe .non-pe-result {\n    display: flex;\n}\n\n\n/* --- NEW: Stats Dashboard Panel --- */\n.stats-wrapper {\n    display: flex; \n    flex-direction: column;\n    gap: 1.5rem;\n    width: 100%; /* Fill its flex parent */\n    box-sizing: border-box; /* Include padding in width */\n}\n\n/* By default, stats are visible, disassembly is hidden */\n.disassembly-wrapper { display: none; }\n\n/* When analyzing/showing results, hide stats and show disassembly */\nbody.is-analyzing .stats-wrapper,\nbody.is-showing-result .stats-wrapper {\n    display: none;\n}\nbody.is-analyzing .disassembly-wrapper,\nbody.is-showing-result .disassembly-wrapper {\n    display: flex; /* Use flex to match its own styles */\n}\n\n\n.stats-grid {\n    display: flex; \n    flex-direction: column;\n    /* Force stacking */\n    gap: 1.5rem;\n}\n\n.stat-card {\n    display: flex;\n    align-items: center;\n    gap: 1.5rem;\n    background-color: var(--bg-dark-2);\n    padding: 1.5rem;\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n}\n.stat-card i {\n    font-size: 2.5rem;\n    color: var(--blue);\n}\n.stat-content {\n    display: flex;\n    flex-direction: column;\n}\n.stat-number {\n    font-size: 2rem;\n    font-weight: 600;\n    color: var(--text-light);\n    line-height: 1.2;\n}\n.stat-label {\n    font-size: 0.9rem;\n    color: var(--text-medium);\n}\n\n.chart-container-wrapper {\n    display: flex;\n    flex-direction: column;\n    gap: 1.5rem;\n}\n\n.chart-container {\n    background-color: var(--bg-dark-2);\n    padding: 1.5rem;\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    box-sizing: border-box;\n}\n.chart-container h3 {\n    margin-top: 0;\n    margin-bottom: 1.5rem;\n    text-align: center;\n    color: var(--text-light);\n    font-size: 1.1rem;\n}\n\n\n/* --- Disassembly Panel --- */\n.disassembly-wrapper {\n    /* display: none; set by default now */\n    flex-direction: column;\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n    height: 600px; /* Fixed height */\n    max-height: 70vh;\n    opacity: 0;\n    transition: all 0.3s ease;\n    width: 100%;\n    box-sizing: border-box;\n}\n\nbody.is-analyzing .disassembly-wrapper,\nbody.is-showing-result .disassembly-wrapper {\n    opacity: 1;\n}\n\n.disassembly-header {\n    padding: 1rem 1.5rem;\n    border-bottom: 1px solid var(--border-color);\n    background-color: var(--bg-dark-3);\n    border-radius: 12px 12px 0 0;\n}\n.disassembly-header h3 {\n    margin: 0;\n    color: var(--text-light);\n    font-size: 1.1rem;\n    font-family: 'Courier New', Courier, monospace;\n}\n.disassembly-code {\n    flex-grow: 1;\n    overflow-y: auto;\n    padding: 1rem;\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.95rem;\n}\n.disassembly-line {\n    display: block;\n    padding: 2px 1rem;\n    border-radius: 4px;\n    transition: background-color 0.2s ease;\n}\n.disassembly-line.active {\n    background-color: var(--blue);\n    color: var(--syntax-const-text); /* MODIFIED */\n}\n.disassembly-line .addr { color: var(--text-dark); margin-right: 1rem; }\n.disassembly-line .op { color: var(--syntax-op); font-weight: bold; width: 50px; display: inline-block; } /* MODIFIED */\n.disassembly-line .args { color: var(--text-light); }\n.disassembly-line .string { color: var(--syntax-string); } /* MODIFIED */\n.disassembly-line .comment { color: var(--green); margin-left: 1rem; }\n\n\n/* --- Analysis Details Panel --- */\n.analysis-details-container {\n    width: 100%;\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    padding: 2rem;\n    display: none; /* Hidden by default */\n    box-sizing: border-box;\n}\nbody.is-showing-result .analysis-details-container {\n    display: block;\n}\n\n.progress-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 0.75rem;\n}\n.progress-header h3 {\n    margin: 0;\n    font-size: 1.1rem;\n    color: var(--text-light);\n}\n.score-percentage {\n    font-size: 1.2rem;\n    font-weight: 600;\n}\n.score-green { color: var(--green); }\n.score-yellow { color: var(--yellow); }\n.score-red { color: var(--red); }\n\n.progress-bar-background {\n    width: 100%;\n    height: 12px;\n    background-color: var(--bg-dark-3);\n    border-radius: 6px;\n    overflow: hidden;\n    margin-bottom: 1.5rem;\n}\n.progress-bar-fill {\n    height: 100%;\n    width: 0%;\n    border-radius: 6px;\n    transition: width 0.5s ease;\n}\n.progress-bar-green { background-color: var(--green); }\n.progress-bar-yellow { background-color: var(--yellow); }\n.progress-bar-red { background-color: var(--red); }\n\n.details-section {\n    margin-bottom: 1.25rem;\n}\n.details-section h4 {\n    margin: 0 0 0.5rem 0;\n    color: var(--text-medium);\n    font-size: 0.9rem;\n    text-transform: uppercase;\n}\n.details-section p {\n    margin: 0;\n    color: var(--text-light);\n    font-size: 1rem;\n}\n.hash-text {\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.95rem;\n    word-break: break-all;\n}\n\n/* --- Vendor & Signature --- */\n.details-grid {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 1.5rem;\n    margin-bottom: 1.25rem;\n}\n.vendor-info, .signature-info {\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n    font-size: 1rem;\n    font-weight: 500;\n}\n.vendor-info i {\n    font-size: 1.5rem;\n    color: var(--text-medium);\n}\n.signature-info i {\n    font-size: 1.25rem;\n}\n/* Use the levels from datasrcs.js */\n.sig-verified { color: var(--green); }\n.sig-untrusted { color: var(--red); }\n.sig-unknown { color: var(--yellow); }\n\n/* --- File Internals Card --- */\n.file-internals-container {\n    width: 100%;\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    padding: 2rem;\n    display: none; /* Hidden by default */\n    box-sizing: border-box;\n    flex-direction: column;\n    gap: 1.5rem;\n}\nbody.is-showing-result .file-internals-container {\n    display: flex;\n}\n.file-internals-container h3 {\n    margin-top: 0;\n    margin-bottom: 0;\n    color: var(--text-light);\n    font-size: 1.25rem;\n    padding-bottom: 1rem;\n    border-bottom: 1px solid var(--border-color);\n}\n\n/* --- Entropy Bars --- */\n.entropy-bars {\n    display: flex;\n    flex-direction: column;\n    gap: 0.75rem;\n}\n.entropy-bar-row {\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n}\n.entropy-bar-label {\n    width: 60px;\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.9rem;\n    color: var(--text-medium);\n    flex-shrink: 0;\n}\n.entropy-bar-bg {\n    flex-grow: 1;\n    height: 20px;\n    background-color: var(--bg-dark-3);\n    border-radius: 4px;\n    overflow: hidden;\n}\n.entropy-bar-fill {\n    height: 100%;\n    width: 0%; /* Set by JS */\n    background-color: var(--blue);\n    border-radius: 4px;\n    transition: width 0.5s ease;\n    display: flex;\n    justify-content: flex-end;\n    align-items: center;\n    padding-right: 0.5rem;\n    box-sizing: border-box;\n}\n.entropy-bar-value {\n    font-size: 0.8rem;\n    font-weight: bold;\n    color: var(--syntax-const-text); /* MODIFIED */\n    text-shadow: 0 0 3px rgba(0,0,0,0.5);\n}\n/* Color coding for entropy bars */\n.entropy-bar-fill.low { background-color: var(--green); }\n.entropy-bar-fill.medium { background-color: var(--blue); }\n.entropy-bar-fill.high { background-color: var(--yellow); }\n.entropy-bar-fill.packed { background-color: var(--red); }\n\n/* --- Key Strings --- */\n.key-strings {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 0.5rem;\n}\n.key-string-tag {\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.9rem;\n    background-color: var(--bg-dark-3);\n    border: 1px solid var(--border-color);\n    padding: 0.25rem 0.5rem;\n    border-radius: 4px;\n    color: var(--text-light);\n}\n.key-string-tag.suspicious {\n    border-color: var(--red);\n    color: var(--red);\n    background-color: #e74c3c1a;\n}\n.key-string-tag.benign {\n    border-color: var(--green);\n    color: var(--green);\n    background-color: #2ecc711a;\n}\n\n/* --- Buttons --- */\n.btn-wrapper {\n    margin-top: 2rem;\n    display: flex;\n    gap: 1rem;\n}\n.btn {\n    flex-grow: 1; /* Make buttons fill space */\n    background-color: var(--blue);\n    color: var(--syntax-const-text); /* MODIFIED */\n    border: none;\n    padding: 12px 24px;\n    border-radius: 6px;\n    font-size: 1rem;\n    font-weight: bold;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    text-decoration: none;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    gap: 0.5rem;\n}\n.btn:hover {\n    filter: brightness(1.2);\n}\n.btn-primary {\n    background-color: var(--blue);\n}\n.btn-secondary {\n    background-color: var(--bg-dark-4);\n    color: var(--text-light);\n}\n.btn-secondary:hover {\n    background-color: #555;\n}\n.btn i {\n    margin-right: 0.25rem;\n}\n\n\n/* --- Background Particle Animations --- */\n.animation-swarm {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%; \n    height: 100%;\n    z-index: -1;\n    pointer-events: none;\n    overflow: hidden; \n}\n\n/* Base style for each new span particle */\n.animation-swarm span {\n    position: absolute;\n    top: -20px; /* Start off-screen */\n    font-size: 1.5rem;\n    opacity: 0; /* Start invisible */\n    animation: fall 10s linear infinite;\n}\n\n/* The ::before holds the icon content */\n.animation-swarm span::before {\n    content: '';\n    font-family: \"Font Awesome 6 Free\";\n    font-weight: 900;\n    text-shadow: 0 0 5px;\n}\n\n/* Keyframes for falling (starts with opacity) */\n@keyframes fall {\n    0% {\n        transform: translateY(0vh) rotate(0);\n        opacity: 0.3;\n    }\n    100% {\n        transform: translateY(105vh) rotate(360deg);\n        opacity: 0;\n    }\n}\n\n/* Set icon and color based on body class */\nbody.result-safe-active .animation-swarm span::before {\n    content: '\\f132'; /* fa-shield-halved */\n    color: var(--green);\n}\nbody.result-suspicious-active .animation-swarm span::before {\n    content: '\\f071'; /* fa-exclamation-triangle */\n    color: var(--yellow);\n}\nbody.result-malware-active .animation-swarm span::before {\n    content: '\\f188'; /* fa-bug */\n    color: var(--red);\n}\n\n/* Give each particle a unique position and delay --- THIS IS THE FINAL FIX --- */\n/* All values are kept well away from the 90-100% range */\n.animation-swarm span:nth-child(1) { left: 10%; animation-delay: 0s; }\n.animation-swarm span:nth-child(2) { left: 20%; animation-delay: -2s; }\n.animation-swarm span:nth-child(3) { left: 30%; animation-delay: -4s; }\n.animation-swarm span:nth-child(4) { left: 40%; animation-delay: -6s; }\n.animation-swarm span:nth-child(5) { left: 50%; animation-delay: -8s; }\n.animation-swarm span:nth-child(6) { left: 60%; animation-delay: -1s; }\n.animation-swarm span:nth-child(7) { left: 70%; animation-delay: -3s; }\n.animation-swarm span:nth-child(8) { left: 75%; animation-delay: -5s; } /* Was 80% */\n.animation-swarm span:nth-child(9) { left: 15%; animation-delay: -7s; } /* Was 90% */\n.animation-swarm span:nth-child(10) { left: 5%; animation-delay: -9s; }\n\n\n/* --- History Panel --- */\n.history-overlay {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0,0,0,0.5);\n    z-index: 1001;\n    opacity: 0;\n    visibility: hidden;\n    transition: all 0.3s ease;\n}\n.history-panel {\n    position: fixed;\n    top: 0;\n    right: -450px; /* Start off-screen */\n    width: 400px;\n    max-width: 90%;\n    height: 100%;\n    background-color: var(--bg-dark-2);\n    z-index: 1002;\n    transition: all 0.3s ease;\n    display: flex;\n    flex-direction: column;\n}\nbody.is-history-open .history-overlay {\n    opacity: 1;\n    visibility: visible;\n}\nbody.is-history-open .history-panel {\n    right: 0;\n}\n.history-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 1rem 1.5rem;\n    border-bottom: 1px solid var(--border-color);\n}\n.history-header h3 {\n    margin: 0;\n    font-size: 1.2rem;\n}\n.history-close-btn {\n    background: none;\n    border: none;\n    color: var(--text-medium);\n    font-size: 1.5rem;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n.history-close-btn:hover {\n    color: var(--text-light);\n}\n.history-list {\n    list-style: none;\n    padding: 0;\n    margin: 0;\n    overflow-y: auto;\n    flex-grow: 1;\n}\n.history-list li {\n    display: flex;\n    align-items: center;\n    gap: 1rem;\n    padding: 1rem 1.5rem;\n    border-bottom: 1px solid var(--border-color);\n    transition: background-color 0.2s ease;\n}\n\n.history-list li:hover {\n    background-color: var(--bg-dark-3);\n}\n\n.history-item {\n    display: flex;\n    align-items: flex-start;\n    gap: 1rem;\n}\n\n.history-icon-wrapper {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 0.5rem;\n    min-width: 60px;\n}\n\n.history-icon {\n    font-size: 1.8rem;\n    width: 40px;\n    height: 40px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    border-radius: 8px;\n    background-color: var(--bg-dark-3);\n}\n\n.history-icon.safe {\n    color: var(--green);\n    border: 2px solid var(--green);\n}\n\n.history-icon.suspicious {\n    color: var(--yellow);\n    border: 2px solid var(--yellow);\n}\n\n.history-icon.malware {\n    color: var(--red);\n    border: 2px solid var(--red);\n}\n\n.history-file-type {\n    font-size: 1rem;\n    color: var(--text-medium);\n}\n\n.history-details {\n    flex-grow: 1;\n    display: flex;\n    flex-direction: column;\n    gap: 0.5rem;\n    min-width: 0; /* Allow text truncation */\n}\n\n.history-filename {\n    font-weight: 600;\n    color: var(--text-light);\n    font-size: 0.95rem;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.history-classification {\n    font-size: 0.85rem;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.05em;\n}\n\n.history-classification.safe {\n    color: var(--green);\n}\n\n.history-classification.suspicious {\n    color: var(--yellow);\n}\n\n.history-classification.malware {\n    color: var(--red);\n}\n\n.history-hash {\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.75rem;\n    color: var(--text-medium);\n    background-color: var(--bg-dark-3);\n    padding: 0.25rem 0.5rem;\n    border-radius: 4px;\n    word-break: break-all;\n    line-height: 1.4;\n}\n\n.history-date {\n    font-size: 0.8rem;\n    color: var(--text-medium);\n    white-space: nowrap;\n    align-self: flex-start;\n    padding-top: 0.25rem;\n}\n\n.history-item-empty,\n.history-item-loading {\n    color: var(--text-medium);\n    text-align: center;\n    padding: 2rem;\n    font-style: italic;\n}\n\n\n/* --- Hover Scroll Zones --- */\n.scroll-zone {\n    position: fixed;\n    left: 0;\n    width: 100%;\n    height: 80px;\n    z-index: 998;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n}\n.scroll-zone.top { top: 60px; /* Below nav */ }\n.scroll-zone.bottom { bottom: 0; }\n\n.scroll-zone i {\n    font-size: 2rem;\n    color: var(--text-light);\n    opacity: 0;\n    transition: all 0.3s ease;\n    text-shadow: 0 0 15px rgba(0,0,0,0.7);\n}\n.scroll-zone.scrolling i {\n    opacity: 0.3;\n}\n.scroll-zone:hover i {\n    opacity: 0.7;\n}\n\n\n/* --- Graph Panel --- */\n.graph-wrapper {\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n    margin-top: 1rem;\n    display: none; /* Hidden by default */\n    box-sizing: border-box;\n}\nbody.is-showing-result .graph-wrapper {\n    display: block; /* Show with results */\n}\n\n.graph-header {\n    padding: 1rem 1.5rem;\n    border-bottom: 1px solid var(--border-color);\n    background-color: var(--bg-dark-3);\n    border-radius: 12px 12px 0 0;\n}\n.graph-header h3 {\n    margin: 0;\n    color: var(--text-light);\n    font-size: 1.1rem;\n}\n.call-graph-container {\n    overflow: auto; /* Allow scrolling for large graphs */\n}\n.call-graph {\n    flex-grow: 1;\n    overflow: auto;\n    position: relative; /* KEY for node positioning */\n    min-height: 400px;\n    padding: 1rem;\n}\n\n.graph-node {\n    position: absolute;\n    padding: 0.75rem 1.25rem;\n    border-radius: 8px;\n    background-color: var(--bg-dark-3);\n    border: 2px solid var(--border-color);\n    font-family: 'Courier New', Courier, monospace;\n    font-weight: bold;\n    white-space: nowrap;\n    box-shadow: 0 4px 10px rgba(0,0,0,0.3);\n    z-index: 2;\n    text-align: center;\n}\n/* MODIFIED to use variables */\n.node-entry { background-color: var(--node-bg-entry); border-color: var(--green); color: var(--syntax-const-text); }\n.node-std { background-color: var(--bg-dark-3); border-color: var(--border-color); color: var(--text-light); }\n.node-api { background-color: var(--node-bg-api); border-color: var(--blue); color: var(--syntax-const-text); }\n.node-suspicious { background-color: var(--node-bg-suspicious); border-color: var(--yellow); color: var(--syntax-const-text); }\n.node-malicious { background-color: var(--node-bg-malicious); border-color: var(--red); color: var(--syntax-const-text); }\n\n.leader-line {\n    z-index: 1; /* Sit behind nodes */\n    opacity: 0.8;\n}\nbody.light-theme .chart-container {\n    color: var(--text-medium);\n}\n\n/* Light theme navigation buttons */\nbody.light-theme .nav-btn {\n    background: linear-gradient(135deg, var(--primary), var(--secondary));\n    color: white;\n    box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);\n}\n\nbody.light-theme .nav-btn:hover:not(:disabled) {\n    box-shadow: 0 6px 20px rgba(139, 92, 246, 0.6);\n}\n\nbody.light-theme .nav-btn:disabled {\n    background: var(--bg-dark-3) !important;\n    color: var(--text-dark) !important;\n    box-shadow: none !important;\n}\n\nbody.light-theme .nav-info {\n    color: var(--text-light);\n    font-weight: 600;\n}\n\nbody.light-theme .scan-navigation {\n    border-top-color: var(--border-color);\n}\n","epoch":129,"telemetryInfo":{}}],["file:///home/trang/localnsv/mAIware/style.css::request_d367970c-4c33-4139-8cfb-aed7f33ec476",{"uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/style.css","external":"file:///home/trang/localnsv/mAIware/style.css","path":"/home/trang/localnsv/mAIware/style.css","scheme":"file"},"requestId":"request_d367970c-4c33-4139-8cfb-aed7f33ec476","content":"/* --- Global & Fonts --- */\n:root {\n    /* --- Dark Theme (Default) --- */\n    --bg-dark-1: #121212;\n    --bg-dark-2: #1e1e1e;\n    --bg-dark-3: #2a2a2e;\n    --bg-dark-4: #333333;\n    --border-color: #444444;\n    --text-light: #e0e0e0;\n    --text-medium: #aaa;\n    --text-dark: #888;\n    \n    /* --- Semantic Colors --- */\n    --blue: #007bff;\n    --red: #e74c3c;\n    --yellow: #f1c40f;\n    --green: #2ecc71;\n    \n    /* --- Syntax & Node Colors --- */\n    --syntax-op: #c39eff;\n    --syntax-string: #e6db74;\n    --syntax-const-text: #ffffff; /* Constant white for dark buttons/nodes */\n    --node-bg-entry: #254a25;\n    --node-bg-api: #2a3e4a;\n    --node-bg-suspicious: #4a452a;\n    --node-bg-malicious: #4a2a2a;\n\n    --chart-legend-text: var(--text-light);  /* #e0e0e0 */\n    --chart-axes-text: var(--text-medium);   /* #aaa */\n    --chart-grid-line: var(--border-color);\n}\n\n/* --- Light Theme --- */\n/* Add \".light-theme\" to the <body> tag to activate */\nbody.light-theme {\n    --bg-dark-1: #f8f9fa;     /* Main background */\n    --bg-dark-2: #ffffff;     /* Card background */\n    --bg-dark-3: #e9ecef;     /* Hover/active background */\n    --bg-dark-4: #ced4da;     /* Secondary button background */\n    --border-color: #dee2e6;  /* Border color */\n    --text-light: #212529;    /* Main text */\n    --text-medium: #6c757d;   /* Secondary text */\n    --text-dark: #888;        /* Tertiary text (can stay gray) */\n    \n    /* Semantic colors are unchanged */\n    /* --blue, --red, --yellow, --green */\n    \n    /* --- Light Theme Syntax --- */\n    --syntax-op: #a040ff;       /* Darker purple */\n    --syntax-string: #b8860b;     /* Dark goldenrod */\n    --syntax-const-text: #ffffff; /* Stays white for colored buttons/nodes */\n    \n    /* Node backgrounds are unchanged, they look good on a light BG */\n    --chart-legend-text: var(--text-medium); /* User Request */\n    --chart-axes-text: var(--text-medium);   /* User Request */\n    --chart-grid-line: var(--border-color);\n}\n\n\n/* Apply overflow-x to html as well */\nhtml {\n    overflow-x: hidden;\n    font-size: 16px; /* Ensure base font size */\n}\n\nbody {\n    font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n    background-color: var(--bg-dark-1);\n    color: var(--text-light);\n    margin: 0;\n    padding-top: 60px; /* Make space for fixed top nav */\n    overflow-x: hidden; /* Prevent horizontal scroll */\n    width: 100%;\n    min-height: 100vh;\n}\n\n/* --- Main Grid Container --- */\n.main-container {\n    display: grid;\n    grid-template-columns: 1fr 1fr; /* Simpler 2-column definition */\n    grid-template-rows: auto auto; /* Rows for content and graph */\n    gap: 2rem;\n    padding: 2rem; /* Spacing from nav and screen edges */\n    align-items: start;\n    \n    /* Set max-width on the grid itself */\n    max-width: 1400px; \n    /* Center the whole grid */\n    margin: 0 auto; \n    \n    min-height: calc(100vh - 60px); /* Full height minus nav */\n    box-sizing: border-box;\n    width: 100%;\n}\n\n.scanner-wrapper {\n    grid-column: 1 / 2; /* Span first column */\n    grid-row: 1 / 2;\n    display: flex;\n    flex-direction: column;\n    gap: 1.5rem;\n    width: 100%; /* Fill the column */\n}\n\n.right-panel-wrapper {\n    grid-column: 2 / 3; /* Span second column */\n    grid-row: 1 / 2;\n    display: flex; /* Make it a flex container */\n    flex-direction: column; /* Stack its children vertically */\n    gap: 1.5rem; /* Space between its children */\n    width: 100%; /* Fill the column */\n}\n\n.graph-wrapper {\n    grid-column: 1 / 3; /* Span BOTH columns */\n    grid-row: 2 / 3;\n    width: 100%;\n    /* max-width is now inherited from main-container */\n    justify-self: center; /* Center in the grid area */\n}\n\n\n/* --- Top Navigation --- */\n.top-nav {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    height: 60px;\n    background-color: var(--bg-dark-2);\n    border-bottom: 1px solid var(--border-color);\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 0 2rem;\n    z-index: 1000;\n    box-sizing: border-box;\n}\n\n.top-nav .logo {\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n    font-size: 1.3rem;\n    font-weight: 600;\n    color: var(--text-light);\n}\n\n.top-nav .logo i {\n    color: var(--blue);\n}\n\n.nav-links {\n    display: flex;\n    gap: 0.5rem;\n}\n\n.nav-link {\n    color: var(--text-medium);\n    font-size: 1.25rem;\n    padding: 0.75rem;\n    border-radius: 8px;\n    transition: all 0.2s ease;\n    position: relative;\n    text-decoration: none;\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n}\n\n.nav-link .link-text {\n    font-size: 0.9rem;\n    font-weight: 500;\n    max-width: 0;\n    overflow: hidden;\n    white-space: nowrap;\n    transition: all 0.3s ease;\n}\n\n.nav-link:hover {\n    background-color: var(--bg-dark-3);\n    color: var(--text-light);\n}\n\n.nav-link:hover .link-text {\n    max-width: 80px; /* Expand text on hover */\n    margin-left: 0.25rem;\n}\n\n/* --- Tooltip --- */\n.nav-link:hover::before {\n    content: attr(data-tooltip);\n    position: absolute;\n    bottom: -35px;\n    left: 50%;\n    transform: translateX(-50%);\n    background-color: var(--bg-dark-3);\n    color: var(--text-light);\n    padding: 5px 10px;\n    border-radius: 4px;\n    font-size: 0.8rem;\n    white-space: nowrap;\n    opacity: 0;\n    transition: opacity 0.2s 0.3s; /* Delay tooltip */\n    pointer-events: none;\n}\n.nav-link:hover .link-text {\n    display: none; /* Hide expanded text if tooltip is showing */\n}\n.nav-link:hover:hover::before {\n    opacity: 1;\n}\n\n/* On smaller screens, stack the columns */\n@media (max-width: 1280px) { /* Widened breakpoint */\n    .main-container {\n        grid-template-columns: 1fr; /* Stack columns */\n        padding: 1rem;\n    }\n    .scanner-wrapper, .right-panel-wrapper, .graph-wrapper {\n        grid-column: 1 / 2; /* All in one column */\n        max-width: 100%;\n        justify-self: center;\n    }\n    .right-panel-wrapper {\n        grid-row: 2 / 3;\n    }\n    .graph-wrapper {\n        grid-row: 3 / 4;\n    }\n}\n\n/* Hide link text on very small screens */\n@media (max-width: 768px) {\n    .nav-link .link-text { display: none; }\n    .nav-link:hover .link-text { display: none; }\n    .top-nav { padding: 0 1rem; }\n}\n\n\n/* --- Main Scanner Box --- */\n.scanner-container {\n    width: 100%; /* Ensure it fills its flex parent */\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n    padding: 2.5rem;\n    text-align: center;\n    overflow: hidden;\n    transition: all 0.3s ease;\n    box-sizing: border-box; /* Include padding in width */\n}\n\nh1 {\n    color: var(--text-light);\n    margin-top: 0;\n    margin-bottom: 1rem;\n}\n\n.scanner-container p {\n    color: var(--text-medium);\n    margin-bottom: 2rem;\n    font-size: 1.1rem;\n}\n\n.scanner-state {\n    display: none;\n}\n.scanner-state.active {\n    display: block;\n}\n\n/* --- State 1: Upload --- */\n.upload-zone {\n    border: 2px dashed var(--border-color);\n    border-radius: 8px;\n    padding: 3rem 2rem;\n    cursor: pointer;\n    transition: all 0.3s ease;\n}\n.upload-zone:hover {\n    background-color: var(--bg-dark-3);\n    border-color: var(--blue);\n}\n.upload-icon {\n    font-size: 4rem;\n    color: var(--blue);\n    margin-bottom: 1rem;\n}\n.upload-zone h3 {\n    margin: 0;\n    color: var(--text-light);\n}\n.upload-zone span {\n    color: var(--text-dark);\n}\n\n/* --- State 2: Analyzing --- */\n.analyzing-icon .loader {\n    width: 80px;\n    height: 80px;\n    border: 6px solid var(--bg-dark-4);\n    border-top-color: var(--blue);\n    border-radius: 50%;\n    animation: spin 1s linear infinite;\n    margin: 2rem auto;\n}\n@keyframes spin {\n    to { transform: rotate(360deg); }\n}\n.analyzing-state h3 {\n    color: var(--text-light);\n    margin-bottom: 0.5rem;\n}\n.analyzing-state .filename,\n.result-state .filename {\n    color: var(--text-medium);\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 1.1rem;\n    word-break: break-all;\n}\n\n/* --- State 3: Result --- */\n.result-icon {\n    font-size: 6rem;\n    line-height: 1;\n    margin: 1.5rem 0;\n}\n.result-state h2 {\n    font-size: 2.5rem;\n    margin: 0 0 0.5rem 0;\n}\n.result-malware .result-icon, .result-malware h2 { color: var(--red); }\n.result-suspicious .result-icon, .result-suspicious h2 { color: var(--yellow); }\n.result-safe .result-icon, .result-safe h2 { color: var(--green); }\n.result-state p {\n    font-size: 1rem;\n    margin-bottom: 2rem;\n}\n\n/* --- Scan Navigation Controls --- */\n.scan-navigation {\n    display: none;\n    align-items: center;\n    justify-content: center;\n    gap: 1.5rem;\n    margin: 1.5rem 0;\n    padding: 1rem;\n    background: rgba(255, 255, 255, 0.03);\n    border-radius: 8px;\n}\n\n/* Show navigation only when results are displayed */\nbody.is-showing-result .scan-navigation,\nbody.is-non-pe .scan-navigation {\n    display: flex;\n}\n\n.nav-btn {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    padding: 0.75rem 1.5rem;\n    background: linear-gradient(135deg, var(--primary), var(--secondary));\n    color: white;\n    border: none;\n    border-radius: 8px;\n    font-size: 1rem;\n    font-weight: 600;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);\n}\n\n.nav-btn:hover:not(:disabled) {\n    transform: translateY(-2px);\n    box-shadow: 0 6px 20px rgba(139, 92, 246, 0.5);\n}\n\n.nav-btn:active:not(:disabled) {\n    transform: translateY(0);\n}\n\n.nav-btn:disabled {\n    background: rgba(255, 255, 255, 0.1) !important;\n    color: rgba(255, 255, 255, 0.3) !important;\n    cursor: not-allowed;\n    box-shadow: none !important;\n}\n\n.nav-info {\n    color: var(--text-medium);\n    font-size: 0.95rem;\n    font-weight: 500;\n    min-width: 80px;\n    text-align: center;\n}\n\n.non-pe-result {\n    display: none;\n    flex-direction: column;\n    align-items: center;\n    gap: 1.5rem;\n    color: var(--text-light);\n    padding: 1rem 0 0 0;\n}\n\n.non-pe-result.active {\n    display: flex;\n}\n\n.non-pe-icon {\n    width: 96px;\n    height: 96px;\n    border-radius: 24px;\n    background: linear-gradient(135deg, rgba(80, 130, 255, 0.2), rgba(80, 130, 255, 0.05));\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 3rem;\n    color: var(--blue);\n}\n\n.non-pe-hash-grid {\n    display: flex;\n    gap: 1.5rem;\n    flex-wrap: wrap;\n    justify-content: center;\n}\n\n.non-pe-hash {\n    min-width: 220px;\n    background: var(--bg-dark-3);\n    padding: 1rem 1.25rem;\n    border-radius: 12px;\n    border: 1px solid rgba(255, 255, 255, 0.05);\n    text-align: left;\n}\n\n.non-pe-hash h4 {\n    margin: 0 0 0.5rem 0;\n    font-size: 0.85rem;\n    text-transform: uppercase;\n    letter-spacing: 0.08rem;\n    color: var(--text-medium);\n}\n\n.non-pe-hash p {\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.9rem;\n    word-break: break-all;\n    color: var(--text-light);\n}\n\nbody.is-non-pe .analysis-details-container,\nbody.is-non-pe #analysis-details-wrapper,\nbody.is-non-pe #disassembly-wrapper,\nbody.is-non-pe #file-internals-wrapper,\nbody.is-non-pe #graph-wrapper {\n    display: none !important;\n}\n\nbody.is-non-pe #result-state {\n    display: none !important;\n}\n\nbody.is-non-pe .non-pe-result {\n    display: flex;\n}\n\n\n/* --- NEW: Stats Dashboard Panel --- */\n.stats-wrapper {\n    display: flex; \n    flex-direction: column;\n    gap: 1.5rem;\n    width: 100%; /* Fill its flex parent */\n    box-sizing: border-box; /* Include padding in width */\n}\n\n/* By default, stats are visible, disassembly is hidden */\n.disassembly-wrapper { display: none; }\n\n/* When analyzing/showing results, hide stats and show disassembly */\nbody.is-analyzing .stats-wrapper,\nbody.is-showing-result .stats-wrapper {\n    display: none;\n}\nbody.is-analyzing .disassembly-wrapper,\nbody.is-showing-result .disassembly-wrapper {\n    display: flex; /* Use flex to match its own styles */\n}\n\n\n.stats-grid {\n    display: flex; \n    flex-direction: column;\n    /* Force stacking */\n    gap: 1.5rem;\n}\n\n.stat-card {\n    display: flex;\n    align-items: center;\n    gap: 1.5rem;\n    background-color: var(--bg-dark-2);\n    padding: 1.5rem;\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n}\n.stat-card i {\n    font-size: 2.5rem;\n    color: var(--blue);\n}\n.stat-content {\n    display: flex;\n    flex-direction: column;\n}\n.stat-number {\n    font-size: 2rem;\n    font-weight: 600;\n    color: var(--text-light);\n    line-height: 1.2;\n}\n.stat-label {\n    font-size: 0.9rem;\n    color: var(--text-medium);\n}\n\n.chart-container-wrapper {\n    display: flex;\n    flex-direction: column;\n    gap: 1.5rem;\n}\n\n.chart-container {\n    background-color: var(--bg-dark-2);\n    padding: 1.5rem;\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    box-sizing: border-box;\n}\n.chart-container h3 {\n    margin-top: 0;\n    margin-bottom: 1.5rem;\n    text-align: center;\n    color: var(--text-light);\n    font-size: 1.1rem;\n}\n\n\n/* --- Disassembly Panel --- */\n.disassembly-wrapper {\n    /* display: none; set by default now */\n    flex-direction: column;\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n    height: 600px; /* Fixed height */\n    max-height: 70vh;\n    opacity: 0;\n    transition: all 0.3s ease;\n    width: 100%;\n    box-sizing: border-box;\n}\n\nbody.is-analyzing .disassembly-wrapper,\nbody.is-showing-result .disassembly-wrapper {\n    opacity: 1;\n}\n\n.disassembly-header {\n    padding: 1rem 1.5rem;\n    border-bottom: 1px solid var(--border-color);\n    background-color: var(--bg-dark-3);\n    border-radius: 12px 12px 0 0;\n}\n.disassembly-header h3 {\n    margin: 0;\n    color: var(--text-light);\n    font-size: 1.1rem;\n    font-family: 'Courier New', Courier, monospace;\n}\n.disassembly-code {\n    flex-grow: 1;\n    overflow-y: auto;\n    padding: 1rem;\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.95rem;\n}\n.disassembly-line {\n    display: block;\n    padding: 2px 1rem;\n    border-radius: 4px;\n    transition: background-color 0.2s ease;\n}\n.disassembly-line.active {\n    background-color: var(--blue);\n    color: var(--syntax-const-text); /* MODIFIED */\n}\n.disassembly-line .addr { color: var(--text-dark); margin-right: 1rem; }\n.disassembly-line .op { color: var(--syntax-op); font-weight: bold; width: 50px; display: inline-block; } /* MODIFIED */\n.disassembly-line .args { color: var(--text-light); }\n.disassembly-line .string { color: var(--syntax-string); } /* MODIFIED */\n.disassembly-line .comment { color: var(--green); margin-left: 1rem; }\n\n\n/* --- Analysis Details Panel --- */\n.analysis-details-container {\n    width: 100%;\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    padding: 2rem;\n    display: none; /* Hidden by default */\n    box-sizing: border-box;\n}\nbody.is-showing-result .analysis-details-container {\n    display: block;\n}\n\n.progress-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 0.75rem;\n}\n.progress-header h3 {\n    margin: 0;\n    font-size: 1.1rem;\n    color: var(--text-light);\n}\n.score-percentage {\n    font-size: 1.2rem;\n    font-weight: 600;\n}\n.score-green { color: var(--green); }\n.score-yellow { color: var(--yellow); }\n.score-red { color: var(--red); }\n\n.progress-bar-background {\n    width: 100%;\n    height: 12px;\n    background-color: var(--bg-dark-3);\n    border-radius: 6px;\n    overflow: hidden;\n    margin-bottom: 1.5rem;\n}\n.progress-bar-fill {\n    height: 100%;\n    width: 0%;\n    border-radius: 6px;\n    transition: width 0.5s ease;\n}\n.progress-bar-green { background-color: var(--green); }\n.progress-bar-yellow { background-color: var(--yellow); }\n.progress-bar-red { background-color: var(--red); }\n\n.details-section {\n    margin-bottom: 1.25rem;\n}\n.details-section h4 {\n    margin: 0 0 0.5rem 0;\n    color: var(--text-medium);\n    font-size: 0.9rem;\n    text-transform: uppercase;\n}\n.details-section p {\n    margin: 0;\n    color: var(--text-light);\n    font-size: 1rem;\n}\n.hash-text {\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.95rem;\n    word-break: break-all;\n}\n\n/* --- Vendor & Signature --- */\n.details-grid {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 1.5rem;\n    margin-bottom: 1.25rem;\n}\n.vendor-info, .signature-info {\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n    font-size: 1rem;\n    font-weight: 500;\n}\n.vendor-info i {\n    font-size: 1.5rem;\n    color: var(--text-medium);\n}\n.signature-info i {\n    font-size: 1.25rem;\n}\n/* Use the levels from datasrcs.js */\n.sig-verified { color: var(--green); }\n.sig-untrusted { color: var(--red); }\n.sig-unknown { color: var(--yellow); }\n\n/* --- File Internals Card --- */\n.file-internals-container {\n    width: 100%;\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    padding: 2rem;\n    display: none; /* Hidden by default */\n    box-sizing: border-box;\n    flex-direction: column;\n    gap: 1.5rem;\n}\nbody.is-showing-result .file-internals-container {\n    display: flex;\n}\n.file-internals-container h3 {\n    margin-top: 0;\n    margin-bottom: 0;\n    color: var(--text-light);\n    font-size: 1.25rem;\n    padding-bottom: 1rem;\n    border-bottom: 1px solid var(--border-color);\n}\n\n/* --- Entropy Bars --- */\n.entropy-bars {\n    display: flex;\n    flex-direction: column;\n    gap: 0.75rem;\n}\n.entropy-bar-row {\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n}\n.entropy-bar-label {\n    width: 60px;\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.9rem;\n    color: var(--text-medium);\n    flex-shrink: 0;\n}\n.entropy-bar-bg {\n    flex-grow: 1;\n    height: 20px;\n    background-color: var(--bg-dark-3);\n    border-radius: 4px;\n    overflow: hidden;\n}\n.entropy-bar-fill {\n    height: 100%;\n    width: 0%; /* Set by JS */\n    background-color: var(--blue);\n    border-radius: 4px;\n    transition: width 0.5s ease;\n    display: flex;\n    justify-content: flex-end;\n    align-items: center;\n    padding-right: 0.5rem;\n    box-sizing: border-box;\n}\n.entropy-bar-value {\n    font-size: 0.8rem;\n    font-weight: bold;\n    color: var(--syntax-const-text); /* MODIFIED */\n    text-shadow: 0 0 3px rgba(0,0,0,0.5);\n}\n/* Color coding for entropy bars */\n.entropy-bar-fill.low { background-color: var(--green); }\n.entropy-bar-fill.medium { background-color: var(--blue); }\n.entropy-bar-fill.high { background-color: var(--yellow); }\n.entropy-bar-fill.packed { background-color: var(--red); }\n\n/* --- Key Strings --- */\n.key-strings {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 0.5rem;\n}\n.key-string-tag {\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.9rem;\n    background-color: var(--bg-dark-3);\n    border: 1px solid var(--border-color);\n    padding: 0.25rem 0.5rem;\n    border-radius: 4px;\n    color: var(--text-light);\n}\n.key-string-tag.suspicious {\n    border-color: var(--red);\n    color: var(--red);\n    background-color: #e74c3c1a;\n}\n.key-string-tag.benign {\n    border-color: var(--green);\n    color: var(--green);\n    background-color: #2ecc711a;\n}\n\n/* --- Buttons --- */\n.btn-wrapper {\n    margin-top: 2rem;\n    display: flex;\n    gap: 1rem;\n}\n.btn {\n    flex-grow: 1; /* Make buttons fill space */\n    background-color: var(--blue);\n    color: var(--syntax-const-text); /* MODIFIED */\n    border: none;\n    padding: 12px 24px;\n    border-radius: 6px;\n    font-size: 1rem;\n    font-weight: bold;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    text-decoration: none;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    gap: 0.5rem;\n}\n.btn:hover {\n    filter: brightness(1.2);\n}\n.btn-primary {\n    background-color: var(--blue);\n}\n.btn-secondary {\n    background-color: var(--bg-dark-4);\n    color: var(--text-light);\n}\n.btn-secondary:hover {\n    background-color: #555;\n}\n.btn i {\n    margin-right: 0.25rem;\n}\n\n\n/* --- Background Particle Animations --- */\n.animation-swarm {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%; \n    height: 100%;\n    z-index: -1;\n    pointer-events: none;\n    overflow: hidden; \n}\n\n/* Base style for each new span particle */\n.animation-swarm span {\n    position: absolute;\n    top: -20px; /* Start off-screen */\n    font-size: 1.5rem;\n    opacity: 0; /* Start invisible */\n    animation: fall 10s linear infinite;\n}\n\n/* The ::before holds the icon content */\n.animation-swarm span::before {\n    content: '';\n    font-family: \"Font Awesome 6 Free\";\n    font-weight: 900;\n    text-shadow: 0 0 5px;\n}\n\n/* Keyframes for falling (starts with opacity) */\n@keyframes fall {\n    0% {\n        transform: translateY(0vh) rotate(0);\n        opacity: 0.3;\n    }\n    100% {\n        transform: translateY(105vh) rotate(360deg);\n        opacity: 0;\n    }\n}\n\n/* Set icon and color based on body class */\nbody.result-safe-active .animation-swarm span::before {\n    content: '\\f132'; /* fa-shield-halved */\n    color: var(--green);\n}\nbody.result-suspicious-active .animation-swarm span::before {\n    content: '\\f071'; /* fa-exclamation-triangle */\n    color: var(--yellow);\n}\nbody.result-malware-active .animation-swarm span::before {\n    content: '\\f188'; /* fa-bug */\n    color: var(--red);\n}\n\n/* Give each particle a unique position and delay --- THIS IS THE FINAL FIX --- */\n/* All values are kept well away from the 90-100% range */\n.animation-swarm span:nth-child(1) { left: 10%; animation-delay: 0s; }\n.animation-swarm span:nth-child(2) { left: 20%; animation-delay: -2s; }\n.animation-swarm span:nth-child(3) { left: 30%; animation-delay: -4s; }\n.animation-swarm span:nth-child(4) { left: 40%; animation-delay: -6s; }\n.animation-swarm span:nth-child(5) { left: 50%; animation-delay: -8s; }\n.animation-swarm span:nth-child(6) { left: 60%; animation-delay: -1s; }\n.animation-swarm span:nth-child(7) { left: 70%; animation-delay: -3s; }\n.animation-swarm span:nth-child(8) { left: 75%; animation-delay: -5s; } /* Was 80% */\n.animation-swarm span:nth-child(9) { left: 15%; animation-delay: -7s; } /* Was 90% */\n.animation-swarm span:nth-child(10) { left: 5%; animation-delay: -9s; }\n\n\n/* --- History Panel --- */\n.history-overlay {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0,0,0,0.5);\n    z-index: 1001;\n    opacity: 0;\n    visibility: hidden;\n    transition: all 0.3s ease;\n}\n.history-panel {\n    position: fixed;\n    top: 0;\n    right: -450px; /* Start off-screen */\n    width: 400px;\n    max-width: 90%;\n    height: 100%;\n    background-color: var(--bg-dark-2);\n    z-index: 1002;\n    transition: all 0.3s ease;\n    display: flex;\n    flex-direction: column;\n}\nbody.is-history-open .history-overlay {\n    opacity: 1;\n    visibility: visible;\n}\nbody.is-history-open .history-panel {\n    right: 0;\n}\n.history-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 1rem 1.5rem;\n    border-bottom: 1px solid var(--border-color);\n}\n.history-header h3 {\n    margin: 0;\n    font-size: 1.2rem;\n}\n.history-close-btn {\n    background: none;\n    border: none;\n    color: var(--text-medium);\n    font-size: 1.5rem;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n.history-close-btn:hover {\n    color: var(--text-light);\n}\n.history-list {\n    list-style: none;\n    padding: 0;\n    margin: 0;\n    overflow-y: auto;\n    flex-grow: 1;\n}\n.history-list li {\n    display: flex;\n    align-items: center;\n    gap: 1rem;\n    padding: 1rem 1.5rem;\n    border-bottom: 1px solid var(--border-color);\n    transition: background-color 0.2s ease;\n}\n\n.history-list li:hover {\n    background-color: var(--bg-dark-3);\n}\n\n.history-item {\n    display: flex;\n    align-items: flex-start;\n    gap: 1rem;\n}\n\n.history-icon-wrapper {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 0.5rem;\n    min-width: 60px;\n}\n\n.history-icon {\n    font-size: 1.8rem;\n    width: 40px;\n    height: 40px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    border-radius: 8px;\n    background-color: var(--bg-dark-3);\n}\n\n.history-icon.safe {\n    color: var(--green);\n    border: 2px solid var(--green);\n}\n\n.history-icon.suspicious {\n    color: var(--yellow);\n    border: 2px solid var(--yellow);\n}\n\n.history-icon.malware {\n    color: var(--red);\n    border: 2px solid var(--red);\n}\n\n.history-file-type {\n    font-size: 1rem;\n    color: var(--text-medium);\n}\n\n.history-details {\n    flex-grow: 1;\n    display: flex;\n    flex-direction: column;\n    gap: 0.5rem;\n    min-width: 0; /* Allow text truncation */\n}\n\n.history-filename {\n    font-weight: 600;\n    color: var(--text-light);\n    font-size: 0.95rem;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.history-classification {\n    font-size: 0.85rem;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.05em;\n}\n\n.history-classification.safe {\n    color: var(--green);\n}\n\n.history-classification.suspicious {\n    color: var(--yellow);\n}\n\n.history-classification.malware {\n    color: var(--red);\n}\n\n.history-hash {\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.75rem;\n    color: var(--text-medium);\n    background-color: var(--bg-dark-3);\n    padding: 0.25rem 0.5rem;\n    border-radius: 4px;\n    word-break: break-all;\n    line-height: 1.4;\n}\n\n.history-date {\n    font-size: 0.8rem;\n    color: var(--text-medium);\n    white-space: nowrap;\n    align-self: flex-start;\n    padding-top: 0.25rem;\n}\n\n.history-item-empty,\n.history-item-loading {\n    color: var(--text-medium);\n    text-align: center;\n    padding: 2rem;\n    font-style: italic;\n}\n\n\n/* --- Hover Scroll Zones --- */\n.scroll-zone {\n    position: fixed;\n    left: 0;\n    width: 100%;\n    height: 80px;\n    z-index: 998;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n}\n.scroll-zone.top { top: 60px; /* Below nav */ }\n.scroll-zone.bottom { bottom: 0; }\n\n.scroll-zone i {\n    font-size: 2rem;\n    color: var(--text-light);\n    opacity: 0;\n    transition: all 0.3s ease;\n    text-shadow: 0 0 15px rgba(0,0,0,0.7);\n}\n.scroll-zone.scrolling i {\n    opacity: 0.3;\n}\n.scroll-zone:hover i {\n    opacity: 0.7;\n}\n\n\n/* --- Graph Panel --- */\n.graph-wrapper {\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n    margin-top: 1rem;\n    display: none; /* Hidden by default */\n    box-sizing: border-box;\n}\nbody.is-showing-result .graph-wrapper {\n    display: block; /* Show with results */\n}\n\n.graph-header {\n    padding: 1rem 1.5rem;\n    border-bottom: 1px solid var(--border-color);\n    background-color: var(--bg-dark-3);\n    border-radius: 12px 12px 0 0;\n}\n.graph-header h3 {\n    margin: 0;\n    color: var(--text-light);\n    font-size: 1.1rem;\n}\n.call-graph-container {\n    overflow: auto; /* Allow scrolling for large graphs */\n}\n.call-graph {\n    flex-grow: 1;\n    overflow: auto;\n    position: relative; /* KEY for node positioning */\n    min-height: 400px;\n    padding: 1rem;\n}\n\n.graph-node {\n    position: absolute;\n    padding: 0.75rem 1.25rem;\n    border-radius: 8px;\n    background-color: var(--bg-dark-3);\n    border: 2px solid var(--border-color);\n    font-family: 'Courier New', Courier, monospace;\n    font-weight: bold;\n    white-space: nowrap;\n    box-shadow: 0 4px 10px rgba(0,0,0,0.3);\n    z-index: 2;\n    text-align: center;\n}\n/* MODIFIED to use variables */\n.node-entry { background-color: var(--node-bg-entry); border-color: var(--green); color: var(--syntax-const-text); }\n.node-std { background-color: var(--bg-dark-3); border-color: var(--border-color); color: var(--text-light); }\n.node-api { background-color: var(--node-bg-api); border-color: var(--blue); color: var(--syntax-const-text); }\n.node-suspicious { background-color: var(--node-bg-suspicious); border-color: var(--yellow); color: var(--syntax-const-text); }\n.node-malicious { background-color: var(--node-bg-malicious); border-color: var(--red); color: var(--syntax-const-text); }\n\n.leader-line {\n    z-index: 1; /* Sit behind nodes */\n    opacity: 0.8;\n}\nbody.light-theme .chart-container {\n    color: var(--text-medium);\n}\n\n/* Light theme navigation buttons */\nbody.light-theme .nav-btn {\n    background: linear-gradient(135deg, var(--primary), var(--secondary));\n    color: white;\n    box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);\n}\n\nbody.light-theme .nav-btn:hover:not(:disabled) {\n    box-shadow: 0 6px 20px rgba(139, 92, 246, 0.6);\n}\n\nbody.light-theme .nav-btn:disabled {\n    background: var(--bg-dark-3) !important;\n    color: var(--text-dark) !important;\n    box-shadow: none !important;\n}\n\nbody.light-theme .nav-info {\n    color: var(--text-light);\n    font-weight: 600;\n}\n\nbody.light-theme .scan-navigation {\n    border-top-color: var(--border-color);\n}\n","epoch":133,"telemetryInfo":{}}],["file:///home/trang/localnsv/mAIware/index.html::request_072750c6-1243-4dc9-a6c2-997a44762e6d",{"uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/index.html","external":"file:///home/trang/localnsv/mAIware/index.html","path":"/home/trang/localnsv/mAIware/index.html","scheme":"file"},"requestId":"request_072750c6-1243-4dc9-a6c2-997a44762e6d","content":"<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>mAIware AI Malware Detection Demo</title>\n    <!-- Font Awesome for icons (which you already had) -->\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css\">\n    <!-- Chart.js for stats (which you already had) -->\n    <script src=\"https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js\"></script>\n    <!-- Link to the CSS file -->\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n\n<body>\n    <nav class=\"top-nav\">\n        <div class=\"logo\"> <i class=\"fas fa-shield-virus\"></i> <span>mAIware</span> </div>\n        <div class=\"nav-links\"> <a href=\"#\" class=\"nav-link\" data-tooltip=\"Login\"><i class=\"fas fa-sign-in-alt\"></i><span class=\"link-text\">Login</span></a> <a href=\"#\" class=\"nav-link\" data-tooltip=\"Sign Up\"><i class=\"fas fa-user-plus\"></i><span class=\"link-text\">Sign Up</span></a> <a href=\"#\" class=\"nav-link\" data-tooltip=\"Community\"><i class=\"fas fa-users\"></i><span class=\"link-text\">Community</span></a> <a href=\"#\" class=\"nav-link\" data-tooltip=\"API Docs\"><i class=\"fas fa-code\"></i><span class=\"link-text\">API</span></a> <a href=\"#\" id=\"history-btn\" class=\"nav-link\" data-tooltip=\"Scan History\"><i class=\"fas fa-history\"></i><span class=\"link-text\">History</span></a> <a href=\"#\" class=\"nav-link\" id=\"theme-toggle\" data-tooltip=\"Toggle Theme\"> <i class=\"fas fa-sun\"></i> </a> </div>\n    </nav>\n\n    <main class=\"main-container\">\n        <!-- Column 1 -->\n        <div class=\"scanner-wrapper\">\n            <!-- Main Scanner Box -->\n            <div class=\"scanner-container\">\n                <h1>AI Malware Detection</h1>\n                \n                <!-- Navigation Controls (Top Position) -->\n                <div class=\"scan-navigation scan-navigation-top\">\n                    <button id=\"prev-scan-btn\" class=\"nav-btn\" disabled>\n                        <i class=\"fas fa-chevron-left\"></i> Previous\n                    </button>\n                    <span id=\"nav-info\" class=\"nav-info\">1 of 1</span>\n                    <button id=\"next-scan-btn\" class=\"nav-btn\" disabled>\n                        Next <i class=\"fas fa-chevron-right\"></i>\n                    </button>\n                </div>\n                \n                <!-- State 1: Initial -->\n                <div id=\"initial-state\" class=\"scanner-state active\">\n                    <p>Watching your Downloads folder for new files...</p>\n                    <div id=\"drop-zone\" class=\"upload-zone\"> <i class=\"upload-icon fas fa-eye\"></i>\n                        <h3>Automatic Scanning Active</h3>\n                        <span>(Download a file to begin)</span>\n                    </div>\n                </div>\n\n                <!-- State 2: Analyzing -->\n                <div id=\"analyzing-state\" class=\"scanner-state\">\n                    <div class=\"analyzing-icon\">\n                        <div class=\"loader\"></div>\n                    </div>\n                    <h3>Analyzing...</h3> <span class=\"filename\" id=\"analyzing-filename\">demo_file.exe</span> </div>\n\n                <!-- State 3: Result -->\n                <div id=\"result-state\" class=\"scanner-state\"> <i class=\"result-icon\" id=\"result-icon\"></i>\n                    <h2 id=\"result-text\"></h2>\n                    <div class=\"filename\" id=\"result-filename\"></div>\n                    <p id=\"result-details\"></p>\n                    <!-- Removed the resetDemo() button as it's automatic now -->\n                </div>\n                <div id=\"non-pe-result\" class=\"scanner-state non-pe-result\">\n                    <div class=\"non-pe-icon\"><i class=\"fas fa-file\"></i></div>\n                    <h2 id=\"non-pe-title\">File is not a Windows PE executable</h2>\n                    <p class=\"filename\" id=\"non-pe-filename\"></p>\n                    <div class=\"non-pe-hash-grid\">\n                        <div class=\"non-pe-hash\">\n                            <h4>SHA256</h4>\n                            <p id=\"non-pe-hash-sha256\">...</p>\n                        </div>\n                        <div class=\"non-pe-hash\">\n                            <h4>MD5</h4>\n                            <p id=\"non-pe-hash-md5\">...</p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Analysis Details (Shows on result) -->\n            <div class=\"analysis-details-container\" id=\"analysis-details-wrapper\">\n                <div class=\"progress-header\">\n                    <h3>Malware Confidence</h3> <span class=\"score-percentage\" id=\"score-percentage\">0%</span> </div>\n                <div class=\"progress-bar-background\">\n                    <div class=\"progress-bar-fill\" id=\"progress-bar-fill\" style=\"width: 0%;\"></div>\n                </div>\n\n                <!-- This grid holds Vendor and Signature -->\n                <div class=\"details-grid\">\n                    <!-- Vendor UI Container -->\n                    <div class=\"details-section\" id=\"details-vendor\">\n                        <h4>Vendor Analysis</h4>\n                        <div class=\"vendor-info\">\n                            <i class=\"fas fa-question-circle\"></i>\n                            <span>Scanning...</span>\n                        </div>\n                    </div>\n                    <!-- Signature UI Container -->\n                    <div class=\"details-section\" id=\"details-signature\">\n                        <h4>Digital Signature</h4>\n                        <div class=\"signature-info\">\n                            <i class=\"fas fa-question-circle\"></i>\n                            <span>Checking...</span>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Reasoning (File Type/Packer) -->\n                <div class=\"details-section\">\n                    <h4>Key Findings</h4>\n                    <p id=\"details-reasoning\">...</p>\n                </div>\n                \n                <div class=\"details-section\">\n                    <h4>SHA256 Hash</h4>\n                    <p class=\"hash-text\" id=\"details-hash-sha256\">...</p>\n                </div>\n\n                <div class=\"details-section\">\n                    <h4>MD5 Hash</h4>\n                    <p class=\"hash-text\" id=\"details-hash-md5\">...</p>\n                </div>\n\n                <div class=\"details-section\">\n                    <h4>System IP</h4>\n                    <p class=\"hash-text\" id=\"details-system-ip\">Detecting...</p>\n                </div>\n\n                <div class=\"details-section\">\n                    <h4>What To Do Next</h4>\n                    <p id=\"details-recommendation\">...</p>\n                </div>\n\n                <div class=\"btn-wrapper\"> <button class=\"btn btn-primary\"><i class=\"fas fa-download\"></i> Download Report</button> <button class=\"btn btn-secondary\"><i class=\"fas fa-flag\"></i> Report False Positive</button> </div>\n            </div>\n        </div>\n\n        <!-- Column 2 -->\n        <div class=\"right-panel-wrapper\">\n            <!-- Stats (Shows on initial) -->\n            <div class=\"stats-wrapper\" id=\"stats-wrapper\">\n                <div class=\"stats-grid\">\n                    <div class=\"stat-card\"> <i class=\"fas fa-virus-slash\"></i>\n                        <div class=\"stat-content\"> <span class=\"stat-number\" data-target=\"14720938\">0</span> <span class=\"stat-label\">Malware Analyzed</span> </div>\n                    </div>\n                    <div class=\"stat-card\"> <i class=\"fas fa-users\"></i>\n                        <div class=\"stat-content\"> <span class=\"stat-number\" data-target=\"82041\">0</span> <span class=\"stat-label\">Active Users</span> </div>\n                    </div>\n                    <div class=\"stat-card\"> <i class=\"fas fa-chart-line\"></i>\n                        <div class=\"stat-content\"> <span class=\"stat-number\" data-target=\"1259024\">0</span> <span class=\"stat-label\">Site Visits (24h)</span> </div>\n                    </div>\n                </div>\n                <div class=\"chart-container-wrapper\">\n                    <div class=\"chart-container\">\n                        <h3>Top 5 Malware Families (30 Days)</h3> <canvas id=\"topMalwareChart\"></canvas> </div>\n                    <div class=\"chart-container\">\n                        <h3>Submission Types</h3> <canvas id=\"malwareTypesChart\"></canvas> </div>\n                </div>\n            </div>\n\n            <!-- Disassembly (Shows on analyzing/result) -->\n            <div class=\"disassembly-wrapper\" id=\"disassembly-wrapper\">\n                <div class=\"disassembly-header\">\n                    <h3>Disassembly: <span id=\"disassembly-filename\"></span></h3>\n                </div>\n                <div class=\"disassembly-code\" id=\"disassembly-code\"> </div>\n            </div>\n\n            <!-- File Internals (Shows on result) -->\n            <div class=\"file-internals-container\" id=\"file-internals-wrapper\">\n                <h3>File Internals</h3>\n                \n                <!-- Entropy UI Container -->\n                <div class=\"details-section\">\n                    <h4>Section Entropy (0=Normal, 8=Packed/Encrypted)</h4>\n                    <div class=\"entropy-bars\" id=\"entropy-bars-container\">\n                        <!-- JS will populate this -->\n                    </div>\n                </div>\n                \n                <!-- Key Strings UI Container -->\n                <div class=\"details-section\">\n                    <h4>Suspicious / Key Strings</h4>\n                    <div class=\"key-strings\" id=\"key-strings-container\">\n                        <!-- JS will populate this -->\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Full Width Row -->\n        <div class=\"graph-wrapper\" id=\"graph-wrapper\">\n            <div class=\"graph-header\">\n                <h3>Dynamic Function Call Graph (Simulation)</h3>\n            </div>\n            <div class=\"call-graph-container\">\n                <div class=\"call-graph\" id=\"call-graph\">\n                    <!-- JS will populate this -->\n                </div>\n            </div>\n        </div>\n    </main>\n\n    <!-- History Panel (Hidden by default) -->\n    <div class=\"history-overlay\" id=\"history-overlay\"></div>\n    <div class=\"history-panel\" id=\"history-panel\">\n        <div class=\"history-header\">\n            <h3>Scan History</h3> <button class=\"history-close-btn\" id=\"history-close-btn\"><i class=\"fas fa-times\"></i></button> </div>\n        <ul class=\"history-list\">\n            <!-- JS would populate this -->\n        </ul>\n    </div>\n\n    <!-- Scroll Zones -->\n    <div class=\"scroll-zone top\" id=\"scroll-zone-top\"><i class=\"fas fa-chevron-up\"></i></div>\n    <div class=\"scroll-zone bottom\" id=\"scroll-zone-bottom\"><i class=\"fas fa-chevron-down\"></i></div>\n    \n    <!-- LeaderLine for graph (which you already had) -->\n    <script src=\"https://cdn.jsdelivr.net/npm/leader-line-new@1.1.9/leader-line.min.js\"></script>\n    <!-- Link to the JS file -->\n    <script src=\"script.js\"></script>\n\n    <script>\n    // Apply saved theme class immediately (before DOMContentLoaded)\n    const savedTheme = localStorage.getItem('theme') || 'dark';\n    if (savedTheme === 'light') {\n        document.body.classList.add('light-theme');\n    }\n    \n    document.addEventListener('DOMContentLoaded', () => {\n        const themeToggleButton = document.getElementById('theme-toggle');\n        const body = document.body;\n        const themeIcon = themeToggleButton.querySelector('i');\n\n        // Set icon based on current theme\n        if (body.classList.contains('light-theme')) {\n            themeIcon.classList.remove('fa-sun');\n            themeIcon.classList.add('fa-moon');\n        }\n\n        // Function to apply the saved theme\n        const applyTheme = (theme) => {\n            if (theme === 'light') {\n                body.classList.add('light-theme');\n                themeIcon.classList.remove('fa-sun');\n                themeIcon.classList.add('fa-moon');\n            } else {\n                body.classList.remove('light-theme');\n                themeIcon.classList.remove('fa-moon');\n                themeIcon.classList.add('fa-sun');\n            }\n            \n            // Recreate charts with updated theme colors\n            if (window.recreateCharts) {\n                window.recreateCharts();\n            }\n        };\n\n        // Add click event for the toggle button\n        themeToggleButton.addEventListener('click', (e) => {\n            e.preventDefault(); // Stop the link from navigating\n            \n            // Check current theme\n            const isLightTheme = body.classList.contains('light-theme');\n            \n            // Set new theme\n            const newTheme = isLightTheme ? 'dark' : 'light';\n            \n            // Apply the new theme\n            applyTheme(newTheme);\n            \n            // Save the new theme to localStorage\n            localStorage.setItem('theme', newTheme);\n        });\n    });\n    </script>\n</body>\n</html>\n","epoch":137,"telemetryInfo":{}}],["file:///home/trang/localnsv/mAIware/style.css::request_072750c6-1243-4dc9-a6c2-997a44762e6d",{"uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/style.css","external":"file:///home/trang/localnsv/mAIware/style.css","path":"/home/trang/localnsv/mAIware/style.css","scheme":"file"},"requestId":"request_072750c6-1243-4dc9-a6c2-997a44762e6d","content":"/* --- Global & Fonts --- */\n:root {\n    /* --- Dark Theme (Default) --- */\n    --bg-dark-1: #121212;\n    --bg-dark-2: #1e1e1e;\n    --bg-dark-3: #2a2a2e;\n    --bg-dark-4: #333333;\n    --border-color: #444444;\n    --text-light: #e0e0e0;\n    --text-medium: #aaa;\n    --text-dark: #888;\n    \n    /* --- Semantic Colors --- */\n    --blue: #007bff;\n    --red: #e74c3c;\n    --yellow: #f1c40f;\n    --green: #2ecc71;\n    \n    /* --- Syntax & Node Colors --- */\n    --syntax-op: #c39eff;\n    --syntax-string: #e6db74;\n    --syntax-const-text: #ffffff; /* Constant white for dark buttons/nodes */\n    --node-bg-entry: #254a25;\n    --node-bg-api: #2a3e4a;\n    --node-bg-suspicious: #4a452a;\n    --node-bg-malicious: #4a2a2a;\n\n    --chart-legend-text: var(--text-light);  /* #e0e0e0 */\n    --chart-axes-text: var(--text-medium);   /* #aaa */\n    --chart-grid-line: var(--border-color);\n}\n\n/* --- Light Theme --- */\n/* Add \".light-theme\" to the <body> tag to activate */\nbody.light-theme {\n    --bg-dark-1: #f8f9fa;     /* Main background */\n    --bg-dark-2: #ffffff;     /* Card background */\n    --bg-dark-3: #e9ecef;     /* Hover/active background */\n    --bg-dark-4: #ced4da;     /* Secondary button background */\n    --border-color: #dee2e6;  /* Border color */\n    --text-light: #212529;    /* Main text */\n    --text-medium: #6c757d;   /* Secondary text */\n    --text-dark: #888;        /* Tertiary text (can stay gray) */\n    \n    /* Semantic colors are unchanged */\n    /* --blue, --red, --yellow, --green */\n    \n    /* --- Light Theme Syntax --- */\n    --syntax-op: #a040ff;       /* Darker purple */\n    --syntax-string: #b8860b;     /* Dark goldenrod */\n    --syntax-const-text: #ffffff; /* Stays white for colored buttons/nodes */\n    \n    /* Node backgrounds are unchanged, they look good on a light BG */\n    --chart-legend-text: var(--text-medium); /* User Request */\n    --chart-axes-text: var(--text-medium);   /* User Request */\n    --chart-grid-line: var(--border-color);\n}\n\n\n/* Apply overflow-x to html as well */\nhtml {\n    overflow-x: hidden;\n    font-size: 16px; /* Ensure base font size */\n}\n\nbody {\n    font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n    background-color: var(--bg-dark-1);\n    color: var(--text-light);\n    margin: 0;\n    padding-top: 60px; /* Make space for fixed top nav */\n    overflow-x: hidden; /* Prevent horizontal scroll */\n    width: 100%;\n    min-height: 100vh;\n}\n\n/* --- Main Grid Container --- */\n.main-container {\n    display: grid;\n    grid-template-columns: 1fr 1fr; /* Simpler 2-column definition */\n    grid-template-rows: auto auto; /* Rows for content and graph */\n    gap: 2rem;\n    padding: 2rem; /* Spacing from nav and screen edges */\n    align-items: start;\n    \n    /* Set max-width on the grid itself */\n    max-width: 1400px; \n    /* Center the whole grid */\n    margin: 0 auto; \n    \n    min-height: calc(100vh - 60px); /* Full height minus nav */\n    box-sizing: border-box;\n    width: 100%;\n}\n\n.scanner-wrapper {\n    grid-column: 1 / 2; /* Span first column */\n    grid-row: 1 / 2;\n    display: flex;\n    flex-direction: column;\n    gap: 1.5rem;\n    width: 100%; /* Fill the column */\n}\n\n.right-panel-wrapper {\n    grid-column: 2 / 3; /* Span second column */\n    grid-row: 1 / 2;\n    display: flex; /* Make it a flex container */\n    flex-direction: column; /* Stack its children vertically */\n    gap: 1.5rem; /* Space between its children */\n    width: 100%; /* Fill the column */\n}\n\n.graph-wrapper {\n    grid-column: 1 / 3; /* Span BOTH columns */\n    grid-row: 2 / 3;\n    width: 100%;\n    /* max-width is now inherited from main-container */\n    justify-self: center; /* Center in the grid area */\n}\n\n\n/* --- Top Navigation --- */\n.top-nav {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    height: 60px;\n    background-color: var(--bg-dark-2);\n    border-bottom: 1px solid var(--border-color);\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 0 2rem;\n    z-index: 1000;\n    box-sizing: border-box;\n}\n\n.top-nav .logo {\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n    font-size: 1.3rem;\n    font-weight: 600;\n    color: var(--text-light);\n}\n\n.top-nav .logo i {\n    color: var(--blue);\n}\n\n.nav-links {\n    display: flex;\n    gap: 0.5rem;\n}\n\n.nav-link {\n    color: var(--text-medium);\n    font-size: 1.25rem;\n    padding: 0.75rem;\n    border-radius: 8px;\n    transition: all 0.2s ease;\n    position: relative;\n    text-decoration: none;\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n}\n\n.nav-link .link-text {\n    font-size: 0.9rem;\n    font-weight: 500;\n    max-width: 0;\n    overflow: hidden;\n    white-space: nowrap;\n    transition: all 0.3s ease;\n}\n\n.nav-link:hover {\n    background-color: var(--bg-dark-3);\n    color: var(--text-light);\n}\n\n.nav-link:hover .link-text {\n    max-width: 80px; /* Expand text on hover */\n    margin-left: 0.25rem;\n}\n\n/* --- Tooltip --- */\n.nav-link:hover::before {\n    content: attr(data-tooltip);\n    position: absolute;\n    bottom: -35px;\n    left: 50%;\n    transform: translateX(-50%);\n    background-color: var(--bg-dark-3);\n    color: var(--text-light);\n    padding: 5px 10px;\n    border-radius: 4px;\n    font-size: 0.8rem;\n    white-space: nowrap;\n    opacity: 0;\n    transition: opacity 0.2s 0.3s; /* Delay tooltip */\n    pointer-events: none;\n}\n.nav-link:hover .link-text {\n    display: none; /* Hide expanded text if tooltip is showing */\n}\n.nav-link:hover:hover::before {\n    opacity: 1;\n}\n\n/* On smaller screens, stack the columns */\n@media (max-width: 1280px) { /* Widened breakpoint */\n    .main-container {\n        grid-template-columns: 1fr; /* Stack columns */\n        padding: 1rem;\n    }\n    .scanner-wrapper, .right-panel-wrapper, .graph-wrapper {\n        grid-column: 1 / 2; /* All in one column */\n        max-width: 100%;\n        justify-self: center;\n    }\n    .right-panel-wrapper {\n        grid-row: 2 / 3;\n    }\n    .graph-wrapper {\n        grid-row: 3 / 4;\n    }\n}\n\n/* Hide link text on very small screens */\n@media (max-width: 768px) {\n    .nav-link .link-text { display: none; }\n    .nav-link:hover .link-text { display: none; }\n    .top-nav { padding: 0 1rem; }\n}\n\n\n/* --- Main Scanner Box --- */\n.scanner-container {\n    width: 100%; /* Ensure it fills its flex parent */\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n    padding: 2.5rem;\n    text-align: center;\n    overflow: hidden;\n    transition: all 0.3s ease;\n    box-sizing: border-box; /* Include padding in width */\n}\n\nh1 {\n    color: var(--text-light);\n    margin-top: 0;\n    margin-bottom: 1rem;\n}\n\n.scanner-container p {\n    color: var(--text-medium);\n    margin-bottom: 2rem;\n    font-size: 1.1rem;\n}\n\n.scanner-state {\n    display: none;\n}\n.scanner-state.active {\n    display: block;\n}\n\n/* --- State 1: Upload --- */\n.upload-zone {\n    border: 2px dashed var(--border-color);\n    border-radius: 8px;\n    padding: 3rem 2rem;\n    cursor: pointer;\n    transition: all 0.3s ease;\n}\n.upload-zone:hover {\n    background-color: var(--bg-dark-3);\n    border-color: var(--blue);\n}\n.upload-icon {\n    font-size: 4rem;\n    color: var(--blue);\n    margin-bottom: 1rem;\n}\n.upload-zone h3 {\n    margin: 0;\n    color: var(--text-light);\n}\n.upload-zone span {\n    color: var(--text-dark);\n}\n\n/* --- State 2: Analyzing --- */\n.analyzing-icon .loader {\n    width: 80px;\n    height: 80px;\n    border: 6px solid var(--bg-dark-4);\n    border-top-color: var(--blue);\n    border-radius: 50%;\n    animation: spin 1s linear infinite;\n    margin: 2rem auto;\n}\n@keyframes spin {\n    to { transform: rotate(360deg); }\n}\n.analyzing-state h3 {\n    color: var(--text-light);\n    margin-bottom: 0.5rem;\n}\n.analyzing-state .filename,\n.result-state .filename {\n    color: var(--text-medium);\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 1.1rem;\n    word-break: break-all;\n}\n\n/* --- State 3: Result --- */\n.result-icon {\n    font-size: 6rem;\n    line-height: 1;\n    margin: 1.5rem 0;\n}\n.result-state h2 {\n    font-size: 2.5rem;\n    margin: 0 0 0.5rem 0;\n}\n.result-malware .result-icon, .result-malware h2 { color: var(--red); }\n.result-suspicious .result-icon, .result-suspicious h2 { color: var(--yellow); }\n.result-safe .result-icon, .result-safe h2 { color: var(--green); }\n.result-state p {\n    font-size: 1rem;\n    margin-bottom: 2rem;\n}\n\n/* --- Scan Navigation Controls --- */\n.scan-navigation {\n    display: none;\n    align-items: center;\n    justify-content: center;\n    gap: 1.5rem;\n    margin: 1.5rem 0;\n    padding: 1rem;\n    background: rgba(255, 255, 255, 0.03);\n    border-radius: 8px;\n}\n\n/* Show navigation only when results are displayed */\nbody.is-showing-result .scan-navigation,\nbody.is-non-pe .scan-navigation {\n    display: flex;\n}\n\n.nav-btn {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    padding: 0.75rem 1.5rem;\n    background: linear-gradient(135deg, var(--primary), var(--secondary));\n    color: white;\n    border: none;\n    border-radius: 8px;\n    font-size: 1rem;\n    font-weight: 600;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);\n}\n\n.nav-btn:hover:not(:disabled) {\n    transform: translateY(-2px);\n    box-shadow: 0 6px 20px rgba(139, 92, 246, 0.5);\n}\n\n.nav-btn:active:not(:disabled) {\n    transform: translateY(0);\n}\n\n.nav-btn:disabled {\n    background: rgba(255, 255, 255, 0.1) !important;\n    color: rgba(255, 255, 255, 0.3) !important;\n    cursor: not-allowed;\n    box-shadow: none !important;\n}\n\n.nav-info {\n    color: var(--text-medium);\n    font-size: 0.95rem;\n    font-weight: 500;\n    min-width: 80px;\n    text-align: center;\n}\n\n.non-pe-result {\n    display: none;\n    flex-direction: column;\n    align-items: center;\n    gap: 1.5rem;\n    color: var(--text-light);\n    padding: 1rem 0 0 0;\n}\n\n.non-pe-result.active {\n    display: flex;\n}\n\n.non-pe-icon {\n    width: 96px;\n    height: 96px;\n    border-radius: 24px;\n    background: linear-gradient(135deg, rgba(80, 130, 255, 0.2), rgba(80, 130, 255, 0.05));\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 3rem;\n    color: var(--blue);\n}\n\n.non-pe-hash-grid {\n    display: flex;\n    gap: 1.5rem;\n    flex-wrap: wrap;\n    justify-content: center;\n}\n\n.non-pe-hash {\n    min-width: 220px;\n    background: var(--bg-dark-3);\n    padding: 1rem 1.25rem;\n    border-radius: 12px;\n    border: 1px solid rgba(255, 255, 255, 0.05);\n    text-align: left;\n}\n\n.non-pe-hash h4 {\n    margin: 0 0 0.5rem 0;\n    font-size: 0.85rem;\n    text-transform: uppercase;\n    letter-spacing: 0.08rem;\n    color: var(--text-medium);\n}\n\n.non-pe-hash p {\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.9rem;\n    word-break: break-all;\n    color: var(--text-light);\n}\n\nbody.is-non-pe .analysis-details-container,\nbody.is-non-pe #analysis-details-wrapper,\nbody.is-non-pe #disassembly-wrapper,\nbody.is-non-pe #file-internals-wrapper,\nbody.is-non-pe #graph-wrapper {\n    display: none !important;\n}\n\nbody.is-non-pe #result-state {\n    display: none !important;\n}\n\nbody.is-non-pe .non-pe-result {\n    display: flex;\n}\n\n\n/* --- NEW: Stats Dashboard Panel --- */\n.stats-wrapper {\n    display: flex; \n    flex-direction: column;\n    gap: 1.5rem;\n    width: 100%; /* Fill its flex parent */\n    box-sizing: border-box; /* Include padding in width */\n}\n\n/* By default, stats are visible, disassembly is hidden */\n.disassembly-wrapper { display: none; }\n\n/* When analyzing/showing results, hide stats and show disassembly */\nbody.is-analyzing .stats-wrapper,\nbody.is-showing-result .stats-wrapper {\n    display: none;\n}\nbody.is-analyzing .disassembly-wrapper,\nbody.is-showing-result .disassembly-wrapper {\n    display: flex; /* Use flex to match its own styles */\n}\n\n\n.stats-grid {\n    display: flex; \n    flex-direction: column;\n    /* Force stacking */\n    gap: 1.5rem;\n}\n\n.stat-card {\n    display: flex;\n    align-items: center;\n    gap: 1.5rem;\n    background-color: var(--bg-dark-2);\n    padding: 1.5rem;\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n}\n.stat-card i {\n    font-size: 2.5rem;\n    color: var(--blue);\n}\n.stat-content {\n    display: flex;\n    flex-direction: column;\n}\n.stat-number {\n    font-size: 2rem;\n    font-weight: 600;\n    color: var(--text-light);\n    line-height: 1.2;\n}\n.stat-label {\n    font-size: 0.9rem;\n    color: var(--text-medium);\n}\n\n.chart-container-wrapper {\n    display: flex;\n    flex-direction: column;\n    gap: 1.5rem;\n}\n\n.chart-container {\n    background-color: var(--bg-dark-2);\n    padding: 1.5rem;\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    box-sizing: border-box;\n}\n.chart-container h3 {\n    margin-top: 0;\n    margin-bottom: 1.5rem;\n    text-align: center;\n    color: var(--text-light);\n    font-size: 1.1rem;\n}\n\n\n/* --- Disassembly Panel --- */\n.disassembly-wrapper {\n    /* display: none; set by default now */\n    flex-direction: column;\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n    height: 600px; /* Fixed height */\n    max-height: 70vh;\n    opacity: 0;\n    transition: all 0.3s ease;\n    width: 100%;\n    box-sizing: border-box;\n}\n\nbody.is-analyzing .disassembly-wrapper,\nbody.is-showing-result .disassembly-wrapper {\n    opacity: 1;\n}\n\n.disassembly-header {\n    padding: 1rem 1.5rem;\n    border-bottom: 1px solid var(--border-color);\n    background-color: var(--bg-dark-3);\n    border-radius: 12px 12px 0 0;\n}\n.disassembly-header h3 {\n    margin: 0;\n    color: var(--text-light);\n    font-size: 1.1rem;\n    font-family: 'Courier New', Courier, monospace;\n}\n.disassembly-code {\n    flex-grow: 1;\n    overflow-y: auto;\n    padding: 1rem;\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.95rem;\n}\n.disassembly-line {\n    display: block;\n    padding: 2px 1rem;\n    border-radius: 4px;\n    transition: background-color 0.2s ease;\n}\n.disassembly-line.active {\n    background-color: var(--blue);\n    color: var(--syntax-const-text); /* MODIFIED */\n}\n.disassembly-line .addr { color: var(--text-dark); margin-right: 1rem; }\n.disassembly-line .op { color: var(--syntax-op); font-weight: bold; width: 50px; display: inline-block; } /* MODIFIED */\n.disassembly-line .args { color: var(--text-light); }\n.disassembly-line .string { color: var(--syntax-string); } /* MODIFIED */\n.disassembly-line .comment { color: var(--green); margin-left: 1rem; }\n\n\n/* --- Analysis Details Panel --- */\n.analysis-details-container {\n    width: 100%;\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    padding: 2rem;\n    display: none; /* Hidden by default */\n    box-sizing: border-box;\n}\nbody.is-showing-result .analysis-details-container {\n    display: block;\n}\n\n.progress-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 0.75rem;\n}\n.progress-header h3 {\n    margin: 0;\n    font-size: 1.1rem;\n    color: var(--text-light);\n}\n.score-percentage {\n    font-size: 1.2rem;\n    font-weight: 600;\n}\n.score-green { color: var(--green); }\n.score-yellow { color: var(--yellow); }\n.score-red { color: var(--red); }\n\n.progress-bar-background {\n    width: 100%;\n    height: 12px;\n    background-color: var(--bg-dark-3);\n    border-radius: 6px;\n    overflow: hidden;\n    margin-bottom: 1.5rem;\n}\n.progress-bar-fill {\n    height: 100%;\n    width: 0%;\n    border-radius: 6px;\n    transition: width 0.5s ease;\n}\n.progress-bar-green { background-color: var(--green); }\n.progress-bar-yellow { background-color: var(--yellow); }\n.progress-bar-red { background-color: var(--red); }\n\n.details-section {\n    margin-bottom: 1.25rem;\n}\n.details-section h4 {\n    margin: 0 0 0.5rem 0;\n    color: var(--text-medium);\n    font-size: 0.9rem;\n    text-transform: uppercase;\n}\n.details-section p {\n    margin: 0;\n    color: var(--text-light);\n    font-size: 1rem;\n}\n.hash-text {\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.95rem;\n    word-break: break-all;\n}\n\n/* --- Vendor & Signature --- */\n.details-grid {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 1.5rem;\n    margin-bottom: 1.25rem;\n}\n.vendor-info, .signature-info {\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n    font-size: 1rem;\n    font-weight: 500;\n}\n.vendor-info i {\n    font-size: 1.5rem;\n    color: var(--text-medium);\n}\n.signature-info i {\n    font-size: 1.25rem;\n}\n/* Use the levels from datasrcs.js */\n.sig-verified { color: var(--green); }\n.sig-untrusted { color: var(--red); }\n.sig-unknown { color: var(--yellow); }\n\n/* --- File Internals Card --- */\n.file-internals-container {\n    width: 100%;\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    padding: 2rem;\n    display: none; /* Hidden by default */\n    box-sizing: border-box;\n    flex-direction: column;\n    gap: 1.5rem;\n}\nbody.is-showing-result .file-internals-container {\n    display: flex;\n}\n.file-internals-container h3 {\n    margin-top: 0;\n    margin-bottom: 0;\n    color: var(--text-light);\n    font-size: 1.25rem;\n    padding-bottom: 1rem;\n    border-bottom: 1px solid var(--border-color);\n}\n\n/* --- Entropy Bars --- */\n.entropy-bars {\n    display: flex;\n    flex-direction: column;\n    gap: 0.75rem;\n}\n.entropy-bar-row {\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n}\n.entropy-bar-label {\n    width: 60px;\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.9rem;\n    color: var(--text-medium);\n    flex-shrink: 0;\n}\n.entropy-bar-bg {\n    flex-grow: 1;\n    height: 20px;\n    background-color: var(--bg-dark-3);\n    border-radius: 4px;\n    overflow: hidden;\n}\n.entropy-bar-fill {\n    height: 100%;\n    width: 0%; /* Set by JS */\n    background-color: var(--blue);\n    border-radius: 4px;\n    transition: width 0.5s ease;\n    display: flex;\n    justify-content: flex-end;\n    align-items: center;\n    padding-right: 0.5rem;\n    box-sizing: border-box;\n}\n.entropy-bar-value {\n    font-size: 0.8rem;\n    font-weight: bold;\n    color: var(--syntax-const-text); /* MODIFIED */\n    text-shadow: 0 0 3px rgba(0,0,0,0.5);\n}\n/* Color coding for entropy bars */\n.entropy-bar-fill.low { background-color: var(--green); }\n.entropy-bar-fill.medium { background-color: var(--blue); }\n.entropy-bar-fill.high { background-color: var(--yellow); }\n.entropy-bar-fill.packed { background-color: var(--red); }\n\n/* --- Key Strings --- */\n.key-strings {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 0.5rem;\n}\n.key-string-tag {\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.9rem;\n    background-color: var(--bg-dark-3);\n    border: 1px solid var(--border-color);\n    padding: 0.25rem 0.5rem;\n    border-radius: 4px;\n    color: var(--text-light);\n}\n.key-string-tag.suspicious {\n    border-color: var(--red);\n    color: var(--red);\n    background-color: #e74c3c1a;\n}\n.key-string-tag.benign {\n    border-color: var(--green);\n    color: var(--green);\n    background-color: #2ecc711a;\n}\n\n/* --- Buttons --- */\n.btn-wrapper {\n    margin-top: 2rem;\n    display: flex;\n    gap: 1rem;\n}\n.btn {\n    flex-grow: 1; /* Make buttons fill space */\n    background-color: var(--blue);\n    color: var(--syntax-const-text); /* MODIFIED */\n    border: none;\n    padding: 12px 24px;\n    border-radius: 6px;\n    font-size: 1rem;\n    font-weight: bold;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    text-decoration: none;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    gap: 0.5rem;\n}\n.btn:hover {\n    filter: brightness(1.2);\n}\n.btn-primary {\n    background-color: var(--blue);\n}\n.btn-secondary {\n    background-color: var(--bg-dark-4);\n    color: var(--text-light);\n}\n.btn-secondary:hover {\n    background-color: #555;\n}\n.btn i {\n    margin-right: 0.25rem;\n}\n\n\n/* --- Background Particle Animations --- */\n.animation-swarm {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%; \n    height: 100%;\n    z-index: -1;\n    pointer-events: none;\n    overflow: hidden; \n}\n\n/* Base style for each new span particle */\n.animation-swarm span {\n    position: absolute;\n    top: -20px; /* Start off-screen */\n    font-size: 1.5rem;\n    opacity: 0; /* Start invisible */\n    animation: fall 10s linear infinite;\n}\n\n/* The ::before holds the icon content */\n.animation-swarm span::before {\n    content: '';\n    font-family: \"Font Awesome 6 Free\";\n    font-weight: 900;\n    text-shadow: 0 0 5px;\n}\n\n/* Keyframes for falling (starts with opacity) */\n@keyframes fall {\n    0% {\n        transform: translateY(0vh) rotate(0);\n        opacity: 0.3;\n    }\n    100% {\n        transform: translateY(105vh) rotate(360deg);\n        opacity: 0;\n    }\n}\n\n/* Set icon and color based on body class */\nbody.result-safe-active .animation-swarm span::before {\n    content: '\\f132'; /* fa-shield-halved */\n    color: var(--green);\n}\nbody.result-suspicious-active .animation-swarm span::before {\n    content: '\\f071'; /* fa-exclamation-triangle */\n    color: var(--yellow);\n}\nbody.result-malware-active .animation-swarm span::before {\n    content: '\\f188'; /* fa-bug */\n    color: var(--red);\n}\n\n/* Give each particle a unique position and delay --- THIS IS THE FINAL FIX --- */\n/* All values are kept well away from the 90-100% range */\n.animation-swarm span:nth-child(1) { left: 10%; animation-delay: 0s; }\n.animation-swarm span:nth-child(2) { left: 20%; animation-delay: -2s; }\n.animation-swarm span:nth-child(3) { left: 30%; animation-delay: -4s; }\n.animation-swarm span:nth-child(4) { left: 40%; animation-delay: -6s; }\n.animation-swarm span:nth-child(5) { left: 50%; animation-delay: -8s; }\n.animation-swarm span:nth-child(6) { left: 60%; animation-delay: -1s; }\n.animation-swarm span:nth-child(7) { left: 70%; animation-delay: -3s; }\n.animation-swarm span:nth-child(8) { left: 75%; animation-delay: -5s; } /* Was 80% */\n.animation-swarm span:nth-child(9) { left: 15%; animation-delay: -7s; } /* Was 90% */\n.animation-swarm span:nth-child(10) { left: 5%; animation-delay: -9s; }\n\n\n/* --- History Panel --- */\n.history-overlay {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0,0,0,0.5);\n    z-index: 1001;\n    opacity: 0;\n    visibility: hidden;\n    transition: all 0.3s ease;\n}\n.history-panel {\n    position: fixed;\n    top: 0;\n    right: -450px; /* Start off-screen */\n    width: 400px;\n    max-width: 90%;\n    height: 100%;\n    background-color: var(--bg-dark-2);\n    z-index: 1002;\n    transition: all 0.3s ease;\n    display: flex;\n    flex-direction: column;\n}\nbody.is-history-open .history-overlay {\n    opacity: 1;\n    visibility: visible;\n}\nbody.is-history-open .history-panel {\n    right: 0;\n}\n.history-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 1rem 1.5rem;\n    border-bottom: 1px solid var(--border-color);\n}\n.history-header h3 {\n    margin: 0;\n    font-size: 1.2rem;\n}\n.history-close-btn {\n    background: none;\n    border: none;\n    color: var(--text-medium);\n    font-size: 1.5rem;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n.history-close-btn:hover {\n    color: var(--text-light);\n}\n.history-list {\n    list-style: none;\n    padding: 0;\n    margin: 0;\n    overflow-y: auto;\n    flex-grow: 1;\n}\n.history-list li {\n    display: flex;\n    align-items: center;\n    gap: 1rem;\n    padding: 1rem 1.5rem;\n    border-bottom: 1px solid var(--border-color);\n    transition: background-color 0.2s ease;\n}\n\n.history-list li:hover {\n    background-color: var(--bg-dark-3);\n}\n\n.history-item {\n    display: flex;\n    align-items: flex-start;\n    gap: 1rem;\n}\n\n.history-icon-wrapper {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 0.5rem;\n    min-width: 60px;\n}\n\n.history-icon {\n    font-size: 1.8rem;\n    width: 40px;\n    height: 40px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    border-radius: 8px;\n    background-color: var(--bg-dark-3);\n}\n\n.history-icon.safe {\n    color: var(--green);\n    border: 2px solid var(--green);\n}\n\n.history-icon.suspicious {\n    color: var(--yellow);\n    border: 2px solid var(--yellow);\n}\n\n.history-icon.malware {\n    color: var(--red);\n    border: 2px solid var(--red);\n}\n\n.history-file-type {\n    font-size: 1rem;\n    color: var(--text-medium);\n}\n\n.history-details {\n    flex-grow: 1;\n    display: flex;\n    flex-direction: column;\n    gap: 0.5rem;\n    min-width: 0; /* Allow text truncation */\n}\n\n.history-filename {\n    font-weight: 600;\n    color: var(--text-light);\n    font-size: 0.95rem;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.history-classification {\n    font-size: 0.85rem;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.05em;\n}\n\n.history-classification.safe {\n    color: var(--green);\n}\n\n.history-classification.suspicious {\n    color: var(--yellow);\n}\n\n.history-classification.malware {\n    color: var(--red);\n}\n\n.history-hash {\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.75rem;\n    color: var(--text-medium);\n    background-color: var(--bg-dark-3);\n    padding: 0.25rem 0.5rem;\n    border-radius: 4px;\n    word-break: break-all;\n    line-height: 1.4;\n}\n\n.history-date {\n    font-size: 0.8rem;\n    color: var(--text-medium);\n    white-space: nowrap;\n    align-self: flex-start;\n    padding-top: 0.25rem;\n}\n\n.history-item-empty,\n.history-item-loading {\n    color: var(--text-medium);\n    text-align: center;\n    padding: 2rem;\n    font-style: italic;\n}\n\n\n/* --- Hover Scroll Zones --- */\n.scroll-zone {\n    position: fixed;\n    left: 0;\n    width: 100%;\n    height: 80px;\n    z-index: 998;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n}\n.scroll-zone.top { top: 60px; /* Below nav */ }\n.scroll-zone.bottom { bottom: 0; }\n\n.scroll-zone i {\n    font-size: 2rem;\n    color: var(--text-light);\n    opacity: 0;\n    transition: all 0.3s ease;\n    text-shadow: 0 0 15px rgba(0,0,0,0.7);\n}\n.scroll-zone.scrolling i {\n    opacity: 0.3;\n}\n.scroll-zone:hover i {\n    opacity: 0.7;\n}\n\n\n/* --- Graph Panel --- */\n.graph-wrapper {\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n    margin-top: 1rem;\n    display: none; /* Hidden by default */\n    box-sizing: border-box;\n}\nbody.is-showing-result .graph-wrapper {\n    display: block; /* Show with results */\n}\n\n.graph-header {\n    padding: 1rem 1.5rem;\n    border-bottom: 1px solid var(--border-color);\n    background-color: var(--bg-dark-3);\n    border-radius: 12px 12px 0 0;\n}\n.graph-header h3 {\n    margin: 0;\n    color: var(--text-light);\n    font-size: 1.1rem;\n}\n.call-graph-container {\n    overflow: auto; /* Allow scrolling for large graphs */\n}\n.call-graph {\n    flex-grow: 1;\n    overflow: auto;\n    position: relative; /* KEY for node positioning */\n    min-height: 400px;\n    padding: 1rem;\n}\n\n.graph-node {\n    position: absolute;\n    padding: 0.75rem 1.25rem;\n    border-radius: 8px;\n    background-color: var(--bg-dark-3);\n    border: 2px solid var(--border-color);\n    font-family: 'Courier New', Courier, monospace;\n    font-weight: bold;\n    white-space: nowrap;\n    box-shadow: 0 4px 10px rgba(0,0,0,0.3);\n    z-index: 2;\n    text-align: center;\n}\n/* MODIFIED to use variables */\n.node-entry { background-color: var(--node-bg-entry); border-color: var(--green); color: var(--syntax-const-text); }\n.node-std { background-color: var(--bg-dark-3); border-color: var(--border-color); color: var(--text-light); }\n.node-api { background-color: var(--node-bg-api); border-color: var(--blue); color: var(--syntax-const-text); }\n.node-suspicious { background-color: var(--node-bg-suspicious); border-color: var(--yellow); color: var(--syntax-const-text); }\n.node-malicious { background-color: var(--node-bg-malicious); border-color: var(--red); color: var(--syntax-const-text); }\n\n.leader-line {\n    z-index: 1; /* Sit behind nodes */\n    opacity: 0.8;\n}\nbody.light-theme .chart-container {\n    color: var(--text-medium);\n}\n\n/* Light theme navigation buttons */\n/* Light theme navigation buttons */\nbody.light-theme .nav-btn {\n    background: linear-gradient(135deg, #8b5cf6, #7c3aed) !important;\n    color: white !important;\n    box-shadow: 0 4px 12px rgba(139, 92, 246, 0.5) !important;\n}\n\nbody.light-theme .nav-btn:hover:not(:disabled) {\n    background: linear-gradient(135deg, #7c3aed, #6d28d9) !important;\n    box-shadow: 0 6px 20px rgba(139, 92, 246, 0.7) !important;\n}\n\nbody.light-theme .nav-btn:disabled {\n    background: #e9ecef !important;\n    color: #adb5bd !important;\n    box-shadow: none !important;\n    opacity: 0.7 !important;\n}\n\nbody.light-theme .nav-info {\n    color: var(--text-light);\n    font-weight: 600;\n}\n\nbody.light-theme .scan-navigation {\n    border-top-color: var(--border-color);\n}\n","epoch":141,"telemetryInfo":{}}],["file:///home/trang/localnsv/mAIware/script.js::request_072750c6-1243-4dc9-a6c2-997a44762e6d",{"uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/script.js","external":"file:///home/trang/localnsv/mAIware/script.js","path":"/home/trang/localnsv/mAIware/script.js","scheme":"file"},"requestId":"request_072750c6-1243-4dc9-a6c2-997a44762e6d","content":"// --- MOCK DISASSEMBLY DATA ---\n// (We keep this for now, as requested)\nconst mockDisassemblyBenign = [\n    `<span class=\"addr\">0x401000</span> <span class=\"op\">PUSH</span> <span class=\"args\">ebp</span> <span class=\"comment\">; setup stack frame</span>`,\n    `<span class=\"addr\">0x401001</span> <span class=\"op\">MOV</span> <span class=\"args\">ebp, esp</span>`,\n    `<span class=\"addr\">0x401003</span> <span class=\"op\">SUB</span> <span class=\"args\">esp, 48h</span>`,\n    `<span class=\"addr\">0x40100C</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4012A0</span> <span class=\"comment\">; initialize_string</span>`,\n    `<span class=\"addr\">0x401015</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4013F0</span> <span class=\"comment\">; get_user_input</span>`,\n    `<span class=\"addr\">0x40101E</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4015D0</span> <span class=\"comment\">; print_output</span>`,\n    `<span class=\"addr\">0x401028</span> <span class=\"op\">RETN</span>`,\n    `<span class=\"addr\">...</span>`,\n];\nconst mockDisassemblySuspicious = [\n    `<span class=\"addr\">0x401000</span> <span class=\"op\">PUSH</span> <span class=\"args\">ebp</span>`,\n    `<span class=\"addr\">0x401003</span> <span class=\"op\">SUB</span> <span class=\"args\">esp, 80h</span>`,\n    `<span class=\"addr\">0x40100D</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4012A0</span> <span class=\"comment\">; read_file_to_buffer</span>`,\n    `<span class=\"addr\">0x40101B</span> <span class=\"op\">REP</span> <span class=\"op\">MOVSB</span> <span class=\"comment\">; unsafe buffer write</span>`,\n    `<span class=\"addr\">0x401020</span> <span class=\"op\">JGE</span> <span class=\"args\">0x401030</span> <span class=\"comment\">; jump if overflow</span>`,\n    `<span class=\"addr\">0x401028</span> <span class=\"op\">RETN</span>`,\n    `<span class=\"addr\">...</span>`,\n];\nconst mockDisassemblyMalware = [\n    `<span class=\"addr\">0x401000</span> <span class=\"op\">PUSH</span> <span class=\"args\">ebp</span> <span class=\"comment\">; setup stack frame</span>`,\n    `<span class=\"addr\">0x40100B</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4011B0</span> <span class=\"comment\">; kernel32.LoadLibraryA</span>`,\n    `<span class=\"addr\">0x401013</span> <span class=\"op\">PUSH</span> <span class=\"string\">\"CreateRemoteThread\"</span>`,\n    `<span class=\"addr\">0x401019</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4011C0</span> <span class=\"comment\">; kernel32.GetProcAddress</span>`,\n    `<span class=\"addr\">0x401028</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4012F0</span> <span class=\"comment\">; decrypt_payload</span>`,\n    `<span class=\"addr\">0x401034</span> <span class=\"op\">CALL</span> <span class=\"args\">[ebp-24h]</span> <span class=\"comment\">; call CreateRemoteThread</span>`,\n    `<span class=\"addr\">0x401037</span> <span class=\"op\">JMP</span> <span class=\"args\">0x40102D</span> <span class=\"comment\">; loop?</span>`,\n    `<span class=\"addr\">...</span>`,\n];\n\n// --- REMOVED MOCK GRAPH DATA ---\n// const mockGraphSafe = ... (DELETED)\n// const mockGraphSuspicious = ... (DELETED)\n// const mockGraphMalware = ... (DELETED)\n\n// --- NAVIGATION STATE ---\nlet scanHistory = [];\nlet currentHistoryIndex = -1;\n\n// --- ELEMENT REFERENCES ---\nconst initialState = document.getElementById('initial-state');\nconst analyzingState = document.getElementById('analyzing-state');\nconst resultState = document.getElementById('result-state');\n\nconst analyzingFilename = document.getElementById('analyzing-filename');\nconst resultIcon = document.getElementById('result-icon');\nconst resultText = document.getElementById('result-text');\nconst resultFilename = document.getElementById('result-filename');\nconst resultDetails = document.getElementById('result-details');\nconst nonPeResultWrapper = document.getElementById('non-pe-result');\nconst nonPeFilename = document.getElementById('non-pe-filename');\nconst nonPeHashSha256 = document.getElementById('non-pe-hash-sha256');\nconst nonPeHashMd5 = document.getElementById('non-pe-hash-md5');\n\nconst bodyEl = document.body;\nlet animationWrapper = null;\n\nconst disassemblyWrapper = document.getElementById('disassembly-wrapper');\nconst disassemblyCodeEl = document.getElementById('disassembly-code');\nconst disassemblyFilenameEl = document.getElementById('disassembly-filename');\n\n// Analysis Details elements\nconst analysisDetailsWrapper = document.getElementById('analysis-details-wrapper');\nconst progressBarFill = document.getElementById('progress-bar-fill');\nconst scorePercentage = document.getElementById('score-percentage');\nconst detailsReasoning = document.getElementById('details-reasoning'); // We'll reuse this\nconst detailsHashSha256 = document.getElementById('details-hash-sha256');\nconst detailsHashMd5 = document.getElementById('details-hash-md5');\nconst detailsSystemIp = document.getElementById('details-system-ip');\nconst detailsRecommendation = document.getElementById('details-recommendation');\nconst detailsVendor = document.getElementById('details-vendor');\nconst detailsSignature = document.getElementById('details-signature');\nconst fileInternalsWrapper = document.getElementById('file-internals-wrapper');\nconst entropyBarsContainer = document.getElementById('entropy-bars-container');\nconst keyStringsContainer = document.getElementById('key-strings-container');\n\n// History Panel elements\nconst historyBtn = document.getElementById('history-btn');\nconst historyPanel = document.getElementById('history-panel');\nconst historyCloseBtn = document.getElementById('history-close-btn');\nconst historyOverlay = document.getElementById('history-overlay');\nconst historyListEl = document.querySelector('.history-list');\n\n// Scroll Zone elements\nconst scrollZoneTop = document.getElementById('scroll-zone-top');\nconst scrollZoneBottom = document.getElementById('scroll-zone-bottom');\n\n// Graph Panel elements\nconst graphWrapper = document.getElementById('graph-wrapper');\nconst callGraphEl = document.getElementById('call-graph');\n\n// Stats elements\nconst statsWrapper = document.getElementById('stats-wrapper');\n\n\n// --- STATE ---\nlet disassemblyInterval = null;\nlet scrollInterval = null; // For auto-scrolling\nlet currentGraphLines = []; // Renamed from currentLines to avoid conflict\nlet currentFileMetadata = null;\nlet lastScanResult = null;\n\n// 1. Listen for the 'scan-started' message from the backend\nwindow.electronAPI.onScanStarted((filename) => {\n  console.log(`UI: Received scan-started for ${filename}`);\n\n  // 1. Set UI to \"Analyzing\" state\n  initialState.classList.remove('active'); //\n  analyzingState.classList.add('active'); //\n  analyzingFilename.textContent = filename; //\n  disassemblyFilenameEl.textContent = filename; //\n\n  currentFileMetadata = { filename, isPe: true };\n  lastScanResult = null;\n  nonPeResultWrapper.classList.remove('active');\n  bodyEl.classList.remove('is-non-pe');\n\n  // 2. Update body class to show disassembly\n  bodyEl.classList.remove('is-showing-result'); //\n  bodyEl.classList.add('is-analyzing'); //\n  removeAnimationClasses(); //\n  \n  // 3. Populate disassembly with a \"suspicious\" default and start animation\n  // (We don't know the result yet, so we pick one)\n  populateDisassembly(mockDisassemblySuspicious); //\n  startDisassemblyAnimation(); //\n\n  // 4. Clear old results\n  clearResultData();\n});\n\n// 2. Listen for the 'scan-result' message\nwindow.electronAPI.onScanResult((scanResult) => {\n  console.log(\"UI: Received scan-result:\", scanResult);\n\n  clearInterval(disassemblyInterval); //\n  disassemblyInterval = null; //\n\n  bodyEl.classList.remove('is-analyzing'); //\n  bodyEl.classList.add('is-showing-result'); //\n\n  analyzingState.classList.remove('active'); //\n  resultState.classList.add('active'); //\n\n  // Add to history\n  scanHistory.push(scanResult);\n  currentHistoryIndex = scanHistory.length - 1;\n  \n  lastScanResult = scanResult;\n\n  renderScanResult();\n  updateNavigationButtons();\n});\n\nwindow.electronAPI.onScanFileMetadata((metadata) => {\n  if (!metadata || typeof metadata !== 'object') {\n    return;\n  }\n\n  currentFileMetadata = metadata;\n\n  if (lastScanResult && metadata.filename === lastScanResult.detected_filename) {\n    renderScanResult();\n  }\n});\n\nfunction renderScanResult() {\n  if (!lastScanResult) {\n    return;\n  }\n\n  const metadataMatches = currentFileMetadata && currentFileMetadata.filename === lastScanResult.detected_filename;\n  const isNonPe = metadataMatches && currentFileMetadata.isPe === false;\n\n  if (isNonPe) {\n    renderNonPeResult(lastScanResult);\n    return;\n  }\n\n  renderPeResult(lastScanResult);\n}\n\nfunction ensureAnimationWrapper() {\n  if (animationWrapper) {\n    return;\n  }\n\n  animationWrapper = document.createElement('div');\n  animationWrapper.className = 'animation-swarm';\n  for (let i = 0; i < 10; i++) {\n    const particle = document.createElement('span');\n    animationWrapper.appendChild(particle);\n  }\n  bodyEl.prepend(animationWrapper);\n}\n\nfunction renderPeResult(scanResult) {\n  removeAnimationClasses();\n  bodyEl.classList.remove('is-non-pe');\n  nonPeResultWrapper.classList.remove('active');\n\n  let resultIconClass = 'fas fa-check-circle'; //\n  let resultMockDisassembly = mockDisassemblyBenign; //\n  let resultBodyClass = 'result-safe-active'; //\n  let resultScannerClass = 'result-safe'; //\n  let resultProgressClass = 'progress-bar-green'; //\n  let resultScoreClass = 'score-green'; //\n  let recommendation = 'You can safely run this file.'; //\n\n  if (scanResult.classification.includes('Malware')) {\n    resultIconClass = 'fas fa-bug';\n    resultMockDisassembly = mockDisassemblyMalware;\n    resultBodyClass = 'result-malware-active'; //\n    resultScannerClass = 'result-malware'; //\n    resultProgressClass = 'progress-bar-red'; //\n    resultScoreClass = 'score-red'; //\n    recommendation = 'DO NOT OPEN. Quarantine this file immediately.'; //\n  } else if (scanResult.classification.includes('Suspicious')) {\n    resultIconClass = 'fas fa-exclamation-triangle'; //\n    resultMockDisassembly = mockDisassemblySuspicious; //\n    resultBodyClass = 'result-suspicious-active'; //\n    resultScannerClass = 'result-suspicious'; //\n    resultProgressClass = 'progress-bar-yellow'; //\n    resultScoreClass = 'score-yellow'; //\n    recommendation = 'Be cautious. Only run if you trust the source.'; //\n  }\n\n  ensureAnimationWrapper();\n  bodyEl.classList.add(resultBodyClass); //\n\n  resultState.className = `scanner-state active ${resultScannerClass}`; //\n  resultIcon.className = `result-icon ${resultIconClass}`; //\n  resultText.textContent = scanResult.classification; //\n\n  let detailsText = `Scanned ${scanResult.detected_filename}.`;\n  if (scanResult.malware_family) {\n    detailsText = `Family: ${scanResult.malware_family}`;\n  }\n  resultDetails.textContent = detailsText;\n  resultFilename.textContent = scanResult.detected_filename; //\n\n  progressBarFill.className = 'progress-bar-fill'; //\n  scorePercentage.className = 'score-percentage'; //\n  progressBarFill.classList.add(resultProgressClass); //\n  const rawConfidence = Number(scanResult.confidence_score);\n  const confidenceValue = Number.isFinite(rawConfidence) ? rawConfidence * 100 : 0;\n  progressBarFill.style.width = `${confidenceValue}%`; //\n  scorePercentage.textContent = `${Math.round(confidenceValue)}%`; //\n  scorePercentage.classList.add(resultScoreClass); //\n\n  detailsReasoning.textContent = `Filetype: ${scanResult.key_findings.file_type}. Packer: ${scanResult.key_findings.packer_detected}.`; //\n  const hashData = scanResult.file_hashes || {};\n  detailsHashSha256.textContent = hashData.sha256 || 'Not available'; //\n  detailsHashMd5.textContent = hashData.md5 || 'Not available'; //\n  updateSystemIpDisplay();\n  detailsRecommendation.textContent = recommendation;\n\n  populateVendor(scanResult.vendor); //\n  populateSignature(scanResult.key_findings.signature); //\n  populateEntropyBars(scanResult.key_findings.section_entropy || []); //\n  populateKeyStrings(scanResult.key_findings.key_strings || [], scanResult.classification); //\n\n  populateDisassembly(resultMockDisassembly); //\n\n  const apiList = scanResult.key_findings.api_imports || [];\n  const graphData = generateGraphData(apiList, scanResult.classification);\n  drawCallGraph(graphData);\n}\n\nfunction renderNonPeResult(scanResult) {\n  removeAnimationClasses();\n  bodyEl.classList.add('is-non-pe');\n  resultState.className = 'scanner-state active';\n  resultIcon.className = 'result-icon fas fa-file';\n  resultText.textContent = '';\n  resultDetails.textContent = '';\n  resultFilename.textContent = '';\n\n  const hashData = scanResult.file_hashes || {};\n  nonPeFilename.textContent = scanResult.detected_filename || '';\n  nonPeHashSha256.textContent = hashData.sha256 || 'Not available';\n  nonPeHashMd5.textContent = hashData.md5 || 'Not available';\n\n  detailsHashSha256.textContent = hashData.sha256 || 'Not available';\n  detailsHashMd5.textContent = hashData.md5 || 'Not available';\n\n  nonPeResultWrapper.classList.add('active');\n\n  callGraphEl.innerHTML = '';\n  currentGraphLines.forEach(line => line.remove());\n  currentGraphLines = [];\n  entropyBarsContainer.innerHTML = '';\n  keyStringsContainer.innerHTML = '';\n}\n\n/**\n * Clears all dynamic result data to prepare for the next scan.\n */\nfunction clearResultData() {\n    // Clear scanner panel\n    resultText.textContent = '';\n    resultDetails.textContent = '';\n    resultFilename.textContent = '';\n    nonPeResultWrapper.classList.remove('active');\n    nonPeFilename.textContent = '';\n    nonPeHashSha256.textContent = '...';\n    nonPeHashMd5.textContent = '...';\n    bodyEl.classList.remove('is-non-pe');\n\n    // Clear analysis panel\n    progressBarFill.style.width = `0%`;\n    scorePercentage.textContent = `0%`;\n    detailsReasoning.textContent = '...';\n    detailsHashSha256.textContent = '...';\n    detailsHashMd5.textContent = '...';\n    if (detailsSystemIp) {\n        detailsSystemIp.textContent = 'Detecting...';\n    }\n    detailsRecommendation.textContent = '...';\n\n    // Clear vendor\n    detailsVendor.innerHTML = `\n        <h4>Vendor Analysis</h4>\n        <div class=\"vendor-info\">\n            <i class=\"fas fa-question-circle\"></i>\n            <span>Scanning...</span>\n        </div>`;\n    \n    // Clear signature\n    detailsSignature.innerHTML = `\n        <h4>Digital Signature</h4>\n        <div class=\"signature-info\">\n            <i class=\"fas fa-question-circle\"></i>\n            <span>Checking...</span>\n        </div>`;\n    \n    // Clear internals\n    entropyBarsContainer.innerHTML = '';\n    keyStringsContainer.innerHTML = '';\n    \n    // Clear graph\n    callGraphEl.innerHTML = '';\n    currentGraphLines.forEach(line => line.remove());\n    currentGraphLines = [];\n}\n\n// --- VENDOR UI FUNCTION (IMPLEMENTED) ---\nfunction populateVendor(vendor) {\n    if (!vendor) return;\n    const icon = vendor.icon || 'fas fa-question-circle'; //\n    const name = vendor.name || 'Unknown'; //\n    detailsVendor.innerHTML = `\n        <h4>Vendor Analysis</h4> <div class=\"vendor-info\"> <i class=\"${icon}\"></i>\n            <span>${name}</span>\n        </div>\n    `;\n}\n\n// --- SIGNATURE UI FUNCTION (IMPLEMENTED) ---\nfunction populateSignature(signature) {\n    if (!signature) return;\n    let icon = signature.icon || 'fas fa-question-circle';\n    let cssClass = `sig-${signature.level || 'unknown'}`; // 'sig-verified', 'sig-untrusted', 'sig-unknown'\n\n    detailsSignature.innerHTML = `\n        <h4>Digital Signature</h4> <div class=\"signature-info ${cssClass}\"> <i class=\"${icon}\"></i>\n            <span>${signature.name}</span>\n        </div>\n    `;\n}\n\n// --- ENTROPY BARS UI FUNCTION (IMPLEMENTED) ---\nfunction populateEntropyBars(sections) {\n    entropyBarsContainer.innerHTML = ''; // Clear old bars\n    if (!sections || sections.length === 0) {\n        entropyBarsContainer.innerHTML = '<p class=\"hash-text\">No PE sections found to analyze.</p>';\n        return;\n    }\n\n    sections.forEach(section => { //\n        const value = section.entropy; //\n        const width = (value / 8.0) * 100; // Entropy is 0-8\n        let cssClass = 'low';\n        \n        if (value > 6.0) cssClass = 'medium';\n        if (value > 7.0) cssClass = 'high';\n        if (value > 7.8) cssClass = 'packed'; // Match style.css\n\n        const row = document.createElement('div');\n        row.className = 'entropy-bar-row';\n        row.innerHTML = `\n            <span class=\"entropy-bar-label\">${section.name}</span> <div class=\"entropy-bar-bg\">\n                <div class=\"entropy-bar-fill ${cssClass}\" style=\"width: ${width}%\">\n                    <span class=\"entropy-bar-value\">${value.toFixed(2)}</span>\n                </div>\n            </div>\n        `;\n        entropyBarsContainer.appendChild(row);\n    });\n}\n\n// --- KEY STRINGS UI FUNCTION (IMPLEMENTED) ---\nfunction populateKeyStrings(strings, classification) {\n    keyStringsContainer.innerHTML = ''; // Clear old strings\n    if (!strings || strings.length === 0) {\n        keyStringsContainer.innerHTML = '<span class=\"key-string-tag\">No notable strings found.</span>';\n        return;\n    }\n    \n    const tagClass = classification.includes('Benign') ? 'benign' : 'suspicious'; //\n\n    strings.forEach(str => { //\n        const tag = document.createElement('span');\n        tag.className = `key-string-tag ${tagClass}`;\n        tag.textContent = str;\n        keyStringsContainer.appendChild(tag);\n    });\n}\n\nfunction updateSystemIpDisplay() {\n    if (!detailsSystemIp || !window.electronAPI || typeof window.electronAPI.getSystemIp !== 'function') {\n        return;\n    }\n\n    detailsSystemIp.textContent = 'Detecting...';\n\n    window.electronAPI.getSystemIp()\n        .then((ip) => {\n            if (!ip) {\n                detailsSystemIp.textContent = 'Unavailable';\n                return;\n            }\n\n            detailsSystemIp.textContent = ip;\n        })\n        .catch(() => {\n            detailsSystemIp.textContent = 'Unavailable';\n        });\n}\n\nfunction removeAnimationClasses() {\n    bodyEl.classList.remove('result-safe-active');\n    bodyEl.classList.remove('result-suspicious-active');\n    bodyEl.classList.remove('result-malware-active');\n}\n\n// --- Disassembly Functions ---\n\nfunction populateDisassembly(codeLines) {\n    disassemblyCodeEl.innerHTML = '';\n    codeLines.forEach((line, index) => {\n        const lineEl = document.createElement('span');\n        lineEl.className = 'disassembly-line';\n        lineEl.id = `line-${index}`;\n        lineEl.innerHTML = line;\n        disassemblyCodeEl.appendChild(lineEl);\n    });\n}\n\nfunction startDisassemblyAnimation() {\n    if (disassemblyInterval) {\n        clearInterval(disassemblyInterval);\n    }\n    let currentLine = 0;\n    const totalLines = disassemblyCodeEl.children.length;\n\n    disassemblyInterval = setInterval(() => {\n        const prevLine = document.querySelector('.disassembly-line.active');\n        if (prevLine) {\n            prevLine.classList.remove('active');\n        }\n\n        const lineEl = document.getElementById(`line-${currentLine}`);\n        if (lineEl) {\n            lineEl.classList.add('active');\n            lineEl.scrollIntoView({\n                behavior: 'smooth',\n                block: 'center',\n                inline: 'nearest'\n            });\n        }\n        currentLine = (currentLine + 1) % totalLines;\n    }, 150);\n}\n\n/**\n * This function was MOVED here from jsonsamples.js\n * Dynamically generates the graph data based on API imports.\n * @param {string[]} apiImports - Array of API names (e.g., ['CreateRemoteThread'])\n * @param {string} classification - 'Benign', 'Suspicious', or 'Malware'\n * @returns {object} A graph object with 'nodes' and 'edges' arrays.\n */\nfunction generateGraphData(apiImports, classification) {\n    let nodes = [];\n    let edges = [];\n    const nodeSpacing = 150;\n    const startY = 100;\n    const startX = 250;\n\n    // 1. Add the Main Entry Point node\n    nodes.push({ \n        id: 'main-entry', \n        label: 'main()', \n        class: 'node-entry', \n        pos: { top: `${startY + (apiImports.length / 2) * (nodeSpacing / 2)}px`, left: '50px' } \n    });\n\n    if (!apiImports || apiImports.length === 0) {\n        // Benign/Empty graph\n        nodes.push({ id: 'benign-1', label: 'ReadFile', class: 'node-std', pos: { top: `${startY}px`, left: `${startX}px` } });\n        nodes.push({ id: 'benign-2', label: 'WriteFile', class: 'node-std', pos: { top: `${startY + nodeSpacing / 2}px`, left: `${startX}px` } });\n        edges.push({ from: 'main-entry', to: 'benign-1', options: { color: '#888' } });\n        edges.push({ from: 'main-entry', to: 'benign-2', options: { color: '#888' } });\n    } else {\n        // Suspicious/Malware graph\n        apiImports.forEach((apiName, index) => {\n            let nodeClass = 'node-api'; // Default\n            let edgeColor = '#888'; // Default\n\n            if (classification === 'Malware') {\n                nodeClass = 'node-malicious';\n                edgeColor = '#e74c3c'; // Malware red\n            } else if (classification === 'Suspicious') {\n                nodeClass = 'node-suspicious';\n                edgeColor = '#f1c40f'; // Suspicious yellow\n            } else {\n                // Benign\n                nodeClass = 'node-std';\n                edgeColor = '#888';\n            }\n\n\n            const nodeId = `api-${index}`;\n            const yPos = startY + (index * (nodeSpacing-50)); // Make them a bit closer\n            const xPos = startX + (index % 2 === 0 ? 0 : 150); // Stagger them\n\n            // Add the API node\n            nodes.push({\n                id: nodeId,\n                label: apiName,\n                class: nodeClass,\n                pos: { top: `${yPos}px`, left: `${xPos}px` }\n            });\n\n            // Add the edge from main\n            edges.push({\n                from: 'main-entry',\n                to: nodeId,\n                options: { color: edgeColor }\n            });\n        });\n    }\n\n    return { nodes, edges };\n}\n\n// --- Graph Drawing ---\nfunction drawCallGraph(graphData) {\n    // 1. Clear previous graph (both nodes and lines)\n    callGraphEl.innerHTML = '';\n    currentGraphLines.forEach(line => line.remove());\n    currentGraphLines = [];\n\n    if (!graphData || !graphData.nodes || !graphData.edges) {\n        console.error(\"Invalid graph data received\", graphData);\n        return;\n    }\n\n    // 2. Create and place all nodes\n    graphData.nodes.forEach(node => {\n        const nodeEl = document.createElement('div');\n        nodeEl.id = node.id;\n        nodeEl.className = `graph-node ${node.class}`;\n        nodeEl.style.top = node.pos.top;\n        nodeEl.style.left = node.pos.left;\n        nodeEl.textContent = node.label;\n        callGraphEl.appendChild(nodeEl);\n    });\n\n    // 3. Draw all edges (must be done *after* nodes are in DOM)\n    // Use a slight timeout to ensure DOM is ready\n    setTimeout(() => {\n        graphData.edges.forEach(edge => {\n            try {\n                const line = new LeaderLine(\n                    document.getElementById(edge.from),\n                    document.getElementById(edge.to),\n                    {\n                        color: edge.options.color,\n                        path: edge.options.path || 'straight',\n                        startSocket: edge.options.startSocket || 'auto',\n                        endSocket: edge.options.endSocket || 'auto',\n                        endPlug: 'arrow1',\n                        size: 3,\n                        endPlugSize: 1.5,\n                    }\n                );\n                currentGraphLines.push(line);\n            } catch(e) {\n                console.error(\"Could not draw line:\", e);\n            }\n        });\n    }, 500); // 500ms timeout to let CSS fade-in finish\n}\n\n\n// --- History Panel Logic ---\nasync function loadHistory() {\n  if (!historyListEl) return;\n  \n  historyListEl.innerHTML = '<li class=\"history-item-loading\">Loading...</li>';\n\n  try {\n    const historyData = await window.electronAPI.getHistory();\n\n    if (!historyData || historyData.length === 0) {\n      historyListEl.innerHTML = '<li class=\"history-item-empty\">No scan history found.</li>';\n      return;\n    }\n\n    historyListEl.innerHTML = '';\n\n    historyData.forEach(scan => {\n      const li = document.createElement('li');\n      li.className = 'history-item';\n\n      // Determine classification icon\n      let statusIcon = 'fas fa-check-circle';\n      let classType = 'safe';\n      if (scan.classification.includes('Malware')) {\n        statusIcon = 'fas fa-bug';\n        classType = 'malware';\n      } else if (scan.classification.includes('Suspicious')) {\n        statusIcon = 'fas fa-exclamation-triangle';\n        classType = 'suspicious';\n      }\n\n      // Determine file type icon based on extension\n      const filename = scan.detected_filename || '';\n      const ext = filename.split('.').pop().toLowerCase();\n      let fileTypeIcon = 'fas fa-file';\n      \n      if (['exe', 'dll', 'sys', 'msi'].includes(ext)) {\n        fileTypeIcon = 'fas fa-cog'; // Executable\n      } else if (['jpg', 'jpeg', 'png', 'gif', 'bmp', 'svg', 'webp'].includes(ext)) {\n        fileTypeIcon = 'fas fa-image'; // Image\n      } else if (['js', 'ts', 'py', 'java', 'cpp', 'c', 'h', 'cs', 'go', 'rs', 'php', 'rb'].includes(ext)) {\n        fileTypeIcon = 'fas fa-code'; // Code\n      } else if (['pdf', 'doc', 'docx', 'txt', 'rtf', 'odt'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-alt'; // Document\n      } else if (['zip', 'rar', '7z', 'tar', 'gz', 'bz2'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-archive'; // Archive\n      } else if (['mp3', 'wav', 'ogg', 'flac', 'aac'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-audio'; // Audio\n      } else if (['mp4', 'avi', 'mkv', 'mov', 'wmv', 'flv'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-video'; // Video\n      } else if (['html', 'htm', 'css', 'xml', 'json'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-code'; // Web file\n      }\n\n      const scanDate = new Date(scan.scanDate).toLocaleString();\n      const hashSha256 = scan.file_hashes?.sha256 || 'N/A';\n      const hashDisplay = hashSha256.substring(0, 16) + '...'; // Show first 16 chars\n\n      li.innerHTML = `\n        <div class=\"history-icon-wrapper\">\n          <div class=\"history-icon ${classType}\">\n            <i class=\"${statusIcon}\"></i>\n          </div>\n          <div class=\"history-file-type\">\n            <i class=\"${fileTypeIcon}\"></i>\n          </div>\n        </div>\n        <div class=\"history-details\">\n          <span class=\"history-filename\" title=\"${filename}\">${filename}</span>\n          <span class=\"history-classification ${classType}\">${scan.classification}</span>\n          <span class=\"history-hash\" title=\"${hashSha256}\">SHA256: ${hashDisplay}</span>\n        </div>\n        <span class=\"history-date\">${scanDate}</span>\n      `;\n      \n      historyListEl.appendChild(li);\n    });\n\n  } catch (err) {\n    console.error('Failed to load history:', err);\n    historyListEl.innerHTML = '<li class=\"history-item-empty\">Error loading history.</li>';\n  }\n}\n\nfunction toggleHistoryPanel() {\n  bodyEl.classList.toggle('is-history-open');\n  \n  // ADD THIS: If we are opening the panel, load the history\n  if (bodyEl.classList.contains('is-history-open')) {\n    loadHistory();\n  }\n}\n\nhistoryBtn.addEventListener('click', (e) => {\n    e.preventDefault();\n    toggleHistoryPanel();\n});\nhistoryCloseBtn.addEventListener('click', toggleHistoryPanel);\nhistoryOverlay.addEventListener('click', toggleHistoryPanel);\n\n\n// --- Auto-scroll Logic ---\nfunction startScrolling(direction) {\n    if (scrollInterval) {\n        clearInterval(scrollInterval);\n    }\n    scrollInterval = setInterval(() => {\n        window.scrollBy(0, direction * 10); // 10 pixels at a time\n    }, 20); // every 20ms\n}\n\nfunction stopScrolling() {\n    clearInterval(scrollInterval);\n    scrollInterval = null;\n}\n\nscrollZoneTop.addEventListener('mouseenter', () => {\n    startScrolling(-1); // Scroll Up\n    scrollZoneTop.classList.add('scrolling');\n});\nscrollZoneTop.addEventListener('mouseleave', () => {\n    stopScrolling();\n    scrollZoneTop.classList.remove('scrolling');\n});\n\nscrollZoneBottom.addEventListener('mouseenter', () => {\n    startScrolling(1); // Scroll Down\n    scrollZoneBottom.classList.add('scrolling');\n});\nscrollZoneBottom.addEventListener('mouseleave', () => {\n    stopScrolling();\n    scrollZoneBottom.classList.remove('scrolling');\n});\n\n\n// --- Chart instances ---\nlet malwareTypesChart = null;\nlet topMalwareChart = null;\n\n// --- Function to create/recreate charts ---\nwindow.recreateCharts = function() {\n    // Check if light theme is active\n    const isLightTheme = document.body.classList.contains('light-theme');\n    \n    // Set colors based on theme\n    const chartLegendColor = isLightTheme ? '#6c757d' : '#e0e0e0';\n    const chartAxesColor = isLightTheme ? '#6c757d' : '#aaa';\n    const chartGridColor = isLightTheme ? '#dee2e6' : '#444444';\n\n    // Destroy existing charts if they exist\n    if (malwareTypesChart) {\n        malwareTypesChart.destroy();\n    }\n    if (topMalwareChart) {\n        topMalwareChart.destroy();\n    }\n\n    // Create Malware Types Chart (Doughnut)\n    const typesCtx = document.getElementById('malwareTypesChart');\n    if (typesCtx) {\n        malwareTypesChart = new Chart(typesCtx, {\n            type: 'doughnut',\n            data: {\n                labels: ['PE (exe/dll)', 'JavaScript', 'VBS', 'Macro', 'Other'],\n                datasets: [{\n                    label: 'Submission Types',\n                    data: [65, 15, 8, 7, 5],\n                    backgroundColor: [\n                        '#007bff', // Blue\n                        '#f1c40f', // Yellow\n                        '#e74c3c', // Red\n                        '#9b59b6', // Purple\n                        '#34495e'  // Gray\n                    ],\n                    borderColor: '#2a2a2e',\n                    borderWidth: 3,\n                }]\n            },\n            options: {\n                responsive: true,\n                plugins: {\n                    legend: {\n                        position: 'right',\n                        labels: {\n                            color: chartLegendColor,\n                            boxWidth: 20\n                        }\n                    }\n                }\n            }\n        });\n    }\n\n    // Create Top Malware Chart (Line)\n    const topMalwareCtx = document.getElementById('topMalwareChart');\n    if (topMalwareCtx) {\n        topMalwareChart = new Chart(topMalwareCtx, {\n            type: 'line',\n            data: {\n                labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5'],\n                datasets: [\n                    {\n                        label: 'Zeus',\n                        data: [120, 150, 130, 180, 160],\n                        borderColor: '#e74c3c',\n                        backgroundColor: '#e74c3c20',\n                        fill: true,\n                        tension: 0.4\n                    },\n                    {\n                        label: 'WannaCry',\n                        data: [80, 90, 110, 100, 130],\n                        borderColor: '#007bff',\n                        backgroundColor: '#007bff20',\n                        fill: true,\n                        tension: 0.4\n                    },\n                    {\n                        label: 'Emotet',\n                        data: [50, 60, 80, 70, 90],\n                        borderColor: '#f1c40f',\n                        backgroundColor: '#f1c40f20',\n                        fill: true,\n                        tension: 0.4\n                    }\n                ]\n            },\n            options: {\n                responsive: true,\n                plugins: {\n                    legend: {\n                        labels: {\n                            color: chartLegendColor\n                        }\n                    }\n                },\n                scales: {\n                    x: {\n                        ticks: { color: chartAxesColor },\n                        grid: { color: chartGridColor + '50' }\n                    },\n                    y: {\n                        ticks: { color: chartAxesColor },\n                        grid: { color: chartGridColor }\n                    }\n                }\n            }\n        });\n    }\n};\n\n// --- NAVIGATION FUNCTIONS ---\nfunction updateNavigationButtons() {\n    const prevBtn = document.getElementById('prev-scan-btn');\n    const nextBtn = document.getElementById('next-scan-btn');\n    const navInfo = document.getElementById('nav-info');\n    \n    if (!prevBtn || !nextBtn) return;\n    \n    // Disable/enable buttons based on position\n    prevBtn.disabled = currentHistoryIndex <= 0;\n    nextBtn.disabled = currentHistoryIndex >= scanHistory.length - 1;\n    \n    // Update info text\n    if (navInfo && scanHistory.length > 0) {\n        navInfo.textContent = `${currentHistoryIndex + 1} of ${scanHistory.length}`;\n    }\n}\n\nfunction showPreviousScan() {\n    if (currentHistoryIndex > 0) {\n        currentHistoryIndex--;\n        lastScanResult = scanHistory[currentHistoryIndex];\n        renderScanResult();\n        updateNavigationButtons();\n    }\n}\n\nfunction showNextScan() {\n    if (currentHistoryIndex < scanHistory.length - 1) {\n        currentHistoryIndex++;\n        lastScanResult = scanHistory[currentHistoryIndex];\n        renderScanResult();\n        updateNavigationButtons();\n    }\n}\n\n// Initialize history from electron-store on load\nasync function initializeScanHistory() {\n    try {\n        const storedHistory = await window.electronAPI.getHistory();\n        if (storedHistory && Array.isArray(storedHistory)) {\n            scanHistory = storedHistory;\n            currentHistoryIndex = scanHistory.length - 1;\n        }\n    } catch (error) {\n        console.error('Failed to load scan history:', error);\n    }\n}\n\n// --- Run on Page Load ---\ndocument.addEventListener('DOMContentLoaded', () => {\n    // 1. Animate Stat Cards\n    const statNumbers = document.querySelectorAll('.stat-number');\n    statNumbers.forEach(stat => {\n        const target = +stat.getAttribute('data-target');\n        const duration = 2000;\n        const stepTime = 20;\n        const steps = duration / stepTime;\n        const increment = target / steps;\n        let current = 0;\n\n        const updateCount = () => {\n            current += increment;\n            if (current < target) {\n                stat.textContent = Math.ceil(current).toLocaleString();\n                setTimeout(updateCount, stepTime);\n            } else {\n                stat.textContent = target.toLocaleString();\n            }\n        };\n        updateCount();\n    });\n\n    // 2. Create the charts\n    recreateCharts();\n    \n    // 3. Initialize scan history\n    initializeScanHistory();\n    \n    // 4. Setup navigation button handlers\n    const prevBtn = document.getElementById('prev-scan-btn');\n    const nextBtn = document.getElementById('next-scan-btn');\n    \n    if (prevBtn) prevBtn.addEventListener('click', showPreviousScan);\n    if (nextBtn) nextBtn.addEventListener('click', showNextScan);\n});\n","epoch":144,"telemetryInfo":{}}],["file:///home/trang/localnsv/mAIware/script.js::request_65c3482f-996f-41ad-92f1-68a84ee31e00",{"uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/script.js","external":"file:///home/trang/localnsv/mAIware/script.js","path":"/home/trang/localnsv/mAIware/script.js","scheme":"file"},"requestId":"request_65c3482f-996f-41ad-92f1-68a84ee31e00","content":"// --- MOCK DISASSEMBLY DATA ---\n// (We keep this for now, as requested)\nconst mockDisassemblyBenign = [\n    `<span class=\"addr\">0x401000</span> <span class=\"op\">PUSH</span> <span class=\"args\">ebp</span> <span class=\"comment\">; setup stack frame</span>`,\n    `<span class=\"addr\">0x401001</span> <span class=\"op\">MOV</span> <span class=\"args\">ebp, esp</span>`,\n    `<span class=\"addr\">0x401003</span> <span class=\"op\">SUB</span> <span class=\"args\">esp, 48h</span>`,\n    `<span class=\"addr\">0x40100C</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4012A0</span> <span class=\"comment\">; initialize_string</span>`,\n    `<span class=\"addr\">0x401015</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4013F0</span> <span class=\"comment\">; get_user_input</span>`,\n    `<span class=\"addr\">0x40101E</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4015D0</span> <span class=\"comment\">; print_output</span>`,\n    `<span class=\"addr\">0x401028</span> <span class=\"op\">RETN</span>`,\n    `<span class=\"addr\">...</span>`,\n];\nconst mockDisassemblySuspicious = [\n    `<span class=\"addr\">0x401000</span> <span class=\"op\">PUSH</span> <span class=\"args\">ebp</span>`,\n    `<span class=\"addr\">0x401003</span> <span class=\"op\">SUB</span> <span class=\"args\">esp, 80h</span>`,\n    `<span class=\"addr\">0x40100D</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4012A0</span> <span class=\"comment\">; read_file_to_buffer</span>`,\n    `<span class=\"addr\">0x40101B</span> <span class=\"op\">REP</span> <span class=\"op\">MOVSB</span> <span class=\"comment\">; unsafe buffer write</span>`,\n    `<span class=\"addr\">0x401020</span> <span class=\"op\">JGE</span> <span class=\"args\">0x401030</span> <span class=\"comment\">; jump if overflow</span>`,\n    `<span class=\"addr\">0x401028</span> <span class=\"op\">RETN</span>`,\n    `<span class=\"addr\">...</span>`,\n];\nconst mockDisassemblyMalware = [\n    `<span class=\"addr\">0x401000</span> <span class=\"op\">PUSH</span> <span class=\"args\">ebp</span> <span class=\"comment\">; setup stack frame</span>`,\n    `<span class=\"addr\">0x40100B</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4011B0</span> <span class=\"comment\">; kernel32.LoadLibraryA</span>`,\n    `<span class=\"addr\">0x401013</span> <span class=\"op\">PUSH</span> <span class=\"string\">\"CreateRemoteThread\"</span>`,\n    `<span class=\"addr\">0x401019</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4011C0</span> <span class=\"comment\">; kernel32.GetProcAddress</span>`,\n    `<span class=\"addr\">0x401028</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4012F0</span> <span class=\"comment\">; decrypt_payload</span>`,\n    `<span class=\"addr\">0x401034</span> <span class=\"op\">CALL</span> <span class=\"args\">[ebp-24h]</span> <span class=\"comment\">; call CreateRemoteThread</span>`,\n    `<span class=\"addr\">0x401037</span> <span class=\"op\">JMP</span> <span class=\"args\">0x40102D</span> <span class=\"comment\">; loop?</span>`,\n    `<span class=\"addr\">...</span>`,\n];\n\n// --- REMOVED MOCK GRAPH DATA ---\n// const mockGraphSafe = ... (DELETED)\n// const mockGraphSuspicious = ... (DELETED)\n// const mockGraphMalware = ... (DELETED)\n\n// --- NAVIGATION STATE ---\nlet scanHistory = [];\nlet currentHistoryIndex = -1;\n\n// --- ELEMENT REFERENCES ---\nconst initialState = document.getElementById('initial-state');\nconst analyzingState = document.getElementById('analyzing-state');\nconst resultState = document.getElementById('result-state');\n\nconst analyzingFilename = document.getElementById('analyzing-filename');\nconst resultIcon = document.getElementById('result-icon');\nconst resultText = document.getElementById('result-text');\nconst resultFilename = document.getElementById('result-filename');\nconst resultDetails = document.getElementById('result-details');\nconst nonPeResultWrapper = document.getElementById('non-pe-result');\nconst nonPeFilename = document.getElementById('non-pe-filename');\nconst nonPeHashSha256 = document.getElementById('non-pe-hash-sha256');\nconst nonPeHashMd5 = document.getElementById('non-pe-hash-md5');\n\nconst bodyEl = document.body;\nlet animationWrapper = null;\n\nconst disassemblyWrapper = document.getElementById('disassembly-wrapper');\nconst disassemblyCodeEl = document.getElementById('disassembly-code');\nconst disassemblyFilenameEl = document.getElementById('disassembly-filename');\n\n// Analysis Details elements\nconst analysisDetailsWrapper = document.getElementById('analysis-details-wrapper');\nconst progressBarFill = document.getElementById('progress-bar-fill');\nconst scorePercentage = document.getElementById('score-percentage');\nconst detailsReasoning = document.getElementById('details-reasoning'); // We'll reuse this\nconst detailsHashSha256 = document.getElementById('details-hash-sha256');\nconst detailsHashMd5 = document.getElementById('details-hash-md5');\nconst detailsSystemIp = document.getElementById('details-system-ip');\nconst detailsRecommendation = document.getElementById('details-recommendation');\nconst detailsVendor = document.getElementById('details-vendor');\nconst detailsSignature = document.getElementById('details-signature');\nconst fileInternalsWrapper = document.getElementById('file-internals-wrapper');\nconst entropyBarsContainer = document.getElementById('entropy-bars-container');\nconst keyStringsContainer = document.getElementById('key-strings-container');\n\n// History Panel elements\nconst historyBtn = document.getElementById('history-btn');\nconst historyPanel = document.getElementById('history-panel');\nconst historyCloseBtn = document.getElementById('history-close-btn');\nconst historyOverlay = document.getElementById('history-overlay');\nconst historyListEl = document.querySelector('.history-list');\n\n// Scroll Zone elements\nconst scrollZoneTop = document.getElementById('scroll-zone-top');\nconst scrollZoneBottom = document.getElementById('scroll-zone-bottom');\n\n// Graph Panel elements\nconst graphWrapper = document.getElementById('graph-wrapper');\nconst callGraphEl = document.getElementById('call-graph');\n\n// Stats elements\nconst statsWrapper = document.getElementById('stats-wrapper');\n\n\n// --- STATE ---\nlet disassemblyInterval = null;\nlet scrollInterval = null; // For auto-scrolling\nlet currentGraphLines = []; // Renamed from currentLines to avoid conflict\nlet currentFileMetadata = null;\nlet lastScanResult = null;\n\n// 1. Listen for the 'scan-started' message from the backend\nwindow.electronAPI.onScanStarted((filename) => {\n  console.log(`UI: Received scan-started for ${filename}`);\n\n  // 1. Set UI to \"Analyzing\" state\n  initialState.classList.remove('active'); //\n  analyzingState.classList.add('active'); //\n  analyzingFilename.textContent = filename; //\n  disassemblyFilenameEl.textContent = filename; //\n\n  currentFileMetadata = { filename, isPe: true };\n  lastScanResult = null;\n  nonPeResultWrapper.classList.remove('active');\n  bodyEl.classList.remove('is-non-pe');\n\n  // 2. Update body class to show disassembly\n  bodyEl.classList.remove('is-showing-result'); //\n  bodyEl.classList.add('is-analyzing'); //\n  removeAnimationClasses(); //\n  \n  // 3. Populate disassembly with a \"suspicious\" default and start animation\n  // (We don't know the result yet, so we pick one)\n  populateDisassembly(mockDisassemblySuspicious); //\n  startDisassemblyAnimation(); //\n\n  // 4. Clear old results\n  clearResultData();\n});\n\n// 2. Listen for the 'scan-result' message\nwindow.electronAPI.onScanResult((scanResult) => {\n  console.log(\"UI: Received scan-result:\", scanResult);\n\n  clearInterval(disassemblyInterval); //\n  disassemblyInterval = null; //\n\n  bodyEl.classList.remove('is-analyzing'); //\n  bodyEl.classList.add('is-showing-result'); //\n\n  analyzingState.classList.remove('active'); //\n  resultState.classList.add('active'); //\n\n  // Add to history\n  scanHistory.push(scanResult);\n  currentHistoryIndex = scanHistory.length - 1;\n  \n  lastScanResult = scanResult;\n\n  renderScanResult();\n  updateNavigationButtons();\n});\n\nwindow.electronAPI.onScanFileMetadata((metadata) => {\n  if (!metadata || typeof metadata !== 'object') {\n    return;\n  }\n\n  currentFileMetadata = metadata;\n\n  if (lastScanResult && metadata.filename === lastScanResult.detected_filename) {\n    renderScanResult();\n  }\n});\n\nfunction renderScanResult() {\n  if (!lastScanResult) {\n    return;\n  }\n\n  const metadataMatches = currentFileMetadata && currentFileMetadata.filename === lastScanResult.detected_filename;\n  const isNonPe = metadataMatches && currentFileMetadata.isPe === false;\n\n  if (isNonPe) {\n    renderNonPeResult(lastScanResult);\n    return;\n  }\n\n  renderPeResult(lastScanResult);\n}\n\nfunction ensureAnimationWrapper() {\n  if (animationWrapper) {\n    return;\n  }\n\n  animationWrapper = document.createElement('div');\n  animationWrapper.className = 'animation-swarm';\n  for (let i = 0; i < 10; i++) {\n    const particle = document.createElement('span');\n    animationWrapper.appendChild(particle);\n  }\n  bodyEl.prepend(animationWrapper);\n}\n\nfunction renderPeResult(scanResult) {\n  removeAnimationClasses();\n  bodyEl.classList.remove('is-non-pe');\n  nonPeResultWrapper.classList.remove('active');\n\n  let resultIconClass = 'fas fa-check-circle'; //\n  let resultMockDisassembly = mockDisassemblyBenign; //\n  let resultBodyClass = 'result-safe-active'; //\n  let resultScannerClass = 'result-safe'; //\n  let resultProgressClass = 'progress-bar-green'; //\n  let resultScoreClass = 'score-green'; //\n  let recommendation = 'You can safely run this file.'; //\n\n  if (scanResult.classification.includes('Malware')) {\n    resultIconClass = 'fas fa-bug';\n    resultMockDisassembly = mockDisassemblyMalware;\n    resultBodyClass = 'result-malware-active'; //\n    resultScannerClass = 'result-malware'; //\n    resultProgressClass = 'progress-bar-red'; //\n    resultScoreClass = 'score-red'; //\n    recommendation = 'DO NOT OPEN. Quarantine this file immediately.'; //\n  } else if (scanResult.classification.includes('Suspicious')) {\n    resultIconClass = 'fas fa-exclamation-triangle'; //\n    resultMockDisassembly = mockDisassemblySuspicious; //\n    resultBodyClass = 'result-suspicious-active'; //\n    resultScannerClass = 'result-suspicious'; //\n    resultProgressClass = 'progress-bar-yellow'; //\n    resultScoreClass = 'score-yellow'; //\n    recommendation = 'Be cautious. Only run if you trust the source.'; //\n  }\n\n  ensureAnimationWrapper();\n  bodyEl.classList.add(resultBodyClass); //\n\n  resultState.className = `scanner-state active ${resultScannerClass}`; //\n  resultIcon.className = `result-icon ${resultIconClass}`; //\n  resultText.textContent = scanResult.classification; //\n\n  let detailsText = `Scanned ${scanResult.detected_filename}.`;\n  if (scanResult.malware_family) {\n    detailsText = `Family: ${scanResult.malware_family}`;\n  }\n  resultDetails.textContent = detailsText;\n  resultFilename.textContent = scanResult.detected_filename; //\n\n  progressBarFill.className = 'progress-bar-fill'; //\n  scorePercentage.className = 'score-percentage'; //\n  progressBarFill.classList.add(resultProgressClass); //\n  const rawConfidence = Number(scanResult.confidence_score);\n  const confidenceValue = Number.isFinite(rawConfidence) ? rawConfidence * 100 : 0;\n  progressBarFill.style.width = `${confidenceValue}%`; //\n  scorePercentage.textContent = `${Math.round(confidenceValue)}%`; //\n  scorePercentage.classList.add(resultScoreClass); //\n\n  detailsReasoning.textContent = `Filetype: ${scanResult.key_findings.file_type}. Packer: ${scanResult.key_findings.packer_detected}.`; //\n  const hashData = scanResult.file_hashes || {};\n  detailsHashSha256.textContent = hashData.sha256 || 'Not available'; //\n  detailsHashMd5.textContent = hashData.md5 || 'Not available'; //\n  updateSystemIpDisplay();\n  detailsRecommendation.textContent = recommendation;\n\n  populateVendor(scanResult.vendor); //\n  populateSignature(scanResult.key_findings.signature); //\n  populateEntropyBars(scanResult.key_findings.section_entropy || []); //\n  populateKeyStrings(scanResult.key_findings.key_strings || [], scanResult.classification); //\n\n  populateDisassembly(resultMockDisassembly); //\n\n  const apiList = scanResult.key_findings.api_imports || [];\n  const graphData = generateGraphData(apiList, scanResult.classification);\n  drawCallGraph(graphData);\n}\n\nfunction renderNonPeResult(scanResult) {\n  removeAnimationClasses();\n  bodyEl.classList.add('is-non-pe');\n  resultState.className = 'scanner-state active';\n  resultIcon.className = 'result-icon fas fa-file';\n  resultText.textContent = '';\n  resultDetails.textContent = '';\n  resultFilename.textContent = '';\n\n  const hashData = scanResult.file_hashes || {};\n  nonPeFilename.textContent = scanResult.detected_filename || '';\n  nonPeHashSha256.textContent = hashData.sha256 || 'Not available';\n  nonPeHashMd5.textContent = hashData.md5 || 'Not available';\n\n  detailsHashSha256.textContent = hashData.sha256 || 'Not available';\n  detailsHashMd5.textContent = hashData.md5 || 'Not available';\n\n  nonPeResultWrapper.classList.add('active');\n\n  callGraphEl.innerHTML = '';\n  currentGraphLines.forEach(line => line.remove());\n  currentGraphLines = [];\n  entropyBarsContainer.innerHTML = '';\n  keyStringsContainer.innerHTML = '';\n}\n\n/**\n * Clears all dynamic result data to prepare for the next scan.\n */\nfunction clearResultData() {\n    // Clear scanner panel\n    resultText.textContent = '';\n    resultDetails.textContent = '';\n    resultFilename.textContent = '';\n    nonPeResultWrapper.classList.remove('active');\n    nonPeFilename.textContent = '';\n    nonPeHashSha256.textContent = '...';\n    nonPeHashMd5.textContent = '...';\n    bodyEl.classList.remove('is-non-pe');\n\n    // Clear analysis panel\n    progressBarFill.style.width = `0%`;\n    scorePercentage.textContent = `0%`;\n    detailsReasoning.textContent = '...';\n    detailsHashSha256.textContent = '...';\n    detailsHashMd5.textContent = '...';\n    if (detailsSystemIp) {\n        detailsSystemIp.textContent = 'Detecting...';\n    }\n    detailsRecommendation.textContent = '...';\n\n    // Clear vendor\n    detailsVendor.innerHTML = `\n        <h4>Vendor Analysis</h4>\n        <div class=\"vendor-info\">\n            <i class=\"fas fa-question-circle\"></i>\n            <span>Scanning...</span>\n        </div>`;\n    \n    // Clear signature\n    detailsSignature.innerHTML = `\n        <h4>Digital Signature</h4>\n        <div class=\"signature-info\">\n            <i class=\"fas fa-question-circle\"></i>\n            <span>Checking...</span>\n        </div>`;\n    \n    // Clear internals\n    entropyBarsContainer.innerHTML = '';\n    keyStringsContainer.innerHTML = '';\n    \n    // Clear graph\n    callGraphEl.innerHTML = '';\n    currentGraphLines.forEach(line => line.remove());\n    currentGraphLines = [];\n}\n\n// --- VENDOR UI FUNCTION (IMPLEMENTED) ---\nfunction populateVendor(vendor) {\n    if (!vendor) return;\n    const icon = vendor.icon || 'fas fa-question-circle'; //\n    const name = vendor.name || 'Unknown'; //\n    detailsVendor.innerHTML = `\n        <h4>Vendor Analysis</h4> <div class=\"vendor-info\"> <i class=\"${icon}\"></i>\n            <span>${name}</span>\n        </div>\n    `;\n}\n\n// --- SIGNATURE UI FUNCTION (IMPLEMENTED) ---\nfunction populateSignature(signature) {\n    if (!signature) return;\n    let icon = signature.icon || 'fas fa-question-circle';\n    let cssClass = `sig-${signature.level || 'unknown'}`; // 'sig-verified', 'sig-untrusted', 'sig-unknown'\n\n    detailsSignature.innerHTML = `\n        <h4>Digital Signature</h4> <div class=\"signature-info ${cssClass}\"> <i class=\"${icon}\"></i>\n            <span>${signature.name}</span>\n        </div>\n    `;\n}\n\n// --- ENTROPY BARS UI FUNCTION (IMPLEMENTED) ---\nfunction populateEntropyBars(sections) {\n    entropyBarsContainer.innerHTML = ''; // Clear old bars\n    if (!sections || sections.length === 0) {\n        entropyBarsContainer.innerHTML = '<p class=\"hash-text\">No PE sections found to analyze.</p>';\n        return;\n    }\n\n    sections.forEach(section => { //\n        const value = section.entropy; //\n        const width = (value / 8.0) * 100; // Entropy is 0-8\n        let cssClass = 'low';\n        \n        if (value > 6.0) cssClass = 'medium';\n        if (value > 7.0) cssClass = 'high';\n        if (value > 7.8) cssClass = 'packed'; // Match style.css\n\n        const row = document.createElement('div');\n        row.className = 'entropy-bar-row';\n        row.innerHTML = `\n            <span class=\"entropy-bar-label\">${section.name}</span> <div class=\"entropy-bar-bg\">\n                <div class=\"entropy-bar-fill ${cssClass}\" style=\"width: ${width}%\">\n                    <span class=\"entropy-bar-value\">${value.toFixed(2)}</span>\n                </div>\n            </div>\n        `;\n        entropyBarsContainer.appendChild(row);\n    });\n}\n\n// --- KEY STRINGS UI FUNCTION (IMPLEMENTED) ---\nfunction populateKeyStrings(strings, classification) {\n    keyStringsContainer.innerHTML = ''; // Clear old strings\n    if (!strings || strings.length === 0) {\n        keyStringsContainer.innerHTML = '<span class=\"key-string-tag\">No notable strings found.</span>';\n        return;\n    }\n    \n    const tagClass = classification.includes('Benign') ? 'benign' : 'suspicious'; //\n\n    strings.forEach(str => { //\n        const tag = document.createElement('span');\n        tag.className = `key-string-tag ${tagClass}`;\n        tag.textContent = str;\n        keyStringsContainer.appendChild(tag);\n    });\n}\n\nfunction updateSystemIpDisplay() {\n    if (!detailsSystemIp || !window.electronAPI || typeof window.electronAPI.getSystemIp !== 'function') {\n        return;\n    }\n\n    detailsSystemIp.textContent = 'Detecting...';\n\n    window.electronAPI.getSystemIp()\n        .then((ip) => {\n            if (!ip) {\n                detailsSystemIp.textContent = 'Unavailable';\n                return;\n            }\n\n            detailsSystemIp.textContent = ip;\n        })\n        .catch(() => {\n            detailsSystemIp.textContent = 'Unavailable';\n        });\n}\n\nfunction removeAnimationClasses() {\n    bodyEl.classList.remove('result-safe-active');\n    bodyEl.classList.remove('result-suspicious-active');\n    bodyEl.classList.remove('result-malware-active');\n}\n\n// --- Disassembly Functions ---\n\nfunction populateDisassembly(codeLines) {\n    disassemblyCodeEl.innerHTML = '';\n    codeLines.forEach((line, index) => {\n        const lineEl = document.createElement('span');\n        lineEl.className = 'disassembly-line';\n        lineEl.id = `line-${index}`;\n        lineEl.innerHTML = line;\n        disassemblyCodeEl.appendChild(lineEl);\n    });\n}\n\nfunction startDisassemblyAnimation() {\n    if (disassemblyInterval) {\n        clearInterval(disassemblyInterval);\n    }\n    let currentLine = 0;\n    const totalLines = disassemblyCodeEl.children.length;\n\n    disassemblyInterval = setInterval(() => {\n        const prevLine = document.querySelector('.disassembly-line.active');\n        if (prevLine) {\n            prevLine.classList.remove('active');\n        }\n\n        const lineEl = document.getElementById(`line-${currentLine}`);\n        if (lineEl) {\n            lineEl.classList.add('active');\n            lineEl.scrollIntoView({\n                behavior: 'smooth',\n                block: 'center',\n                inline: 'nearest'\n            });\n        }\n        currentLine = (currentLine + 1) % totalLines;\n    }, 150);\n}\n\n/**\n * This function was MOVED here from jsonsamples.js\n * Dynamically generates the graph data based on API imports.\n * @param {string[]} apiImports - Array of API names (e.g., ['CreateRemoteThread'])\n * @param {string} classification - 'Benign', 'Suspicious', or 'Malware'\n * @returns {object} A graph object with 'nodes' and 'edges' arrays.\n */\nfunction generateGraphData(apiImports, classification) {\n    let nodes = [];\n    let edges = [];\n    const nodeSpacing = 150;\n    const startY = 100;\n    const startX = 250;\n\n    // 1. Add the Main Entry Point node\n    nodes.push({ \n        id: 'main-entry', \n        label: 'main()', \n        class: 'node-entry', \n        pos: { top: `${startY + (apiImports.length / 2) * (nodeSpacing / 2)}px`, left: '50px' } \n    });\n\n    if (!apiImports || apiImports.length === 0) {\n        // Benign/Empty graph\n        nodes.push({ id: 'benign-1', label: 'ReadFile', class: 'node-std', pos: { top: `${startY}px`, left: `${startX}px` } });\n        nodes.push({ id: 'benign-2', label: 'WriteFile', class: 'node-std', pos: { top: `${startY + nodeSpacing / 2}px`, left: `${startX}px` } });\n        edges.push({ from: 'main-entry', to: 'benign-1', options: { color: '#888' } });\n        edges.push({ from: 'main-entry', to: 'benign-2', options: { color: '#888' } });\n    } else {\n        // Suspicious/Malware graph\n        apiImports.forEach((apiName, index) => {\n            let nodeClass = 'node-api'; // Default\n            let edgeColor = '#888'; // Default\n\n            if (classification === 'Malware') {\n                nodeClass = 'node-malicious';\n                edgeColor = '#e74c3c'; // Malware red\n            } else if (classification === 'Suspicious') {\n                nodeClass = 'node-suspicious';\n                edgeColor = '#f1c40f'; // Suspicious yellow\n            } else {\n                // Benign\n                nodeClass = 'node-std';\n                edgeColor = '#888';\n            }\n\n\n            const nodeId = `api-${index}`;\n            const yPos = startY + (index * (nodeSpacing-50)); // Make them a bit closer\n            const xPos = startX + (index % 2 === 0 ? 0 : 150); // Stagger them\n\n            // Add the API node\n            nodes.push({\n                id: nodeId,\n                label: apiName,\n                class: nodeClass,\n                pos: { top: `${yPos}px`, left: `${xPos}px` }\n            });\n\n            // Add the edge from main\n            edges.push({\n                from: 'main-entry',\n                to: nodeId,\n                options: { color: edgeColor }\n            });\n        });\n    }\n\n    return { nodes, edges };\n}\n\n// --- Graph Drawing ---\nfunction drawCallGraph(graphData) {\n    // 1. Clear previous graph (both nodes and lines)\n    callGraphEl.innerHTML = '';\n    currentGraphLines.forEach(line => line.remove());\n    currentGraphLines = [];\n\n    if (!graphData || !graphData.nodes || !graphData.edges) {\n        console.error(\"Invalid graph data received\", graphData);\n        return;\n    }\n\n    // 2. Create and place all nodes\n    graphData.nodes.forEach(node => {\n        const nodeEl = document.createElement('div');\n        nodeEl.id = node.id;\n        nodeEl.className = `graph-node ${node.class}`;\n        nodeEl.style.top = node.pos.top;\n        nodeEl.style.left = node.pos.left;\n        nodeEl.textContent = node.label;\n        callGraphEl.appendChild(nodeEl);\n    });\n\n    // 3. Draw all edges (must be done *after* nodes are in DOM)\n    // Use a slight timeout to ensure DOM is ready\n    setTimeout(() => {\n        graphData.edges.forEach(edge => {\n            try {\n                const line = new LeaderLine(\n                    document.getElementById(edge.from),\n                    document.getElementById(edge.to),\n                    {\n                        color: edge.options.color,\n                        path: edge.options.path || 'straight',\n                        startSocket: edge.options.startSocket || 'auto',\n                        endSocket: edge.options.endSocket || 'auto',\n                        endPlug: 'arrow1',\n                        size: 3,\n                        endPlugSize: 1.5,\n                    }\n                );\n                currentGraphLines.push(line);\n            } catch(e) {\n                console.error(\"Could not draw line:\", e);\n            }\n        });\n    }, 500); // 500ms timeout to let CSS fade-in finish\n}\n\n\n// --- History Panel Logic ---\nasync function loadHistory() {\n  if (!historyListEl) return;\n  \n  historyListEl.innerHTML = '<li class=\"history-item-loading\">Loading...</li>';\n\n  try {\n    const historyData = await window.electronAPI.getHistory();\n\n    if (!historyData || historyData.length === 0) {\n      historyListEl.innerHTML = '<li class=\"history-item-empty\">No scan history found.</li>';\n      return;\n    }\n\n    historyListEl.innerHTML = '';\n\n    historyData.forEach(scan => {\n      const li = document.createElement('li');\n      li.className = 'history-item';\n\n      // Determine classification icon\n      let statusIcon = 'fas fa-check-circle';\n      let classType = 'safe';\n      if (scan.classification.includes('Malware')) {\n        statusIcon = 'fas fa-bug';\n        classType = 'malware';\n      } else if (scan.classification.includes('Suspicious')) {\n        statusIcon = 'fas fa-exclamation-triangle';\n        classType = 'suspicious';\n      }\n\n      // Determine file type icon based on extension\n      const filename = scan.detected_filename || '';\n      const ext = filename.split('.').pop().toLowerCase();\n      let fileTypeIcon = 'fas fa-file';\n      \n      if (['exe', 'dll', 'sys', 'msi'].includes(ext)) {\n        fileTypeIcon = 'fas fa-cog'; // Executable\n      } else if (['jpg', 'jpeg', 'png', 'gif', 'bmp', 'svg', 'webp'].includes(ext)) {\n        fileTypeIcon = 'fas fa-image'; // Image\n      } else if (['js', 'ts', 'py', 'java', 'cpp', 'c', 'h', 'cs', 'go', 'rs', 'php', 'rb'].includes(ext)) {\n        fileTypeIcon = 'fas fa-code'; // Code\n      } else if (['pdf', 'doc', 'docx', 'txt', 'rtf', 'odt'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-alt'; // Document\n      } else if (['zip', 'rar', '7z', 'tar', 'gz', 'bz2'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-archive'; // Archive\n      } else if (['mp3', 'wav', 'ogg', 'flac', 'aac'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-audio'; // Audio\n      } else if (['mp4', 'avi', 'mkv', 'mov', 'wmv', 'flv'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-video'; // Video\n      } else if (['html', 'htm', 'css', 'xml', 'json'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-code'; // Web file\n      }\n\n      const scanDate = new Date(scan.scanDate).toLocaleString();\n      const hashSha256 = scan.file_hashes?.sha256 || 'N/A';\n      const hashDisplay = hashSha256.substring(0, 16) + '...'; // Show first 16 chars\n\n      li.innerHTML = `\n        <div class=\"history-icon-wrapper\">\n          <div class=\"history-icon ${classType}\">\n            <i class=\"${statusIcon}\"></i>\n          </div>\n          <div class=\"history-file-type\">\n            <i class=\"${fileTypeIcon}\"></i>\n          </div>\n        </div>\n        <div class=\"history-details\">\n          <span class=\"history-filename\" title=\"${filename}\">${filename}</span>\n          <span class=\"history-classification ${classType}\">${scan.classification}</span>\n          <span class=\"history-hash\" title=\"${hashSha256}\">SHA256: ${hashDisplay}</span>\n        </div>\n        <span class=\"history-date\">${scanDate}</span>\n      `;\n      \n      historyListEl.appendChild(li);\n    });\n\n  } catch (err) {\n    console.error('Failed to load history:', err);\n    historyListEl.innerHTML = '<li class=\"history-item-empty\">Error loading history.</li>';\n  }\n}\n\nfunction toggleHistoryPanel() {\n  bodyEl.classList.toggle('is-history-open');\n  \n  // ADD THIS: If we are opening the panel, load the history\n  if (bodyEl.classList.contains('is-history-open')) {\n    loadHistory();\n  }\n}\n\nhistoryBtn.addEventListener('click', (e) => {\n    e.preventDefault();\n    toggleHistoryPanel();\n});\nhistoryCloseBtn.addEventListener('click', toggleHistoryPanel);\nhistoryOverlay.addEventListener('click', toggleHistoryPanel);\n\n\n// --- Auto-scroll Logic ---\nfunction startScrolling(direction) {\n    if (scrollInterval) {\n        clearInterval(scrollInterval);\n    }\n    scrollInterval = setInterval(() => {\n        window.scrollBy(0, direction * 10); // 10 pixels at a time\n    }, 20); // every 20ms\n}\n\nfunction stopScrolling() {\n    clearInterval(scrollInterval);\n    scrollInterval = null;\n}\n\nscrollZoneTop.addEventListener('mouseenter', () => {\n    startScrolling(-1); // Scroll Up\n    scrollZoneTop.classList.add('scrolling');\n});\nscrollZoneTop.addEventListener('mouseleave', () => {\n    stopScrolling();\n    scrollZoneTop.classList.remove('scrolling');\n});\n\nscrollZoneBottom.addEventListener('mouseenter', () => {\n    startScrolling(1); // Scroll Down\n    scrollZoneBottom.classList.add('scrolling');\n});\nscrollZoneBottom.addEventListener('mouseleave', () => {\n    stopScrolling();\n    scrollZoneBottom.classList.remove('scrolling');\n});\n\n\n// --- Chart instances ---\nlet malwareTypesChart = null;\nlet topMalwareChart = null;\n\n// --- Function to create/recreate charts ---\nwindow.recreateCharts = function() {\n    // Check if light theme is active\n    const isLightTheme = document.body.classList.contains('light-theme');\n    \n    // Set colors based on theme\n    const chartLegendColor = isLightTheme ? '#6c757d' : '#e0e0e0';\n    const chartAxesColor = isLightTheme ? '#6c757d' : '#aaa';\n    const chartGridColor = isLightTheme ? '#dee2e6' : '#444444';\n\n    // Destroy existing charts if they exist\n    if (malwareTypesChart) {\n        malwareTypesChart.destroy();\n    }\n    if (topMalwareChart) {\n        topMalwareChart.destroy();\n    }\n\n    // Create Malware Types Chart (Doughnut)\n    const typesCtx = document.getElementById('malwareTypesChart');\n    if (typesCtx) {\n        malwareTypesChart = new Chart(typesCtx, {\n            type: 'doughnut',\n            data: {\n                labels: ['PE (exe/dll)', 'JavaScript', 'VBS', 'Macro', 'Other'],\n                datasets: [{\n                    label: 'Submission Types',\n                    data: [65, 15, 8, 7, 5],\n                    backgroundColor: [\n                        '#007bff', // Blue\n                        '#f1c40f', // Yellow\n                        '#e74c3c', // Red\n                        '#9b59b6', // Purple\n                        '#34495e'  // Gray\n                    ],\n                    borderColor: '#2a2a2e',\n                    borderWidth: 3,\n                }]\n            },\n            options: {\n                responsive: true,\n                plugins: {\n                    legend: {\n                        position: 'right',\n                        labels: {\n                            color: chartLegendColor,\n                            boxWidth: 20\n                        }\n                    }\n                }\n            }\n        });\n    }\n\n    // Create Top Malware Chart (Line)\n    const topMalwareCtx = document.getElementById('topMalwareChart');\n    if (topMalwareCtx) {\n        topMalwareChart = new Chart(topMalwareCtx, {\n            type: 'line',\n            data: {\n                labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5'],\n                datasets: [\n                    {\n                        label: 'Zeus',\n                        data: [120, 150, 130, 180, 160],\n                        borderColor: '#e74c3c',\n                        backgroundColor: '#e74c3c20',\n                        fill: true,\n                        tension: 0.4\n                    },\n                    {\n                        label: 'WannaCry',\n                        data: [80, 90, 110, 100, 130],\n                        borderColor: '#007bff',\n                        backgroundColor: '#007bff20',\n                        fill: true,\n                        tension: 0.4\n                    },\n                    {\n                        label: 'Emotet',\n                        data: [50, 60, 80, 70, 90],\n                        borderColor: '#f1c40f',\n                        backgroundColor: '#f1c40f20',\n                        fill: true,\n                        tension: 0.4\n                    }\n                ]\n            },\n            options: {\n                responsive: true,\n                plugins: {\n                    legend: {\n                        labels: {\n                            color: chartLegendColor\n                        }\n                    }\n                },\n                scales: {\n                    x: {\n                        ticks: { color: chartAxesColor },\n                        grid: { color: chartGridColor + '50' }\n                    },\n                    y: {\n                        ticks: { color: chartAxesColor },\n                        grid: { color: chartGridColor }\n                    }\n                }\n            }\n        });\n    }\n};\n\n// --- NAVIGATION FUNCTIONS ---\nfunction updateNavigationButtons() {\n    const prevBtn = document.getElementById('prev-scan-btn');\n    const nextBtn = document.getElementById('next-scan-btn');\n    const navInfo = document.getElementById('nav-info');\n    \n    if (!prevBtn || !nextBtn) return;\n    \n    // Disable/enable buttons based on position\n    prevBtn.disabled = currentHistoryIndex <= 0;\n    nextBtn.disabled = currentHistoryIndex >= scanHistory.length - 1;\n    \n    // Update info text\n    if (navInfo && scanHistory.length > 0) {\n        navInfo.textContent = `${currentHistoryIndex + 1} of ${scanHistory.length}`;\n    }\n}\n\nfunction showPreviousScan() {\n    if (currentHistoryIndex > 0) {\n        currentHistoryIndex--;\n        lastScanResult = scanHistory[currentHistoryIndex];\n        renderScanResult();\n        updateNavigationButtons();\n    }\n}\n\nfunction showNextScan() {\n    if (currentHistoryIndex < scanHistory.length - 1) {\n        currentHistoryIndex++;\n        lastScanResult = scanHistory[currentHistoryIndex];\n        renderScanResult();\n        updateNavigationButtons();\n    }\n}\n\n// Initialize history from electron-store on load\nasync function initializeScanHistory() {\n    try {\n        const storedHistory = await window.electronAPI.getHistory();\n        if (storedHistory && Array.isArray(storedHistory)) {\n            scanHistory = storedHistory;\n            currentHistoryIndex = scanHistory.length - 1;\n        }\n    } catch (error) {\n        console.error('Failed to load scan history:', error);\n    }\n}\n\n// --- Run on Page Load ---\ndocument.addEventListener('DOMContentLoaded', () => {\n    // 1. Animate Stat Cards\n    const statNumbers = document.querySelectorAll('.stat-number');\n    statNumbers.forEach(stat => {\n        const target = +stat.getAttribute('data-target');\n        const duration = 2000;\n        const stepTime = 20;\n        const steps = duration / stepTime;\n        const increment = target / steps;\n        let current = 0;\n\n        const updateCount = () => {\n            current += increment;\n            if (current < target) {\n                stat.textContent = Math.ceil(current).toLocaleString();\n                setTimeout(updateCount, stepTime);\n            } else {\n                stat.textContent = target.toLocaleString();\n            }\n        };\n        updateCount();\n    });\n\n    // 2. Create the charts\n    recreateCharts();\n    \n    // 3. Initialize scan history\n    initializeScanHistory();\n    \n    // 4. Setup navigation button handlers\n    const prevBtn = document.getElementById('prev-scan-btn');\n    const nextBtn = document.getElementById('next-scan-btn');\n    \n    if (prevBtn) prevBtn.addEventListener('click', showPreviousScan);\n    if (nextBtn) nextBtn.addEventListener('click', showNextScan);\n});\n","epoch":152,"telemetryInfo":{}}],["file:///home/trang/localnsv/mAIware/script.js::request_91be0cc1-01fb-4211-9903-9c2be6b5539e",{"uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/script.js","external":"file:///home/trang/localnsv/mAIware/script.js","path":"/home/trang/localnsv/mAIware/script.js","scheme":"file"},"requestId":"request_91be0cc1-01fb-4211-9903-9c2be6b5539e","content":"// --- MOCK DISASSEMBLY DATA ---\n// (We keep this for now, as requested)\nconst mockDisassemblyBenign = [\n    `<span class=\"addr\">0x401000</span> <span class=\"op\">PUSH</span> <span class=\"args\">ebp</span> <span class=\"comment\">; setup stack frame</span>`,\n    `<span class=\"addr\">0x401001</span> <span class=\"op\">MOV</span> <span class=\"args\">ebp, esp</span>`,\n    `<span class=\"addr\">0x401003</span> <span class=\"op\">SUB</span> <span class=\"args\">esp, 48h</span>`,\n    `<span class=\"addr\">0x40100C</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4012A0</span> <span class=\"comment\">; initialize_string</span>`,\n    `<span class=\"addr\">0x401015</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4013F0</span> <span class=\"comment\">; get_user_input</span>`,\n    `<span class=\"addr\">0x40101E</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4015D0</span> <span class=\"comment\">; print_output</span>`,\n    `<span class=\"addr\">0x401028</span> <span class=\"op\">RETN</span>`,\n    `<span class=\"addr\">...</span>`,\n];\nconst mockDisassemblySuspicious = [\n    `<span class=\"addr\">0x401000</span> <span class=\"op\">PUSH</span> <span class=\"args\">ebp</span>`,\n    `<span class=\"addr\">0x401003</span> <span class=\"op\">SUB</span> <span class=\"args\">esp, 80h</span>`,\n    `<span class=\"addr\">0x40100D</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4012A0</span> <span class=\"comment\">; read_file_to_buffer</span>`,\n    `<span class=\"addr\">0x40101B</span> <span class=\"op\">REP</span> <span class=\"op\">MOVSB</span> <span class=\"comment\">; unsafe buffer write</span>`,\n    `<span class=\"addr\">0x401020</span> <span class=\"op\">JGE</span> <span class=\"args\">0x401030</span> <span class=\"comment\">; jump if overflow</span>`,\n    `<span class=\"addr\">0x401028</span> <span class=\"op\">RETN</span>`,\n    `<span class=\"addr\">...</span>`,\n];\nconst mockDisassemblyMalware = [\n    `<span class=\"addr\">0x401000</span> <span class=\"op\">PUSH</span> <span class=\"args\">ebp</span> <span class=\"comment\">; setup stack frame</span>`,\n    `<span class=\"addr\">0x40100B</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4011B0</span> <span class=\"comment\">; kernel32.LoadLibraryA</span>`,\n    `<span class=\"addr\">0x401013</span> <span class=\"op\">PUSH</span> <span class=\"string\">\"CreateRemoteThread\"</span>`,\n    `<span class=\"addr\">0x401019</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4011C0</span> <span class=\"comment\">; kernel32.GetProcAddress</span>`,\n    `<span class=\"addr\">0x401028</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4012F0</span> <span class=\"comment\">; decrypt_payload</span>`,\n    `<span class=\"addr\">0x401034</span> <span class=\"op\">CALL</span> <span class=\"args\">[ebp-24h]</span> <span class=\"comment\">; call CreateRemoteThread</span>`,\n    `<span class=\"addr\">0x401037</span> <span class=\"op\">JMP</span> <span class=\"args\">0x40102D</span> <span class=\"comment\">; loop?</span>`,\n    `<span class=\"addr\">...</span>`,\n];\n\n// --- REMOVED MOCK GRAPH DATA ---\n// const mockGraphSafe = ... (DELETED)\n// const mockGraphSuspicious = ... (DELETED)\n// const mockGraphMalware = ... (DELETED)\n\n// --- NAVIGATION STATE ---\nlet scanHistory = [];\nlet currentHistoryIndex = -1;\n\n// --- ELEMENT REFERENCES ---\nconst initialState = document.getElementById('initial-state');\nconst analyzingState = document.getElementById('analyzing-state');\nconst resultState = document.getElementById('result-state');\n\nconst analyzingFilename = document.getElementById('analyzing-filename');\nconst resultIcon = document.getElementById('result-icon');\nconst resultText = document.getElementById('result-text');\nconst resultFilename = document.getElementById('result-filename');\nconst resultDetails = document.getElementById('result-details');\nconst nonPeResultWrapper = document.getElementById('non-pe-result');\nconst nonPeFilename = document.getElementById('non-pe-filename');\nconst nonPeHashSha256 = document.getElementById('non-pe-hash-sha256');\nconst nonPeHashMd5 = document.getElementById('non-pe-hash-md5');\n\nconst bodyEl = document.body;\nlet animationWrapper = null;\n\nconst disassemblyWrapper = document.getElementById('disassembly-wrapper');\nconst disassemblyCodeEl = document.getElementById('disassembly-code');\nconst disassemblyFilenameEl = document.getElementById('disassembly-filename');\n\n// Analysis Details elements\nconst analysisDetailsWrapper = document.getElementById('analysis-details-wrapper');\nconst progressBarFill = document.getElementById('progress-bar-fill');\nconst scorePercentage = document.getElementById('score-percentage');\nconst detailsReasoning = document.getElementById('details-reasoning'); // We'll reuse this\nconst detailsHashSha256 = document.getElementById('details-hash-sha256');\nconst detailsHashMd5 = document.getElementById('details-hash-md5');\nconst detailsSystemIp = document.getElementById('details-system-ip');\nconst detailsRecommendation = document.getElementById('details-recommendation');\nconst detailsVendor = document.getElementById('details-vendor');\nconst detailsSignature = document.getElementById('details-signature');\nconst fileInternalsWrapper = document.getElementById('file-internals-wrapper');\nconst entropyBarsContainer = document.getElementById('entropy-bars-container');\nconst keyStringsContainer = document.getElementById('key-strings-container');\n\n// History Panel elements\nconst historyBtn = document.getElementById('history-btn');\nconst historyPanel = document.getElementById('history-panel');\nconst historyCloseBtn = document.getElementById('history-close-btn');\nconst historyOverlay = document.getElementById('history-overlay');\nconst historyListEl = document.querySelector('.history-list');\n\n// Scroll Zone elements\nconst scrollZoneTop = document.getElementById('scroll-zone-top');\nconst scrollZoneBottom = document.getElementById('scroll-zone-bottom');\n\n// Graph Panel elements\nconst graphWrapper = document.getElementById('graph-wrapper');\nconst callGraphEl = document.getElementById('call-graph');\n\n// Stats elements\nconst statsWrapper = document.getElementById('stats-wrapper');\n\n\n// --- STATE ---\nlet disassemblyInterval = null;\nlet scrollInterval = null; // For auto-scrolling\nlet currentGraphLines = []; // Renamed from currentLines to avoid conflict\nlet currentFileMetadata = null;\nlet lastScanResult = null;\n\n// 1. Listen for the 'scan-started' message from the backend\nwindow.electronAPI.onScanStarted((filename) => {\n  console.log(`UI: Received scan-started for ${filename}`);\n\n  // 1. Set UI to \"Analyzing\" state\n  initialState.classList.remove('active'); //\n  analyzingState.classList.add('active'); //\n  analyzingFilename.textContent = filename; //\n  disassemblyFilenameEl.textContent = filename; //\n\n  currentFileMetadata = { filename, isPe: true };\n  lastScanResult = null;\n  nonPeResultWrapper.classList.remove('active');\n  bodyEl.classList.remove('is-non-pe');\n\n  // 2. Update body class to show disassembly\n  bodyEl.classList.remove('is-showing-result'); //\n  bodyEl.classList.add('is-analyzing'); //\n  removeAnimationClasses(); //\n  \n  // 3. Populate disassembly with a \"suspicious\" default and start animation\n  // (We don't know the result yet, so we pick one)\n  populateDisassembly(mockDisassemblySuspicious); //\n  startDisassemblyAnimation(); //\n\n  // 4. Clear old results\n  clearResultData();\n});\n\n// 2. Listen for the 'scan-result' message\nwindow.electronAPI.onScanResult((scanResult) => {\n  console.log(\"UI: Received scan-result:\", scanResult);\n\n  clearInterval(disassemblyInterval); //\n  disassemblyInterval = null; //\n\n  bodyEl.classList.remove('is-analyzing'); //\n  bodyEl.classList.add('is-showing-result'); //\n\n  analyzingState.classList.remove('active'); //\n  resultState.classList.add('active'); //\n\n  // Add to history\n  scanHistory.push(scanResult);\n  currentHistoryIndex = scanHistory.length - 1;\n  \n  lastScanResult = scanResult;\n\n  renderScanResult();\n  updateNavigationButtons();\n});\n\nwindow.electronAPI.onScanFileMetadata((metadata) => {\n  if (!metadata || typeof metadata !== 'object') {\n    return;\n  }\n\n  currentFileMetadata = metadata;\n\n  if (lastScanResult && metadata.filename === lastScanResult.detected_filename) {\n    renderScanResult();\n  }\n});\n\nfunction renderScanResult() {\n  if (!lastScanResult) {\n    return;\n  }\n\n  const metadataMatches = currentFileMetadata && currentFileMetadata.filename === lastScanResult.detected_filename;\n  const isNonPe = metadataMatches && currentFileMetadata.isPe === false;\n\n  if (isNonPe) {\n    renderNonPeResult(lastScanResult);\n    return;\n  }\n\n  renderPeResult(lastScanResult);\n}\n\nfunction ensureAnimationWrapper() {\n  if (animationWrapper) {\n    return;\n  }\n\n  animationWrapper = document.createElement('div');\n  animationWrapper.className = 'animation-swarm';\n  for (let i = 0; i < 10; i++) {\n    const particle = document.createElement('span');\n    animationWrapper.appendChild(particle);\n  }\n  bodyEl.prepend(animationWrapper);\n}\n\nfunction renderPeResult(scanResult) {\n  removeAnimationClasses();\n  bodyEl.classList.remove('is-non-pe');\n  nonPeResultWrapper.classList.remove('active');\n\n  let resultIconClass = 'fas fa-check-circle'; //\n  let resultMockDisassembly = mockDisassemblyBenign; //\n  let resultBodyClass = 'result-safe-active'; //\n  let resultScannerClass = 'result-safe'; //\n  let resultProgressClass = 'progress-bar-green'; //\n  let resultScoreClass = 'score-green'; //\n  let recommendation = 'You can safely run this file.'; //\n\n  if (scanResult.classification.includes('Malware')) {\n    resultIconClass = 'fas fa-bug';\n    resultMockDisassembly = mockDisassemblyMalware;\n    resultBodyClass = 'result-malware-active'; //\n    resultScannerClass = 'result-malware'; //\n    resultProgressClass = 'progress-bar-red'; //\n    resultScoreClass = 'score-red'; //\n    recommendation = 'DO NOT OPEN. Quarantine this file immediately.'; //\n  } else if (scanResult.classification.includes('Suspicious')) {\n    resultIconClass = 'fas fa-exclamation-triangle'; //\n    resultMockDisassembly = mockDisassemblySuspicious; //\n    resultBodyClass = 'result-suspicious-active'; //\n    resultScannerClass = 'result-suspicious'; //\n    resultProgressClass = 'progress-bar-yellow'; //\n    resultScoreClass = 'score-yellow'; //\n    recommendation = 'Be cautious. Only run if you trust the source.'; //\n  }\n\n  ensureAnimationWrapper();\n  bodyEl.classList.add(resultBodyClass); //\n\n  resultState.className = `scanner-state active ${resultScannerClass}`; //\n  resultIcon.className = `result-icon ${resultIconClass}`; //\n  resultText.textContent = scanResult.classification; //\n\n  let detailsText = `Scanned ${scanResult.detected_filename}.`;\n  if (scanResult.malware_family) {\n    detailsText = `Family: ${scanResult.malware_family}`;\n  }\n  resultDetails.textContent = detailsText;\n  resultFilename.textContent = scanResult.detected_filename; //\n\n  progressBarFill.className = 'progress-bar-fill'; //\n  scorePercentage.className = 'score-percentage'; //\n  progressBarFill.classList.add(resultProgressClass); //\n  const rawConfidence = Number(scanResult.confidence_score);\n  const confidenceValue = Number.isFinite(rawConfidence) ? rawConfidence * 100 : 0;\n  progressBarFill.style.width = `${confidenceValue}%`; //\n  scorePercentage.textContent = `${Math.round(confidenceValue)}%`; //\n  scorePercentage.classList.add(resultScoreClass); //\n\n  detailsReasoning.textContent = `Filetype: ${scanResult.key_findings.file_type}. Packer: ${scanResult.key_findings.packer_detected}.`; //\n  const hashData = scanResult.file_hashes || {};\n  detailsHashSha256.textContent = hashData.sha256 || 'Not available'; //\n  detailsHashMd5.textContent = hashData.md5 || 'Not available'; //\n  updateSystemIpDisplay();\n  detailsRecommendation.textContent = recommendation;\n\n  populateVendor(scanResult.vendor); //\n  populateSignature(scanResult.key_findings.signature); //\n  populateEntropyBars(scanResult.key_findings.section_entropy || []); //\n  populateKeyStrings(scanResult.key_findings.key_strings || [], scanResult.classification); //\n\n  populateDisassembly(resultMockDisassembly); //\n\n  const apiList = scanResult.key_findings.api_imports || [];\n  const graphData = generateGraphData(apiList, scanResult.classification);\n  drawCallGraph(graphData);\n}\n\nfunction renderNonPeResult(scanResult) {\n  removeAnimationClasses();\n  bodyEl.classList.add('is-non-pe');\n  resultState.className = 'scanner-state active';\n  resultIcon.className = 'result-icon fas fa-file';\n  resultText.textContent = '';\n  resultDetails.textContent = '';\n  resultFilename.textContent = '';\n\n  const hashData = scanResult.file_hashes || {};\n  nonPeFilename.textContent = scanResult.detected_filename || '';\n  nonPeHashSha256.textContent = hashData.sha256 || 'Not available';\n  nonPeHashMd5.textContent = hashData.md5 || 'Not available';\n\n  detailsHashSha256.textContent = hashData.sha256 || 'Not available';\n  detailsHashMd5.textContent = hashData.md5 || 'Not available';\n\n  nonPeResultWrapper.classList.add('active');\n\n  callGraphEl.innerHTML = '';\n  currentGraphLines.forEach(line => line.remove());\n  currentGraphLines = [];\n  entropyBarsContainer.innerHTML = '';\n  keyStringsContainer.innerHTML = '';\n}\n\n/**\n * Clears all dynamic result data to prepare for the next scan.\n */\nfunction clearResultData() {\n    // Clear scanner panel\n    resultText.textContent = '';\n    resultDetails.textContent = '';\n    resultFilename.textContent = '';\n    nonPeResultWrapper.classList.remove('active');\n    nonPeFilename.textContent = '';\n    nonPeHashSha256.textContent = '...';\n    nonPeHashMd5.textContent = '...';\n    bodyEl.classList.remove('is-non-pe');\n\n    // Clear analysis panel\n    progressBarFill.style.width = `0%`;\n    scorePercentage.textContent = `0%`;\n    detailsReasoning.textContent = '...';\n    detailsHashSha256.textContent = '...';\n    detailsHashMd5.textContent = '...';\n    if (detailsSystemIp) {\n        detailsSystemIp.textContent = 'Detecting...';\n    }\n    detailsRecommendation.textContent = '...';\n\n    // Clear vendor\n    detailsVendor.innerHTML = `\n        <h4>Vendor Analysis</h4>\n        <div class=\"vendor-info\">\n            <i class=\"fas fa-question-circle\"></i>\n            <span>Scanning...</span>\n        </div>`;\n    \n    // Clear signature\n    detailsSignature.innerHTML = `\n        <h4>Digital Signature</h4>\n        <div class=\"signature-info\">\n            <i class=\"fas fa-question-circle\"></i>\n            <span>Checking...</span>\n        </div>`;\n    \n    // Clear internals\n    entropyBarsContainer.innerHTML = '';\n    keyStringsContainer.innerHTML = '';\n    \n    // Clear graph\n    callGraphEl.innerHTML = '';\n    currentGraphLines.forEach(line => line.remove());\n    currentGraphLines = [];\n}\n\n// --- VENDOR UI FUNCTION (IMPLEMENTED) ---\nfunction populateVendor(vendor) {\n    if (!vendor) return;\n    const icon = vendor.icon || 'fas fa-question-circle'; //\n    const name = vendor.name || 'Unknown'; //\n    detailsVendor.innerHTML = `\n        <h4>Vendor Analysis</h4> <div class=\"vendor-info\"> <i class=\"${icon}\"></i>\n            <span>${name}</span>\n        </div>\n    `;\n}\n\n// --- SIGNATURE UI FUNCTION (IMPLEMENTED) ---\nfunction populateSignature(signature) {\n    if (!signature) return;\n    let icon = signature.icon || 'fas fa-question-circle';\n    let cssClass = `sig-${signature.level || 'unknown'}`; // 'sig-verified', 'sig-untrusted', 'sig-unknown'\n\n    detailsSignature.innerHTML = `\n        <h4>Digital Signature</h4> <div class=\"signature-info ${cssClass}\"> <i class=\"${icon}\"></i>\n            <span>${signature.name}</span>\n        </div>\n    `;\n}\n\n// --- ENTROPY BARS UI FUNCTION (IMPLEMENTED) ---\nfunction populateEntropyBars(sections) {\n    entropyBarsContainer.innerHTML = ''; // Clear old bars\n    if (!sections || sections.length === 0) {\n        entropyBarsContainer.innerHTML = '<p class=\"hash-text\">No PE sections found to analyze.</p>';\n        return;\n    }\n\n    sections.forEach(section => { //\n        const value = section.entropy; //\n        const width = (value / 8.0) * 100; // Entropy is 0-8\n        let cssClass = 'low';\n        \n        if (value > 6.0) cssClass = 'medium';\n        if (value > 7.0) cssClass = 'high';\n        if (value > 7.8) cssClass = 'packed'; // Match style.css\n\n        const row = document.createElement('div');\n        row.className = 'entropy-bar-row';\n        row.innerHTML = `\n            <span class=\"entropy-bar-label\">${section.name}</span> <div class=\"entropy-bar-bg\">\n                <div class=\"entropy-bar-fill ${cssClass}\" style=\"width: ${width}%\">\n                    <span class=\"entropy-bar-value\">${value.toFixed(2)}</span>\n                </div>\n            </div>\n        `;\n        entropyBarsContainer.appendChild(row);\n    });\n}\n\n// --- KEY STRINGS UI FUNCTION (IMPLEMENTED) ---\nfunction populateKeyStrings(strings, classification) {\n    keyStringsContainer.innerHTML = ''; // Clear old strings\n    if (!strings || strings.length === 0) {\n        keyStringsContainer.innerHTML = '<span class=\"key-string-tag\">No notable strings found.</span>';\n        return;\n    }\n    \n    const tagClass = classification.includes('Benign') ? 'benign' : 'suspicious'; //\n\n    strings.forEach(str => { //\n        const tag = document.createElement('span');\n        tag.className = `key-string-tag ${tagClass}`;\n        tag.textContent = str;\n        keyStringsContainer.appendChild(tag);\n    });\n}\n\nfunction updateSystemIpDisplay() {\n    if (!detailsSystemIp || !window.electronAPI || typeof window.electronAPI.getSystemIp !== 'function') {\n        return;\n    }\n\n    detailsSystemIp.textContent = 'Detecting...';\n\n    window.electronAPI.getSystemIp()\n        .then((ip) => {\n            if (!ip) {\n                detailsSystemIp.textContent = 'Unavailable';\n                return;\n            }\n\n            detailsSystemIp.textContent = ip;\n        })\n        .catch(() => {\n            detailsSystemIp.textContent = 'Unavailable';\n        });\n}\n\nfunction removeAnimationClasses() {\n    bodyEl.classList.remove('result-safe-active');\n    bodyEl.classList.remove('result-suspicious-active');\n    bodyEl.classList.remove('result-malware-active');\n}\n\n// --- Disassembly Functions ---\n\nfunction populateDisassembly(codeLines) {\n    disassemblyCodeEl.innerHTML = '';\n    codeLines.forEach((line, index) => {\n        const lineEl = document.createElement('span');\n        lineEl.className = 'disassembly-line';\n        lineEl.id = `line-${index}`;\n        lineEl.innerHTML = line;\n        disassemblyCodeEl.appendChild(lineEl);\n    });\n}\n\nfunction startDisassemblyAnimation() {\n    if (disassemblyInterval) {\n        clearInterval(disassemblyInterval);\n    }\n    let currentLine = 0;\n    const totalLines = disassemblyCodeEl.children.length;\n\n    disassemblyInterval = setInterval(() => {\n        const prevLine = document.querySelector('.disassembly-line.active');\n        if (prevLine) {\n            prevLine.classList.remove('active');\n        }\n\n        const lineEl = document.getElementById(`line-${currentLine}`);\n        if (lineEl) {\n            lineEl.classList.add('active');\n            lineEl.scrollIntoView({\n                behavior: 'smooth',\n                block: 'center',\n                inline: 'nearest'\n            });\n        }\n        currentLine = (currentLine + 1) % totalLines;\n    }, 150);\n}\n\n/**\n * This function was MOVED here from jsonsamples.js\n * Dynamically generates the graph data based on API imports.\n * @param {string[]} apiImports - Array of API names (e.g., ['CreateRemoteThread'])\n * @param {string} classification - 'Benign', 'Suspicious', or 'Malware'\n * @returns {object} A graph object with 'nodes' and 'edges' arrays.\n */\nfunction generateGraphData(apiImports, classification) {\n    let nodes = [];\n    let edges = [];\n    const nodeSpacing = 150;\n    const startY = 100;\n    const startX = 250;\n\n    // 1. Add the Main Entry Point node\n    nodes.push({ \n        id: 'main-entry', \n        label: 'main()', \n        class: 'node-entry', \n        pos: { top: `${startY + (apiImports.length / 2) * (nodeSpacing / 2)}px`, left: '50px' } \n    });\n\n    if (!apiImports || apiImports.length === 0) {\n        // Benign/Empty graph\n        nodes.push({ id: 'benign-1', label: 'ReadFile', class: 'node-std', pos: { top: `${startY}px`, left: `${startX}px` } });\n        nodes.push({ id: 'benign-2', label: 'WriteFile', class: 'node-std', pos: { top: `${startY + nodeSpacing / 2}px`, left: `${startX}px` } });\n        edges.push({ from: 'main-entry', to: 'benign-1', options: { color: '#888' } });\n        edges.push({ from: 'main-entry', to: 'benign-2', options: { color: '#888' } });\n    } else {\n        // Suspicious/Malware graph\n        apiImports.forEach((apiName, index) => {\n            let nodeClass = 'node-api'; // Default\n            let edgeColor = '#888'; // Default\n\n            if (classification === 'Malware') {\n                nodeClass = 'node-malicious';\n                edgeColor = '#e74c3c'; // Malware red\n            } else if (classification === 'Suspicious') {\n                nodeClass = 'node-suspicious';\n                edgeColor = '#f1c40f'; // Suspicious yellow\n            } else {\n                // Benign\n                nodeClass = 'node-std';\n                edgeColor = '#888';\n            }\n\n\n            const nodeId = `api-${index}`;\n            const yPos = startY + (index * (nodeSpacing-50)); // Make them a bit closer\n            const xPos = startX + (index % 2 === 0 ? 0 : 150); // Stagger them\n\n            // Add the API node\n            nodes.push({\n                id: nodeId,\n                label: apiName,\n                class: nodeClass,\n                pos: { top: `${yPos}px`, left: `${xPos}px` }\n            });\n\n            // Add the edge from main\n            edges.push({\n                from: 'main-entry',\n                to: nodeId,\n                options: { color: edgeColor }\n            });\n        });\n    }\n\n    return { nodes, edges };\n}\n\n// --- Graph Drawing ---\nfunction drawCallGraph(graphData) {\n    // 1. Clear previous graph (both nodes and lines)\n    callGraphEl.innerHTML = '';\n    currentGraphLines.forEach(line => line.remove());\n    currentGraphLines = [];\n\n    if (!graphData || !graphData.nodes || !graphData.edges) {\n        console.error(\"Invalid graph data received\", graphData);\n        return;\n    }\n\n    // 2. Create and place all nodes\n    graphData.nodes.forEach(node => {\n        const nodeEl = document.createElement('div');\n        nodeEl.id = node.id;\n        nodeEl.className = `graph-node ${node.class}`;\n        nodeEl.style.top = node.pos.top;\n        nodeEl.style.left = node.pos.left;\n        nodeEl.textContent = node.label;\n        callGraphEl.appendChild(nodeEl);\n    });\n\n    // 3. Draw all edges (must be done *after* nodes are in DOM)\n    // Use a slight timeout to ensure DOM is ready\n    setTimeout(() => {\n        graphData.edges.forEach(edge => {\n            try {\n                const line = new LeaderLine(\n                    document.getElementById(edge.from),\n                    document.getElementById(edge.to),\n                    {\n                        color: edge.options.color,\n                        path: edge.options.path || 'straight',\n                        startSocket: edge.options.startSocket || 'auto',\n                        endSocket: edge.options.endSocket || 'auto',\n                        endPlug: 'arrow1',\n                        size: 3,\n                        endPlugSize: 1.5,\n                    }\n                );\n                currentGraphLines.push(line);\n            } catch(e) {\n                console.error(\"Could not draw line:\", e);\n            }\n        });\n    }, 500); // 500ms timeout to let CSS fade-in finish\n}\n\n\n// --- History Panel Logic ---\nasync function loadHistory() {\n  if (!historyListEl) return;\n  \n  historyListEl.innerHTML = '<li class=\"history-item-loading\">Loading...</li>';\n\n  try {\n    const historyData = await window.electronAPI.getHistory();\n\n    if (!historyData || historyData.length === 0) {\n      historyListEl.innerHTML = '<li class=\"history-item-empty\">No scan history found.</li>';\n      return;\n    }\n\n    historyListEl.innerHTML = '';\n\n    historyData.forEach(scan => {\n      const li = document.createElement('li');\n      li.className = 'history-item';\n\n      // Determine classification icon\n      let statusIcon = 'fas fa-check-circle';\n      let classType = 'safe';\n      if (scan.classification.includes('Malware')) {\n        statusIcon = 'fas fa-bug';\n        classType = 'malware';\n      } else if (scan.classification.includes('Suspicious')) {\n        statusIcon = 'fas fa-exclamation-triangle';\n        classType = 'suspicious';\n      }\n\n      // Determine file type icon based on extension\n      const filename = scan.detected_filename || '';\n      const ext = filename.split('.').pop().toLowerCase();\n      let fileTypeIcon = 'fas fa-file';\n      \n      if (['exe', 'dll', 'sys', 'msi'].includes(ext)) {\n        fileTypeIcon = 'fas fa-cog'; // Executable\n      } else if (['jpg', 'jpeg', 'png', 'gif', 'bmp', 'svg', 'webp'].includes(ext)) {\n        fileTypeIcon = 'fas fa-image'; // Image\n      } else if (['js', 'ts', 'py', 'java', 'cpp', 'c', 'h', 'cs', 'go', 'rs', 'php', 'rb'].includes(ext)) {\n        fileTypeIcon = 'fas fa-code'; // Code\n      } else if (['pdf', 'doc', 'docx', 'txt', 'rtf', 'odt'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-alt'; // Document\n      } else if (['zip', 'rar', '7z', 'tar', 'gz', 'bz2'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-archive'; // Archive\n      } else if (['mp3', 'wav', 'ogg', 'flac', 'aac'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-audio'; // Audio\n      } else if (['mp4', 'avi', 'mkv', 'mov', 'wmv', 'flv'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-video'; // Video\n      } else if (['html', 'htm', 'css', 'xml', 'json'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-code'; // Web file\n      }\n\n      const scanDate = new Date(scan.scanDate).toLocaleString();\n      const hashSha256 = scan.file_hashes?.sha256 || 'N/A';\n      const hashDisplay = hashSha256.substring(0, 16) + '...'; // Show first 16 chars\n\n      li.innerHTML = `\n        <div class=\"history-icon-wrapper\">\n          <div class=\"history-icon ${classType}\">\n            <i class=\"${statusIcon}\"></i>\n          </div>\n          <div class=\"history-file-type\">\n            <i class=\"${fileTypeIcon}\"></i>\n          </div>\n        </div>\n        <div class=\"history-details\">\n          <span class=\"history-filename\" title=\"${filename}\">${filename}</span>\n          <span class=\"history-classification ${classType}\">${scan.classification}</span>\n          <span class=\"history-hash\" title=\"${hashSha256}\">SHA256: ${hashDisplay}</span>\n        </div>\n        <span class=\"history-date\">${scanDate}</span>\n      `;\n      \n      historyListEl.appendChild(li);\n    });\n\n  } catch (err) {\n    console.error('Failed to load history:', err);\n    historyListEl.innerHTML = '<li class=\"history-item-empty\">Error loading history.</li>';\n  }\n}\n\nfunction toggleHistoryPanel() {\n  bodyEl.classList.toggle('is-history-open');\n  \n  // ADD THIS: If we are opening the panel, load the history\n  if (bodyEl.classList.contains('is-history-open')) {\n    loadHistory();\n  }\n}\n\nhistoryBtn.addEventListener('click', (e) => {\n    e.preventDefault();\n    toggleHistoryPanel();\n});\nhistoryCloseBtn.addEventListener('click', toggleHistoryPanel);\nhistoryOverlay.addEventListener('click', toggleHistoryPanel);\n\n\n// --- Auto-scroll Logic ---\nfunction startScrolling(direction) {\n    if (scrollInterval) {\n        clearInterval(scrollInterval);\n    }\n    scrollInterval = setInterval(() => {\n        window.scrollBy(0, direction * 10); // 10 pixels at a time\n    }, 20); // every 20ms\n}\n\nfunction stopScrolling() {\n    clearInterval(scrollInterval);\n    scrollInterval = null;\n}\n\nscrollZoneTop.addEventListener('mouseenter', () => {\n    startScrolling(-1); // Scroll Up\n    scrollZoneTop.classList.add('scrolling');\n});\nscrollZoneTop.addEventListener('mouseleave', () => {\n    stopScrolling();\n    scrollZoneTop.classList.remove('scrolling');\n});\n\nscrollZoneBottom.addEventListener('mouseenter', () => {\n    startScrolling(1); // Scroll Down\n    scrollZoneBottom.classList.add('scrolling');\n});\nscrollZoneBottom.addEventListener('mouseleave', () => {\n    stopScrolling();\n    scrollZoneBottom.classList.remove('scrolling');\n});\n\n\n// --- Chart instances ---\nlet malwareTypesChart = null;\nlet topMalwareChart = null;\n\n// --- Function to create/recreate charts ---\nwindow.recreateCharts = function() {\n    // Check if light theme is active\n    const isLightTheme = document.body.classList.contains('light-theme');\n    \n    // Set colors based on theme\n    const chartLegendColor = isLightTheme ? '#6c757d' : '#e0e0e0';\n    const chartAxesColor = isLightTheme ? '#6c757d' : '#aaa';\n    const chartGridColor = isLightTheme ? '#dee2e6' : '#444444';\n\n    // Destroy existing charts if they exist\n    if (malwareTypesChart) {\n        malwareTypesChart.destroy();\n    }\n    if (topMalwareChart) {\n        topMalwareChart.destroy();\n    }\n\n    // Create Malware Types Chart (Doughnut)\n    const typesCtx = document.getElementById('malwareTypesChart');\n    if (typesCtx) {\n        malwareTypesChart = new Chart(typesCtx, {\n            type: 'doughnut',\n            data: {\n                labels: ['PE (exe/dll)', 'JavaScript', 'VBS', 'Macro', 'Other'],\n                datasets: [{\n                    label: 'Submission Types',\n                    data: [65, 15, 8, 7, 5],\n                    backgroundColor: [\n                        '#007bff', // Blue\n                        '#f1c40f', // Yellow\n                        '#e74c3c', // Red\n                        '#9b59b6', // Purple\n                        '#34495e'  // Gray\n                    ],\n                    borderColor: '#2a2a2e',\n                    borderWidth: 3,\n                }]\n            },\n            options: {\n                responsive: true,\n                plugins: {\n                    legend: {\n                        position: 'right',\n                        labels: {\n                            color: chartLegendColor,\n                            boxWidth: 20\n                        }\n                    }\n                }\n            }\n        });\n    }\n\n    // Create Top Malware Chart (Line)\n    const topMalwareCtx = document.getElementById('topMalwareChart');\n    if (topMalwareCtx) {\n        topMalwareChart = new Chart(topMalwareCtx, {\n            type: 'line',\n            data: {\n                labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5'],\n                datasets: [\n                    {\n                        label: 'Zeus',\n                        data: [120, 150, 130, 180, 160],\n                        borderColor: '#e74c3c',\n                        backgroundColor: '#e74c3c20',\n                        fill: true,\n                        tension: 0.4\n                    },\n                    {\n                        label: 'WannaCry',\n                        data: [80, 90, 110, 100, 130],\n                        borderColor: '#007bff',\n                        backgroundColor: '#007bff20',\n                        fill: true,\n                        tension: 0.4\n                    },\n                    {\n                        label: 'Emotet',\n                        data: [50, 60, 80, 70, 90],\n                        borderColor: '#f1c40f',\n                        backgroundColor: '#f1c40f20',\n                        fill: true,\n                        tension: 0.4\n                    }\n                ]\n            },\n            options: {\n                responsive: true,\n                plugins: {\n                    legend: {\n                        labels: {\n                            color: chartLegendColor\n                        }\n                    }\n                },\n                scales: {\n                    x: {\n                        ticks: { color: chartAxesColor },\n                        grid: { color: chartGridColor + '50' }\n                    },\n                    y: {\n                        ticks: { color: chartAxesColor },\n                        grid: { color: chartGridColor }\n                    }\n                }\n            }\n        });\n    }\n};\n\n// --- NAVIGATION FUNCTIONS ---\nfunction updateNavigationButtons() {\n    const prevBtn = document.getElementById('prev-scan-btn');\n    const nextBtn = document.getElementById('next-scan-btn');\n    const navInfo = document.getElementById('nav-info');\n    \n    if (!prevBtn || !nextBtn) return;\n    \n    // Disable/enable buttons based on position\n    prevBtn.disabled = currentHistoryIndex <= 0;\n    nextBtn.disabled = currentHistoryIndex >= scanHistory.length - 1;\n    \n    // Update info text\n    if (navInfo && scanHistory.length > 0) {\n        navInfo.textContent = `${currentHistoryIndex + 1} of ${scanHistory.length}`;\n    }\n}\n\nfunction showPreviousScan() {\n    if (currentHistoryIndex > 0) {\n        currentHistoryIndex--;\n        lastScanResult = scanHistory[currentHistoryIndex];\n        renderScanResult();\n        updateNavigationButtons();\n    }\n}\n\nfunction showNextScan() {\n    if (currentHistoryIndex < scanHistory.length - 1) {\n        currentHistoryIndex++;\n        lastScanResult = scanHistory[currentHistoryIndex];\n        renderScanResult();\n        updateNavigationButtons();\n    }\n}\n\n// Initialize history from electron-store on load\nasync function initializeScanHistory() {\n    try {\n        const storedHistory = await window.electronAPI.getHistory();\n        if (storedHistory && Array.isArray(storedHistory)) {\n            scanHistory = storedHistory;\n            currentHistoryIndex = scanHistory.length - 1;\n        }\n    } catch (error) {\n        console.error('Failed to load scan history:', error);\n    }\n}\n\n// --- Run on Page Load ---\ndocument.addEventListener('DOMContentLoaded', () => {\n    // 1. Animate Stat Cards\n    const statNumbers = document.querySelectorAll('.stat-number');\n    statNumbers.forEach(stat => {\n        const target = +stat.getAttribute('data-target');\n        const duration = 2000;\n        const stepTime = 20;\n        const steps = duration / stepTime;\n        const increment = target / steps;\n        let current = 0;\n\n        const updateCount = () => {\n            current += increment;\n            if (current < target) {\n                stat.textContent = Math.ceil(current).toLocaleString();\n                setTimeout(updateCount, stepTime);\n            } else {\n                stat.textContent = target.toLocaleString();\n            }\n        };\n        updateCount();\n    });\n\n    // 2. Create the charts\n    recreateCharts();\n    \n    // 3. Initialize scan history\n    initializeScanHistory();\n    \n    // 4. Setup navigation button handlers\n    const prevBtn = document.getElementById('prev-scan-btn');\n    const nextBtn = document.getElementById('next-scan-btn');\n    \n    if (prevBtn) prevBtn.addEventListener('click', showPreviousScan);\n    if (nextBtn) nextBtn.addEventListener('click', showNextScan);\n});\n","epoch":156,"telemetryInfo":{}}],["file:///home/trang/localnsv/mAIware/index.html::request_0bd3737c-96a7-45c8-bdaa-69c39a73dfda",{"uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/index.html","external":"file:///home/trang/localnsv/mAIware/index.html","path":"/home/trang/localnsv/mAIware/index.html","scheme":"file"},"requestId":"request_0bd3737c-96a7-45c8-bdaa-69c39a73dfda","content":"<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>mAIware AI Malware Detection Demo</title>\n    <!-- Font Awesome for icons (which you already had) -->\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css\">\n    <!-- Chart.js for stats (which you already had) -->\n    <script src=\"https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js\"></script>\n    <!-- Link to the CSS file -->\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n\n<body>\n    <nav class=\"top-nav\">\n        <div class=\"logo\"> <i class=\"fas fa-shield-virus\"></i> <span>mAIware</span> </div>\n        <div class=\"nav-links\"> <a href=\"#\" class=\"nav-link\" data-tooltip=\"Login\"><i class=\"fas fa-sign-in-alt\"></i><span class=\"link-text\">Login</span></a> <a href=\"#\" class=\"nav-link\" data-tooltip=\"Sign Up\"><i class=\"fas fa-user-plus\"></i><span class=\"link-text\">Sign Up</span></a> <a href=\"#\" class=\"nav-link\" data-tooltip=\"Community\"><i class=\"fas fa-users\"></i><span class=\"link-text\">Community</span></a> <a href=\"#\" class=\"nav-link\" data-tooltip=\"API Docs\"><i class=\"fas fa-code\"></i><span class=\"link-text\">API</span></a> <a href=\"#\" id=\"history-btn\" class=\"nav-link\" data-tooltip=\"Scan History\"><i class=\"fas fa-history\"></i><span class=\"link-text\">History</span></a> <a href=\"#\" class=\"nav-link\" id=\"theme-toggle\" data-tooltip=\"Toggle Theme\"> <i class=\"fas fa-sun\"></i> </a> </div>\n    </nav>\n\n    <main class=\"main-container\">\n        <!-- Column 1 -->\n        <div class=\"scanner-wrapper\">\n            <!-- Main Scanner Box -->\n            <div class=\"scanner-container\">\n                <h1>AI Malware Detection</h1>\n                \n                <!-- Navigation Controls (Top Position) -->\n                <div class=\"scan-navigation scan-navigation-top\">\n                    <button id=\"prev-scan-btn\" class=\"nav-btn\" disabled>\n                        <i class=\"fas fa-chevron-left\"></i> Previous\n                    </button>\n                    <span id=\"nav-info\" class=\"nav-info\">1 of 1</span>\n                    <button id=\"next-scan-btn\" class=\"nav-btn\" disabled>\n                        Next <i class=\"fas fa-chevron-right\"></i>\n                    </button>\n                </div>\n                \n                <!-- State 1: Initial -->\n                <div id=\"initial-state\" class=\"scanner-state active\">\n                    <p>Watching your Downloads folder for new files...</p>\n                    <div id=\"drop-zone\" class=\"upload-zone\"> <i class=\"upload-icon fas fa-eye\"></i>\n                        <h3>Automatic Scanning Active</h3>\n                        <span>(Download a file to begin)</span>\n                    </div>\n                </div>\n\n                <!-- State 2: Analyzing -->\n                <div id=\"analyzing-state\" class=\"scanner-state\">\n                    <div class=\"analyzing-icon\">\n                        <div class=\"loader\"></div>\n                    </div>\n                    <h3>Analyzing...</h3> <span class=\"filename\" id=\"analyzing-filename\">demo_file.exe</span> </div>\n\n                <!-- State 3: Result -->\n                <div id=\"result-state\" class=\"scanner-state\"> <i class=\"result-icon\" id=\"result-icon\"></i>\n                    <h2 id=\"result-text\"></h2>\n                    <div class=\"filename\" id=\"result-filename\"></div>\n                    <p id=\"result-details\"></p>\n                    <!-- Removed the resetDemo() button as it's automatic now -->\n                </div>\n                <div id=\"non-pe-result\" class=\"scanner-state non-pe-result\">\n                    <div class=\"non-pe-icon\"><i class=\"fas fa-file\"></i></div>\n                    <h2 id=\"non-pe-title\">File is not a Windows PE executable</h2>\n                    <p class=\"filename\" id=\"non-pe-filename\"></p>\n                    <div class=\"non-pe-hash-grid\">\n                        <div class=\"non-pe-hash\">\n                            <h4>SHA256</h4>\n                            <p id=\"non-pe-hash-sha256\">...</p>\n                        </div>\n                        <div class=\"non-pe-hash\">\n                            <h4>MD5</h4>\n                            <p id=\"non-pe-hash-md5\">...</p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Analysis Details (Shows on result) -->\n            <div class=\"analysis-details-container\" id=\"analysis-details-wrapper\">\n                <div class=\"progress-header\">\n                    <h3>Malware Confidence</h3> <span class=\"score-percentage\" id=\"score-percentage\">0%</span> </div>\n                <div class=\"progress-bar-background\">\n                    <div class=\"progress-bar-fill\" id=\"progress-bar-fill\" style=\"width: 0%;\"></div>\n                </div>\n\n                <!-- This grid holds Vendor and Signature -->\n                <div class=\"details-grid\">\n                    <!-- Vendor UI Container -->\n                    <div class=\"details-section\" id=\"details-vendor\">\n                        <h4>Vendor Analysis</h4>\n                        <div class=\"vendor-info\">\n                            <i class=\"fas fa-question-circle\"></i>\n                            <span>Scanning...</span>\n                        </div>\n                    </div>\n                    <!-- Signature UI Container -->\n                    <div class=\"details-section\" id=\"details-signature\">\n                        <h4>Digital Signature</h4>\n                        <div class=\"signature-info\">\n                            <i class=\"fas fa-question-circle\"></i>\n                            <span>Checking...</span>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Reasoning (File Type/Packer) -->\n                <div class=\"details-section\">\n                    <h4>Key Findings</h4>\n                    <p id=\"details-reasoning\">...</p>\n                </div>\n                \n                <div class=\"details-section\">\n                    <h4>SHA256 Hash</h4>\n                    <p class=\"hash-text\" id=\"details-hash-sha256\">...</p>\n                </div>\n\n                <div class=\"details-section\">\n                    <h4>MD5 Hash</h4>\n                    <p class=\"hash-text\" id=\"details-hash-md5\">...</p>\n                </div>\n\n                <div class=\"details-section\">\n                    <h4>System IP</h4>\n                    <p class=\"hash-text\" id=\"details-system-ip\">Detecting...</p>\n                </div>\n\n                <div class=\"details-section\">\n                    <h4>What To Do Next</h4>\n                    <p id=\"details-recommendation\">...</p>\n                </div>\n\n                <div class=\"btn-wrapper\"> <button class=\"btn btn-primary\"><i class=\"fas fa-download\"></i> Download Report</button> <button class=\"btn btn-secondary\"><i class=\"fas fa-flag\"></i> Report False Positive</button> </div>\n            </div>\n        </div>\n\n        <!-- Column 2 -->\n        <div class=\"right-panel-wrapper\">\n            <!-- Stats (Shows on initial) -->\n            <div class=\"stats-wrapper\" id=\"stats-wrapper\">\n                <div class=\"stats-grid\">\n                    <div class=\"stat-card\"> <i class=\"fas fa-virus-slash\"></i>\n                        <div class=\"stat-content\"> <span class=\"stat-number\" data-target=\"14720938\">0</span> <span class=\"stat-label\">Malware Analyzed</span> </div>\n                    </div>\n                    <div class=\"stat-card\"> <i class=\"fas fa-users\"></i>\n                        <div class=\"stat-content\"> <span class=\"stat-number\" data-target=\"82041\">0</span> <span class=\"stat-label\">Active Users</span> </div>\n                    </div>\n                    <div class=\"stat-card\"> <i class=\"fas fa-chart-line\"></i>\n                        <div class=\"stat-content\"> <span class=\"stat-number\" data-target=\"1259024\">0</span> <span class=\"stat-label\">Site Visits (24h)</span> </div>\n                    </div>\n                </div>\n                <div class=\"chart-container-wrapper\">\n                    <div class=\"chart-container\">\n                        <h3>Top 5 Malware Families (30 Days)</h3> <canvas id=\"topMalwareChart\"></canvas> </div>\n                    <div class=\"chart-container\">\n                        <h3>Submission Types</h3> <canvas id=\"malwareTypesChart\"></canvas> </div>\n                </div>\n            </div>\n\n            <!-- Disassembly (Shows on analyzing/result) -->\n            <div class=\"disassembly-wrapper\" id=\"disassembly-wrapper\">\n                <div class=\"disassembly-header\">\n                    <h3>Disassembly: <span id=\"disassembly-filename\"></span></h3>\n                </div>\n                <div class=\"disassembly-code\" id=\"disassembly-code\"> </div>\n            </div>\n\n            <!-- File Internals (Shows on result) -->\n            <div class=\"file-internals-container\" id=\"file-internals-wrapper\">\n                <h3>File Internals</h3>\n                \n                <!-- Entropy UI Container -->\n                <div class=\"details-section\">\n                    <h4>Section Entropy (0=Normal, 8=Packed/Encrypted)</h4>\n                    <div class=\"entropy-bars\" id=\"entropy-bars-container\">\n                        <!-- JS will populate this -->\n                    </div>\n                </div>\n                \n                <!-- Key Strings UI Container -->\n                <div class=\"details-section\">\n                    <h4>Suspicious / Key Strings</h4>\n                    <div class=\"key-strings\" id=\"key-strings-container\">\n                        <!-- JS will populate this -->\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Full Width Row -->\n        <div class=\"graph-wrapper\" id=\"graph-wrapper\">\n            <div class=\"graph-header\">\n                <h3>Dynamic Function Call Graph (Simulation)</h3>\n            </div>\n            <div class=\"call-graph-container\">\n                <div class=\"call-graph\" id=\"call-graph\">\n                    <!-- JS will populate this -->\n                </div>\n            </div>\n        </div>\n    </main>\n\n    <!-- History Panel (Hidden by default) -->\n    <div class=\"history-overlay\" id=\"history-overlay\"></div>\n    <div class=\"history-panel\" id=\"history-panel\">\n        <div class=\"history-header\">\n            <h3>Scan History</h3> <button class=\"history-close-btn\" id=\"history-close-btn\"><i class=\"fas fa-times\"></i></button> </div>\n        <ul class=\"history-list\">\n            <!-- JS would populate this -->\n        </ul>\n    </div>\n\n    <!-- Scroll Zones -->\n    <div class=\"scroll-zone top\" id=\"scroll-zone-top\"><i class=\"fas fa-chevron-up\"></i></div>\n    <div class=\"scroll-zone bottom\" id=\"scroll-zone-bottom\"><i class=\"fas fa-chevron-down\"></i></div>\n    \n    <!-- LeaderLine for graph (which you already had) -->\n    <script src=\"https://cdn.jsdelivr.net/npm/leader-line-new@1.1.9/leader-line.min.js\"></script>\n    <!-- Link to the JS file -->\n    <script src=\"script.js\"></script>\n\n    <script>\n    // Apply saved theme class immediately (before DOMContentLoaded)\n    const savedTheme = localStorage.getItem('theme') || 'dark';\n    if (savedTheme === 'light') {\n        document.body.classList.add('light-theme');\n    }\n    \n    document.addEventListener('DOMContentLoaded', () => {\n        const themeToggleButton = document.getElementById('theme-toggle');\n        const body = document.body;\n        const themeIcon = themeToggleButton.querySelector('i');\n\n        // Set icon based on current theme\n        if (body.classList.contains('light-theme')) {\n            themeIcon.classList.remove('fa-sun');\n            themeIcon.classList.add('fa-moon');\n        }\n\n        // Function to apply the saved theme\n        const applyTheme = (theme) => {\n            if (theme === 'light') {\n                body.classList.add('light-theme');\n                themeIcon.classList.remove('fa-sun');\n                themeIcon.classList.add('fa-moon');\n            } else {\n                body.classList.remove('light-theme');\n                themeIcon.classList.remove('fa-moon');\n                themeIcon.classList.add('fa-sun');\n            }\n            \n            // Recreate charts with updated theme colors\n            if (window.recreateCharts) {\n                window.recreateCharts();\n            }\n        };\n\n        // Add click event for the toggle button\n        themeToggleButton.addEventListener('click', (e) => {\n            e.preventDefault(); // Stop the link from navigating\n            \n            // Check current theme\n            const isLightTheme = body.classList.contains('light-theme');\n            \n            // Set new theme\n            const newTheme = isLightTheme ? 'dark' : 'light';\n            \n            // Apply the new theme\n            applyTheme(newTheme);\n            \n            // Save the new theme to localStorage\n            localStorage.setItem('theme', newTheme);\n        });\n    });\n    </script>\n</body>\n</html>\n","epoch":160,"telemetryInfo":{}}],["file:///home/trang/localnsv/mAIware/style.css::request_0bd3737c-96a7-45c8-bdaa-69c39a73dfda",{"uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/style.css","external":"file:///home/trang/localnsv/mAIware/style.css","path":"/home/trang/localnsv/mAIware/style.css","scheme":"file"},"requestId":"request_0bd3737c-96a7-45c8-bdaa-69c39a73dfda","content":"/* --- Global & Fonts --- */\n:root {\n    /* --- Dark Theme (Default) --- */\n    --bg-dark-1: #121212;\n    --bg-dark-2: #1e1e1e;\n    --bg-dark-3: #2a2a2e;\n    --bg-dark-4: #333333;\n    --border-color: #444444;\n    --text-light: #e0e0e0;\n    --text-medium: #aaa;\n    --text-dark: #888;\n    \n    /* --- Semantic Colors --- */\n    --blue: #007bff;\n    --red: #e74c3c;\n    --yellow: #f1c40f;\n    --green: #2ecc71;\n    \n    /* --- Syntax & Node Colors --- */\n    --syntax-op: #c39eff;\n    --syntax-string: #e6db74;\n    --syntax-const-text: #ffffff; /* Constant white for dark buttons/nodes */\n    --node-bg-entry: #254a25;\n    --node-bg-api: #2a3e4a;\n    --node-bg-suspicious: #4a452a;\n    --node-bg-malicious: #4a2a2a;\n\n    --chart-legend-text: var(--text-light);  /* #e0e0e0 */\n    --chart-axes-text: var(--text-medium);   /* #aaa */\n    --chart-grid-line: var(--border-color);\n}\n\n/* --- Light Theme --- */\n/* Add \".light-theme\" to the <body> tag to activate */\nbody.light-theme {\n    --bg-dark-1: #f8f9fa;     /* Main background */\n    --bg-dark-2: #ffffff;     /* Card background */\n    --bg-dark-3: #e9ecef;     /* Hover/active background */\n    --bg-dark-4: #ced4da;     /* Secondary button background */\n    --border-color: #dee2e6;  /* Border color */\n    --text-light: #212529;    /* Main text */\n    --text-medium: #6c757d;   /* Secondary text */\n    --text-dark: #888;        /* Tertiary text (can stay gray) */\n    \n    /* Semantic colors are unchanged */\n    /* --blue, --red, --yellow, --green */\n    \n    /* --- Light Theme Syntax --- */\n    --syntax-op: #a040ff;       /* Darker purple */\n    --syntax-string: #b8860b;     /* Dark goldenrod */\n    --syntax-const-text: #ffffff; /* Stays white for colored buttons/nodes */\n    \n    /* Node backgrounds are unchanged, they look good on a light BG */\n    --chart-legend-text: var(--text-medium); /* User Request */\n    --chart-axes-text: var(--text-medium);   /* User Request */\n    --chart-grid-line: var(--border-color);\n}\n\n\n/* Apply overflow-x to html as well */\nhtml {\n    overflow-x: hidden;\n    font-size: 16px; /* Ensure base font size */\n}\n\nbody {\n    font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n    background-color: var(--bg-dark-1);\n    color: var(--text-light);\n    margin: 0;\n    padding-top: 60px; /* Make space for fixed top nav */\n    overflow-x: hidden; /* Prevent horizontal scroll */\n    width: 100%;\n    min-height: 100vh;\n}\n\n/* --- Main Grid Container --- */\n.main-container {\n    display: grid;\n    grid-template-columns: 1fr 1fr; /* Simpler 2-column definition */\n    grid-template-rows: auto auto; /* Rows for content and graph */\n    gap: 2rem;\n    padding: 2rem; /* Spacing from nav and screen edges */\n    align-items: start;\n    \n    /* Set max-width on the grid itself */\n    max-width: 1400px; \n    /* Center the whole grid */\n    margin: 0 auto; \n    \n    min-height: calc(100vh - 60px); /* Full height minus nav */\n    box-sizing: border-box;\n    width: 100%;\n}\n\n.scanner-wrapper {\n    grid-column: 1 / 2; /* Span first column */\n    grid-row: 1 / 2;\n    display: flex;\n    flex-direction: column;\n    gap: 1.5rem;\n    width: 100%; /* Fill the column */\n}\n\n.right-panel-wrapper {\n    grid-column: 2 / 3; /* Span second column */\n    grid-row: 1 / 2;\n    display: flex; /* Make it a flex container */\n    flex-direction: column; /* Stack its children vertically */\n    gap: 1.5rem; /* Space between its children */\n    width: 100%; /* Fill the column */\n}\n\n.graph-wrapper {\n    grid-column: 1 / 3; /* Span BOTH columns */\n    grid-row: 2 / 3;\n    width: 100%;\n    /* max-width is now inherited from main-container */\n    justify-self: center; /* Center in the grid area */\n}\n\n\n/* --- Top Navigation --- */\n.top-nav {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    height: 60px;\n    background-color: var(--bg-dark-2);\n    border-bottom: 1px solid var(--border-color);\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 0 2rem;\n    z-index: 1000;\n    box-sizing: border-box;\n}\n\n.top-nav .logo {\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n    font-size: 1.3rem;\n    font-weight: 600;\n    color: var(--text-light);\n}\n\n.top-nav .logo i {\n    color: var(--blue);\n}\n\n.nav-links {\n    display: flex;\n    gap: 0.5rem;\n}\n\n.nav-link {\n    color: var(--text-medium);\n    font-size: 1.25rem;\n    padding: 0.75rem;\n    border-radius: 8px;\n    transition: all 0.2s ease;\n    position: relative;\n    text-decoration: none;\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n}\n\n.nav-link .link-text {\n    font-size: 0.9rem;\n    font-weight: 500;\n    max-width: 0;\n    overflow: hidden;\n    white-space: nowrap;\n    transition: all 0.3s ease;\n}\n\n.nav-link:hover {\n    background-color: var(--bg-dark-3);\n    color: var(--text-light);\n}\n\n.nav-link:hover .link-text {\n    max-width: 80px; /* Expand text on hover */\n    margin-left: 0.25rem;\n}\n\n/* --- Tooltip --- */\n.nav-link:hover::before {\n    content: attr(data-tooltip);\n    position: absolute;\n    bottom: -35px;\n    left: 50%;\n    transform: translateX(-50%);\n    background-color: var(--bg-dark-3);\n    color: var(--text-light);\n    padding: 5px 10px;\n    border-radius: 4px;\n    font-size: 0.8rem;\n    white-space: nowrap;\n    opacity: 0;\n    transition: opacity 0.2s 0.3s; /* Delay tooltip */\n    pointer-events: none;\n}\n.nav-link:hover .link-text {\n    display: none; /* Hide expanded text if tooltip is showing */\n}\n.nav-link:hover:hover::before {\n    opacity: 1;\n}\n\n/* On smaller screens, stack the columns */\n@media (max-width: 1280px) { /* Widened breakpoint */\n    .main-container {\n        grid-template-columns: 1fr; /* Stack columns */\n        padding: 1rem;\n    }\n    .scanner-wrapper, .right-panel-wrapper, .graph-wrapper {\n        grid-column: 1 / 2; /* All in one column */\n        max-width: 100%;\n        justify-self: center;\n    }\n    .right-panel-wrapper {\n        grid-row: 2 / 3;\n    }\n    .graph-wrapper {\n        grid-row: 3 / 4;\n    }\n}\n\n/* Hide link text on very small screens */\n@media (max-width: 768px) {\n    .nav-link .link-text { display: none; }\n    .nav-link:hover .link-text { display: none; }\n    .top-nav { padding: 0 1rem; }\n}\n\n\n/* --- Main Scanner Box --- */\n.scanner-container {\n    width: 100%; /* Ensure it fills its flex parent */\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n    padding: 2.5rem;\n    text-align: center;\n    overflow: hidden;\n    transition: all 0.3s ease;\n    box-sizing: border-box; /* Include padding in width */\n}\n\nh1 {\n    color: var(--text-light);\n    margin-top: 0;\n    margin-bottom: 1rem;\n}\n\n.scanner-container p {\n    color: var(--text-medium);\n    margin-bottom: 2rem;\n    font-size: 1.1rem;\n}\n\n.scanner-state {\n    display: none;\n}\n.scanner-state.active {\n    display: block;\n}\n\n/* --- State 1: Upload --- */\n.upload-zone {\n    border: 2px dashed var(--border-color);\n    border-radius: 8px;\n    padding: 3rem 2rem;\n    cursor: pointer;\n    transition: all 0.3s ease;\n}\n.upload-zone:hover {\n    background-color: var(--bg-dark-3);\n    border-color: var(--blue);\n}\n.upload-icon {\n    font-size: 4rem;\n    color: var(--blue);\n    margin-bottom: 1rem;\n}\n.upload-zone h3 {\n    margin: 0;\n    color: var(--text-light);\n}\n.upload-zone span {\n    color: var(--text-dark);\n}\n\n/* --- State 2: Analyzing --- */\n.analyzing-icon .loader {\n    width: 80px;\n    height: 80px;\n    border: 6px solid var(--bg-dark-4);\n    border-top-color: var(--blue);\n    border-radius: 50%;\n    animation: spin 1s linear infinite;\n    margin: 2rem auto;\n}\n@keyframes spin {\n    to { transform: rotate(360deg); }\n}\n.analyzing-state h3 {\n    color: var(--text-light);\n    margin-bottom: 0.5rem;\n}\n.analyzing-state .filename,\n.result-state .filename {\n    color: var(--text-medium);\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 1.1rem;\n    word-break: break-all;\n}\n\n/* --- State 3: Result --- */\n.result-icon {\n    font-size: 6rem;\n    line-height: 1;\n    margin: 1.5rem 0;\n}\n.result-state h2 {\n    font-size: 2.5rem;\n    margin: 0 0 0.5rem 0;\n}\n.result-malware .result-icon, .result-malware h2 { color: var(--red); }\n.result-suspicious .result-icon, .result-suspicious h2 { color: var(--yellow); }\n.result-safe .result-icon, .result-safe h2 { color: var(--green); }\n.result-state p {\n    font-size: 1rem;\n    margin-bottom: 2rem;\n}\n\n/* --- Scan Navigation Controls --- */\n.scan-navigation {\n    display: none;\n    align-items: center;\n    justify-content: center;\n    gap: 1.5rem;\n    margin: 1.5rem 0;\n    padding: 1rem;\n    background: rgba(255, 255, 255, 0.03);\n    border-radius: 8px;\n}\n\n/* Show navigation only when results are displayed */\nbody.is-showing-result .scan-navigation,\nbody.is-non-pe .scan-navigation {\n    display: flex;\n}\n\n.nav-btn {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    padding: 0.75rem 1.5rem;\n    background: linear-gradient(135deg, var(--primary), var(--secondary));\n    color: white;\n    border: none;\n    border-radius: 8px;\n    font-size: 1rem;\n    font-weight: 600;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);\n}\n\n.nav-btn:hover:not(:disabled) {\n    transform: translateY(-2px);\n    box-shadow: 0 6px 20px rgba(139, 92, 246, 0.5);\n}\n\n.nav-btn:active:not(:disabled) {\n    transform: translateY(0);\n}\n\n.nav-btn:disabled {\n    background: rgba(255, 255, 255, 0.1) !important;\n    color: rgba(255, 255, 255, 0.3) !important;\n    cursor: not-allowed;\n    box-shadow: none !important;\n}\n\n.nav-info {\n    color: var(--text-medium);\n    font-size: 0.95rem;\n    font-weight: 500;\n    min-width: 80px;\n    text-align: center;\n}\n\n.non-pe-result {\n    display: none;\n    flex-direction: column;\n    align-items: center;\n    gap: 1.5rem;\n    color: var(--text-light);\n    padding: 1rem 0 0 0;\n}\n\n.non-pe-result.active {\n    display: flex;\n}\n\n.non-pe-icon {\n    width: 96px;\n    height: 96px;\n    border-radius: 24px;\n    background: linear-gradient(135deg, rgba(80, 130, 255, 0.2), rgba(80, 130, 255, 0.05));\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 3rem;\n    color: var(--blue);\n}\n\n.non-pe-hash-grid {\n    display: flex;\n    gap: 1.5rem;\n    flex-wrap: wrap;\n    justify-content: center;\n}\n\n.non-pe-hash {\n    min-width: 220px;\n    background: var(--bg-dark-3);\n    padding: 1rem 1.25rem;\n    border-radius: 12px;\n    border: 1px solid rgba(255, 255, 255, 0.05);\n    text-align: left;\n}\n\n.non-pe-hash h4 {\n    margin: 0 0 0.5rem 0;\n    font-size: 0.85rem;\n    text-transform: uppercase;\n    letter-spacing: 0.08rem;\n    color: var(--text-medium);\n}\n\n.non-pe-hash p {\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.9rem;\n    word-break: break-all;\n    color: var(--text-light);\n}\n\nbody.is-non-pe .analysis-details-container,\nbody.is-non-pe #analysis-details-wrapper,\nbody.is-non-pe #disassembly-wrapper,\nbody.is-non-pe #file-internals-wrapper,\nbody.is-non-pe #graph-wrapper {\n    display: none !important;\n}\n\nbody.is-non-pe #result-state {\n    display: none !important;\n}\n\nbody.is-non-pe .non-pe-result {\n    display: flex;\n}\n\n\n/* --- NEW: Stats Dashboard Panel --- */\n.stats-wrapper {\n    display: flex; \n    flex-direction: column;\n    gap: 1.5rem;\n    width: 100%; /* Fill its flex parent */\n    box-sizing: border-box; /* Include padding in width */\n}\n\n/* By default, stats are visible, disassembly is hidden */\n.disassembly-wrapper { display: none; }\n\n/* When analyzing/showing results, hide stats and show disassembly */\nbody.is-analyzing .stats-wrapper,\nbody.is-showing-result .stats-wrapper {\n    display: none;\n}\nbody.is-analyzing .disassembly-wrapper,\nbody.is-showing-result .disassembly-wrapper {\n    display: flex; /* Use flex to match its own styles */\n}\n\n\n.stats-grid {\n    display: flex; \n    flex-direction: column;\n    /* Force stacking */\n    gap: 1.5rem;\n}\n\n.stat-card {\n    display: flex;\n    align-items: center;\n    gap: 1.5rem;\n    background-color: var(--bg-dark-2);\n    padding: 1.5rem;\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n}\n.stat-card i {\n    font-size: 2.5rem;\n    color: var(--blue);\n}\n.stat-content {\n    display: flex;\n    flex-direction: column;\n}\n.stat-number {\n    font-size: 2rem;\n    font-weight: 600;\n    color: var(--text-light);\n    line-height: 1.2;\n}\n.stat-label {\n    font-size: 0.9rem;\n    color: var(--text-medium);\n}\n\n.chart-container-wrapper {\n    display: flex;\n    flex-direction: column;\n    gap: 1.5rem;\n}\n\n.chart-container {\n    background-color: var(--bg-dark-2);\n    padding: 1.5rem;\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    box-sizing: border-box;\n}\n.chart-container h3 {\n    margin-top: 0;\n    margin-bottom: 1.5rem;\n    text-align: center;\n    color: var(--text-light);\n    font-size: 1.1rem;\n}\n\n\n/* --- Disassembly Panel --- */\n.disassembly-wrapper {\n    /* display: none; set by default now */\n    flex-direction: column;\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n    height: 600px; /* Fixed height */\n    max-height: 70vh;\n    opacity: 0;\n    transition: all 0.3s ease;\n    width: 100%;\n    box-sizing: border-box;\n}\n\nbody.is-analyzing .disassembly-wrapper,\nbody.is-showing-result .disassembly-wrapper {\n    opacity: 1;\n}\n\n.disassembly-header {\n    padding: 1rem 1.5rem;\n    border-bottom: 1px solid var(--border-color);\n    background-color: var(--bg-dark-3);\n    border-radius: 12px 12px 0 0;\n}\n.disassembly-header h3 {\n    margin: 0;\n    color: var(--text-light);\n    font-size: 1.1rem;\n    font-family: 'Courier New', Courier, monospace;\n}\n.disassembly-code {\n    flex-grow: 1;\n    overflow-y: auto;\n    padding: 1rem;\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.95rem;\n}\n.disassembly-line {\n    display: block;\n    padding: 2px 1rem;\n    border-radius: 4px;\n    transition: background-color 0.2s ease;\n}\n.disassembly-line.active {\n    background-color: var(--blue);\n    color: var(--syntax-const-text); /* MODIFIED */\n}\n.disassembly-line .addr { color: var(--text-dark); margin-right: 1rem; }\n.disassembly-line .op { color: var(--syntax-op); font-weight: bold; width: 50px; display: inline-block; } /* MODIFIED */\n.disassembly-line .args { color: var(--text-light); }\n.disassembly-line .string { color: var(--syntax-string); } /* MODIFIED */\n.disassembly-line .comment { color: var(--green); margin-left: 1rem; }\n\n\n/* --- Analysis Details Panel --- */\n.analysis-details-container {\n    width: 100%;\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    padding: 2rem;\n    display: none; /* Hidden by default */\n    box-sizing: border-box;\n}\nbody.is-showing-result .analysis-details-container {\n    display: block;\n}\n\n.progress-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 0.75rem;\n}\n.progress-header h3 {\n    margin: 0;\n    font-size: 1.1rem;\n    color: var(--text-light);\n}\n.score-percentage {\n    font-size: 1.2rem;\n    font-weight: 600;\n}\n.score-green { color: var(--green); }\n.score-yellow { color: var(--yellow); }\n.score-red { color: var(--red); }\n\n.progress-bar-background {\n    width: 100%;\n    height: 12px;\n    background-color: var(--bg-dark-3);\n    border-radius: 6px;\n    overflow: hidden;\n    margin-bottom: 1.5rem;\n}\n.progress-bar-fill {\n    height: 100%;\n    width: 0%;\n    border-radius: 6px;\n    transition: width 0.5s ease;\n}\n.progress-bar-green { background-color: var(--green); }\n.progress-bar-yellow { background-color: var(--yellow); }\n.progress-bar-red { background-color: var(--red); }\n\n.details-section {\n    margin-bottom: 1.25rem;\n}\n.details-section h4 {\n    margin: 0 0 0.5rem 0;\n    color: var(--text-medium);\n    font-size: 0.9rem;\n    text-transform: uppercase;\n}\n.details-section p {\n    margin: 0;\n    color: var(--text-light);\n    font-size: 1rem;\n}\n.hash-text {\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.95rem;\n    word-break: break-all;\n}\n\n/* --- Vendor & Signature --- */\n.details-grid {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 1.5rem;\n    margin-bottom: 1.25rem;\n}\n.vendor-info, .signature-info {\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n    font-size: 1rem;\n    font-weight: 500;\n}\n.vendor-info i {\n    font-size: 1.5rem;\n    color: var(--text-medium);\n}\n.signature-info i {\n    font-size: 1.25rem;\n}\n/* Use the levels from datasrcs.js */\n.sig-verified { color: var(--green); }\n.sig-untrusted { color: var(--red); }\n.sig-unknown { color: var(--yellow); }\n\n/* --- File Internals Card --- */\n.file-internals-container {\n    width: 100%;\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    padding: 2rem;\n    display: none; /* Hidden by default */\n    box-sizing: border-box;\n    flex-direction: column;\n    gap: 1.5rem;\n}\nbody.is-showing-result .file-internals-container {\n    display: flex;\n}\n.file-internals-container h3 {\n    margin-top: 0;\n    margin-bottom: 0;\n    color: var(--text-light);\n    font-size: 1.25rem;\n    padding-bottom: 1rem;\n    border-bottom: 1px solid var(--border-color);\n}\n\n/* --- Entropy Bars --- */\n.entropy-bars {\n    display: flex;\n    flex-direction: column;\n    gap: 0.75rem;\n}\n.entropy-bar-row {\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n}\n.entropy-bar-label {\n    width: 60px;\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.9rem;\n    color: var(--text-medium);\n    flex-shrink: 0;\n}\n.entropy-bar-bg {\n    flex-grow: 1;\n    height: 20px;\n    background-color: var(--bg-dark-3);\n    border-radius: 4px;\n    overflow: hidden;\n}\n.entropy-bar-fill {\n    height: 100%;\n    width: 0%; /* Set by JS */\n    background-color: var(--blue);\n    border-radius: 4px;\n    transition: width 0.5s ease;\n    display: flex;\n    justify-content: flex-end;\n    align-items: center;\n    padding-right: 0.5rem;\n    box-sizing: border-box;\n}\n.entropy-bar-value {\n    font-size: 0.8rem;\n    font-weight: bold;\n    color: var(--syntax-const-text); /* MODIFIED */\n    text-shadow: 0 0 3px rgba(0,0,0,0.5);\n}\n/* Color coding for entropy bars */\n.entropy-bar-fill.low { background-color: var(--green); }\n.entropy-bar-fill.medium { background-color: var(--blue); }\n.entropy-bar-fill.high { background-color: var(--yellow); }\n.entropy-bar-fill.packed { background-color: var(--red); }\n\n/* --- Key Strings --- */\n.key-strings {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 0.5rem;\n}\n.key-string-tag {\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.9rem;\n    background-color: var(--bg-dark-3);\n    border: 1px solid var(--border-color);\n    padding: 0.25rem 0.5rem;\n    border-radius: 4px;\n    color: var(--text-light);\n}\n.key-string-tag.suspicious {\n    border-color: var(--red);\n    color: var(--red);\n    background-color: #e74c3c1a;\n}\n.key-string-tag.benign {\n    border-color: var(--green);\n    color: var(--green);\n    background-color: #2ecc711a;\n}\n\n/* --- Buttons --- */\n.btn-wrapper {\n    margin-top: 2rem;\n    display: flex;\n    gap: 1rem;\n}\n.btn {\n    flex-grow: 1; /* Make buttons fill space */\n    background-color: var(--blue);\n    color: var(--syntax-const-text); /* MODIFIED */\n    border: none;\n    padding: 12px 24px;\n    border-radius: 6px;\n    font-size: 1rem;\n    font-weight: bold;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    text-decoration: none;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    gap: 0.5rem;\n}\n.btn:hover {\n    filter: brightness(1.2);\n}\n.btn-primary {\n    background-color: var(--blue);\n}\n.btn-secondary {\n    background-color: var(--bg-dark-4);\n    color: var(--text-light);\n}\n.btn-secondary:hover {\n    background-color: #555;\n}\n.btn i {\n    margin-right: 0.25rem;\n}\n\n\n/* --- Background Particle Animations --- */\n.animation-swarm {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%; \n    height: 100%;\n    z-index: -1;\n    pointer-events: none;\n    overflow: hidden; \n}\n\n/* Base style for each new span particle */\n.animation-swarm span {\n    position: absolute;\n    top: -20px; /* Start off-screen */\n    font-size: 1.5rem;\n    opacity: 0; /* Start invisible */\n    animation: fall 10s linear infinite;\n}\n\n/* The ::before holds the icon content */\n.animation-swarm span::before {\n    content: '';\n    font-family: \"Font Awesome 6 Free\";\n    font-weight: 900;\n    text-shadow: 0 0 5px;\n}\n\n/* Keyframes for falling (starts with opacity) */\n@keyframes fall {\n    0% {\n        transform: translateY(0vh) rotate(0);\n        opacity: 0.3;\n    }\n    100% {\n        transform: translateY(105vh) rotate(360deg);\n        opacity: 0;\n    }\n}\n\n/* Set icon and color based on body class */\nbody.result-safe-active .animation-swarm span::before {\n    content: '\\f132'; /* fa-shield-halved */\n    color: var(--green);\n}\nbody.result-suspicious-active .animation-swarm span::before {\n    content: '\\f071'; /* fa-exclamation-triangle */\n    color: var(--yellow);\n}\nbody.result-malware-active .animation-swarm span::before {\n    content: '\\f188'; /* fa-bug */\n    color: var(--red);\n}\n\n/* Give each particle a unique position and delay --- THIS IS THE FINAL FIX --- */\n/* All values are kept well away from the 90-100% range */\n.animation-swarm span:nth-child(1) { left: 10%; animation-delay: 0s; }\n.animation-swarm span:nth-child(2) { left: 20%; animation-delay: -2s; }\n.animation-swarm span:nth-child(3) { left: 30%; animation-delay: -4s; }\n.animation-swarm span:nth-child(4) { left: 40%; animation-delay: -6s; }\n.animation-swarm span:nth-child(5) { left: 50%; animation-delay: -8s; }\n.animation-swarm span:nth-child(6) { left: 60%; animation-delay: -1s; }\n.animation-swarm span:nth-child(7) { left: 70%; animation-delay: -3s; }\n.animation-swarm span:nth-child(8) { left: 75%; animation-delay: -5s; } /* Was 80% */\n.animation-swarm span:nth-child(9) { left: 15%; animation-delay: -7s; } /* Was 90% */\n.animation-swarm span:nth-child(10) { left: 5%; animation-delay: -9s; }\n\n\n/* --- History Panel --- */\n.history-overlay {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0,0,0,0.5);\n    z-index: 1001;\n    opacity: 0;\n    visibility: hidden;\n    transition: all 0.3s ease;\n}\n.history-panel {\n    position: fixed;\n    top: 0;\n    right: -450px; /* Start off-screen */\n    width: 400px;\n    max-width: 90%;\n    height: 100%;\n    background-color: var(--bg-dark-2);\n    z-index: 1002;\n    transition: all 0.3s ease;\n    display: flex;\n    flex-direction: column;\n}\nbody.is-history-open .history-overlay {\n    opacity: 1;\n    visibility: visible;\n}\nbody.is-history-open .history-panel {\n    right: 0;\n}\n.history-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 1rem 1.5rem;\n    border-bottom: 1px solid var(--border-color);\n}\n.history-header h3 {\n    margin: 0;\n    font-size: 1.2rem;\n}\n.history-close-btn {\n    background: none;\n    border: none;\n    color: var(--text-medium);\n    font-size: 1.5rem;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n.history-close-btn:hover {\n    color: var(--text-light);\n}\n.history-list {\n    list-style: none;\n    padding: 0;\n    margin: 0;\n    overflow-y: auto;\n    flex-grow: 1;\n}\n.history-list li {\n    display: flex;\n    align-items: center;\n    gap: 1rem;\n    padding: 1rem 1.5rem;\n    border-bottom: 1px solid var(--border-color);\n    transition: background-color 0.2s ease;\n}\n\n.history-list li:hover {\n    background-color: var(--bg-dark-3);\n}\n\n.history-item {\n    display: flex;\n    align-items: flex-start;\n    gap: 1rem;\n}\n\n.history-icon-wrapper {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 0.5rem;\n    min-width: 60px;\n}\n\n.history-icon {\n    font-size: 1.8rem;\n    width: 40px;\n    height: 40px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    border-radius: 8px;\n    background-color: var(--bg-dark-3);\n}\n\n.history-icon.safe {\n    color: var(--green);\n    border: 2px solid var(--green);\n}\n\n.history-icon.suspicious {\n    color: var(--yellow);\n    border: 2px solid var(--yellow);\n}\n\n.history-icon.malware {\n    color: var(--red);\n    border: 2px solid var(--red);\n}\n\n.history-file-type {\n    font-size: 1rem;\n    color: var(--text-medium);\n}\n\n.history-details {\n    flex-grow: 1;\n    display: flex;\n    flex-direction: column;\n    gap: 0.5rem;\n    min-width: 0; /* Allow text truncation */\n}\n\n.history-filename {\n    font-weight: 600;\n    color: var(--text-light);\n    font-size: 0.95rem;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.history-classification {\n    font-size: 0.85rem;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.05em;\n}\n\n.history-classification.safe {\n    color: var(--green);\n}\n\n.history-classification.suspicious {\n    color: var(--yellow);\n}\n\n.history-classification.malware {\n    color: var(--red);\n}\n\n.history-hash {\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.75rem;\n    color: var(--text-medium);\n    background-color: var(--bg-dark-3);\n    padding: 0.25rem 0.5rem;\n    border-radius: 4px;\n    word-break: break-all;\n    line-height: 1.4;\n}\n\n.history-date {\n    font-size: 0.8rem;\n    color: var(--text-medium);\n    white-space: nowrap;\n    align-self: flex-start;\n    padding-top: 0.25rem;\n}\n\n.history-item-empty,\n.history-item-loading {\n    color: var(--text-medium);\n    text-align: center;\n    padding: 2rem;\n    font-style: italic;\n}\n\n\n/* --- Hover Scroll Zones --- */\n.scroll-zone {\n    position: fixed;\n    left: 0;\n    width: 100%;\n    height: 80px;\n    z-index: 998;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n}\n.scroll-zone.top { top: 60px; /* Below nav */ }\n.scroll-zone.bottom { bottom: 0; }\n\n.scroll-zone i {\n    font-size: 2rem;\n    color: var(--text-light);\n    opacity: 0;\n    transition: all 0.3s ease;\n    text-shadow: 0 0 15px rgba(0,0,0,0.7);\n}\n.scroll-zone.scrolling i {\n    opacity: 0.3;\n}\n.scroll-zone:hover i {\n    opacity: 0.7;\n}\n\n\n/* --- Graph Panel --- */\n.graph-wrapper {\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n    margin-top: 1rem;\n    display: none; /* Hidden by default */\n    box-sizing: border-box;\n}\nbody.is-showing-result .graph-wrapper {\n    display: block; /* Show with results */\n}\n\n.graph-header {\n    padding: 1rem 1.5rem;\n    border-bottom: 1px solid var(--border-color);\n    background-color: var(--bg-dark-3);\n    border-radius: 12px 12px 0 0;\n}\n.graph-header h3 {\n    margin: 0;\n    color: var(--text-light);\n    font-size: 1.1rem;\n}\n.call-graph-container {\n    overflow: auto; /* Allow scrolling for large graphs */\n}\n.call-graph {\n    flex-grow: 1;\n    overflow: auto;\n    position: relative; /* KEY for node positioning */\n    min-height: 400px;\n    padding: 1rem;\n}\n\n.graph-node {\n    position: absolute;\n    padding: 0.75rem 1.25rem;\n    border-radius: 8px;\n    background-color: var(--bg-dark-3);\n    border: 2px solid var(--border-color);\n    font-family: 'Courier New', Courier, monospace;\n    font-weight: bold;\n    white-space: nowrap;\n    box-shadow: 0 4px 10px rgba(0,0,0,0.3);\n    z-index: 2;\n    text-align: center;\n}\n/* MODIFIED to use variables */\n.node-entry { background-color: var(--node-bg-entry); border-color: var(--green); color: var(--syntax-const-text); }\n.node-std { background-color: var(--bg-dark-3); border-color: var(--border-color); color: var(--text-light); }\n.node-api { background-color: var(--node-bg-api); border-color: var(--blue); color: var(--syntax-const-text); }\n.node-suspicious { background-color: var(--node-bg-suspicious); border-color: var(--yellow); color: var(--syntax-const-text); }\n.node-malicious { background-color: var(--node-bg-malicious); border-color: var(--red); color: var(--syntax-const-text); }\n\n.leader-line {\n    z-index: 1; /* Sit behind nodes */\n    opacity: 0.8;\n}\nbody.light-theme .chart-container {\n    color: var(--text-medium);\n}\n\n/* Light theme navigation buttons */\n/* Light theme navigation buttons */\nbody.light-theme .nav-btn {\n    background: linear-gradient(135deg, #8b5cf6, #7c3aed) !important;\n    color: white !important;\n    box-shadow: 0 4px 12px rgba(139, 92, 246, 0.5) !important;\n}\n\nbody.light-theme .nav-btn:hover:not(:disabled) {\n    background: linear-gradient(135deg, #7c3aed, #6d28d9) !important;\n    box-shadow: 0 6px 20px rgba(139, 92, 246, 0.7) !important;\n}\n\nbody.light-theme .nav-btn:disabled {\n    background: #e9ecef !important;\n    color: #adb5bd !important;\n    box-shadow: none !important;\n    opacity: 0.7 !important;\n}\n\nbody.light-theme .nav-info {\n    color: var(--text-light);\n    font-weight: 600;\n}\n\nbody.light-theme .scan-navigation {\n    border-top-color: var(--border-color);\n}\n","epoch":163,"telemetryInfo":{}}],["file:///home/trang/localnsv/mAIware/script.js::request_0bd3737c-96a7-45c8-bdaa-69c39a73dfda",{"uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/script.js","external":"file:///home/trang/localnsv/mAIware/script.js","path":"/home/trang/localnsv/mAIware/script.js","scheme":"file"},"requestId":"request_0bd3737c-96a7-45c8-bdaa-69c39a73dfda","content":"// --- MOCK DISASSEMBLY DATA ---\n// (We keep this for now, as requested)\nconst mockDisassemblyBenign = [\n    `<span class=\"addr\">0x401000</span> <span class=\"op\">PUSH</span> <span class=\"args\">ebp</span> <span class=\"comment\">; setup stack frame</span>`,\n    `<span class=\"addr\">0x401001</span> <span class=\"op\">MOV</span> <span class=\"args\">ebp, esp</span>`,\n    `<span class=\"addr\">0x401003</span> <span class=\"op\">SUB</span> <span class=\"args\">esp, 48h</span>`,\n    `<span class=\"addr\">0x40100C</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4012A0</span> <span class=\"comment\">; initialize_string</span>`,\n    `<span class=\"addr\">0x401015</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4013F0</span> <span class=\"comment\">; get_user_input</span>`,\n    `<span class=\"addr\">0x40101E</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4015D0</span> <span class=\"comment\">; print_output</span>`,\n    `<span class=\"addr\">0x401028</span> <span class=\"op\">RETN</span>`,\n    `<span class=\"addr\">...</span>`,\n];\nconst mockDisassemblySuspicious = [\n    `<span class=\"addr\">0x401000</span> <span class=\"op\">PUSH</span> <span class=\"args\">ebp</span>`,\n    `<span class=\"addr\">0x401003</span> <span class=\"op\">SUB</span> <span class=\"args\">esp, 80h</span>`,\n    `<span class=\"addr\">0x40100D</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4012A0</span> <span class=\"comment\">; read_file_to_buffer</span>`,\n    `<span class=\"addr\">0x40101B</span> <span class=\"op\">REP</span> <span class=\"op\">MOVSB</span> <span class=\"comment\">; unsafe buffer write</span>`,\n    `<span class=\"addr\">0x401020</span> <span class=\"op\">JGE</span> <span class=\"args\">0x401030</span> <span class=\"comment\">; jump if overflow</span>`,\n    `<span class=\"addr\">0x401028</span> <span class=\"op\">RETN</span>`,\n    `<span class=\"addr\">...</span>`,\n];\nconst mockDisassemblyMalware = [\n    `<span class=\"addr\">0x401000</span> <span class=\"op\">PUSH</span> <span class=\"args\">ebp</span> <span class=\"comment\">; setup stack frame</span>`,\n    `<span class=\"addr\">0x40100B</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4011B0</span> <span class=\"comment\">; kernel32.LoadLibraryA</span>`,\n    `<span class=\"addr\">0x401013</span> <span class=\"op\">PUSH</span> <span class=\"string\">\"CreateRemoteThread\"</span>`,\n    `<span class=\"addr\">0x401019</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4011C0</span> <span class=\"comment\">; kernel32.GetProcAddress</span>`,\n    `<span class=\"addr\">0x401028</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4012F0</span> <span class=\"comment\">; decrypt_payload</span>`,\n    `<span class=\"addr\">0x401034</span> <span class=\"op\">CALL</span> <span class=\"args\">[ebp-24h]</span> <span class=\"comment\">; call CreateRemoteThread</span>`,\n    `<span class=\"addr\">0x401037</span> <span class=\"op\">JMP</span> <span class=\"args\">0x40102D</span> <span class=\"comment\">; loop?</span>`,\n    `<span class=\"addr\">...</span>`,\n];\n\n// --- REMOVED MOCK GRAPH DATA ---\n// const mockGraphSafe = ... (DELETED)\n// const mockGraphSuspicious = ... (DELETED)\n// const mockGraphMalware = ... (DELETED)\n\n// --- NAVIGATION STATE ---\nlet scanHistory = [];\nlet currentHistoryIndex = -1;\n\n// --- ELEMENT REFERENCES ---\nconst initialState = document.getElementById('initial-state');\nconst analyzingState = document.getElementById('analyzing-state');\nconst resultState = document.getElementById('result-state');\n\nconst analyzingFilename = document.getElementById('analyzing-filename');\nconst resultIcon = document.getElementById('result-icon');\nconst resultText = document.getElementById('result-text');\nconst resultFilename = document.getElementById('result-filename');\nconst resultDetails = document.getElementById('result-details');\nconst nonPeResultWrapper = document.getElementById('non-pe-result');\nconst nonPeFilename = document.getElementById('non-pe-filename');\nconst nonPeHashSha256 = document.getElementById('non-pe-hash-sha256');\nconst nonPeHashMd5 = document.getElementById('non-pe-hash-md5');\n\nconst bodyEl = document.body;\nlet animationWrapper = null;\n\nconst disassemblyWrapper = document.getElementById('disassembly-wrapper');\nconst disassemblyCodeEl = document.getElementById('disassembly-code');\nconst disassemblyFilenameEl = document.getElementById('disassembly-filename');\n\n// Analysis Details elements\nconst analysisDetailsWrapper = document.getElementById('analysis-details-wrapper');\nconst progressBarFill = document.getElementById('progress-bar-fill');\nconst scorePercentage = document.getElementById('score-percentage');\nconst detailsReasoning = document.getElementById('details-reasoning'); // We'll reuse this\nconst detailsHashSha256 = document.getElementById('details-hash-sha256');\nconst detailsHashMd5 = document.getElementById('details-hash-md5');\nconst detailsSystemIp = document.getElementById('details-system-ip');\nconst detailsRecommendation = document.getElementById('details-recommendation');\nconst detailsVendor = document.getElementById('details-vendor');\nconst detailsSignature = document.getElementById('details-signature');\nconst fileInternalsWrapper = document.getElementById('file-internals-wrapper');\nconst entropyBarsContainer = document.getElementById('entropy-bars-container');\nconst keyStringsContainer = document.getElementById('key-strings-container');\n\n// History Panel elements\nconst historyBtn = document.getElementById('history-btn');\nconst historyPanel = document.getElementById('history-panel');\nconst historyCloseBtn = document.getElementById('history-close-btn');\nconst historyOverlay = document.getElementById('history-overlay');\nconst historyListEl = document.querySelector('.history-list');\n\n// Scroll Zone elements\nconst scrollZoneTop = document.getElementById('scroll-zone-top');\nconst scrollZoneBottom = document.getElementById('scroll-zone-bottom');\n\n// Graph Panel elements\nconst graphWrapper = document.getElementById('graph-wrapper');\nconst callGraphEl = document.getElementById('call-graph');\n\n// Stats elements\nconst statsWrapper = document.getElementById('stats-wrapper');\n\n\n// --- STATE ---\nlet disassemblyInterval = null;\nlet scrollInterval = null; // For auto-scrolling\nlet currentGraphLines = []; // Renamed from currentLines to avoid conflict\nlet currentFileMetadata = null;\nlet lastScanResult = null;\n\n// 1. Listen for the 'scan-started' message from the backend\nwindow.electronAPI.onScanStarted((filename) => {\n  console.log(`UI: Received scan-started for ${filename}`);\n\n    // If user is viewing a result, don't auto-switch to analyzing.\n    if (bodyEl.classList.contains('is-showing-result') || bodyEl.classList.contains('is-non-pe')) {\n        console.log('UI: Result is being viewed; deferring analyzing UI switch');\n        return;\n    }\n\n  // 1. Set UI to \"Analyzing\" state\n  initialState.classList.remove('active'); //\n  analyzingState.classList.add('active'); //\n  analyzingFilename.textContent = filename; //\n  disassemblyFilenameEl.textContent = filename; //\n\n  currentFileMetadata = { filename, isPe: true };\n  lastScanResult = null;\n  nonPeResultWrapper.classList.remove('active');\n  bodyEl.classList.remove('is-non-pe');\n\n  // 2. Update body class to show disassembly\n  bodyEl.classList.remove('is-showing-result'); //\n  bodyEl.classList.add('is-analyzing'); //\n  removeAnimationClasses(); //\n  \n  // 3. Populate disassembly with a \"suspicious\" default and start animation\n  // (We don't know the result yet, so we pick one)\n  populateDisassembly(mockDisassemblySuspicious); //\n  startDisassemblyAnimation(); //\n\n  // 4. Clear old results\n  clearResultData();\n});\n\n// 2. Listen for the 'scan-result' message\nwindow.electronAPI.onScanResult((scanResult) => {\n  console.log(\"UI: Received scan-result:\", scanResult);\n\n  clearInterval(disassemblyInterval); //\n  disassemblyInterval = null; //\n\n  // Add to history\n  scanHistory.push(scanResult);\n  currentHistoryIndex = scanHistory.length - 1;\n\n    // If a result is already being viewed, do not auto-advance UI.\n    if (bodyEl.classList.contains('is-showing-result') || bodyEl.classList.contains('is-non-pe')) {\n        updateNavigationButtons();\n        return;\n    }\n\n    bodyEl.classList.remove('is-analyzing'); //\n    bodyEl.classList.add('is-showing-result'); //\n\n    analyzingState.classList.remove('active'); //\n    resultState.classList.add('active'); //\n\n    lastScanResult = scanResult;\n    renderScanResult();\n    updateNavigationButtons();\n});\n\nwindow.electronAPI.onScanFileMetadata((metadata) => {\n  if (!metadata || typeof metadata !== 'object') {\n    return;\n  }\n\n  currentFileMetadata = metadata;\n\n  if (lastScanResult && metadata.filename === lastScanResult.detected_filename) {\n    renderScanResult();\n  }\n});\n\nfunction renderScanResult() {\n  if (!lastScanResult) {\n    return;\n  }\n\n  const metadataMatches = currentFileMetadata && currentFileMetadata.filename === lastScanResult.detected_filename;\n  const isNonPe = metadataMatches && currentFileMetadata.isPe === false;\n\n  if (isNonPe) {\n    renderNonPeResult(lastScanResult);\n    return;\n  }\n\n  renderPeResult(lastScanResult);\n}\n\nfunction ensureAnimationWrapper() {\n  if (animationWrapper) {\n    return;\n  }\n\n  animationWrapper = document.createElement('div');\n  animationWrapper.className = 'animation-swarm';\n  for (let i = 0; i < 10; i++) {\n    const particle = document.createElement('span');\n    animationWrapper.appendChild(particle);\n  }\n  bodyEl.prepend(animationWrapper);\n}\n\nfunction renderPeResult(scanResult) {\n  removeAnimationClasses();\n  bodyEl.classList.remove('is-non-pe');\n  nonPeResultWrapper.classList.remove('active');\n\n  let resultIconClass = 'fas fa-check-circle'; //\n  let resultMockDisassembly = mockDisassemblyBenign; //\n  let resultBodyClass = 'result-safe-active'; //\n  let resultScannerClass = 'result-safe'; //\n  let resultProgressClass = 'progress-bar-green'; //\n  let resultScoreClass = 'score-green'; //\n  let recommendation = 'You can safely run this file.'; //\n\n  if (scanResult.classification.includes('Malware')) {\n    resultIconClass = 'fas fa-bug';\n    resultMockDisassembly = mockDisassemblyMalware;\n    resultBodyClass = 'result-malware-active'; //\n    resultScannerClass = 'result-malware'; //\n    resultProgressClass = 'progress-bar-red'; //\n    resultScoreClass = 'score-red'; //\n    recommendation = 'DO NOT OPEN. Quarantine this file immediately.'; //\n  } else if (scanResult.classification.includes('Suspicious')) {\n    resultIconClass = 'fas fa-exclamation-triangle'; //\n    resultMockDisassembly = mockDisassemblySuspicious; //\n    resultBodyClass = 'result-suspicious-active'; //\n    resultScannerClass = 'result-suspicious'; //\n    resultProgressClass = 'progress-bar-yellow'; //\n    resultScoreClass = 'score-yellow'; //\n    recommendation = 'Be cautious. Only run if you trust the source.'; //\n  }\n\n  ensureAnimationWrapper();\n  bodyEl.classList.add(resultBodyClass); //\n\n  resultState.className = `scanner-state active ${resultScannerClass}`; //\n  resultIcon.className = `result-icon ${resultIconClass}`; //\n  resultText.textContent = scanResult.classification; //\n\n  let detailsText = `Scanned ${scanResult.detected_filename}.`;\n  if (scanResult.malware_family) {\n    detailsText = `Family: ${scanResult.malware_family}`;\n  }\n  resultDetails.textContent = detailsText;\n  resultFilename.textContent = scanResult.detected_filename; //\n\n  progressBarFill.className = 'progress-bar-fill'; //\n  scorePercentage.className = 'score-percentage'; //\n  progressBarFill.classList.add(resultProgressClass); //\n  const rawConfidence = Number(scanResult.confidence_score);\n  const confidenceValue = Number.isFinite(rawConfidence) ? rawConfidence * 100 : 0;\n  progressBarFill.style.width = `${confidenceValue}%`; //\n  scorePercentage.textContent = `${Math.round(confidenceValue)}%`; //\n  scorePercentage.classList.add(resultScoreClass); //\n\n  detailsReasoning.textContent = `Filetype: ${scanResult.key_findings.file_type}. Packer: ${scanResult.key_findings.packer_detected}.`; //\n  const hashData = scanResult.file_hashes || {};\n  detailsHashSha256.textContent = hashData.sha256 || 'Not available'; //\n  detailsHashMd5.textContent = hashData.md5 || 'Not available'; //\n  updateSystemIpDisplay();\n  detailsRecommendation.textContent = recommendation;\n\n  populateVendor(scanResult.vendor); //\n  populateSignature(scanResult.key_findings.signature); //\n  populateEntropyBars(scanResult.key_findings.section_entropy || []); //\n  populateKeyStrings(scanResult.key_findings.key_strings || [], scanResult.classification); //\n\n  populateDisassembly(resultMockDisassembly); //\n\n  const apiList = scanResult.key_findings.api_imports || [];\n  const graphData = generateGraphData(apiList, scanResult.classification);\n  drawCallGraph(graphData);\n}\n\nfunction renderNonPeResult(scanResult) {\n  removeAnimationClasses();\n  bodyEl.classList.add('is-non-pe');\n  resultState.className = 'scanner-state active';\n  resultIcon.className = 'result-icon fas fa-file';\n  resultText.textContent = '';\n  resultDetails.textContent = '';\n  resultFilename.textContent = '';\n\n  const hashData = scanResult.file_hashes || {};\n  nonPeFilename.textContent = scanResult.detected_filename || '';\n  nonPeHashSha256.textContent = hashData.sha256 || 'Not available';\n  nonPeHashMd5.textContent = hashData.md5 || 'Not available';\n\n  detailsHashSha256.textContent = hashData.sha256 || 'Not available';\n  detailsHashMd5.textContent = hashData.md5 || 'Not available';\n\n  nonPeResultWrapper.classList.add('active');\n\n  callGraphEl.innerHTML = '';\n  currentGraphLines.forEach(line => line.remove());\n  currentGraphLines = [];\n  entropyBarsContainer.innerHTML = '';\n  keyStringsContainer.innerHTML = '';\n}\n\n/**\n * Clears all dynamic result data to prepare for the next scan.\n */\nfunction clearResultData() {\n    // Clear scanner panel\n    resultText.textContent = '';\n    resultDetails.textContent = '';\n    resultFilename.textContent = '';\n    nonPeResultWrapper.classList.remove('active');\n    nonPeFilename.textContent = '';\n    nonPeHashSha256.textContent = '...';\n    nonPeHashMd5.textContent = '...';\n    bodyEl.classList.remove('is-non-pe');\n\n    // Clear analysis panel\n    progressBarFill.style.width = `0%`;\n    scorePercentage.textContent = `0%`;\n    detailsReasoning.textContent = '...';\n    detailsHashSha256.textContent = '...';\n    detailsHashMd5.textContent = '...';\n    if (detailsSystemIp) {\n        detailsSystemIp.textContent = 'Detecting...';\n    }\n    detailsRecommendation.textContent = '...';\n\n    // Clear vendor\n    detailsVendor.innerHTML = `\n        <h4>Vendor Analysis</h4>\n        <div class=\"vendor-info\">\n            <i class=\"fas fa-question-circle\"></i>\n            <span>Scanning...</span>\n        </div>`;\n    \n    // Clear signature\n    detailsSignature.innerHTML = `\n        <h4>Digital Signature</h4>\n        <div class=\"signature-info\">\n            <i class=\"fas fa-question-circle\"></i>\n            <span>Checking...</span>\n        </div>`;\n    \n    // Clear internals\n    entropyBarsContainer.innerHTML = '';\n    keyStringsContainer.innerHTML = '';\n    \n    // Clear graph\n    callGraphEl.innerHTML = '';\n    currentGraphLines.forEach(line => line.remove());\n    currentGraphLines = [];\n}\n\n// --- VENDOR UI FUNCTION (IMPLEMENTED) ---\nfunction populateVendor(vendor) {\n    if (!vendor) return;\n    const icon = vendor.icon || 'fas fa-question-circle'; //\n    const name = vendor.name || 'Unknown'; //\n    detailsVendor.innerHTML = `\n        <h4>Vendor Analysis</h4> <div class=\"vendor-info\"> <i class=\"${icon}\"></i>\n            <span>${name}</span>\n        </div>\n    `;\n}\n\n// --- SIGNATURE UI FUNCTION (IMPLEMENTED) ---\nfunction populateSignature(signature) {\n    if (!signature) return;\n    let icon = signature.icon || 'fas fa-question-circle';\n    let cssClass = `sig-${signature.level || 'unknown'}`; // 'sig-verified', 'sig-untrusted', 'sig-unknown'\n\n    detailsSignature.innerHTML = `\n        <h4>Digital Signature</h4> <div class=\"signature-info ${cssClass}\"> <i class=\"${icon}\"></i>\n            <span>${signature.name}</span>\n        </div>\n    `;\n}\n\n// --- ENTROPY BARS UI FUNCTION (IMPLEMENTED) ---\nfunction populateEntropyBars(sections) {\n    entropyBarsContainer.innerHTML = ''; // Clear old bars\n    if (!sections || sections.length === 0) {\n        entropyBarsContainer.innerHTML = '<p class=\"hash-text\">No PE sections found to analyze.</p>';\n        return;\n    }\n\n    sections.forEach(section => { //\n        const value = section.entropy; //\n        const width = (value / 8.0) * 100; // Entropy is 0-8\n        let cssClass = 'low';\n        \n        if (value > 6.0) cssClass = 'medium';\n        if (value > 7.0) cssClass = 'high';\n        if (value > 7.8) cssClass = 'packed'; // Match style.css\n\n        const row = document.createElement('div');\n        row.className = 'entropy-bar-row';\n        row.innerHTML = `\n            <span class=\"entropy-bar-label\">${section.name}</span> <div class=\"entropy-bar-bg\">\n                <div class=\"entropy-bar-fill ${cssClass}\" style=\"width: ${width}%\">\n                    <span class=\"entropy-bar-value\">${value.toFixed(2)}</span>\n                </div>\n            </div>\n        `;\n        entropyBarsContainer.appendChild(row);\n    });\n}\n\n// --- KEY STRINGS UI FUNCTION (IMPLEMENTED) ---\nfunction populateKeyStrings(strings, classification) {\n    keyStringsContainer.innerHTML = ''; // Clear old strings\n    if (!strings || strings.length === 0) {\n        keyStringsContainer.innerHTML = '<span class=\"key-string-tag\">No notable strings found.</span>';\n        return;\n    }\n    \n    const tagClass = classification.includes('Benign') ? 'benign' : 'suspicious'; //\n\n    strings.forEach(str => { //\n        const tag = document.createElement('span');\n        tag.className = `key-string-tag ${tagClass}`;\n        tag.textContent = str;\n        keyStringsContainer.appendChild(tag);\n    });\n}\n\nfunction updateSystemIpDisplay() {\n    if (!detailsSystemIp || !window.electronAPI || typeof window.electronAPI.getSystemIp !== 'function') {\n        return;\n    }\n\n    detailsSystemIp.textContent = 'Detecting...';\n\n    window.electronAPI.getSystemIp()\n        .then((ip) => {\n            if (!ip) {\n                detailsSystemIp.textContent = 'Unavailable';\n                return;\n            }\n\n            detailsSystemIp.textContent = ip;\n        })\n        .catch(() => {\n            detailsSystemIp.textContent = 'Unavailable';\n        });\n}\n\nfunction removeAnimationClasses() {\n    bodyEl.classList.remove('result-safe-active');\n    bodyEl.classList.remove('result-suspicious-active');\n    bodyEl.classList.remove('result-malware-active');\n}\n\n// --- Disassembly Functions ---\n\nfunction populateDisassembly(codeLines) {\n    disassemblyCodeEl.innerHTML = '';\n    codeLines.forEach((line, index) => {\n        const lineEl = document.createElement('span');\n        lineEl.className = 'disassembly-line';\n        lineEl.id = `line-${index}`;\n        lineEl.innerHTML = line;\n        disassemblyCodeEl.appendChild(lineEl);\n    });\n}\n\nfunction startDisassemblyAnimation() {\n    if (disassemblyInterval) {\n        clearInterval(disassemblyInterval);\n    }\n    let currentLine = 0;\n    const totalLines = disassemblyCodeEl.children.length;\n\n    disassemblyInterval = setInterval(() => {\n        const prevLine = document.querySelector('.disassembly-line.active');\n        if (prevLine) {\n            prevLine.classList.remove('active');\n        }\n\n        const lineEl = document.getElementById(`line-${currentLine}`);\n        if (lineEl) {\n            lineEl.classList.add('active');\n            lineEl.scrollIntoView({\n                behavior: 'smooth',\n                block: 'center',\n                inline: 'nearest'\n            });\n        }\n        currentLine = (currentLine + 1) % totalLines;\n    }, 150);\n}\n\n/**\n * This function was MOVED here from jsonsamples.js\n * Dynamically generates the graph data based on API imports.\n * @param {string[]} apiImports - Array of API names (e.g., ['CreateRemoteThread'])\n * @param {string} classification - 'Benign', 'Suspicious', or 'Malware'\n * @returns {object} A graph object with 'nodes' and 'edges' arrays.\n */\nfunction generateGraphData(apiImports, classification) {\n    let nodes = [];\n    let edges = [];\n    const nodeSpacing = 150;\n    const startY = 100;\n    const startX = 250;\n\n    // 1. Add the Main Entry Point node\n    nodes.push({ \n        id: 'main-entry', \n        label: 'main()', \n        class: 'node-entry', \n        pos: { top: `${startY + (apiImports.length / 2) * (nodeSpacing / 2)}px`, left: '50px' } \n    });\n\n    if (!apiImports || apiImports.length === 0) {\n        // Benign/Empty graph\n        nodes.push({ id: 'benign-1', label: 'ReadFile', class: 'node-std', pos: { top: `${startY}px`, left: `${startX}px` } });\n        nodes.push({ id: 'benign-2', label: 'WriteFile', class: 'node-std', pos: { top: `${startY + nodeSpacing / 2}px`, left: `${startX}px` } });\n        edges.push({ from: 'main-entry', to: 'benign-1', options: { color: '#888' } });\n        edges.push({ from: 'main-entry', to: 'benign-2', options: { color: '#888' } });\n    } else {\n        // Suspicious/Malware graph\n        apiImports.forEach((apiName, index) => {\n            let nodeClass = 'node-api'; // Default\n            let edgeColor = '#888'; // Default\n\n            if (classification === 'Malware') {\n                nodeClass = 'node-malicious';\n                edgeColor = '#e74c3c'; // Malware red\n            } else if (classification === 'Suspicious') {\n                nodeClass = 'node-suspicious';\n                edgeColor = '#f1c40f'; // Suspicious yellow\n            } else {\n                // Benign\n                nodeClass = 'node-std';\n                edgeColor = '#888';\n            }\n\n\n            const nodeId = `api-${index}`;\n            const yPos = startY + (index * (nodeSpacing-50)); // Make them a bit closer\n            const xPos = startX + (index % 2 === 0 ? 0 : 150); // Stagger them\n\n            // Add the API node\n            nodes.push({\n                id: nodeId,\n                label: apiName,\n                class: nodeClass,\n                pos: { top: `${yPos}px`, left: `${xPos}px` }\n            });\n\n            // Add the edge from main\n            edges.push({\n                from: 'main-entry',\n                to: nodeId,\n                options: { color: edgeColor }\n            });\n        });\n    }\n\n    return { nodes, edges };\n}\n\n// --- Graph Drawing ---\nfunction drawCallGraph(graphData) {\n    // 1. Clear previous graph (both nodes and lines)\n    callGraphEl.innerHTML = '';\n    currentGraphLines.forEach(line => line.remove());\n    currentGraphLines = [];\n\n    if (!graphData || !graphData.nodes || !graphData.edges) {\n        console.error(\"Invalid graph data received\", graphData);\n        return;\n    }\n\n    // 2. Create and place all nodes\n    graphData.nodes.forEach(node => {\n        const nodeEl = document.createElement('div');\n        nodeEl.id = node.id;\n        nodeEl.className = `graph-node ${node.class}`;\n        nodeEl.style.top = node.pos.top;\n        nodeEl.style.left = node.pos.left;\n        nodeEl.textContent = node.label;\n        callGraphEl.appendChild(nodeEl);\n    });\n\n    // 3. Draw all edges (must be done *after* nodes are in DOM)\n    // Use a slight timeout to ensure DOM is ready\n    setTimeout(() => {\n        graphData.edges.forEach(edge => {\n            try {\n                const line = new LeaderLine(\n                    document.getElementById(edge.from),\n                    document.getElementById(edge.to),\n                    {\n                        color: edge.options.color,\n                        path: edge.options.path || 'straight',\n                        startSocket: edge.options.startSocket || 'auto',\n                        endSocket: edge.options.endSocket || 'auto',\n                        endPlug: 'arrow1',\n                        size: 3,\n                        endPlugSize: 1.5,\n                    }\n                );\n                currentGraphLines.push(line);\n            } catch(e) {\n                console.error(\"Could not draw line:\", e);\n            }\n        });\n    }, 500); // 500ms timeout to let CSS fade-in finish\n}\n\n\n// --- History Panel Logic ---\nasync function loadHistory() {\n  if (!historyListEl) return;\n  \n  historyListEl.innerHTML = '<li class=\"history-item-loading\">Loading...</li>';\n\n  try {\n    const historyData = await window.electronAPI.getHistory();\n\n    if (!historyData || historyData.length === 0) {\n      historyListEl.innerHTML = '<li class=\"history-item-empty\">No scan history found.</li>';\n      return;\n    }\n\n    historyListEl.innerHTML = '';\n\n    historyData.forEach(scan => {\n      const li = document.createElement('li');\n      li.className = 'history-item';\n\n      // Determine classification icon\n      let statusIcon = 'fas fa-check-circle';\n      let classType = 'safe';\n      if (scan.classification.includes('Malware')) {\n        statusIcon = 'fas fa-bug';\n        classType = 'malware';\n      } else if (scan.classification.includes('Suspicious')) {\n        statusIcon = 'fas fa-exclamation-triangle';\n        classType = 'suspicious';\n      }\n\n      // Determine file type icon based on extension\n      const filename = scan.detected_filename || '';\n      const ext = filename.split('.').pop().toLowerCase();\n      let fileTypeIcon = 'fas fa-file';\n      \n      if (['exe', 'dll', 'sys', 'msi'].includes(ext)) {\n        fileTypeIcon = 'fas fa-cog'; // Executable\n      } else if (['jpg', 'jpeg', 'png', 'gif', 'bmp', 'svg', 'webp'].includes(ext)) {\n        fileTypeIcon = 'fas fa-image'; // Image\n      } else if (['js', 'ts', 'py', 'java', 'cpp', 'c', 'h', 'cs', 'go', 'rs', 'php', 'rb'].includes(ext)) {\n        fileTypeIcon = 'fas fa-code'; // Code\n      } else if (['pdf', 'doc', 'docx', 'txt', 'rtf', 'odt'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-alt'; // Document\n      } else if (['zip', 'rar', '7z', 'tar', 'gz', 'bz2'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-archive'; // Archive\n      } else if (['mp3', 'wav', 'ogg', 'flac', 'aac'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-audio'; // Audio\n      } else if (['mp4', 'avi', 'mkv', 'mov', 'wmv', 'flv'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-video'; // Video\n      } else if (['html', 'htm', 'css', 'xml', 'json'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-code'; // Web file\n      }\n\n      const scanDate = new Date(scan.scanDate).toLocaleString();\n      const hashSha256 = scan.file_hashes?.sha256 || 'N/A';\n      const hashDisplay = hashSha256.substring(0, 16) + '...'; // Show first 16 chars\n\n      li.innerHTML = `\n        <div class=\"history-icon-wrapper\">\n          <div class=\"history-icon ${classType}\">\n            <i class=\"${statusIcon}\"></i>\n          </div>\n          <div class=\"history-file-type\">\n            <i class=\"${fileTypeIcon}\"></i>\n          </div>\n        </div>\n        <div class=\"history-details\">\n          <span class=\"history-filename\" title=\"${filename}\">${filename}</span>\n          <span class=\"history-classification ${classType}\">${scan.classification}</span>\n          <span class=\"history-hash\" title=\"${hashSha256}\">SHA256: ${hashDisplay}</span>\n        </div>\n        <span class=\"history-date\">${scanDate}</span>\n      `;\n      \n      historyListEl.appendChild(li);\n    });\n\n  } catch (err) {\n    console.error('Failed to load history:', err);\n    historyListEl.innerHTML = '<li class=\"history-item-empty\">Error loading history.</li>';\n  }\n}\n\nfunction toggleHistoryPanel() {\n  bodyEl.classList.toggle('is-history-open');\n  \n  // ADD THIS: If we are opening the panel, load the history\n  if (bodyEl.classList.contains('is-history-open')) {\n    loadHistory();\n  }\n}\n\nhistoryBtn.addEventListener('click', (e) => {\n    e.preventDefault();\n    toggleHistoryPanel();\n});\nhistoryCloseBtn.addEventListener('click', toggleHistoryPanel);\nhistoryOverlay.addEventListener('click', toggleHistoryPanel);\n\n\n// --- Auto-scroll Logic ---\nfunction startScrolling(direction) {\n    if (scrollInterval) {\n        clearInterval(scrollInterval);\n    }\n    scrollInterval = setInterval(() => {\n        window.scrollBy(0, direction * 10); // 10 pixels at a time\n    }, 20); // every 20ms\n}\n\nfunction stopScrolling() {\n    clearInterval(scrollInterval);\n    scrollInterval = null;\n}\n\nscrollZoneTop.addEventListener('mouseenter', () => {\n    startScrolling(-1); // Scroll Up\n    scrollZoneTop.classList.add('scrolling');\n});\nscrollZoneTop.addEventListener('mouseleave', () => {\n    stopScrolling();\n    scrollZoneTop.classList.remove('scrolling');\n});\n\nscrollZoneBottom.addEventListener('mouseenter', () => {\n    startScrolling(1); // Scroll Down\n    scrollZoneBottom.classList.add('scrolling');\n});\nscrollZoneBottom.addEventListener('mouseleave', () => {\n    stopScrolling();\n    scrollZoneBottom.classList.remove('scrolling');\n});\n\n\n// --- Chart instances ---\nlet malwareTypesChart = null;\nlet topMalwareChart = null;\n\n// --- Function to create/recreate charts ---\nwindow.recreateCharts = function() {\n    // Check if light theme is active\n    const isLightTheme = document.body.classList.contains('light-theme');\n    \n    // Set colors based on theme\n    const chartLegendColor = isLightTheme ? '#6c757d' : '#e0e0e0';\n    const chartAxesColor = isLightTheme ? '#6c757d' : '#aaa';\n    const chartGridColor = isLightTheme ? '#dee2e6' : '#444444';\n\n    // Destroy existing charts if they exist\n    if (malwareTypesChart) {\n        malwareTypesChart.destroy();\n    }\n    if (topMalwareChart) {\n        topMalwareChart.destroy();\n    }\n\n    // Create Malware Types Chart (Doughnut)\n    const typesCtx = document.getElementById('malwareTypesChart');\n    if (typesCtx) {\n        malwareTypesChart = new Chart(typesCtx, {\n            type: 'doughnut',\n            data: {\n                labels: ['PE (exe/dll)', 'JavaScript', 'VBS', 'Macro', 'Other'],\n                datasets: [{\n                    label: 'Submission Types',\n                    data: [65, 15, 8, 7, 5],\n                    backgroundColor: [\n                        '#007bff', // Blue\n                        '#f1c40f', // Yellow\n                        '#e74c3c', // Red\n                        '#9b59b6', // Purple\n                        '#34495e'  // Gray\n                    ],\n                    borderColor: '#2a2a2e',\n                    borderWidth: 3,\n                }]\n            },\n            options: {\n                responsive: true,\n                plugins: {\n                    legend: {\n                        position: 'right',\n                        labels: {\n                            color: chartLegendColor,\n                            boxWidth: 20\n                        }\n                    }\n                }\n            }\n        });\n    }\n\n    // Create Top Malware Chart (Line)\n    const topMalwareCtx = document.getElementById('topMalwareChart');\n    if (topMalwareCtx) {\n        topMalwareChart = new Chart(topMalwareCtx, {\n            type: 'line',\n            data: {\n                labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5'],\n                datasets: [\n                    {\n                        label: 'Zeus',\n                        data: [120, 150, 130, 180, 160],\n                        borderColor: '#e74c3c',\n                        backgroundColor: '#e74c3c20',\n                        fill: true,\n                        tension: 0.4\n                    },\n                    {\n                        label: 'WannaCry',\n                        data: [80, 90, 110, 100, 130],\n                        borderColor: '#007bff',\n                        backgroundColor: '#007bff20',\n                        fill: true,\n                        tension: 0.4\n                    },\n                    {\n                        label: 'Emotet',\n                        data: [50, 60, 80, 70, 90],\n                        borderColor: '#f1c40f',\n                        backgroundColor: '#f1c40f20',\n                        fill: true,\n                        tension: 0.4\n                    }\n                ]\n            },\n            options: {\n                responsive: true,\n                plugins: {\n                    legend: {\n                        labels: {\n                            color: chartLegendColor\n                        }\n                    }\n                },\n                scales: {\n                    x: {\n                        ticks: { color: chartAxesColor },\n                        grid: { color: chartGridColor + '50' }\n                    },\n                    y: {\n                        ticks: { color: chartAxesColor },\n                        grid: { color: chartGridColor }\n                    }\n                }\n            }\n        });\n    }\n};\n\n// --- NAVIGATION FUNCTIONS ---\nfunction updateNavigationButtons() {\n    const prevBtn = document.getElementById('prev-scan-btn');\n    const nextBtn = document.getElementById('next-scan-btn');\n    const navInfo = document.getElementById('nav-info');\n    \n    if (!prevBtn || !nextBtn) return;\n    \n    // Disable/enable buttons based on position\n    prevBtn.disabled = currentHistoryIndex <= 0;\n    nextBtn.disabled = currentHistoryIndex >= scanHistory.length - 1;\n    \n    // Update info text\n    if (navInfo && scanHistory.length > 0) {\n        navInfo.textContent = `${currentHistoryIndex + 1} of ${scanHistory.length}`;\n    }\n}\n\nfunction showPreviousScan() {\n    if (currentHistoryIndex > 0) {\n        currentHistoryIndex--;\n        lastScanResult = scanHistory[currentHistoryIndex];\n        renderScanResult();\n        updateNavigationButtons();\n    }\n}\n\nfunction showNextScan() {\n    if (currentHistoryIndex < scanHistory.length - 1) {\n        currentHistoryIndex++;\n        lastScanResult = scanHistory[currentHistoryIndex];\n        renderScanResult();\n        updateNavigationButtons();\n    }\n}\n\n// Initialize history from electron-store on load\nasync function initializeScanHistory() {\n    try {\n        const storedHistory = await window.electronAPI.getHistory();\n        if (storedHistory && Array.isArray(storedHistory)) {\n            scanHistory = storedHistory;\n            currentHistoryIndex = scanHistory.length - 1;\n        }\n    } catch (error) {\n        console.error('Failed to load scan history:', error);\n    }\n}\n\n// --- Run on Page Load ---\ndocument.addEventListener('DOMContentLoaded', () => {\n    // 1. Animate Stat Cards\n    const statNumbers = document.querySelectorAll('.stat-number');\n    statNumbers.forEach(stat => {\n        const target = +stat.getAttribute('data-target');\n        const duration = 2000;\n        const stepTime = 20;\n        const steps = duration / stepTime;\n        const increment = target / steps;\n        let current = 0;\n\n        const updateCount = () => {\n            current += increment;\n            if (current < target) {\n                stat.textContent = Math.ceil(current).toLocaleString();\n                setTimeout(updateCount, stepTime);\n            } else {\n                stat.textContent = target.toLocaleString();\n            }\n        };\n        updateCount();\n    });\n\n    // 2. Create the charts\n    recreateCharts();\n    \n    // 3. Initialize scan history\n    initializeScanHistory();\n    \n    // 4. Setup navigation button handlers\n    const prevBtn = document.getElementById('prev-scan-btn');\n    const nextBtn = document.getElementById('next-scan-btn');\n    \n    if (prevBtn) prevBtn.addEventListener('click', showPreviousScan);\n    if (nextBtn) nextBtn.addEventListener('click', showNextScan);\n});\n","epoch":166,"telemetryInfo":{}}]],"operations":[{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/scanner-worker.js","external":"file:///home/trang/localnsv/mAIware/scanner-worker.js","path":"/home/trang/localnsv/mAIware/scanner-worker.js","scheme":"file"},"requestId":"request_00215662-f551-41ad-901a-4eb745ef44c4","epoch":4,"edits":[{"text":"const axios = require('axios')\nconst FormData = require('form-data')\nconst { getRandomDemoJson } = require('./jsonsamples') //\nconst { determinePeStatus } = require('./file-type-detector') //","range":{"startLineNumber":13,"startColumn":1,"endLineNumber":15,"endColumn":58}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/scanner-worker.js","external":"file:///home/trang/localnsv/mAIware/scanner-worker.js","path":"/home/trang/localnsv/mAIware/scanner-worker.js","scheme":"file"},"requestId":"request_00215662-f551-41ad-901a-4eb745ef44c4","epoch":6,"edits":[{"text":"  const demoTask = async () => {\n    postLog(`[Scan] Scanning for ${detectedFilename}...`)\n    await delay(SCAN_DELAY_MS)\n\n    let fileHashes = null\n    try {\n      fileHashes = await computeFileHashes(filePath)\n    } catch (err) {\n      postError(`[Hash] Failed to compute hashes for ${detectedFilename}: ${err.message}`)\n    }\n\n    // Check if file is PE\n    let isPe = false\n    try {\n      const peStatus = await determinePeStatus(filePath)\n      isPe = peStatus.isPe\n    } catch (err) {\n      postLog(`[PE Detection] Failed for ${detectedFilename}: ${err.message}`)\n    }\n\n    const scanResult = getRandomDemoJson(detectedFilename, fileHashes, isPe)\n\n    postLog(`[Scan] Scan completed. (Triggered by ${detectedFilename})`)\n    parentPort.postMessage({ channel: 'scan-result', payload: scanResult })\n    \n    // Send to server\n    await sendResultToServer(scanResult)\n  }","range":{"startLineNumber":131,"startColumn":1,"endLineNumber":149,"endColumn":4}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/jsonsamples.js","external":"file:///home/trang/localnsv/mAIware/jsonsamples.js","path":"/home/trang/localnsv/mAIware/jsonsamples.js","scheme":"file"},"requestId":"request_00215662-f551-41ad-901a-4eb745ef44c4","epoch":9,"edits":[{"text":"/**\n * Builds a human-readable JSON report by mapping raw sample data.\n * @param {string} detectedFilename - The name of the file that was actually detected.\n * @param {object} fileHashes - The file hashes (sha256, md5).\n * @param {boolean} isPe - Whether the file is a PE file or not.\n * @returns {object} A final, human-readable JSON object.\n */\nfunction getRandomDemoJson(detectedFilename, fileHashes, isPe = true) {\n  // For non-PE files, always return benign classification with non-PE file type\n  let rawSample;\n  if (!isPe) {\n    // Use the last benign sample (datasheet.pdf) which has no entropy (non-PE)\n    rawSample = rawSamples[7]; // datasheet.pdf - benign, non-PE\n  } else {\n    // 1. Pick a random raw sample definition (only from PE samples)\n    rawSample = rawSamples[Math.floor(Math.random() * rawSamples.length)];\n  }\n  const classification = CLASSIFICATION[rawSample.c];","range":{"startLineNumber":53,"startColumn":1,"endLineNumber":61,"endColumn":54}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/scanner-worker.js","external":"file:///home/trang/localnsv/mAIware/scanner-worker.js","path":"/home/trang/localnsv/mAIware/scanner-worker.js","scheme":"file"},"requestId":"request_437e96e4-e1db-4dd0-b1ca-407e036609b7","epoch":15,"edits":[{"text":"  const demoTask = async () => {\n    postLog(`[Scan] Scanning for ${detectedFilename}...`)\n    await delay(SCAN_DELAY_MS)\n\n    let fileHashes = null\n    try {\n      fileHashes = await computeFileHashes(filePath)\n    } catch (err) {\n      postError(`[Hash] Failed to compute hashes for ${detectedFilename}: ${err.message}`)\n    }\n\n    // Check if file is PE\n    let isPe = false\n    try {\n      const peStatus = await determinePeStatus(filePath)\n      isPe = peStatus.isPe\n      postLog(`[PE Detection] ${detectedFilename} is ${isPe ? 'a PE file' : 'not a PE file'}`)\n    } catch (err) {\n      postLog(`[PE Detection] Failed for ${detectedFilename}: ${err.message}`)\n    }\n\n    const scanResult = getRandomDemoJson(detectedFilename, fileHashes, isPe)\n\n    postLog(`[Scan] Scan completed. (Triggered by ${detectedFilename})`)\n    parentPort.postMessage({ channel: 'scan-result', payload: scanResult })\n    \n    // Send to server\n    await sendResultToServer(scanResult)\n  }","range":{"startLineNumber":130,"startColumn":1,"endLineNumber":148,"endColumn":4}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/jsonsamples.js","external":"file:///home/trang/localnsv/mAIware/jsonsamples.js","path":"/home/trang/localnsv/mAIware/jsonsamples.js","scheme":"file"},"requestId":"request_437e96e4-e1db-4dd0-b1ca-407e036609b7","epoch":16,"edits":[{"text":"/**\n * Builds a human-readable JSON report by mapping raw sample data.\n * @param {string} detectedFilename - The name of the file that was actually detected.\n * @param {object} fileHashes - The file hashes (sha256, md5).\n * @param {boolean} isPe - Whether the file is a PE file or not.\n * @returns {object} A final, human-readable JSON object.\n */\nfunction getRandomDemoJson(detectedFilename, fileHashes, isPe = true) {\n  // For non-PE files, always return benign classification with non-PE file type\n  let rawSample;\n  if (!isPe) {\n    // Use the last benign sample (datasheet.pdf) which has no entropy (non-PE)\n    rawSample = rawSamples[7]; // datasheet.pdf - benign, non-PE (c: 0, f: 4 'PDF Document', e: [])\n  } else {\n    // 1. Pick a random raw sample definition (only from PE samples)\n    rawSample = rawSamples[Math.floor(Math.random() * rawSamples.length)];\n  }\n  const classification = CLASSIFICATION[rawSample.c];","range":{"startLineNumber":53,"startColumn":1,"endLineNumber":61,"endColumn":54}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/scanner-worker.js","external":"file:///home/trang/localnsv/mAIware/scanner-worker.js","path":"/home/trang/localnsv/mAIware/scanner-worker.js","scheme":"file"},"requestId":"request_437e96e4-e1db-4dd0-b1ca-407e036609b7","epoch":17,"edits":[{"text":"const axios = require('axios')\nconst FormData = require('form-data')\nconst { getRandomDemoJson } = require('./jsonsamples') //\nconst { determinePeStatus } = require('./file-type-detector') //\n\nconst AI_APP_API_ENDPOINT = 'http://localhost:1234/scan' //","range":{"startLineNumber":13,"startColumn":1,"endLineNumber":17,"endColumn":60}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/scanner-worker.js","external":"file:///home/trang/localnsv/mAIware/scanner-worker.js","path":"/home/trang/localnsv/mAIware/scanner-worker.js","scheme":"file"},"requestId":"request_496bf68f-603a-4217-8f85-388427b438ef","epoch":23,"edits":[{"text":"    // Check if file is PE\n    let isPe = false\n    try {\n      const peStatus = await determinePeStatus(filePath)\n      isPe = peStatus.isPe\n      postLog(`[PE Detection] *** UPDATED CODE *** ${detectedFilename} is ${isPe ? 'a PE file' : 'not a PE file'}`)\n    } catch (err) {\n      postLog(`[PE Detection] Failed for ${detectedFilename}: ${err.message}`)\n      // If detection fails, assume non-PE to be safe\n      isPe = false\n    }\n\n    postLog(`[Scan] Calling getRandomDemoJson with isPe=${isPe}`)\n    const scanResult = getRandomDemoJson(detectedFilename, fileHashes, isPe)\n    postLog(`[Scan] Result classification: ${scanResult.classification}`)","range":{"startLineNumber":142,"startColumn":1,"endLineNumber":152,"endColumn":77}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/scanner-worker.js","external":"file:///home/trang/localnsv/mAIware/scanner-worker.js","path":"/home/trang/localnsv/mAIware/scanner-worker.js","scheme":"file"},"requestId":"request_c4b64de9-7660-4b42-afcf-12b654c111ef","epoch":27,"edits":[{"text":"  const demoTask = async () => {\n    postLog(`[Scan] Scanning for ${detectedFilename}...`)\n    await delay(SCAN_DELAY_MS)\n\n    let fileHashes = null\n    try {\n      fileHashes = await computeFileHashes(filePath)\n    } catch (err) {\n      postError(`[Hash] Failed to compute hashes for ${detectedFilename}: ${err.message}`)\n    }\n\n    // Check if file is PE\n    let isPe = false\n    try {\n      const peStatus = await determinePeStatus(filePath)\n      isPe = peStatus.isPe\n      postLog(`[PE Detection] ${detectedFilename} is ${isPe ? 'a PE file' : 'not a PE file'}`)\n    } catch (err) {\n      postLog(`[PE Detection] Failed for ${detectedFilename}: ${err.message}`)\n    }\n\n    let scanResult\n    \n    if (!isPe) {\n      // For non-PE files, send minimal result with just filename and hashes\n      scanResult = {\n        detected_filename: detectedFilename,\n        file_hashes: fileHashes || { sha256: '', md5: '' },\n        classification: 'Benign',\n        is_pe: false\n      }\n      postLog(`[Scan] ${detectedFilename} is not a PE file, skipping malware analysis`)\n    } else {\n      // For PE files, generate full demo scan result\n      scanResult = getRandomDemoJson(detectedFilename, fileHashes)\n      scanResult.is_pe = true\n    }\n\n    postLog(`[Scan] Scan completed. (Triggered by ${detectedFilename})`)\n    parentPort.postMessage({ channel: 'scan-result', payload: scanResult })\n    \n    // Send to server\n    await sendResultToServer(scanResult)\n  }","range":{"startLineNumber":131,"startColumn":1,"endLineNumber":159,"endColumn":4}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/jsonsamples.js","external":"file:///home/trang/localnsv/mAIware/jsonsamples.js","path":"/home/trang/localnsv/mAIware/jsonsamples.js","scheme":"file"},"requestId":"request_c4b64de9-7660-4b42-afcf-12b654c111ef","epoch":30,"edits":[{"text":"/**\n * Builds a human-readable JSON report by mapping raw sample data.\n * @param {string} detectedFilename - The name of the file that was actually detected.\n * @returns {object} A final, human-readable JSON object.\n */\nfunction getRandomDemoJson(detectedFilename, fileHashes) {\n  // 1. Pick a random raw sample definition\n  const rawSample = rawSamples[Math.floor(Math.random() * rawSamples.length)];\n  const classification = CLASSIFICATION[rawSample.c];","range":{"startLineNumber":53,"startColumn":1,"endLineNumber":70,"endColumn":54}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/scanner-worker.js","external":"file:///home/trang/localnsv/mAIware/scanner-worker.js","path":"/home/trang/localnsv/mAIware/scanner-worker.js","scheme":"file"},"requestId":"request_a81df6a6-91d1-44bf-86f6-897ed9dbad49","epoch":34,"edits":[{"text":"const { parentPort, workerData } = require('node:worker_threads')\nlet chokidar = null\n\ntry {\n  chokidar = require('chokidar')\n} catch (err) {\n  // Fallback to fs.watch when chokidar is unavailable\n}\nconst path = require('node:path')\nconst fs = require('node:fs')\nconst fsPromises = require('node:fs').promises\nconst crypto = require('node:crypto')\nconst axios = require('axios')\nconst FormData = require('form-data')\nconst { getRandomDemoJson } = require('./jsonsamples') //\nconst { determinePeStatus } = require('./file-type-detector') //\n\nconst AI_APP_API_ENDPOINT = 'http://localhost:1234/scan' //\nconst FILE_SIZE_THRESHOLD = 50 * 1024 * 1024 * 1024 //\nconst DEFAULT_SCAN_DELAY_MS = 10000\n\nconst fileQueue = [] //\nlet isProcessing = false //\nlet activeWatcher = null //\nlet shutdownRequested = false //\n\nconst delay = (ms) => new Promise(resolve => setTimeout(resolve, ms)) //\n\nconst normalizeBoolean = (value) => {\n  if (typeof value !== 'string') {\n    return false\n  }\n\n  return ['1', 'true', 'yes', 'on'].includes(value.toLowerCase())\n}\n\nconst skipUpload = normalizeBoolean(process.env.MAIWARE_SKIP_UPLOAD)\nconst customDelay = Number.parseInt(process.env.MAIWARE_SCAN_DELAY_MS || '', 10)\nconst SCAN_DELAY_MS = Number.isFinite(customDelay) ? Math.max(0, customDelay) : DEFAULT_SCAN_DELAY_MS\n\nfunction postLog(message) {\n  parentPort.postMessage({ channel: 'log', payload: message })\n}\n\nfunction postError(message) {\n  parentPort.postMessage({ channel: 'error', payload: message })\n}\n\nasync function waitForIdle(timeoutMs = 15000) {\n  const deadline = Date.now() + timeoutMs\n\n  while ((isProcessing || fileQueue.length > 0) && Date.now() < deadline) {\n    await delay(100)\n  }\n\n  if (isProcessing || fileQueue.length > 0) {\n    postError('[Monitor] Shutdown timed out with pending work remaining.')\n  }\n}\n\nasync function processQueue() {\n  if (isProcessing || fileQueue.length === 0) {\n    return\n  }\n\n  isProcessing = true\n  const filePath = fileQueue.shift()\n  const detectedFilename = path.basename(filePath)\n\n  postLog(`[Monitor] Processing: ${detectedFilename}`)\n\n  try {\n    const stats = await fsPromises.stat(filePath)\n\n    if (stats.size < FILE_SIZE_THRESHOLD) {\n      await handleSmallFile(filePath, detectedFilename)\n    } else {\n      postLog(`[Monitor] File ${detectedFilename} is large, skipping server push.`)\n    }\n  } catch (err) {\n    postError(`[Monitor] Error processing ${filePath}: ${err.message}`)\n  } finally {\n    isProcessing = false\n    if (!shutdownRequested) {\n      processQueue()\n    }\n  }\n}\n\nasync function sendResultToServer(scanResult) {\n  const SERVER_URL = 'http://localhost:3000/api/submit-scan';\n  \n  try {\n    const response = await fetch(SERVER_URL, {\n      method: 'POST',\n      headers: { 'Content-Type': 'application/json' },\n      body: JSON.stringify(scanResult)\n    });\n    \n    if (response.ok) {\n      postLog('[Server] Scan result uploaded successfully');\n    } else {\n      postLog(`[Server] Upload failed: ${response.statusText}`);\n    }\n  } catch (error) {\n    postLog(`[Server] Failed to upload: ${error.message}`);\n  }\n}\n\nasync function handleSmallFile(filePath, detectedFilename) {\n  const uploadTask = async () => {\n    if (skipUpload) {\n      postLog(`[Push] Skipping upload for ${detectedFilename} (MAIWARE_SKIP_UPLOAD).`)\n      return\n    }\n\n    const form = new FormData()\n    form.append('file', fs.createReadStream(filePath))\n\n    try {\n      postLog(`[Push] Starting upload for ${detectedFilename}...`)\n      const response = await axios.post(AI_APP_API_ENDPOINT, form, {\n        headers: form.getHeaders(),\n      })\n      postLog(`[Push] AI App Response: ${response.status} ${JSON.stringify(response.data)}`)\n    } catch (err) {\n      postError(`[Push] AI app push failed: ${err.message}`)\n    }\n  }\n\n  const demoTask = async () => {\n    postLog(`[Scan] Scanning for ${detectedFilename}...`)\n    await delay(SCAN_DELAY_MS)\n\n    let fileHashes = null\n    try {\n      fileHashes = await computeFileHashes(filePath)\n    } catch (err) {\n      postError(`[Hash] Failed to compute hashes for ${detectedFilename}: ${err.message}`)\n    }\n\n    // Check if file is PE\n    let isPe = false\n    try {\n      const peStatus = await determinePeStatus(filePath)\n      isPe = !!peStatus.isPe\n      postLog(`[PE Detection] ${detectedFilename} is ${isPe ? 'a PE file' : 'not a PE file'}`)\n    } catch (err) {\n      // On error, treat as non-PE (safer default)\n      isPe = false\n      postLog(`[PE Detection] Failed for ${detectedFilename}: ${err.message}`)\n    }\n\n    // Build the proper result based on PE status\n    let scanResult\n    if (!isPe) {\n      scanResult = {\n        detected_filename: detectedFilename,\n        file_hashes: fileHashes || { sha256: '', md5: '' },\n        classification: 'Benign',\n        is_pe: false\n      }\n    } else {\n      scanResult = getRandomDemoJson(detectedFilename, fileHashes)\n      scanResult.is_pe = true\n    }\n\n    postLog(`[Scan] Scan completed. (Triggered by ${detectedFilename})`)\n    parentPort.postMessage({ channel: 'scan-result', payload: scanResult })\n    \n    // Send to server\n    await sendResultToServer(scanResult)\n  }\n\n  await Promise.all([\n    uploadTask(),\n    demoTask(),\n  ])\n}\n\nfunction handleDetectedFile(filePath) {\n  const detectedFilename = path.basename(filePath)\n  postLog(`[Monitor] Detected new file: ${detectedFilename}`)\n\n  parentPort.postMessage({ channel: 'scan-started', payload: detectedFilename })\n\n  fileQueue.push(filePath)\n  processQueue()\n}\n\nfunction setupWatcher(downloadPath) {\n  postLog(`[Monitor] Watching for new files in: ${downloadPath}`)\n\n  if (chokidar) {\n    activeWatcher = chokidar.watch(downloadPath, {\n      ignored: /(^|[\\/\\\\])\\..|.*\\.tmp$|.*\\.crdownload$/,\n      persistent: true,\n      ignoreInitial: true,\n      depth: 0,\n      awaitWriteFinish: {\n        stabilityThreshold: 2000,\n        pollInterval: 100\n      }\n    })\n\n    activeWatcher.on('add', handleDetectedFile)\n    return\n  }\n\n  postLog('[Monitor] chokidar not available. Falling back to fs.watch (reduced accuracy).')\n\n  const fallbackWatcher = fs.watch(downloadPath, { persistent: true }, async (eventType, filename) => {\n    if (eventType !== 'rename' || !filename) {\n      return\n    }\n\n    const candidatePath = path.join(downloadPath, filename)\n\n    try {\n      const stats = await fsPromises.stat(candidatePath)\n\n      if (stats.isFile()) {\n        handleDetectedFile(candidatePath)\n      }\n    } catch (err) {\n      // Ignore ENOENT and similar errors when files are removed quickly\n    }\n  })\n\n  activeWatcher = {\n    close: () => {\n      fallbackWatcher.close()\n      return Promise.resolve()\n    }\n  }\n}\n\nasync function closeWatcher() {\n  if (!activeWatcher) {\n    return\n  }\n\n  try {\n    await activeWatcher.close()\n    postLog('[Monitor] File watcher stopped.')\n  } catch (err) {\n    postError(`[Monitor] Failed to close watcher: ${err.message}`)\n  } finally {\n    activeWatcher = null\n  }\n}\n\nfunction queueManualScan(filePath) {\n  const normalized = path.resolve(filePath)\n  fileQueue.push(normalized)\n  postLog(`[Monitor] Manually queued file: ${normalized}`)\n  processQueue()\n}\n\nfunction computeFileHashes(filePath) {\n  return new Promise((resolve, reject) => {\n    const sha256 = crypto.createHash('sha256')\n    const md5 = crypto.createHash('md5')\n    const stream = fs.createReadStream(filePath)\n\n    stream.on('data', (chunk) => {\n      sha256.update(chunk)\n      md5.update(chunk)\n    })\n\n    stream.on('error', (err) => {\n      reject(err)\n    })\n\n    stream.on('end', () => {\n      try {\n        resolve({\n          sha256: sha256.digest('hex'),\n          md5: md5.digest('hex')\n        })\n      } catch (err) {\n        reject(err)\n      }\n    })\n  })\n}\n\nasync function handleShutdownRequest() {\n  if (shutdownRequested) {\n    return\n  }\n\n  shutdownRequested = true\n  postLog('[Monitor] Shutdown requested.')\n\n  await waitForIdle()\n  await closeWatcher()\n\n  parentPort.postMessage({ channel: 'shutdown-complete' })\n\n  setImmediate(() => {\n    try {\n      if (typeof parentPort.close === 'function') {\n        parentPort.close()\n      }\n    } catch (err) {\n      postError(`[Monitor] Failed to close parent port: ${err.message}`)\n    } finally {\n      process.exit(0)\n    }\n  })\n}\n\nif (parentPort) {\n  parentPort.on('message', (message) => {\n    if (!message || typeof message !== 'object') {\n      return\n    }\n\n    const { type, path: manualPath } = message\n\n    switch (type) {\n      case 'shutdown':\n        handleShutdownRequest().catch((err) => {\n          postError(`[Monitor] Shutdown handler failed: ${err.message}`)\n        })\n        break\n      case 'flush-queue':\n        processQueue()\n        break\n      case 'scan-path':\n        if (typeof manualPath === 'string') {\n          queueManualScan(manualPath)\n        }\n        break\n      default:\n        postLog(`[Monitor] Received unknown control message: ${type}`)\n    }\n  })\n}\n\npostLog(`[Monitor] Worker bootstrapped (pid ${process.pid}). Upload ${skipUpload ? 'disabled' : 'enabled'}, scan delay ${SCAN_DELAY_MS}ms.`)\n\nsetupWatcher(workerData.downloadPath)\n\nparentPort.postMessage({ channel: 'ready', payload: { downloadPath: workerData.downloadPath } })\n","range":{"startLineNumber":1,"startColumn":1,"endLineNumber":348,"endColumn":1}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware-server/server.js","external":"file:///home/trang/localnsv/mAIware-server/server.js","path":"/home/trang/localnsv/mAIware-server/server.js","scheme":"file"},"requestId":"request_f84e9d07-b060-4595-acd7-32ca34f0d58e","epoch":38,"edits":[{"text":"const express = require('express');\nconst cors = require('cors');\nconst path = require('path');\n\nconst app = express();\nconst PORT = process.env.PORT || 3000;\n\n// Middleware\napp.use(cors());\napp.use(express.json({ limit: '10mb' }));\napp.use(express.static('public'));\n\n// In-memory storage (use Redis/MongoDB in production)\nconst scanResults = [];\nconst clients = new Map(); // Track active clients\nconst sseClients = []; // Track SSE connections for dashboard updates\n\n// --- API Endpoints ---\n\n// Health check\napp.get('/api/health', (req, res) => {\n    res.json({ \n        status: 'ok', \n        totalScans: scanResults.length,\n        activeClients: clients.size,\n        timestamp: new Date().toISOString() \n    });\n});\n\n// SSE endpoint for real-time dashboard updates\napp.get('/api/events', (req, res) => {\n    res.setHeader('Content-Type', 'text/event-stream');\n    res.setHeader('Cache-Control', 'no-cache');\n    res.setHeader('Connection', 'keep-alive');\n    res.flushHeaders();\n\n    // Send initial connection message\n    res.write('data: {\"type\":\"connected\"}\\n\\n');\n\n    // Add this client to the list\n    sseClients.push(res);\n\n    // Remove client on disconnect\n    req.on('close', () => {\n        const index = sseClients.indexOf(res);\n        if (index !== -1) {\n            sseClients.splice(index, 1);\n        }\n    });\n});\n\n// Submit scan result from client\napp.post('/api/submit-scan', (req, res) => {\n    try {\n        const incoming = req.body;\n\n        // Basic validation (allow minimal non-PE payloads that omit some fields)\n        if (!incoming || !incoming.detected_filename) {\n            return res.status(400).json({ error: 'Missing detected_filename' });\n        }\n\n        // Normalize / sanitize scan object\n        const scanData = { ...incoming };\n        const isPe = scanData.is_pe !== undefined ? !!scanData.is_pe : true; // default true if absent\n\n        // If non-PE: enforce benign, remove PE-only fields\n        if (!isPe) {\n            scanData.classification = 'Benign';\n            delete scanData.malware_family;\n            if (scanData.key_findings) {\n                delete scanData.key_findings.api_imports;\n                delete scanData.key_findings.key_strings;\n                delete scanData.key_findings.section_entropy;\n                delete scanData.key_findings.packer_detected;\n                delete scanData.key_findings.signature;\n            }\n        } else {\n            // Ensure classification exists for PE paths\n            if (!scanData.classification) {\n                scanData.classification = 'Benign';\n            }\n        }\n\n        // Add server metadata\n        const scanEntry = {\n            ...scanData,\n            serverTimestamp: new Date().toISOString(),\n            scanId: `scan-${Date.now()}-${Math.random().toString(36).substr(2, 9)}`,\n            clientIp: req.ip || req.connection.remoteAddress,\n            is_pe: isPe\n        };\n\n        // Store result (most recent first)\n        scanResults.unshift(scanEntry);\n        \n        // Keep only last 1000 scans\n        if (scanResults.length > 1000) {\n            scanResults.pop();\n        }\n        \n        // Update client tracking\n        const clientId = scanData.systemInfo?.ip || req.ip;\n        clients.set(clientId, {\n            lastSeen: new Date().toISOString(),\n            totalScans: (clients.get(clientId)?.totalScans || 0) + 1\n        });\n        \n        console.log(` Received scan: ${scanEntry.detected_filename}  ${scanEntry.classification}${scanEntry.is_pe ? '' : ' (non-PE)'}`);\n        \n        // Notify all connected dashboard clients via SSE\n        const notification = JSON.stringify({ \n            type: 'new-scan', \n            scan: scanEntry \n        });\n        sseClients.forEach(client => {\n            client.write(`data: ${notification}\\n\\n`);\n        });\n        \n        res.json({ \n            success: true, \n            scanId: scanEntry.scanId,\n            message: 'Scan result recorded' \n        });\n        \n    } catch (error) {\n        console.error('Submit error:', error);\n        res.status(500).json({ error: 'Failed to record scan' });\n    }\n});\n\n// Get all scans (for dashboard)\napp.get('/api/scans', (req, res) => {\n    const limit = parseInt(req.query.limit) || 100;\n    const offset = parseInt(req.query.offset) || 0;\n    \n    const paginatedScans = scanResults.slice(offset, offset + limit);\n    \n    res.json({\n        total: scanResults.length,\n        scans: paginatedScans\n    });\n});\n\n// Get statistics\napp.get('/api/stats', (req, res) => {\n    const now = Date.now();\n    const last24h = now - 24 * 60 * 60 * 1000;\n    const last7d = now - 7 * 24 * 60 * 60 * 1000;\n    \n    const recent24h = scanResults.filter(s => \n        new Date(s.serverTimestamp).getTime() > last24h\n    );\n    \n    const recent7d = scanResults.filter(s => \n        new Date(s.serverTimestamp).getTime() > last7d\n    );\n    \n    const malwareCount = scanResults.filter(s => \n        s.classification === 'Malware'\n    ).length;\n    \n    const suspiciousCount = scanResults.filter(s => \n        s.classification === 'Suspicious'\n    ).length;\n    \n    const benignCount = scanResults.filter(s => \n        s.classification === 'Benign'\n    ).length;\n    \n    // Count active clients (seen in last 10 minutes)\n    const activeClients = Array.from(clients.values()).filter(c => \n        new Date(c.lastSeen).getTime() > now - 10 * 60 * 1000\n    ).length;\n    \n    res.json({\n        totalScans: scanResults.length,\n        scans24h: recent24h.length,\n        scans7d: recent7d.length,\n        malwareCount,\n        suspiciousCount,\n        benignCount,\n        activeClients,\n        clients: clients.size\n    });\n});\n\n// NEW: Get daily analysis data for chart\napp.get('/api/daily-scans', (req, res) => {\n    const days = parseInt(req.query.days) || 30; // Default to last 30 days\n    \n    // Create a map to store counts per day\n    const dailyCounts = new Map();\n    const today = new Date();\n    today.setHours(0, 0, 0, 0);\n    \n    // Initialize the last N days with 0 counts\n    for (let i = days - 1; i >= 0; i--) {\n        const date = new Date(today);\n        date.setDate(date.getDate() - i);\n        const dateKey = date.toISOString().split('T')[0]; // YYYY-MM-DD\n        dailyCounts.set(dateKey, {\n            date: dateKey,\n            total: 0,\n            malware: 0,\n            suspicious: 0,\n            benign: 0\n        });\n    }\n    \n    // Count scans by day\n    scanResults.forEach(scan => {\n        const scanDate = new Date(scan.serverTimestamp);\n        scanDate.setHours(0, 0, 0, 0);\n        const dateKey = scanDate.toISOString().split('T')[0];\n        \n        if (dailyCounts.has(dateKey)) {\n            const counts = dailyCounts.get(dateKey);\n            counts.total++;\n            \n            if (scan.classification === 'Malware') {\n                counts.malware++;\n            } else if (scan.classification === 'Suspicious') {\n                counts.suspicious++;\n            } else if (scan.classification === 'Benign') {\n                counts.benign++;\n            }\n        }\n    });\n    \n    // Convert map to array sorted by date\n    const result = Array.from(dailyCounts.values()).sort((a, b) => \n        a.date.localeCompare(b.date)\n    );\n    \n    res.json({ days: result });\n});\n\n// Get malware source distribution\napp.get('/api/malware-sources', (req, res) => {\n    try {\n        const sources = {\n            'Email Attachment': 0,\n            'Web Download': 0,\n            'USB/External Drive': 0,\n            'Internal Network': 0,\n            'Unknown': 0\n        };\n        \n        scanResults.forEach(scan => {\n            const filename = scan.detected_filename?.toLowerCase() || '';\n            \n            // Categorize based on file patterns and extensions\n            if (filename.match(/\\.(doc|docx|xls|xlsx|pdf|zip|rar|7z)$/)) {\n                sources['Email Attachment']++;\n            } else if (filename.match(/\\.(exe|msi|dmg|pkg|deb|rpm)$/)) {\n                sources['Web Download']++;\n            } else if (filename.match(/\\.(dll|sys|bin)$/)) {\n                sources['Internal Network']++;\n            } else if (filename.match(/\\.(jpg|png|gif|mp3|mp4|avi|mov)$/)) {\n                sources['USB/External Drive']++;\n            } else {\n                sources['Unknown']++;\n            }\n        });\n        \n        // Convert to array format for Chart.js\n        const data = Object.entries(sources).map(([source, count]) => ({\n            source,\n            count\n        }));\n        \n        res.json({ sources: data });\n        \n    } catch (error) {\n        console.error('Malware sources error:', error);\n        res.status(500).json({ error: 'Failed to get malware sources' });\n    }\n});\n\n// Simple IP to location mapping for demo purposes\n// In production, use MaxMind GeoIP2 or a geolocation API service\nfunction getLocationFromIP(ip) {\n    // Handle localhost and local IPs - assign diverse demo locations\n    if (ip === '::1' || ip === '127.0.0.1' || ip.includes('::1') || ip.startsWith('127.')) {\n        // Use a consistent hash of the IP to always assign to the same location\n        const ipHash = ip.split('').reduce((acc, char) => acc + char.charCodeAt(0), 0);\n        const locationIndex = ipHash % 18;\n        const demoLocations = [\n            { lat: 37.7749, lng: -122.4194, city: 'San Francisco', country: 'USA' },\n            { lat: 40.7128, lng: -74.0060, city: 'New York', country: 'USA' },\n            { lat: 51.5074, lng: -0.1278, city: 'London', country: 'UK' },\n            { lat: 48.8566, lng: 2.3522, city: 'Paris', country: 'France' },\n            { lat: 35.6762, lng: 139.6503, city: 'Tokyo', country: 'Japan' },\n            { lat: -33.8688, lng: 151.2093, city: 'Sydney', country: 'Australia' },\n            { lat: 52.5200, lng: 13.4050, city: 'Berlin', country: 'Germany' },\n            { lat: 55.7558, lng: 37.6173, city: 'Moscow', country: 'Russia' },\n            { lat: 19.4326, lng: -99.1332, city: 'Mexico City', country: 'Mexico' },\n            { lat: -23.5505, lng: -46.6333, city: 'So Paulo', country: 'Brazil' },\n            { lat: 1.3521, lng: 103.8198, city: 'Singapore', country: 'Singapore' },\n            { lat: 25.2048, lng: 55.2708, city: 'Dubai', country: 'UAE' },\n            { lat: 28.6139, lng: 77.2090, city: 'New Delhi', country: 'India' },\n            { lat: 39.9042, lng: 116.4074, city: 'Beijing', country: 'China' },\n            { lat: 37.5665, lng: 126.9780, city: 'Seoul', country: 'South Korea' },\n            { lat: 43.6532, lng: -79.3832, city: 'Toronto', country: 'Canada' },\n            { lat: -34.6037, lng: -58.3816, city: 'Buenos Aires', country: 'Argentina' },\n            { lat: 59.3293, lng: 18.0686, city: 'Stockholm', country: 'Sweden' },\n        ];\n        return demoLocations[locationIndex];\n    }\n    \n    // Sample IP to location mapping for demo\n    const ipLocations = {\n        '192.168': { lat: 37.7749, lng: -122.4194, city: 'San Francisco', country: 'USA' },\n        '10.0': { lat: 40.7128, lng: -74.0060, city: 'New York', country: 'USA' },\n        '172.16': { lat: 51.5074, lng: -0.1278, city: 'London', country: 'UK' },\n        '172.17': { lat: 48.8566, lng: 2.3522, city: 'Paris', country: 'France' },\n        '172.18': { lat: 35.6762, lng: 139.6503, city: 'Tokyo', country: 'Japan' },\n        '172.19': { lat: -33.8688, lng: 151.2093, city: 'Sydney', country: 'Australia' },\n        '172.20': { lat: 52.5200, lng: 13.4050, city: 'Berlin', country: 'Germany' },\n        '172.21': { lat: 55.7558, lng: 37.6173, city: 'Moscow', country: 'Russia' },\n        '172.22': { lat: 19.4326, lng: -99.1332, city: 'Mexico City', country: 'Mexico' },\n        '172.23': { lat: -23.5505, lng: -46.6333, city: 'So Paulo', country: 'Brazil' },\n    };\n    \n    // Default locations for common IP patterns\n    const defaultLocations = [\n        { lat: 1.3521, lng: 103.8198, city: 'Singapore', country: 'Singapore' },\n        { lat: 25.2048, lng: 55.2708, city: 'Dubai', country: 'UAE' },\n        { lat: 28.6139, lng: 77.2090, city: 'New Delhi', country: 'India' },\n        { lat: 39.9042, lng: 116.4074, city: 'Beijing', country: 'China' },\n        { lat: 37.5665, lng: 126.9780, city: 'Seoul', country: 'South Korea' },\n        { lat: 43.6532, lng: -79.3832, city: 'Toronto', country: 'Canada' },\n        { lat: -34.6037, lng: -58.3816, city: 'Buenos Aires', country: 'Argentina' },\n        { lat: 59.3293, lng: 18.0686, city: 'Stockholm', country: 'Sweden' },\n    ];\n    \n    // Check for known IP prefixes\n    for (const [prefix, location] of Object.entries(ipLocations)) {\n        if (ip.startsWith(prefix)) {\n            return location;\n        }\n    }\n    \n    // For unknown IPs, assign a random location from defaults\n    const hash = ip.split('.').reduce((acc, part) => acc + parseInt(part || 0), 0);\n    return defaultLocations[hash % defaultLocations.length];\n}\n\n// Get geographic data for IP addresses with malware detections\napp.get('/api/geo-data', (req, res) => {\n    try {\n        // Group scans by IP address\n        const ipData = new Map();\n        \n        scanResults.forEach(scan => {\n            const ip = scan.systemInfo?.ip || scan.clientIp || 'Unknown';\n            \n            if (ip === 'Unknown') {\n                return; // Skip unknown addresses\n            }\n            \n            if (!ipData.has(ip)) {\n                const location = getLocationFromIP(ip);\n                ipData.set(ip, {\n                    ip: ip,\n                    location: location,\n                    scans: [],\n                    malwareCount: 0,\n                    suspiciousCount: 0,\n                    benignCount: 0,\n                    totalScans: 0\n                });\n            }\n            \n            const data = ipData.get(ip);\n            data.scans.push({\n                filename: scan.detected_filename,\n                classification: scan.classification,\n                timestamp: scan.serverTimestamp\n            });\n            data.totalScans++;\n            \n            if (scan.classification === 'Malware') {\n                data.malwareCount++;\n            } else if (scan.classification === 'Suspicious') {\n                data.suspiciousCount++;\n            } else if (scan.classification === 'Benign') {\n                data.benignCount++;\n            }\n        });\n        \n        // Convert map to array\n        const geoDataArray = Array.from(ipData.values());\n        \n        res.json({\n            total: geoDataArray.length,\n            locations: geoDataArray\n        });\n        \n    } catch (error) {\n        console.error('Geo data error:', error);\n        res.status(500).json({ error: 'Failed to get geographic data' });\n    }\n});\n\n// Get threat vector correlations for the interactive graph\napp.get('/api/threat-correlations', (req, res) => {\n    try {\n        const nodes = [];\n        const links = [];\n        const nodeMap = new Map();\n        let nodeId = 0;\n        \n        // Helper to get or create node\n        const getNodeId = (label, type, group) => {\n            const key = `${type}:${label}`;\n            if (!nodeMap.has(key)) {\n                const id = nodeId++;\n                nodeMap.set(key, id);\n                nodes.push({\n                    id,\n                    label,\n                    type,\n                    group,\n                    count: 0,\n                    details: []\n                });\n            }\n            return nodeMap.get(key);\n        };\n        \n        // Process all scans and build relationships\n        const malwareFamilies = new Map();\n        \n        scanResults.forEach(scan => {\n            const family = scan.malware_family || (scan.classification === 'Malware' ? 'Unknown Malware' : null);\n            if (!family) return;\n            \n            const agentId = scan.systemInfo?.hostname || scan.clientIp || 'Unknown Agent';\n            \n            // Get or create malware family node\n            const familyId = getNodeId(family, 'malware', 1);\n            const familyNode = nodes.find(n => n.id === familyId);\n            familyNode.count++;\n            familyNode.details.push(scan.detected_filename);\n            \n            // Track family data for correlation\n            if (!malwareFamilies.has(family)) {\n                malwareFamilies.set(family, {\n                    agents: new Set(),\n                    apis: new Map(),\n                    strings: new Map(),\n                    files: []\n                });\n            }\n            const familyData = malwareFamilies.get(family);\n            familyData.agents.add(agentId);\n            familyData.files.push(scan.detected_filename);\n            \n            // Create agent node and link\n            const agentNodeId = getNodeId(agentId, 'agent', 2);\n            const agentNode = nodes.find(n => n.id === agentNodeId);\n            agentNode.count++;\n            links.push({\n                source: familyId,\n                target: agentNodeId,\n                type: 'detected_by',\n                strength: 2\n            });\n            \n            // Process API imports\n            const apis = scan.key_findings?.api_imports || [];\n            apis.forEach(api => {\n                const apiId = getNodeId(api, 'api', 3);\n                const apiNode = nodes.find(n => n.id === apiId);\n                apiNode.count++;\n                \n                // Track API frequency for this family\n                const apiCount = familyData.apis.get(api) || 0;\n                familyData.apis.set(api, apiCount + 1);\n                \n                // Link malware to API (avoid duplicates)\n                if (!links.find(l => l.source === familyId && l.target === apiId)) {\n                    links.push({\n                        source: familyId,\n                        target: apiId,\n                        type: 'uses_api',\n                        strength: 1\n                    });\n                }\n            });\n            \n            // Process suspicious strings\n            const strings = scan.key_findings?.key_strings || [];\n            strings.slice(0, 3).forEach(str => { // Limit to top 3 to avoid clutter\n                const strId = getNodeId(str.substring(0, 50), 'string', 4);\n                const strNode = nodes.find(n => n.id === strId);\n                strNode.count++;\n                \n                const strCount = familyData.strings.get(str) || 0;\n                familyData.strings.set(str, strCount + 1);\n                \n                if (!links.find(l => l.source === familyId && l.target === strId)) {\n                    links.push({\n                        source: familyId,\n                        target: strId,\n                        type: 'contains_string',\n                        strength: 1\n                    });\n                }\n            });\n        });\n        \n        // Create correlations between malware families that share common traits\n        const familyNodes = nodes.filter(n => n.type === 'malware');\n        for (let i = 0; i < familyNodes.length; i++) {\n            for (let j = i + 1; j < familyNodes.length; j++) {\n                const family1 = familyNodes[i].label;\n                const family2 = familyNodes[j].label;\n                const data1 = malwareFamilies.get(family1);\n                const data2 = malwareFamilies.get(family2);\n                \n                // Check for shared agents\n                const sharedAgents = [...data1.agents].filter(a => data2.agents.has(a));\n                \n                if (sharedAgents.length > 0) {\n                    links.push({\n                        source: familyNodes[i].id,\n                        target: familyNodes[j].id,\n                        type: 'correlated_with',\n                        strength: sharedAgents.length\n                    });\n                }\n            }\n        }\n        \n        res.json({\n            nodes,\n            links,\n            metadata: {\n                totalNodes: nodes.length,\n                totalLinks: links.length,\n                malwareFamilies: familyNodes.length\n            }\n        });\n        \n    } catch (error) {\n        console.error('Threat correlations error:', error);\n        res.status(500).json({ error: 'Failed to get threat correlations' });\n    }\n});\n\n// Get Emerging Threat Intelligence - Top IOCs and threats\napp.get('/api/emerging-threats', (req, res) => {\n    try {\n        // Aggregators for different IOC types\n        const malwareFamilies = new Map();\n        const suspiciousAPIs = new Map();\n        const maliciousStrings = new Map();\n        const packers = new Map();\n        \n        // Track threat severity and recency\n        const now = Date.now();\n        const last24h = now - 24 * 60 * 60 * 1000;\n        \n        scanResults.forEach(scan => {\n            const timestamp = new Date(scan.serverTimestamp).getTime();\n            const isRecent = timestamp > last24h;\n            const weight = isRecent ? 2 : 1; // Recent threats weigh more\n            \n            // Only aggregate from Malware and Suspicious classifications\n            if (scan.classification === 'Malware' || scan.classification === 'Suspicious') {\n                \n                // Aggregate Malware Families\n                if (scan.malware_family) {\n                    const family = scan.malware_family;\n                    const current = malwareFamilies.get(family) || { \n                        count: 0, \n                        recent: 0, \n                        severity: scan.classification === 'Malware' ? 3 : 2,\n                        files: [],\n                        agents: new Set()\n                    };\n                    current.count += weight;\n                    if (isRecent) current.recent++;\n                    current.files.push(scan.detected_filename);\n                    current.agents.add(scan.systemInfo?.hostname || scan.clientIp);\n                    malwareFamilies.set(family, current);\n                }\n                \n                // Aggregate Suspicious APIs\n                const apis = scan.key_findings?.api_imports || [];\n                apis.forEach(api => {\n                    const current = suspiciousAPIs.get(api) || { \n                        count: 0, \n                        recent: 0,\n                        families: new Set() \n                    };\n                    current.count += weight;\n                    if (isRecent) current.recent++;\n                    if (scan.malware_family) current.families.add(scan.malware_family);\n                    suspiciousAPIs.set(api, current);\n                });\n                \n                // Aggregate Malicious Strings\n                const strings = scan.key_findings?.key_strings || [];\n                strings.forEach(str => {\n                    const current = maliciousStrings.get(str) || { \n                        count: 0, \n                        recent: 0,\n                        families: new Set() \n                    };\n                    current.count += weight;\n                    if (isRecent) current.recent++;\n                    if (scan.malware_family) current.families.add(scan.malware_family);\n                    maliciousStrings.set(str, current);\n                });\n                \n                // Aggregate Packers\n                const packer = scan.key_findings?.packer_detected;\n                if (packer && packer !== 'None') {\n                    const current = packers.get(packer) || { \n                        count: 0, \n                        recent: 0,\n                        families: new Set() \n                    };\n                    current.count += weight;\n                    if (isRecent) current.recent++;\n                    if (scan.malware_family) current.families.add(scan.malware_family);\n                    packers.set(packer, current);\n                }\n            }\n        });\n        \n        // Helper to convert Map to sorted array\n        const toTopN = (map, n = 5) => {\n            return Array.from(map.entries())\n                .map(([name, data]) => ({\n                    name,\n                    count: data.count,\n                    recent: data.recent,\n                    severity: data.severity || 2,\n                    details: data.families ? Array.from(data.families) : \n                            (data.files ? data.files.slice(0, 3) : []),\n                    agents: data.agents ? data.agents.size : 0\n                }))\n                .sort((a, b) => {\n                    // Sort by: recent activity, then count, then severity\n                    if (b.recent !== a.recent) return b.recent - a.recent;\n                    if (b.count !== a.count) return b.count - a.count;\n                    return (b.severity || 0) - (a.severity || 0);\n                })\n                .slice(0, n);\n        };\n        \n        res.json({\n            timestamp: new Date().toISOString(),\n            topMalwareFamilies: toTopN(malwareFamilies, 5),\n            topSuspiciousAPIs: toTopN(suspiciousAPIs, 5),\n            topMaliciousStrings: toTopN(maliciousStrings, 5),\n            topPackers: toTopN(packers, 5),\n            summary: {\n                totalThreats: scanResults.filter(s => \n                    s.classification === 'Malware' || s.classification === 'Suspicious'\n                ).length,\n                recentThreats: scanResults.filter(s => {\n                    const timestamp = new Date(s.serverTimestamp).getTime();\n                    return (timestamp > last24h) && \n                           (s.classification === 'Malware' || s.classification === 'Suspicious');\n                }).length\n            }\n        });\n        \n    } catch (error) {\n        console.error('Emerging threats error:', error);\n        res.status(500).json({ error: 'Failed to get emerging threats' });\n    }\n});\n\n// Threat Modeler - Simulate analysis of hypothetical malware\napp.post('/api/threat-model', (req, res) => {\n    try {\n        const { fileType, packer, signature, apiImports, keyStrings } = req.body;\n        \n        // Validate inputs\n        if (!fileType || !packer || !signature || !apiImports || !keyStrings) {\n            return res.status(400).json({ error: 'Missing required parameters' });\n        }\n        \n        // Create a synthetic scan result based on the threat profile\n        const crypto = require('crypto');\n        const timestamp = Date.now();\n        const randomHash = crypto.randomBytes(32).toString('hex');\n        \n        // Determine classification based on threat indicators\n        let classification = 'Benign';\n        let confidence = 0.55;\n        let malwareFamily = null;\n        \n        // Scoring system\n        let threatScore = 0;\n        \n        // Packer increases threat score\n        if (packer !== 'None') threatScore += 25;\n        \n        // Signature evaluation\n        if (signature.includes('Not Signed') || signature.includes('Self-Signed')) {\n            threatScore += 20;\n        }\n        \n        // API analysis - check for malicious APIs\n        const maliciousAPIs = ['CreateRemoteThread', 'WriteProcessMemory', 'VirtualAllocEx', \n                               'SetWindowsHookExW', 'URLDownloadToFileW', 'NtInjectThread'];\n        const maliciousAPICount = apiImports.filter(api => \n            maliciousAPIs.some(mal => api.includes(mal))\n        ).length;\n        threatScore += maliciousAPICount * 15;\n        \n        // String analysis - check for malicious strings\n        const maliciousKeywords = ['keylog', 'steal', 'crack', 'patch', 'disable', \n                                   'powershell', 'encrypted', 'ransom', 'payload'];\n        const maliciousStringCount = keyStrings.filter(str => \n            maliciousKeywords.some(keyword => str.toLowerCase().includes(keyword))\n        ).length;\n        threatScore += maliciousStringCount * 20;\n        \n        // Determine classification\n        if (threatScore >= 60) {\n            classification = 'Malware';\n            confidence = 0.85 + (Math.min(threatScore, 100) / 100) * 0.14;\n            \n            // Assign malware family based on characteristics\n            if (keyStrings.some(s => s.toLowerCase().includes('keylog'))) {\n                malwareFamily = 'Spyware.Win32.Keylogger';\n            } else if (apiImports.includes('CreateRemoteThread') || apiImports.includes('WriteProcessMemory')) {\n                malwareFamily = 'Trojan.Downloader.Win32';\n            } else if (keyStrings.some(s => s.toLowerCase().includes('encrypt') || s.toLowerCase().includes('ransom'))) {\n                malwareFamily = 'Ransomware.Win32.Locky';\n            } else if (apiImports.includes('URLDownloadToFileW')) {\n                malwareFamily = 'Dropper.Win32.Emotet';\n            } else {\n                malwareFamily = 'Masquerader.Win32.Agent';\n            }\n        } else if (threatScore >= 30) {\n            classification = 'Suspicious';\n            confidence = 0.65 + (threatScore / 100) * 0.25;\n        } else {\n            classification = 'Benign';\n            confidence = 0.55 + Math.random() * 0.25;\n        }\n        \n        // Build the synthetic scan result\n        const syntheticScan = {\n            detected_filename: `threat_model_${timestamp}.exe`,\n            file_hashes: {\n                sha256: randomHash,\n                md5: crypto.createHash('md5').update(randomHash).digest('hex')\n            },\n            classification,\n            malware_family: malwareFamily,\n            confidence_score: confidence.toFixed(2),\n            vendor: { name: 'mAIware Threat Modeler', icon: 'fas fa-flask' },\n            key_findings: {\n                file_type: fileType,\n                packer_detected: packer,\n                signature: { \n                    name: signature, \n                    icon: signature.includes('Verified') ? 'fas fa-check-shield' : 'fas fa-times-circle',\n                    level: signature.includes('Verified') ? 'verified' : 'untrusted'\n                },\n                api_imports: apiImports,\n                key_strings: keyStrings,\n                threat_score: threatScore\n            },\n            serverTimestamp: new Date().toISOString(),\n            scanId: `model-${timestamp}`,\n            clientIp: req.ip || 'Threat Modeler',\n            isSimulated: true\n        };\n        \n        // Store in scan results\n        scanResults.unshift(syntheticScan);\n        if (scanResults.length > 1000) {\n            scanResults.pop();\n        }\n        \n        // Notify all SSE clients\n        const notification = JSON.stringify({ \n            type: 'new-scan', \n            scan: syntheticScan \n        });\n        sseClients.forEach(client => {\n            client.write(`data: ${notification}\\n\\n`);\n        });\n        \n        console.log(` Threat Model analyzed: ${classification} (${confidence.toFixed(2)} confidence)`);\n        \n        res.json({\n            success: true,\n            result: syntheticScan\n        });\n        \n    } catch (error) {\n        console.error('Threat model error:', error);\n        res.status(500).json({ error: 'Failed to analyze threat model' });\n    }\n});\n\n// Serve dashboard HTML\napp.get('/', (req, res) => {\n    res.sendFile(path.join(__dirname, 'public', 'dashboard.html'));\n});\n\n// Start server\napp.listen(PORT, () => {\n    console.log(`  mAIware Server Dashboard running on http://localhost:${PORT}`);\n    console.log(` Dashboard: http://localhost:${PORT}`);\n    console.log(` API endpoint: http://localhost:${PORT}/api/submit-scan`);\n});\n\n// Cleanup old client entries every hour\nsetInterval(() => {\n    const oneHourAgo = Date.now() - 60 * 60 * 1000;\n    for (const [clientId, data] of clients.entries()) {\n        if (new Date(data.lastSeen).getTime() < oneHourAgo) {\n            clients.delete(clientId);\n        }\n    }\n}, 60 * 60 * 1000);","range":{"startLineNumber":1,"startColumn":1,"endLineNumber":830,"endColumn":1}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware-server/public/dashboard.html","external":"file:///home/trang/localnsv/mAIware-server/public/dashboard.html","path":"/home/trang/localnsv/mAIware-server/public/dashboard.html","scheme":"file"},"requestId":"request_f84e9d07-b060-4595-acd7-32ca34f0d58e","epoch":41,"edits":[{"text":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>mAIware Server Dashboard</title>\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css\">\n    <link rel=\"stylesheet\" href=\"styles.css\">\n    <!-- Add Chart.js -->\n    <script src=\"https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js\"></script>\n    <!-- Add Leaflet.js for maps -->\n    <link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.9.4/dist/leaflet.css\" />\n    <script src=\"https://unpkg.com/leaflet@1.9.4/dist/leaflet.js\"></script>\n    <!-- Add D3.js for force-directed graph -->\n    <script src=\"https://d3js.org/d3.v7.min.js\"></script>\n</head>\n<body>\n    <div class=\"container\">\n        <header>\n            <h1><i class=\"fas fa-shield-virus\"></i> mAIware Server</h1>\n            <p class=\"subtitle\">Real-time Malware Analysis Dashboard</p>\n        </header>\n        \n        <div class=\"stats-grid\" id=\"stats-grid\">\n            <div class=\"stat-card info\">\n                <i class=\"fas fa-laptop\"></i>\n                <span class=\"stat-number\" id=\"stat-clients\">0</span>\n                <span class=\"stat-label\">Active Clients</span>\n            </div>\n            <div class=\"stat-card info\">\n                <i class=\"fas fa-chart-line\"></i>\n                <span class=\"stat-number\" id=\"stat-total\">0</span>\n                <span class=\"stat-label\">Total Scans</span>\n            </div>\n            <div class=\"stat-card malware\">\n                <i class=\"fas fa-bug\"></i>\n                <span class=\"stat-number\" id=\"stat-malware\">0</span>\n                <span class=\"stat-label\">Malware</span>\n            </div>\n            <div class=\"stat-card suspicious\">\n                <i class=\"fas fa-exclamation-triangle\"></i>\n                <span class=\"stat-number\" id=\"stat-suspicious\">0</span>\n                <span class=\"stat-label\">Suspicious</span>\n            </div>\n            <div class=\"stat-card benign\">\n                <i class=\"fas fa-check-circle\"></i>\n                <span class=\"stat-number\" id=\"stat-benign\">0</span>\n                <span class=\"stat-label\">Benign</span>\n            </div>\n        </div>\n        \n        <!-- NEW: Emerging Threat Intelligence Panel -->\n        <div class=\"eti-container\">\n            <div class=\"eti-header\">\n                <h2><i class=\"fas fa-exclamation-triangle\"></i> Emerging Threat Intelligence (ETI)</h2>\n                <p class=\"eti-subtitle\">Real-time actionable intelligence on active threats and indicators of compromise</p>\n                <div class=\"eti-summary\">\n                    <span class=\"eti-badge\" id=\"eti-total\">0 Total Threats</span>\n                    <span class=\"eti-badge recent\" id=\"eti-recent\">0 Last 24h</span>\n                </div>\n            </div>\n            \n            <div class=\"eti-grid\">\n                <div class=\"eti-panel\">\n                    <h3><i class=\"fas fa-virus\"></i> Top Malware Families</h3>\n                    <div class=\"eti-subtitle-small\">Most active malware families detected</div>\n                    <div id=\"eti-malware\" class=\"eti-list\"></div>\n                </div>\n                \n                <div class=\"eti-panel\">\n                    <h3><i class=\"fas fa-code\"></i> Top Suspicious APIs</h3>\n                    <div class=\"eti-subtitle-small\">Most frequently called malicious APIs</div>\n                    <div id=\"eti-apis\" class=\"eti-list\"></div>\n                </div>\n                \n                <div class=\"eti-panel\">\n                    <h3><i class=\"fas fa-terminal\"></i> Top Malicious Strings</h3>\n                    <div class=\"eti-subtitle-small\">Most common IOC strings and commands</div>\n                    <div id=\"eti-strings\" class=\"eti-list\"></div>\n                </div>\n                \n                <div class=\"eti-panel\">\n                    <h3><i class=\"fas fa-shield-alt\"></i> Top Packers/Obfuscators</h3>\n                    <div class=\"eti-subtitle-small\">Most used evasion techniques</div>\n                    <div id=\"eti-packers\" class=\"eti-list\"></div>\n                </div>\n            </div>\n        </div>\n        \n        <!-- NEW: Threat Modeler Panel -->\n        <div class=\"modeler-container\">\n            <div class=\"modeler-header\">\n                <h2><i class=\"fas fa-flask\"></i> Predictive Threat Modeler</h2>\n                <p class=\"modeler-subtitle\">Build hypothetical malware and predict how mAIware would classify it</p>\n            </div>\n            \n            <div class=\"modeler-grid\">\n                <div class=\"modeler-builder\">\n                    <h3><i class=\"fas fa-cogs\"></i> Threat Configuration</h3>\n                    \n                    <div class=\"modeler-field\">\n                        <label>File Type</label>\n                        <select id=\"model-filetype\" class=\"modeler-select\">\n                            <option>PE32+ (GUI) x86-64</option>\n                            <option>PE32 (Console) Intel 80386</option>\n                            <option>PE32+ DLL x86-64</option>\n                            <option>MSI Installer</option>\n                            <option>PDF Document</option>\n                        </select>\n                    </div>\n                    \n                    <div class=\"modeler-field\">\n                        <label>Packer/Obfuscator</label>\n                        <select id=\"model-packer\" class=\"modeler-select\">\n                            <option>None</option>\n                            <option>UPX</option>\n                            <option>VMProtect</option>\n                            <option>Themida</option>\n                            <option>ASPack</option>\n                            <option>Unknown (High Entropy)</option>\n                        </select>\n                    </div>\n                    \n                    <div class=\"modeler-field\">\n                        <label>Digital Signature</label>\n                        <select id=\"model-signature\" class=\"modeler-select\">\n                            <option>Verified (Microsoft Corporation)</option>\n                            <option>Verified (Google LLC)</option>\n                            <option>Verified (Unknown Publisher)</option>\n                            <option>Not Signed</option>\n                            <option>Expired Certificate</option>\n                            <option>Self-Signed (Untrusted)</option>\n                        </select>\n                    </div>\n                    \n                    <div class=\"modeler-field\">\n                        <label>API Imports (select multiple)</label>\n                        <select id=\"model-apis\" class=\"modeler-select\" multiple size=\"6\">\n                            <option>CreateRemoteThread</option>\n                            <option>WriteProcessMemory</option>\n                            <option>VirtualAllocEx</option>\n                            <option>SetWindowsHookExW</option>\n                            <option>URLDownloadToFileW</option>\n                            <option>WinExec</option>\n                            <option>RegSetValueExW</option>\n                            <option>CryptEncrypt</option>\n                            <option>Socket</option>\n                            <option>ReadFile</option>\n                        </select>\n                        <small class=\"modeler-hint\">Hold Ctrl/Cmd to select multiple</small>\n                    </div>\n                    \n                    <div class=\"modeler-field\">\n                        <label>Suspicious Strings (select multiple)</label>\n                        <select id=\"model-strings\" class=\"modeler-select\" multiple size=\"6\">\n                            <option>http://bad-c2-server.com/payload.dat</option>\n                            <option>keylog.txt</option>\n                            <option>steal_passwords</option>\n                            <option>powershell -enc</option>\n                            <option>vssadmin.exe delete shadows</option>\n                            <option>HOW_TO_DECRYPT.txt</option>\n                            <option>crack</option>\n                            <option>patch</option>\n                            <option>disable_antivirus</option>\n                        </select>\n                        <small class=\"modeler-hint\">Hold Ctrl/Cmd to select multiple</small>\n                    </div>\n                    \n                    <button class=\"modeler-analyze-btn\" onclick=\"analyzeThreatModel()\">\n                        <i class=\"fas fa-brain\"></i> ANALYZE THREAT\n                    </button>\n                </div>\n                \n                <div class=\"modeler-results\">\n                    <h3><i class=\"fas fa-chart-line\"></i> Prediction Results</h3>\n                    <div id=\"modeler-output\" class=\"modeler-output\">\n                        <div class=\"modeler-placeholder\">\n                            <i class=\"fas fa-arrow-left\"></i>\n                            <p>Configure a threat profile and click ANALYZE to see predictions</p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        \n        <div class=\"scans-container\">\n            <div class=\"scans-header\">\n                <h2>Recent Scans</h2>\n                <button class=\"refresh-btn\" onclick=\"manualRefresh()\">\n                    <i class=\"fas fa-sync-alt\"></i> Refresh\n                </button>\n            </div>\n            \n            <table class=\"scans-table\">\n                <thead>\n                    <tr>\n                        <th>Timestamp</th>\n                        <th>Filename</th>\n                        <th>Classification</th>\n                        <th>Client IP</th>\n                        <th>Hash (SHA256)</th>\n                    </tr>\n                </thead>\n                <tbody id=\"scans-tbody\">\n                    <tr>\n                        <td colspan=\"5\" class=\"empty-state\">\n                            <i class=\"fas fa-inbox\"></i>\n                            <p>No scans yet. Waiting for clients...</p>\n                        </td>\n                    </tr>\n                </tbody>\n            </table>\n        </div>\n        \n        <!-- NEW: Daily Analysis Chart -->\n        <div class=\"chart-container\">\n            <div class=\"chart-header\">\n                <h2>Daily Analysis Trends (Last 30 Days)</h2>\n                <div class=\"chart-controls\">\n                    <button class=\"chart-btn active\" onclick=\"setChartDays(7)\">7 Days</button>\n                    <button class=\"chart-btn\" onclick=\"setChartDays(14)\">14 Days</button>\n                    <button class=\"chart-btn\" onclick=\"setChartDays(30)\">30 Days</button>\n                </div>\n            </div>\n            <canvas id=\"dailyScansChart\"></canvas>\n        </div>\n        \n        <!-- NEW: Geographic Distribution Map -->\n        <div class=\"map-container\">\n            <div class=\"map-header\">\n                <h2><i class=\"fas fa-globe\"></i> Geographic Distribution of Detections</h2>\n                <div class=\"map-legend\">\n                    <span class=\"legend-item\"><span class=\"legend-dot malware-dot\"></span> Malware</span>\n                    <span class=\"legend-item\"><span class=\"legend-dot suspicious-dot\"></span> Suspicious</span>\n                    <span class=\"legend-item\"><span class=\"legend-dot benign-dot\"></span> Benign</span>\n                </div>\n            </div>\n            <div id=\"worldMap\" style=\"height: 500px; border-radius: 8px;\"></div>\n        </div>\n        \n        <!-- NEW: Malware Source Distribution Pie Chart -->\n        <div class=\"chart-container\" style=\"margin-top: 24px;\">\n            <div class=\"chart-header\">\n                <h2><i class=\"fas fa-chart-pie\"></i> Malware Source Distribution</h2>\n            </div>\n            <div style=\"max-width: 500px; margin: 0 auto;\">\n                <canvas id=\"malwareSourceChart\"></canvas>\n            </div>\n        </div>\n        \n        <!-- NEW: Threat Vector Correlation Explorer -->\n        <div class=\"correlation-container\">\n            <div class=\"correlation-header\">\n                <h2><i class=\"fas fa-project-diagram\"></i> Threat Vector Correlation Explorer</h2>\n                <p class=\"correlation-subtitle\">Interactive intelligence map showing relationships between malware families, agents, APIs, and indicators</p>\n            </div>\n            <div class=\"graph-controls\">\n                <button class=\"graph-btn\" onclick=\"resetGraph()\"><i class=\"fas fa-sync\"></i> Reset View</button>\n                <button class=\"graph-btn\" onclick=\"centerGraph()\"><i class=\"fas fa-compress\"></i> Center</button>\n                <div class=\"graph-legend\">\n                    <span class=\"legend-item\"><span class=\"node-sample malware-node\"></span> Malware Family</span>\n                    <span class=\"legend-item\"><span class=\"node-sample agent-node\"></span> Agent/System</span>\n                    <span class=\"legend-item\"><span class=\"node-sample api-node\"></span> API Call</span>\n                    <span class=\"legend-item\"><span class=\"node-sample string-node\"></span> Suspicious String</span>\n                </div>\n            </div>\n            <div id=\"correlationGraph\"></div>\n            <div id=\"nodeDetails\" class=\"node-details\" style=\"display: none;\">\n                <h3 id=\"detailsTitle\"></h3>\n                <div id=\"detailsContent\"></div>\n            </div>\n        </div>\n    </div>\n    \n    <script>\n        let dailyChart = null;\n        let currentChartDays = 30;\n        \n        async function loadStats() {\n            try {\n                const response = await fetch('/api/stats');\n                const stats = await response.json();\n                \n                document.getElementById('stat-clients').textContent = stats.activeClients;\n                document.getElementById('stat-total').textContent = stats.totalScans;\n                document.getElementById('stat-malware').textContent = stats.malwareCount;\n                document.getElementById('stat-suspicious').textContent = stats.suspiciousCount;\n                document.getElementById('stat-benign').textContent = stats.benignCount;\n            } catch (error) {\n                console.error('Failed to load stats:', error);\n            }\n        }\n        \n        async function loadScans() {\n            try {\n                const response = await fetch('/api/scans?limit=50');\n                const data = await response.json();\n                \n                const tbody = document.getElementById('scans-tbody');\n                \n                if (data.scans.length === 0) {\n                    tbody.innerHTML = `\n                        <tr>\n                            <td colspan=\"5\" class=\"empty-state\">\n                                <i class=\"fas fa-inbox\"></i>\n                                <p>No scans yet. Waiting for clients...</p>\n                            </td>\n                        </tr>\n                    `;\n                    return;\n                }\n                \n                tbody.innerHTML = data.scans.map(scan => {\n                    const timestamp = new Date(scan.serverTimestamp).toLocaleString();\n                    const hash = scan.file_hashes?.sha256 || 'N/A';\n                    const hashShort = hash.length > 16 ? (hash.substring(0, 16) + '...') : hash;\n                    const classification = scan.classification || 'Unknown';\n                    const badgeClass = classification.toLowerCase();\n                    const nonPeTag = scan.is_pe === false ? '<span class=\"badge non-pe\" title=\"Non-PE file\">Non-PE</span>' : '';\n                    return `\n                        <tr>\n                            <td>${timestamp}</td>\n                            <td>${scan.detected_filename} ${nonPeTag}</td>\n                            <td><span class=\"badge ${badgeClass}\">${classification}</span></td>\n                            <td>${scan.systemInfo?.ip || scan.clientIp || 'Unknown'}</td>\n                            <td class=\"hash\" title=\"${hash}\">${hashShort}</td>\n                        </tr>\n                    `;\n                }).join('');\n                \n            } catch (error) {\n                console.error('Failed to load scans:', error);\n            }\n        }\n        \n        async function loadDailyChart() {\n            try {\n                const response = await fetch(`/api/daily-scans?days=${currentChartDays}`);\n                const data = await response.json();\n                \n                const ctx = document.getElementById('dailyScansChart');\n                \n                // Destroy existing chart if it exists\n                if (dailyChart) {\n                    dailyChart.destroy();\n                }\n                \n                // Format dates for display (MM/DD)\n                const labels = data.days.map(day => {\n                    const date = new Date(day.date);\n                    return `${date.getMonth() + 1}/${date.getDate()}`;\n                });\n                \n                dailyChart = new Chart(ctx, {\n                    type: 'line',\n                    data: {\n                        labels: labels,\n                        datasets: [\n                            {\n                                label: 'Total Scans',\n                                data: data.days.map(d => d.total),\n                                borderColor: '#5a9cf8',\n                                backgroundColor: 'rgba(90, 156, 248, 0.1)',\n                                fill: true,\n                                tension: 0.4,\n                                borderWidth: 2\n                            },\n                            {\n                                label: 'Malware',\n                                data: data.days.map(d => d.malware),\n                                borderColor: '#ff4757',\n                                backgroundColor: 'rgba(255, 71, 87, 0.1)',\n                                fill: true,\n                                tension: 0.4,\n                                borderWidth: 2\n                            },\n                            {\n                                label: 'Suspicious',\n                                data: data.days.map(d => d.suspicious),\n                                borderColor: '#ffa502',\n                                backgroundColor: 'rgba(255, 165, 2, 0.1)',\n                                fill: true,\n                                tension: 0.4,\n                                borderWidth: 2\n                            },\n                            {\n                                label: 'Benign',\n                                data: data.days.map(d => d.benign),\n                                borderColor: '#26de81',\n                                backgroundColor: 'rgba(38, 222, 129, 0.1)',\n                                fill: true,\n                                tension: 0.4,\n                                borderWidth: 2\n                            }\n                        ]\n                    },\n                    options: {\n                        responsive: true,\n                        maintainAspectRatio: false,\n                        interaction: {\n                            mode: 'index',\n                            intersect: false,\n                        },\n                        plugins: {\n                            legend: {\n                                labels: {\n                                    color: '#e0e0e0',\n                                    font: { size: 12 }\n                                }\n                            },\n                            tooltip: {\n                                backgroundColor: 'rgba(0, 0, 0, 0.8)',\n                                titleColor: '#fff',\n                                bodyColor: '#e0e0e0',\n                                borderColor: 'rgba(255, 255, 255, 0.1)',\n                                borderWidth: 1\n                            }\n                        },\n                        scales: {\n                            x: {\n                                ticks: { \n                                    color: '#888',\n                                    maxRotation: 45,\n                                    minRotation: 45\n                                },\n                                grid: { \n                                    color: 'rgba(255, 255, 255, 0.05)' \n                                }\n                            },\n                            y: {\n                                beginAtZero: true,\n                                ticks: { \n                                    color: '#888',\n                                    stepSize: 1\n                                },\n                                grid: { \n                                    color: 'rgba(255, 255, 255, 0.05)' \n                                }\n                            }\n                        }\n                    }\n                });\n                \n            } catch (error) {\n                console.error('Failed to load daily chart:', error);\n            }\n        }\n        \n        let worldMap = null;\n        let markerLayer = null;\n        let mapInitialized = false;\n        let lastGeoDataHash = '';\n        let sourceChart = null;\n        \n        function initializeMap() {\n            if (mapInitialized) return;\n            \n            try {\n                worldMap = L.map('worldMap', {\n                    zoomControl: true,\n                    scrollWheelZoom: true\n                }).setView([20, 0], 2);\n                \n                // Use dark theme tiles\n                L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {\n                    attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors &copy; <a href=\"https://carto.com/attributions\">CARTO</a>',\n                    subdomains: 'abcd',\n                    maxZoom: 19\n                }).addTo(worldMap);\n                \n                markerLayer = L.layerGroup().addTo(worldMap);\n                mapInitialized = true;\n            } catch (error) {\n                console.error('Failed to initialize map:', error);\n            }\n        }\n        \n        async function loadGeoMap() {\n            try {\n                // Initialize map only once\n                if (!mapInitialized) {\n                    initializeMap();\n                }\n                \n                if (!markerLayer) return;\n                \n                const response = await fetch('/api/geo-data');\n                const data = await response.json();\n                \n                // Generate hash of current data to detect changes\n                const currentHash = JSON.stringify(data.locations.map(l => \n                    `${l.ip}-${l.totalScans}-${l.malwareCount}-${l.suspiciousCount}`\n                )).substring(0, 100);\n                \n                // Skip update if data hasn't changed\n                if (currentHash === lastGeoDataHash && markerLayer.getLayers().length > 0) {\n                    return;\n                }\n                lastGeoDataHash = currentHash;\n                \n                // Clear existing markers\n                markerLayer.clearLayers();\n                \n                // Add markers for each location\n                data.locations.forEach(location => {\n                    const { lat, lng, city, country } = location.location;\n                    \n                    // Determine marker color based on severity\n                    let markerColor = '#26de81'; // benign (green)\n                    let primaryClassification = 'Benign';\n                    \n                    if (location.malwareCount > 0) {\n                        markerColor = '#ff4757'; // malware (red)\n                        primaryClassification = 'Malware';\n                    } else if (location.suspiciousCount > 0) {\n                        markerColor = '#ffa502'; // suspicious (orange)\n                        primaryClassification = 'Suspicious';\n                    }\n                    \n                    // Calculate marker size based on total scans (min 8, max 24)\n                    const markerSize = Math.min(24, Math.max(8, 8 + location.totalScans * 2));\n                    \n                    // Create custom circular marker\n                    const marker = L.circleMarker([lat, lng], {\n                        radius: markerSize / 2,\n                        fillColor: markerColor,\n                        color: '#fff',\n                        weight: 2,\n                        opacity: 0.8,\n                        fillOpacity: 0.6\n                    });\n                    \n                    // Create popup content\n                    const popupContent = `\n                        <div style=\"color: #333; min-width: 200px;\">\n                            <h3 style=\"margin: 0 0 10px 0; color: #1a1a1a; font-size: 1.1rem;\">\n                                <i class=\"fas fa-map-marker-alt\" style=\"color: ${markerColor};\"></i>\n                                ${city}, ${country}\n                            </h3>\n                            <p style=\"margin: 5px 0; color: #555;\"><strong>IP:</strong> ${location.ip}</p>\n                            <p style=\"margin: 5px 0; color: #555;\"><strong>Total Scans:</strong> ${location.totalScans}</p>\n                            <div style=\"margin-top: 10px;\">\n                                <div style=\"margin: 3px 0;\">\n                                    <span style=\"color: #ff4757;\"></span> Malware: ${location.malwareCount}\n                                </div>\n                                <div style=\"margin: 3px 0;\">\n                                    <span style=\"color: #ffa502;\"></span> Suspicious: ${location.suspiciousCount}\n                                </div>\n                                <div style=\"margin: 3px 0;\">\n                                    <span style=\"color: #26de81;\"></span> Benign: ${location.benignCount}\n                                </div>\n                            </div>\n                            ${location.scans.length > 0 ? `\n                                <div style=\"margin-top: 10px; padding-top: 10px; border-top: 1px solid #ddd;\">\n                                    <strong>Recent Detections:</strong>\n                                    <ul style=\"margin: 5px 0; padding-left: 20px; font-size: 0.85rem;\">\n                                        ${location.scans.slice(0, 3).map(scan => `\n                                            <li style=\"margin: 2px 0;\">\n                                                ${scan.filename} \n                                                <span style=\"color: ${\n                                                    scan.classification === 'Malware' ? '#ff4757' : \n                                                    scan.classification === 'Suspicious' ? '#ffa502' : '#26de81'\n                                                };\">(${scan.classification})</span>\n                                            </li>\n                                        `).join('')}\n                                        ${location.scans.length > 3 ? `<li>...and ${location.scans.length - 3} more</li>` : ''}\n                                    </ul>\n                                </div>\n                            ` : ''}\n                        </div>\n                    `;\n                    \n                    marker.bindPopup(popupContent);\n                    marker.addTo(markerLayer);\n                    \n                    // Add hover effect\n                    marker.on('mouseover', function() {\n                        this.setStyle({\n                            fillOpacity: 0.9,\n                            opacity: 1\n                        });\n                    });\n                    \n                    marker.on('mouseout', function() {\n                        this.setStyle({\n                            fillOpacity: 0.6,\n                            opacity: 0.8\n                        });\n                    });\n                });\n                \n                console.log(`Map updated with ${data.locations.length} locations`);\n                \n            } catch (error) {\n                console.error('Failed to load geo map:', error);\n            }\n        }\n        \n        async function loadMalwareSources() {\n            try {\n                const response = await fetch('/api/malware-sources');\n                const data = await response.json();\n                \n                const ctx = document.getElementById('malwareSourceChart');\n                \n                // Destroy existing chart if it exists\n                if (sourceChart) {\n                    sourceChart.destroy();\n                }\n                \n                const labels = data.sources.map(s => s.source);\n                const counts = data.sources.map(s => s.count);\n                \n                // Color scheme for different sources\n                const colors = [\n                    '#ff6b6b', // Email Attachment - red\n                    '#4ecdc4', // Web Download - teal\n                    '#ffe66d', // USB/External Drive - yellow\n                    '#a8dadc', // Internal Network - light blue\n                    '#95a5a6'  // Unknown - gray\n                ];\n                \n                sourceChart = new Chart(ctx, {\n                    type: 'pie',\n                    data: {\n                        labels: labels,\n                        datasets: [{\n                            data: counts,\n                            backgroundColor: colors,\n                            borderColor: '#1a1a2e',\n                            borderWidth: 2\n                        }]\n                    },\n                    options: {\n                        responsive: true,\n                        maintainAspectRatio: true,\n                        plugins: {\n                            legend: {\n                                position: 'bottom',\n                                labels: {\n                                    color: '#e0e0e0',\n                                    font: { size: 12 },\n                                    padding: 15\n                                }\n                            },\n                            tooltip: {\n                                backgroundColor: 'rgba(0, 0, 0, 0.8)',\n                                titleColor: '#fff',\n                                bodyColor: '#e0e0e0',\n                                borderColor: 'rgba(255, 255, 255, 0.1)',\n                                borderWidth: 1,\n                                callbacks: {\n                                    label: function(context) {\n                                        const label = context.label || '';\n                                        const value = context.parsed || 0;\n                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);\n                                        const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : 0;\n                                        return `${label}: ${value} (${percentage}%)`;\n                                    }\n                                }\n                            }\n                        }\n                    }\n                });\n                \n            } catch (error) {\n                console.error('Failed to load malware sources:', error);\n            }\n        }\n        \n        async function loadEmergingThreats() {\n            try {\n                const response = await fetch('/api/emerging-threats');\n                const data = await response.json();\n                \n                // Update summary badges\n                document.getElementById('eti-total').textContent = \n                    `${data.summary.totalThreats} Total Threats`;\n                document.getElementById('eti-recent').textContent = \n                    `${data.summary.recentThreats} Last 24h`;\n                \n                // Helper to render IOC list\n                const renderIOCList = (items, container) => {\n                    if (items.length === 0) {\n                        container.innerHTML = '<div class=\"eti-empty\">No threats detected</div>';\n                        return;\n                    }\n                    \n                    container.innerHTML = items.map((item, index) => {\n                        const rank = index + 1;\n                        const recentBadge = item.recent > 0 ? \n                            `<span class=\"eti-recent-badge\">${item.recent} recent</span>` : '';\n                        const agentBadge = item.agents > 0 ? \n                            `<span class=\"eti-agent-badge\">${item.agents} agents</span>` : '';\n                        \n                        return `\n                            <div class=\"eti-item\" data-rank=\"${rank}\">\n                                <div class=\"eti-rank\">${rank}</div>\n                                <div class=\"eti-content\">\n                                    <div class=\"eti-name\">${item.name}</div>\n                                    <div class=\"eti-meta\">\n                                        <span class=\"eti-count\">${item.count} occurrences</span>\n                                        ${recentBadge}\n                                        ${agentBadge}\n                                    </div>\n                                    ${item.details && item.details.length > 0 ? `\n                                        <div class=\"eti-details\">\n                                            ${item.details.slice(0, 2).join(', ')}\n                                            ${item.details.length > 2 ? '...' : ''}\n                                        </div>\n                                    ` : ''}\n                                </div>\n                            </div>\n                        `;\n                    }).join('');\n                };\n                \n                // Render each section\n                renderIOCList(data.topMalwareFamilies, document.getElementById('eti-malware'));\n                renderIOCList(data.topSuspiciousAPIs, document.getElementById('eti-apis'));\n                renderIOCList(data.topMaliciousStrings, document.getElementById('eti-strings'));\n                renderIOCList(data.topPackers, document.getElementById('eti-packers'));\n                \n            } catch (error) {\n                console.error('Failed to load emerging threats:', error);\n            }\n        }\n        \n        async function analyzeThreatModel() {\n            try {\n                // Get selected values\n                const fileType = document.getElementById('model-filetype').value;\n                const packer = document.getElementById('model-packer').value;\n                const signature = document.getElementById('model-signature').value;\n                \n                // Get multiple selections\n                const apisSelect = document.getElementById('model-apis');\n                const apiImports = Array.from(apisSelect.selectedOptions).map(opt => opt.value);\n                \n                const stringsSelect = document.getElementById('model-strings');\n                const keyStrings = Array.from(stringsSelect.selectedOptions).map(opt => opt.value);\n                \n                // Validate\n                if (apiImports.length === 0) {\n                    alert('Please select at least one API import');\n                    return;\n                }\n                if (keyStrings.length === 0) {\n                    alert('Please select at least one suspicious string');\n                    return;\n                }\n                \n                // Show loading state\n                const outputDiv = document.getElementById('modeler-output');\n                outputDiv.innerHTML = `\n                    <div class=\"modeler-loading\">\n                        <i class=\"fas fa-spinner fa-spin\"></i>\n                        <p>Analyzing threat profile...</p>\n                    </div>\n                `;\n                \n                // Send to server\n                const response = await fetch('/api/threat-model', {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({\n                        fileType,\n                        packer,\n                        signature,\n                        apiImports,\n                        keyStrings\n                    })\n                });\n                \n                const data = await response.json();\n                \n                if (data.success) {\n                    const result = data.result;\n                    const classColor = \n                        result.classification === 'Malware' ? '#ff4757' :\n                        result.classification === 'Suspicious' ? '#ffa502' : '#26de81';\n                    \n                    outputDiv.innerHTML = `\n                        <div class=\"prediction-result\">\n                            <div class=\"prediction-header\">\n                                <div class=\"prediction-badge\" style=\"background: ${classColor};\">\n                                    ${result.classification.toUpperCase()}\n                                </div>\n                                <div class=\"prediction-confidence\">\n                                    <div class=\"confidence-label\">Confidence Score</div>\n                                    <div class=\"confidence-value\">${(parseFloat(result.confidence_score) * 100).toFixed(1)}%</div>\n                                </div>\n                            </div>\n                            \n                            ${result.malware_family ? `\n                                <div class=\"prediction-family\">\n                                    <strong>Predicted Malware Family:</strong>\n                                    <span class=\"family-name\">${result.malware_family}</span>\n                                </div>\n                            ` : ''}\n                            \n                            <div class=\"prediction-section\">\n                                <h4>Threat Analysis</h4>\n                                <div class=\"analysis-item\">\n                                    <i class=\"fas fa-file\"></i>\n                                    <span><strong>File Type:</strong> ${result.key_findings.file_type}</span>\n                                </div>\n                                <div class=\"analysis-item\">\n                                    <i class=\"fas fa-box\"></i>\n                                    <span><strong>Packer:</strong> ${result.key_findings.packer_detected}</span>\n                                </div>\n                                <div class=\"analysis-item\">\n                                    <i class=\"fas fa-certificate\"></i>\n                                    <span><strong>Signature:</strong> ${result.key_findings.signature.name}</span>\n                                </div>\n                                <div class=\"analysis-item\">\n                                    <i class=\"fas fa-tachometer-alt\"></i>\n                                    <span><strong>Threat Score:</strong> ${result.key_findings.threat_score}/100</span>\n                                </div>\n                            </div>\n                            \n                            <div class=\"prediction-section\">\n                                <h4>Detected Indicators</h4>\n                                <div class=\"indicator-group\">\n                                    <strong>API Imports:</strong>\n                                    <div class=\"indicator-list\">\n                                        ${result.key_findings.api_imports.map(api => \n                                            `<span class=\"indicator-tag api-tag\">${api}</span>`\n                                        ).join('')}\n                                    </div>\n                                </div>\n                                <div class=\"indicator-group\">\n                                    <strong>Suspicious Strings:</strong>\n                                    <div class=\"indicator-list\">\n                                        ${result.key_findings.key_strings.map(str => \n                                            `<span class=\"indicator-tag string-tag\">${str}</span>`\n                                        ).join('')}\n                                    </div>\n                                </div>\n                            </div>\n                            \n                            <div class=\"prediction-footer\">\n                                <i class=\"fas fa-info-circle\"></i>\n                                This analysis has been added to the scan results and will appear in all visualizations.\n                            </div>\n                        </div>\n                    `;\n                } else {\n                    outputDiv.innerHTML = `\n                        <div class=\"modeler-error\">\n                            <i class=\"fas fa-exclamation-circle\"></i>\n                            <p>Analysis failed: ${data.error}</p>\n                        </div>\n                    `;\n                }\n                \n            } catch (error) {\n                console.error('Failed to analyze threat model:', error);\n                document.getElementById('modeler-output').innerHTML = `\n                    <div class=\"modeler-error\">\n                        <i class=\"fas fa-exclamation-circle\"></i>\n                        <p>Analysis failed. Please try again.</p>\n                    </div>\n                `;\n            }\n        }\n        \n        let graphSimulation = null;\n        let graphSvg = null;\n        \n        async function loadCorrelationGraph() {\n            try {\n                const response = await fetch('/api/threat-correlations');\n                const data = await response.json();\n                \n                // Clear existing graph\n                d3.select('#correlationGraph').selectAll('*').remove();\n                \n                const container = document.getElementById('correlationGraph');\n                const width = container.clientWidth;\n                const height = 600;\n                \n                // Create SVG\n                graphSvg = d3.select('#correlationGraph')\n                    .append('svg')\n                    .attr('width', width)\n                    .attr('height', height)\n                    .style('background', '#0a0a0a')\n                    .style('border-radius', '8px');\n                \n                const g = graphSvg.append('g');\n                \n                // Add zoom behavior\n                const zoom = d3.zoom()\n                    .scaleExtent([0.1, 4])\n                    .on('zoom', (event) => {\n                        g.attr('transform', event.transform);\n                    });\n                \n                graphSvg.call(zoom);\n                \n                // Color schemes for different node types\n                const colorMap = {\n                    malware: '#ff4757',\n                    agent: '#5a9cf8',\n                    api: '#ffa502',\n                    string: '#26de81'\n                };\n                \n                // Create force simulation\n                graphSimulation = d3.forceSimulation(data.nodes)\n                    .force('link', d3.forceLink(data.links)\n                        .id(d => d.id)\n                        .distance(d => d.type === 'correlated_with' ? 200 : 100)\n                        .strength(d => d.strength * 0.3))\n                    .force('charge', d3.forceManyBody().strength(-300))\n                    .force('center', d3.forceCenter(width / 2, height / 2))\n                    .force('collision', d3.forceCollide().radius(30));\n                \n                // Draw links\n                const link = g.append('g')\n                    .selectAll('line')\n                    .data(data.links)\n                    .enter()\n                    .append('line')\n                    .attr('stroke', d => {\n                        if (d.type === 'correlated_with') return '#ff6b6b';\n                        if (d.type === 'detected_by') return '#5a9cf8';\n                        if (d.type === 'uses_api') return '#ffa502';\n                        return '#26de81';\n                    })\n                    .attr('stroke-width', d => Math.sqrt(d.strength) + 1)\n                    .attr('stroke-opacity', 0.6);\n                \n                // Draw nodes\n                const node = g.append('g')\n                    .selectAll('circle')\n                    .data(data.nodes)\n                    .enter()\n                    .append('circle')\n                    .attr('r', d => {\n                        if (d.type === 'malware') return 15 + Math.min(d.count * 2, 15);\n                        if (d.type === 'agent') return 12 + Math.min(d.count, 10);\n                        return 8 + Math.min(d.count, 8);\n                    })\n                    .attr('fill', d => colorMap[d.type])\n                    .attr('stroke', '#fff')\n                    .attr('stroke-width', 2)\n                    .style('cursor', 'pointer')\n                    .call(d3.drag()\n                        .on('start', dragstarted)\n                        .on('drag', dragged)\n                        .on('end', dragended))\n                    .on('click', (event, d) => showNodeDetails(d, data))\n                    .on('mouseover', function(event, d) {\n                        d3.select(this)\n                            .transition()\n                            .duration(200)\n                            .attr('stroke-width', 4)\n                            .attr('r', function() {\n                                const currentR = parseFloat(d3.select(this).attr('r'));\n                                return currentR * 1.3;\n                            });\n                    })\n                    .on('mouseout', function(event, d) {\n                        d3.select(this)\n                            .transition()\n                            .duration(200)\n                            .attr('stroke-width', 2)\n                            .attr('r', function() {\n                                if (d.type === 'malware') return 15 + Math.min(d.count * 2, 15);\n                                if (d.type === 'agent') return 12 + Math.min(d.count, 10);\n                                return 8 + Math.min(d.count, 8);\n                            });\n                    });\n                \n                // Add labels\n                const label = g.append('g')\n                    .selectAll('text')\n                    .data(data.nodes)\n                    .enter()\n                    .append('text')\n                    .text(d => d.label.length > 20 ? d.label.substring(0, 20) + '...' : d.label)\n                    .attr('font-size', d => d.type === 'malware' ? '12px' : '10px')\n                    .attr('fill', '#e0e0e0')\n                    .attr('text-anchor', 'middle')\n                    .attr('dy', d => {\n                        if (d.type === 'malware') return 35;\n                        if (d.type === 'agent') return 25;\n                        return 20;\n                    })\n                    .style('pointer-events', 'none')\n                    .style('font-weight', d => d.type === 'malware' ? 'bold' : 'normal');\n                \n                // Update positions on simulation tick\n                graphSimulation.on('tick', () => {\n                    link\n                        .attr('x1', d => d.source.x)\n                        .attr('y1', d => d.source.y)\n                        .attr('x2', d => d.target.x)\n                        .attr('y2', d => d.target.y);\n                    \n                    node\n                        .attr('cx', d => d.x)\n                        .attr('cy', d => d.y);\n                    \n                    label\n                        .attr('x', d => d.x)\n                        .attr('y', d => d.y);\n                });\n                \n                // Drag functions\n                function dragstarted(event, d) {\n                    if (!event.active) graphSimulation.alphaTarget(0.3).restart();\n                    d.fx = d.x;\n                    d.fy = d.y;\n                }\n                \n                function dragged(event, d) {\n                    d.fx = event.x;\n                    d.fy = event.y;\n                }\n                \n                function dragended(event, d) {\n                    if (!event.active) graphSimulation.alphaTarget(0);\n                    d.fx = null;\n                    d.fy = null;\n                }\n                \n                console.log(`Correlation graph loaded: ${data.nodes.length} nodes, ${data.links.length} links`);\n                \n            } catch (error) {\n                console.error('Failed to load correlation graph:', error);\n            }\n        }\n        \n        function showNodeDetails(node, graphData) {\n            const detailsPanel = document.getElementById('nodeDetails');\n            const detailsTitle = document.getElementById('detailsTitle');\n            const detailsContent = document.getElementById('detailsContent');\n            \n            detailsTitle.textContent = node.label;\n            \n            let html = `<p><strong>Type:</strong> ${node.type.toUpperCase()}</p>`;\n            html += `<p><strong>Occurrences:</strong> ${node.count}</p>`;\n            \n            // Find connections\n            const connections = graphData.links.filter(l => \n                l.source.id === node.id || l.target.id === node.id\n            );\n            \n            if (connections.length > 0) {\n                html += `<p><strong>Connections:</strong> ${connections.length}</p>`;\n                html += '<ul style=\"margin: 10px 0; padding-left: 20px;\">';\n                connections.slice(0, 10).forEach(link => {\n                    const otherNode = link.source.id === node.id ? link.target : link.source;\n                    html += `<li>${link.type.replace(/_/g, ' ')}: ${otherNode.label}</li>`;\n                });\n                if (connections.length > 10) {\n                    html += `<li>...and ${connections.length - 10} more</li>`;\n                }\n                html += '</ul>';\n            }\n            \n            if (node.details && node.details.length > 0) {\n                html += '<p><strong>Associated Files:</strong></p>';\n                html += '<ul style=\"margin: 10px 0; padding-left: 20px; max-height: 150px; overflow-y: auto;\">';\n                node.details.slice(0, 10).forEach(file => {\n                    html += `<li>${file}</li>`;\n                });\n                if (node.details.length > 10) {\n                    html += `<li>...and ${node.details.length - 10} more</li>`;\n                }\n                html += '</ul>';\n            }\n            \n            detailsContent.innerHTML = html;\n            detailsPanel.style.display = 'block';\n        }\n        \n        function resetGraph() {\n            if (graphSimulation) {\n                graphSimulation.alpha(1).restart();\n            }\n        }\n        \n        function centerGraph() {\n            if (graphSvg) {\n                graphSvg.transition().duration(750).call(\n                    d3.zoom().transform,\n                    d3.zoomIdentity\n                );\n            }\n        }\n        \n        function setChartDays(days) {\n            currentChartDays = days;\n            \n            // Update button states\n            document.querySelectorAll('.chart-btn').forEach(btn => {\n                btn.classList.remove('active');\n            });\n            event.target.classList.add('active');\n            \n            loadDailyChart();\n        }\n        \n        function loadData() {\n            loadStats();\n            loadScans();\n            loadDailyChart();\n            loadMalwareSources();\n            loadEmergingThreats();\n            loadCorrelationGraph();\n            loadGeoMap();\n        }\n        \n        function loadDataWithoutMap() {\n            loadStats();\n            loadScans();\n            loadDailyChart();\n            loadMalwareSources();\n            loadEmergingThreats();\n            loadCorrelationGraph();\n        }\n        \n        // Initial load\n        loadData();\n        \n        // Set up Server-Sent Events for real-time updates\n        const eventSource = new EventSource('/api/events');\n        \n        eventSource.onmessage = function(event) {\n            const data = JSON.parse(event.data);\n            \n            if (data.type === 'connected') {\n                console.log('Connected to server for real-time updates');\n            } else if (data.type === 'new-scan') {\n                console.log('New scan received:', data.scan.detected_filename);\n                // Reload all data when new scan arrives\n                loadDataWithoutMap();\n                // Update map less frequently (only if it's been more than 10 seconds)\n                if (!window.lastMapUpdate || Date.now() - window.lastMapUpdate > 10000) {\n                    loadGeoMap();\n                    window.lastMapUpdate = Date.now();\n                }\n            }\n        };\n        \n        eventSource.onerror = function(error) {\n            console.error('SSE Error:', error);\n            // Fallback: reload data every 30 seconds if SSE connection fails\n            if (eventSource.readyState === EventSource.CLOSED) {\n                console.log('SSE connection closed, falling back to polling...');\n                setInterval(loadDataWithoutMap, 30000);\n            }\n        };\n        \n        // Manual refresh button functionality\n        window.manualRefresh = function() {\n            loadData();\n        };\n    </script>\n</body>\n</html>","range":{"startLineNumber":1,"startColumn":1,"endLineNumber":1166,"endColumn":1}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware-server/public/styles.css","external":"file:///home/trang/localnsv/mAIware-server/public/styles.css","path":"/home/trang/localnsv/mAIware-server/public/styles.css","scheme":"file"},"requestId":"request_f84e9d07-b060-4595-acd7-32ca34f0d58e","epoch":44,"edits":[{"text":"* { \n    margin: 0; \n    padding: 0; \n    box-sizing: border-box; \n}\n\nbody {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);\n    color: #e0e0e0;\n    min-height: 100vh;\n    padding: 2rem;\n}\n\n.container {\n    max-width: 1400px;\n    margin: 0 auto;\n}\n\nheader {\n    text-align: center;\n    margin-bottom: 3rem;\n}\n\nh1 {\n    font-size: 2.5rem;\n    color: #5a9cf8;\n    margin-bottom: 0.5rem;\n}\n\n.subtitle {\n    color: #888;\n    font-size: 1.1rem;\n}\n\n.stats-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n    gap: 1.5rem;\n    margin-bottom: 3rem;\n}\n\n/* Emerging Threat Intelligence Panel */\n.eti-container {\n    background: linear-gradient(135deg, rgba(255, 71, 87, 0.1) 0%, rgba(255, 165, 2, 0.1) 100%);\n    border: 2px solid rgba(255, 71, 87, 0.3);\n    border-radius: 12px;\n    padding: 24px;\n    margin-bottom: 3rem;\n    box-shadow: 0 4px 16px rgba(255, 71, 87, 0.2);\n}\n\n.eti-header {\n    margin-bottom: 24px;\n}\n\n.eti-header h2 {\n    margin: 0 0 8px 0;\n    font-size: 1.8rem;\n    color: #ff6b6b;\n    text-shadow: 0 2px 4px rgba(255, 71, 87, 0.3);\n}\n\n.eti-header h2 i {\n    color: #ff4757;\n    margin-right: 10px;\n    animation: pulse 2s infinite;\n}\n\n@keyframes pulse {\n    0%, 100% { opacity: 1; }\n    50% { opacity: 0.6; }\n}\n\n.eti-subtitle {\n    color: #b0b0b0;\n    font-size: 0.95rem;\n    margin: 8px 0 16px 0;\n}\n\n.eti-summary {\n    display: flex;\n    gap: 12px;\n    flex-wrap: wrap;\n}\n\n.eti-badge {\n    background: rgba(90, 156, 248, 0.2);\n    border: 1px solid rgba(90, 156, 248, 0.4);\n    color: #5a9cf8;\n    padding: 6px 14px;\n    border-radius: 20px;\n    font-size: 0.85rem;\n    font-weight: 600;\n}\n\n.eti-badge.recent {\n    background: rgba(255, 71, 87, 0.2);\n    border-color: rgba(255, 71, 87, 0.4);\n    color: #ff6b6b;\n}\n\n.eti-grid {\n    display: grid;\n    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));\n    gap: 20px;\n}\n\n.eti-panel {\n    background: rgba(0, 0, 0, 0.3);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: 10px;\n    padding: 18px;\n    transition: transform 0.3s, box-shadow 0.3s;\n}\n\n.eti-panel:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);\n}\n\n.eti-panel h3 {\n    margin: 0 0 6px 0;\n    font-size: 1.1rem;\n    color: #e0e0e0;\n}\n\n.eti-panel h3 i {\n    color: #ffa502;\n    margin-right: 8px;\n}\n\n.eti-subtitle-small {\n    color: #888;\n    font-size: 0.8rem;\n    margin-bottom: 14px;\n}\n\n.eti-list {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n}\n\n.eti-item {\n    display: flex;\n    gap: 12px;\n    background: rgba(255, 255, 255, 0.03);\n    border: 1px solid rgba(255, 255, 255, 0.08);\n    border-radius: 8px;\n    padding: 12px;\n    transition: all 0.3s;\n}\n\n.eti-item:hover {\n    background: rgba(255, 255, 255, 0.06);\n    border-color: rgba(255, 165, 2, 0.4);\n    transform: translateX(4px);\n}\n\n.eti-rank {\n    flex-shrink: 0;\n    width: 32px;\n    height: 32px;\n    background: linear-gradient(135deg, #ff6b6b, #ffa502);\n    border-radius: 50%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-weight: bold;\n    font-size: 1rem;\n    color: #fff;\n    box-shadow: 0 2px 8px rgba(255, 107, 107, 0.4);\n}\n\n.eti-item[data-rank=\"1\"] .eti-rank {\n    background: linear-gradient(135deg, #ff4757, #ff6348);\n    transform: scale(1.1);\n}\n\n.eti-content {\n    flex: 1;\n    min-width: 0;\n}\n\n.eti-name {\n    font-weight: 600;\n    color: #e0e0e0;\n    font-size: 0.95rem;\n    margin-bottom: 4px;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n}\n\n.eti-meta {\n    display: flex;\n    gap: 8px;\n    flex-wrap: wrap;\n    align-items: center;\n}\n\n.eti-count {\n    color: #888;\n    font-size: 0.8rem;\n}\n\n.eti-recent-badge {\n    background: rgba(255, 71, 87, 0.2);\n    border: 1px solid rgba(255, 71, 87, 0.4);\n    color: #ff6b6b;\n    padding: 2px 8px;\n    border-radius: 10px;\n    font-size: 0.75rem;\n    font-weight: 600;\n}\n\n.eti-agent-badge {\n    background: rgba(90, 156, 248, 0.2);\n    border: 1px solid rgba(90, 156, 248, 0.4);\n    color: #5a9cf8;\n    padding: 2px 8px;\n    border-radius: 10px;\n    font-size: 0.75rem;\n    font-weight: 600;\n}\n\n.eti-details {\n    margin-top: 6px;\n    color: #999;\n    font-size: 0.75rem;\n    font-style: italic;\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n}\n\n.eti-empty {\n    text-align: center;\n    color: #666;\n    padding: 20px;\n    font-style: italic;\n}\n\n/* Threat Modeler */\n.modeler-container {\n    background: linear-gradient(135deg, rgba(90, 156, 248, 0.1) 0%, rgba(38, 222, 129, 0.1) 100%);\n    border: 2px solid rgba(90, 156, 248, 0.3);\n    border-radius: 12px;\n    padding: 24px;\n    margin-bottom: 3rem;\n    box-shadow: 0 4px 16px rgba(90, 156, 248, 0.2);\n}\n\n.modeler-header {\n    margin-bottom: 24px;\n}\n\n.modeler-header h2 {\n    margin: 0 0 8px 0;\n    font-size: 1.8rem;\n    color: #5a9cf8;\n}\n\n.modeler-header h2 i {\n    color: #26de81;\n    margin-right: 10px;\n}\n\n.modeler-subtitle {\n    color: #b0b0b0;\n    font-size: 0.95rem;\n    margin: 0;\n}\n\n.modeler-grid {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 24px;\n}\n\n@media (max-width: 1024px) {\n    .modeler-grid {\n        grid-template-columns: 1fr;\n    }\n}\n\n.modeler-builder,\n.modeler-results {\n    background: rgba(0, 0, 0, 0.3);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: 10px;\n    padding: 20px;\n}\n\n.modeler-builder h3,\n.modeler-results h3 {\n    margin: 0 0 20px 0;\n    font-size: 1.2rem;\n    color: #e0e0e0;\n    border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n    padding-bottom: 10px;\n}\n\n.modeler-builder h3 i {\n    color: #26de81;\n    margin-right: 8px;\n}\n\n.modeler-results h3 i {\n    color: #5a9cf8;\n    margin-right: 8px;\n}\n\n.modeler-field {\n    margin-bottom: 20px;\n}\n\n.modeler-field label {\n    display: block;\n    color: #b0b0b0;\n    font-size: 0.9rem;\n    margin-bottom: 6px;\n    font-weight: 600;\n}\n\n.modeler-select {\n    width: 100%;\n    background: rgba(255, 255, 255, 0.05);\n    border: 1px solid rgba(255, 255, 255, 0.2);\n    border-radius: 6px;\n    color: #e0e0e0;\n    padding: 10px;\n    font-size: 0.9rem;\n    font-family: inherit;\n    cursor: pointer;\n    transition: all 0.3s;\n}\n\n.modeler-select:focus {\n    outline: none;\n    border-color: #5a9cf8;\n    background: rgba(90, 156, 248, 0.1);\n}\n\n.modeler-select option {\n    background: #1a1a2e;\n    color: #e0e0e0;\n    padding: 8px;\n}\n\n.modeler-hint {\n    display: block;\n    color: #666;\n    font-size: 0.75rem;\n    margin-top: 4px;\n    font-style: italic;\n}\n\n.modeler-analyze-btn {\n    width: 100%;\n    background: linear-gradient(135deg, #26de81, #20bf6b);\n    border: none;\n    color: #fff;\n    padding: 14px 24px;\n    border-radius: 8px;\n    font-size: 1rem;\n    font-weight: 700;\n    cursor: pointer;\n    transition: all 0.3s;\n    box-shadow: 0 4px 12px rgba(38, 222, 129, 0.3);\n}\n\n.modeler-analyze-btn:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 6px 16px rgba(38, 222, 129, 0.4);\n}\n\n.modeler-analyze-btn i {\n    margin-right: 8px;\n}\n\n.modeler-output {\n    min-height: 400px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n\n.modeler-placeholder {\n    text-align: center;\n    color: #666;\n}\n\n.modeler-placeholder i {\n    font-size: 3rem;\n    margin-bottom: 16px;\n    opacity: 0.5;\n}\n\n.modeler-placeholder p {\n    font-size: 0.95rem;\n}\n\n.modeler-loading {\n    text-align: center;\n    color: #5a9cf8;\n}\n\n.modeler-loading i {\n    font-size: 3rem;\n    margin-bottom: 16px;\n}\n\n.modeler-error {\n    text-align: center;\n    color: #ff4757;\n}\n\n.modeler-error i {\n    font-size: 3rem;\n    margin-bottom: 16px;\n}\n\n.prediction-result {\n    width: 100%;\n}\n\n.prediction-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 24px;\n    padding: 20px;\n    background: rgba(255, 255, 255, 0.05);\n    border-radius: 8px;\n}\n\n.prediction-badge {\n    padding: 12px 24px;\n    border-radius: 8px;\n    font-size: 1.3rem;\n    font-weight: 800;\n    color: #fff;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n}\n\n.prediction-confidence {\n    text-align: right;\n}\n\n.confidence-label {\n    color: #888;\n    font-size: 0.8rem;\n    margin-bottom: 4px;\n}\n\n.confidence-value {\n    color: #5a9cf8;\n    font-size: 2rem;\n    font-weight: 800;\n}\n\n.prediction-family {\n    padding: 16px;\n    background: rgba(255, 71, 87, 0.1);\n    border-left: 4px solid #ff4757;\n    border-radius: 6px;\n    margin-bottom: 20px;\n    color: #e0e0e0;\n}\n\n.family-name {\n    color: #ff6b6b;\n    font-weight: 700;\n    font-size: 1.1rem;\n    margin-left: 8px;\n}\n\n.prediction-section {\n    margin-bottom: 20px;\n}\n\n.prediction-section h4 {\n    color: #5a9cf8;\n    font-size: 1rem;\n    margin: 0 0 12px 0;\n    border-bottom: 1px solid rgba(90, 156, 248, 0.3);\n    padding-bottom: 6px;\n}\n\n.analysis-item {\n    display: flex;\n    align-items: center;\n    gap: 12px;\n    padding: 8px 0;\n    color: #b0b0b0;\n    font-size: 0.9rem;\n}\n\n.analysis-item i {\n    color: #ffa502;\n    width: 20px;\n}\n\n.indicator-group {\n    margin-bottom: 16px;\n}\n\n.indicator-group strong {\n    display: block;\n    color: #e0e0e0;\n    margin-bottom: 8px;\n    font-size: 0.9rem;\n}\n\n.indicator-list {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 8px;\n}\n\n.indicator-tag {\n    padding: 6px 12px;\n    border-radius: 6px;\n    font-size: 0.8rem;\n    font-weight: 600;\n    font-family: 'Courier New', monospace;\n}\n\n.api-tag {\n    background: rgba(255, 165, 2, 0.2);\n    border: 1px solid rgba(255, 165, 2, 0.4);\n    color: #ffa502;\n}\n\n.string-tag {\n    background: rgba(255, 71, 87, 0.2);\n    border: 1px solid rgba(255, 71, 87, 0.4);\n    color: #ff6b6b;\n}\n\n.prediction-footer {\n    margin-top: 20px;\n    padding: 12px;\n    background: rgba(90, 156, 248, 0.1);\n    border-radius: 6px;\n    color: #5a9cf8;\n    font-size: 0.85rem;\n    display: flex;\n    align-items: center;\n    gap: 8px;\n}\n\n.stat-card {\n    background: rgba(255, 255, 255, 0.05);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: 12px;\n    padding: 1.5rem;\n    text-align: center;\n}\n\n.stat-card i {\n    font-size: 2rem;\n    margin-bottom: 1rem;\n}\n\n.stat-number {\n    display: block;\n    font-size: 2rem;\n    font-weight: bold;\n    margin-bottom: 0.5rem;\n}\n\n.stat-label {\n    color: #888;\n    font-size: 0.9rem;\n}\n\n.stat-card.malware { border-color: #ff4757; }\n.stat-card.malware i { color: #ff4757; }\n.stat-card.malware .stat-number { color: #ff4757; }\n\n.stat-card.suspicious { border-color: #ffa502; }\n.stat-card.suspicious i { color: #ffa502; }\n.stat-card.suspicious .stat-number { color: #ffa502; }\n\n.stat-card.benign { border-color: #26de81; }\n.stat-card.benign i { color: #26de81; }\n.stat-card.benign .stat-number { color: #26de81; }\n\n.stat-card.info { border-color: #5a9cf8; }\n.stat-card.info i { color: #5a9cf8; }\n.stat-card.info .stat-number { color: #5a9cf8; }\n\n.scans-container {\n    background: rgba(255, 255, 255, 0.05);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: 12px;\n    padding: 2rem;\n}\n\n.scans-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 2rem;\n}\n\n.scans-header h2 {\n    color: #5a9cf8;\n}\n\n.refresh-btn {\n    background: #5a9cf8;\n    color: white;\n    border: none;\n    padding: 0.75rem 1.5rem;\n    border-radius: 8px;\n    cursor: pointer;\n    font-size: 1rem;\n    transition: background 0.2s;\n}\n\n.refresh-btn:hover {\n    background: #4a8ce8;\n}\n\n.scans-table {\n    width: 100%;\n    border-collapse: collapse;\n}\n\n.scans-table th {\n    text-align: left;\n    padding: 1rem;\n    background: rgba(255, 255, 255, 0.05);\n    color: #5a9cf8;\n    font-weight: 600;\n}\n\n.scans-table td {\n    padding: 1rem;\n    border-bottom: 1px solid rgba(255, 255, 255, 0.1);\n}\n\n.scans-table tr:hover {\n    background: rgba(255, 255, 255, 0.03);\n}\n\n.badge {\n    display: inline-block;\n    padding: 0.3rem 0.8rem;\n    border-radius: 6px;\n    font-size: 0.85rem;\n    font-weight: 600;\n}\n\n.badge.malware { background: #ff4757; color: white; }\n.badge.suspicious { background: #ffa502; color: white; }\n.badge.benign { background: #26de81; color: white; }\n.badge.non-pe { background: #4b5563; color: #fff; }\n\n.hash {\n    font-family: 'Courier New', monospace;\n    font-size: 0.85rem;\n    color: #888;\n}\n\n.empty-state {\n    text-align: center;\n    padding: 3rem;\n    color: #666;\n}\n\n.empty-state i {\n    font-size: 4rem;\n    margin-bottom: 1rem;\n    opacity: 0.3;\n}\n\n/* NEW: Chart Container Styles */\n.chart-container {\n    background: rgba(255, 255, 255, 0.05);\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    border-radius: 12px;\n    padding: 2rem;\n    margin-top: 2rem;\n}\n\n.chart-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 2rem;\n}\n\n.chart-header h2 {\n    color: #5a9cf8;\n    margin: 0;\n}\n\n.chart-controls {\n    display: flex;\n    gap: 0.5rem;\n}\n\n.chart-btn {\n    background: rgba(255, 255, 255, 0.05);\n    color: #888;\n    border: 1px solid rgba(255, 255, 255, 0.1);\n    padding: 0.5rem 1rem;\n    border-radius: 6px;\n    cursor: pointer;\n    font-size: 0.9rem;\n    transition: all 0.2s;\n}\n\n.chart-btn:hover {\n    background: rgba(255, 255, 255, 0.1);\n    color: #e0e0e0;\n}\n\n.chart-btn.active {\n    background: #5a9cf8;\n    color: white;\n    border-color: #5a9cf8;\n}\n\n#dailyScansChart {\n    max-height: 400px;\n}\n\n@media (max-width: 768px) {\n    .chart-header {\n        flex-direction: column;\n        gap: 1rem;\n        align-items: flex-start;\n    }\n    \n    .chart-controls {\n        width: 100%;\n        justify-content: stretch;\n    }\n    \n    .chart-btn {\n        flex: 1;\n    }\n}\n\n/* Map Container */\n.map-container {\n    background: rgba(255, 255, 255, 0.03);\n    border-radius: 12px;\n    padding: 24px;\n    margin-top: 24px;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n}\n\n.map-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 20px;\n    flex-wrap: wrap;\n    gap: 16px;\n}\n\n.map-header h2 {\n    margin: 0;\n    font-size: 1.5rem;\n    color: #e0e0e0;\n}\n\n.map-header h2 i {\n    color: #5a9cf8;\n    margin-right: 8px;\n}\n\n.map-legend {\n    display: flex;\n    gap: 20px;\n    flex-wrap: wrap;\n}\n\n.legend-item {\n    display: flex;\n    align-items: center;\n    gap: 8px;\n    font-size: 0.9rem;\n    color: #b0b0b0;\n}\n\n.legend-dot {\n    width: 12px;\n    height: 12px;\n    border-radius: 50%;\n    display: inline-block;\n}\n\n.malware-dot {\n    background-color: #ff4757;\n}\n\n.suspicious-dot {\n    background-color: #ffa502;\n}\n\n.benign-dot {\n    background-color: #26de81;\n}\n\n#worldMap {\n    background: #1a1a1a;\n    border: 1px solid rgba(255, 255, 255, 0.1);\n}\n\n/* Correlation Graph */\n.correlation-container {\n    background: rgba(255, 255, 255, 0.03);\n    border-radius: 12px;\n    padding: 24px;\n    margin-top: 24px;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n}\n\n.correlation-header {\n    margin-bottom: 20px;\n}\n\n.correlation-header h2 {\n    margin: 0 0 8px 0;\n    font-size: 1.5rem;\n    color: #e0e0e0;\n}\n\n.correlation-header h2 i {\n    color: #5a9cf8;\n    margin-right: 8px;\n}\n\n.correlation-subtitle {\n    color: #888;\n    font-size: 0.9rem;\n    margin: 0;\n}\n\n.graph-controls {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 16px;\n    flex-wrap: wrap;\n    gap: 16px;\n}\n\n.graph-btn {\n    background: rgba(90, 156, 248, 0.2);\n    border: 1px solid rgba(90, 156, 248, 0.4);\n    color: #5a9cf8;\n    padding: 8px 16px;\n    border-radius: 6px;\n    cursor: pointer;\n    font-size: 0.9rem;\n    transition: all 0.3s;\n}\n\n.graph-btn:hover {\n    background: rgba(90, 156, 248, 0.3);\n    border-color: #5a9cf8;\n}\n\n.graph-btn i {\n    margin-right: 6px;\n}\n\n.graph-legend {\n    display: flex;\n    gap: 20px;\n    flex-wrap: wrap;\n}\n\n.node-sample {\n    width: 12px;\n    height: 12px;\n    border-radius: 50%;\n    display: inline-block;\n    border: 2px solid #fff;\n}\n\n.malware-node {\n    background-color: #ff4757;\n}\n\n.agent-node {\n    background-color: #5a9cf8;\n}\n\n.api-node {\n    background-color: #ffa502;\n}\n\n.string-node {\n    background-color: #26de81;\n}\n\n#correlationGraph {\n    width: 100%;\n    min-height: 600px;\n    position: relative;\n    border-radius: 8px;\n    overflow: hidden;\n}\n\n.node-details {\n    position: absolute;\n    right: 24px;\n    top: 120px;\n    background: rgba(30, 30, 30, 0.95);\n    border: 1px solid rgba(90, 156, 248, 0.4);\n    border-radius: 8px;\n    padding: 16px;\n    max-width: 300px;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n    z-index: 1000;\n}\n\n.node-details h3 {\n    margin: 0 0 12px 0;\n    color: #5a9cf8;\n    font-size: 1.1rem;\n    border-bottom: 1px solid rgba(90, 156, 248, 0.3);\n    padding-bottom: 8px;\n}\n\n.node-details p {\n    margin: 8px 0;\n    color: #e0e0e0;\n    font-size: 0.9rem;\n}\n\n.node-details ul {\n    color: #b0b0b0;\n    font-size: 0.85rem;\n}\n\n.node-details li {\n    margin: 4px 0;\n}\n","range":{"startLineNumber":1,"startColumn":1,"endLineNumber":951,"endColumn":1}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware-server/public/dashboard.html","external":"file:///home/trang/localnsv/mAIware-server/public/dashboard.html","path":"/home/trang/localnsv/mAIware-server/public/dashboard.html","scheme":"file"},"requestId":"request_d7ec2804-c986-4ad0-bd16-ba590bdeeb6b","epoch":48,"edits":[{"text":"<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>mAIware Server Dashboard</title>\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css\">\n    <link rel=\"stylesheet\" href=\"styles.css\">\n    <!-- Add Chart.js -->\n    <script src=\"https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js\"></script>\n    <!-- Add Leaflet.js for maps -->\n    <link rel=\"stylesheet\" href=\"https://unpkg.com/leaflet@1.9.4/dist/leaflet.css\" />\n    <script src=\"https://unpkg.com/leaflet@1.9.4/dist/leaflet.js\"></script>\n    <!-- Add D3.js for force-directed graph -->\n    <script src=\"https://d3js.org/d3.v7.min.js\"></script>\n</head>\n<body>\n    <div class=\"container\">\n        <header>\n            <h1><i class=\"fas fa-shield-virus\"></i> mAIware Server</h1>\n            <p class=\"subtitle\">Real-time Malware Analysis Dashboard</p>\n        </header>\n        \n        <div class=\"stats-grid\" id=\"stats-grid\">\n            <div class=\"stat-card info\">\n                <i class=\"fas fa-laptop\"></i>\n                <span class=\"stat-number\" id=\"stat-clients\">0</span>\n                <span class=\"stat-label\">Active Clients</span>\n            </div>\n            <div class=\"stat-card info\">\n                <i class=\"fas fa-chart-line\"></i>\n                <span class=\"stat-number\" id=\"stat-total\">0</span>\n                <span class=\"stat-label\">Total Scans</span>\n            </div>\n            <div class=\"stat-card malware\">\n                <i class=\"fas fa-bug\"></i>\n                <span class=\"stat-number\" id=\"stat-malware\">0</span>\n                <span class=\"stat-label\">Malware</span>\n            </div>\n            <div class=\"stat-card suspicious\">\n                <i class=\"fas fa-exclamation-triangle\"></i>\n                <span class=\"stat-number\" id=\"stat-suspicious\">0</span>\n                <span class=\"stat-label\">Suspicious</span>\n            </div>\n            <div class=\"stat-card benign\">\n                <i class=\"fas fa-check-circle\"></i>\n                <span class=\"stat-number\" id=\"stat-benign\">0</span>\n                <span class=\"stat-label\">Benign</span>\n            </div>\n        </div>\n        \n        <!-- NEW: Emerging Threat Intelligence Panel -->\n        <div class=\"eti-container\">\n            <div class=\"eti-header\">\n                <h2><i class=\"fas fa-exclamation-triangle\"></i> Emerging Threat Intelligence (ETI)</h2>\n                <p class=\"eti-subtitle\">Real-time actionable intelligence on active threats and indicators of compromise</p>\n                <div class=\"eti-summary\">\n                    <span class=\"eti-badge\" id=\"eti-total\">0 Total Threats</span>\n                    <span class=\"eti-badge recent\" id=\"eti-recent\">0 Last 24h</span>\n                </div>\n            </div>\n            \n            <div class=\"eti-grid\">\n                <div class=\"eti-panel\">\n                    <h3><i class=\"fas fa-virus\"></i> Top Malware Families</h3>\n                    <div class=\"eti-subtitle-small\">Most active malware families detected</div>\n                    <div id=\"eti-malware\" class=\"eti-list\"></div>\n                </div>\n                \n                <div class=\"eti-panel\">\n                    <h3><i class=\"fas fa-code\"></i> Top Suspicious APIs</h3>\n                    <div class=\"eti-subtitle-small\">Most frequently called malicious APIs</div>\n                    <div id=\"eti-apis\" class=\"eti-list\"></div>\n                </div>\n                \n                <div class=\"eti-panel\">\n                    <h3><i class=\"fas fa-terminal\"></i> Top Malicious Strings</h3>\n                    <div class=\"eti-subtitle-small\">Most common IOC strings and commands</div>\n                    <div id=\"eti-strings\" class=\"eti-list\"></div>\n                </div>\n                \n                <div class=\"eti-panel\">\n                    <h3><i class=\"fas fa-shield-alt\"></i> Top Packers/Obfuscators</h3>\n                    <div class=\"eti-subtitle-small\">Most used evasion techniques</div>\n                    <div id=\"eti-packers\" class=\"eti-list\"></div>\n                </div>\n            </div>\n        </div>\n        \n        <!-- NEW: Threat Modeler Panel -->\n        <div class=\"modeler-container\">\n            <div class=\"modeler-header\">\n                <h2><i class=\"fas fa-flask\"></i> Predictive Threat Modeler</h2>\n                <p class=\"modeler-subtitle\">Build hypothetical malware and predict how mAIware would classify it</p>\n            </div>\n            \n            <div class=\"modeler-grid\">\n                <div class=\"modeler-builder\">\n                    <h3><i class=\"fas fa-cogs\"></i> Threat Configuration</h3>\n                    \n                    <div class=\"modeler-field\">\n                        <label>File Type</label>\n                        <select id=\"model-filetype\" class=\"modeler-select\">\n                            <option>PE32+ (GUI) x86-64</option>\n                            <option>PE32 (Console) Intel 80386</option>\n                            <option>PE32+ DLL x86-64</option>\n                            <option>MSI Installer</option>\n                            <option>PDF Document</option>\n                        </select>\n                    </div>\n                    \n                    <div class=\"modeler-field\">\n                        <label>Packer/Obfuscator</label>\n                        <select id=\"model-packer\" class=\"modeler-select\">\n                            <option>None</option>\n                            <option>UPX</option>\n                            <option>VMProtect</option>\n                            <option>Themida</option>\n                            <option>ASPack</option>\n                            <option>Unknown (High Entropy)</option>\n                        </select>\n                    </div>\n                    \n                    <div class=\"modeler-field\">\n                        <label>Digital Signature</label>\n                        <select id=\"model-signature\" class=\"modeler-select\">\n                            <option>Verified (Microsoft Corporation)</option>\n                            <option>Verified (Google LLC)</option>\n                            <option>Verified (Unknown Publisher)</option>\n                            <option>Not Signed</option>\n                            <option>Expired Certificate</option>\n                            <option>Self-Signed (Untrusted)</option>\n                        </select>\n                    </div>\n                    \n                    <div class=\"modeler-field\">\n                        <label>API Imports (select multiple)</label>\n                        <select id=\"model-apis\" class=\"modeler-select\" multiple size=\"6\">\n                            <option>CreateRemoteThread</option>\n                            <option>WriteProcessMemory</option>\n                            <option>VirtualAllocEx</option>\n                            <option>SetWindowsHookExW</option>\n                            <option>URLDownloadToFileW</option>\n                            <option>WinExec</option>\n                            <option>RegSetValueExW</option>\n                            <option>CryptEncrypt</option>\n                            <option>Socket</option>\n                            <option>ReadFile</option>\n                        </select>\n                        <small class=\"modeler-hint\">Hold Ctrl/Cmd to select multiple</small>\n                    </div>\n                    \n                    <div class=\"modeler-field\">\n                        <label>Suspicious Strings (select multiple)</label>\n                        <select id=\"model-strings\" class=\"modeler-select\" multiple size=\"6\">\n                            <option>http://bad-c2-server.com/payload.dat</option>\n                            <option>keylog.txt</option>\n                            <option>steal_passwords</option>\n                            <option>powershell -enc</option>\n                            <option>vssadmin.exe delete shadows</option>\n                            <option>HOW_TO_DECRYPT.txt</option>\n                            <option>crack</option>\n                            <option>patch</option>\n                            <option>disable_antivirus</option>\n                        </select>\n                        <small class=\"modeler-hint\">Hold Ctrl/Cmd to select multiple</small>\n                    </div>\n                    \n                    <button class=\"modeler-analyze-btn\" onclick=\"analyzeThreatModel()\">\n                        <i class=\"fas fa-brain\"></i> ANALYZE THREAT\n                    </button>\n                </div>\n                \n                <div class=\"modeler-results\">\n                    <h3><i class=\"fas fa-chart-line\"></i> Prediction Results</h3>\n                    <div id=\"modeler-output\" class=\"modeler-output\">\n                        <div class=\"modeler-placeholder\">\n                            <i class=\"fas fa-arrow-left\"></i>\n                            <p>Configure a threat profile and click ANALYZE to see predictions</p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        \n        <div class=\"scans-container\">\n            <div class=\"scans-header\">\n                <h2>Recent Scans</h2>\n                <button class=\"refresh-btn\" onclick=\"manualRefresh()\">\n                    <i class=\"fas fa-sync-alt\"></i> Refresh\n                </button>\n            </div>\n            \n            <table class=\"scans-table\">\n                <thead>\n                    <tr>\n                        <th>Timestamp</th>\n                        <th>Filename</th>\n                        <th>Classification</th>\n                        <th>Client IP</th>\n                        <th>Hash (SHA256)</th>\n                    </tr>\n                </thead>\n                <tbody id=\"scans-tbody\">\n                    <tr>\n                        <td colspan=\"5\" class=\"empty-state\">\n                            <i class=\"fas fa-inbox\"></i>\n                            <p>No scans yet. Waiting for clients...</p>\n                        </td>\n                    </tr>\n                </tbody>\n            </table>\n        </div>\n        \n        <!-- NEW: Daily Analysis Chart -->\n        <div class=\"chart-container\">\n            <div class=\"chart-header\">\n                <h2>Daily Analysis Trends (Last 30 Days)</h2>\n                <div class=\"chart-controls\">\n                    <button class=\"chart-btn active\" onclick=\"setChartDays(7)\">7 Days</button>\n                    <button class=\"chart-btn\" onclick=\"setChartDays(14)\">14 Days</button>\n                    <button class=\"chart-btn\" onclick=\"setChartDays(30)\">30 Days</button>\n                </div>\n            </div>\n            <canvas id=\"dailyScansChart\"></canvas>\n        </div>\n        \n        <!-- NEW: Geographic Distribution Map -->\n        <div class=\"map-container\">\n            <div class=\"map-header\">\n                <h2><i class=\"fas fa-globe\"></i> Geographic Distribution of Detections</h2>\n                <div class=\"map-legend\">\n                    <span class=\"legend-item\"><span class=\"legend-dot malware-dot\"></span> Malware</span>\n                    <span class=\"legend-item\"><span class=\"legend-dot suspicious-dot\"></span> Suspicious</span>\n                    <span class=\"legend-item\"><span class=\"legend-dot benign-dot\"></span> Benign</span>\n                </div>\n            </div>\n            <div id=\"worldMap\" style=\"height: 500px; border-radius: 8px;\"></div>\n        </div>\n        \n        <!-- NEW: Malware Source Distribution Pie Chart -->\n        <div class=\"chart-container\" style=\"margin-top: 24px;\">\n            <div class=\"chart-header\">\n                <h2><i class=\"fas fa-chart-pie\"></i> Malware Source Distribution</h2>\n            </div>\n            <div style=\"max-width: 500px; margin: 0 auto;\">\n                <canvas id=\"malwareSourceChart\"></canvas>\n            </div>\n        </div>\n        \n        <!-- NEW: Threat Vector Correlation Explorer -->\n        <div class=\"correlation-container\">\n            <div class=\"correlation-header\">\n                <h2><i class=\"fas fa-project-diagram\"></i> Threat Vector Correlation Explorer</h2>\n                <p class=\"correlation-subtitle\">Interactive intelligence map showing relationships between malware families, agents, APIs, and indicators</p>\n            </div>\n            <div class=\"graph-controls\">\n                <button class=\"graph-btn\" onclick=\"resetGraph()\"><i class=\"fas fa-sync\"></i> Reset View</button>\n                <button class=\"graph-btn\" onclick=\"centerGraph()\"><i class=\"fas fa-compress\"></i> Center</button>\n                <div class=\"graph-legend\">\n                    <span class=\"legend-item\"><span class=\"node-sample malware-node\"></span> Malware Family</span>\n                    <span class=\"legend-item\"><span class=\"node-sample agent-node\"></span> Agent/System</span>\n                    <span class=\"legend-item\"><span class=\"node-sample api-node\"></span> API Call</span>\n                    <span class=\"legend-item\"><span class=\"node-sample string-node\"></span> Suspicious String</span>\n                </div>\n            </div>\n            <div id=\"correlationGraph\"></div>\n            <div id=\"nodeDetails\" class=\"node-details\" style=\"display: none;\">\n                <h3 id=\"detailsTitle\"></h3>\n                <div id=\"detailsContent\"></div>\n            </div>\n        </div>\n    </div>\n    \n    <script>\n        let dailyChart = null;\n        let currentChartDays = 30;\n        \n        async function loadStats() {\n            try {\n                const response = await fetch('/api/stats');\n                const stats = await response.json();\n                \n                document.getElementById('stat-clients').textContent = stats.activeClients;\n                document.getElementById('stat-total').textContent = stats.totalScans;\n                document.getElementById('stat-malware').textContent = stats.malwareCount;\n                document.getElementById('stat-suspicious').textContent = stats.suspiciousCount;\n                document.getElementById('stat-benign').textContent = stats.benignCount;\n            } catch (error) {\n                console.error('Failed to load stats:', error);\n            }\n        }\n        \n        async function loadScans() {\n            try {\n                const response = await fetch('/api/scans?limit=50');\n                const data = await response.json();\n                \n                const tbody = document.getElementById('scans-tbody');\n                \n                if (data.scans.length === 0) {\n                    tbody.innerHTML = `\n                        <tr>\n                            <td colspan=\"5\" class=\"empty-state\">\n                                <i class=\"fas fa-inbox\"></i>\n                                <p>No scans yet. Waiting for clients...</p>\n                            </td>\n                        </tr>\n                    `;\n                    return;\n                }\n                \n                tbody.innerHTML = data.scans.map(scan => {\n                    const timestamp = new Date(scan.serverTimestamp).toLocaleString();\n                    const hash = scan.file_hashes?.sha256 || 'N/A';\n                    const hashShort = hash.length > 16 ? (hash.substring(0, 16) + '...') : hash;\n                    const isNonPe = scan.is_pe === false;\n                    const classification = isNonPe ? 'Non-PE' : (scan.classification || 'Unknown');\n                    const badgeClass = isNonPe ? 'non-pe' : classification.toLowerCase();\n                    const nonPeTag = isNonPe ? '<span class=\"badge non-pe\" title=\"Non-PE file\">Non-PE</span>' : '';\n                    return `\n                        <tr>\n                            <td>${timestamp}</td>\n                            <td>${scan.detected_filename} ${nonPeTag}</td>\n                            <td><span class=\"badge ${badgeClass}\">${classification}</span></td>\n                            <td>${scan.systemInfo?.ip || scan.clientIp || 'Unknown'}</td>\n                            <td class=\"hash\" title=\"${hash}\">${hashShort}</td>\n                        </tr>\n                    `;\n                }).join('');\n                \n            } catch (error) {\n                console.error('Failed to load scans:', error);\n            }\n        }\n        \n        async function loadDailyChart() {\n            try {\n                const response = await fetch(`/api/daily-scans?days=${currentChartDays}`);\n                const data = await response.json();\n                \n                const ctx = document.getElementById('dailyScansChart');\n                \n                // Destroy existing chart if it exists\n                if (dailyChart) {\n                    dailyChart.destroy();\n                }\n                \n                // Format dates for display (MM/DD)\n                const labels = data.days.map(day => {\n                    const date = new Date(day.date);\n                    return `${date.getMonth() + 1}/${date.getDate()}`;\n                });\n                \n                dailyChart = new Chart(ctx, {\n                    type: 'line',\n                    data: {\n                        labels: labels,\n                        datasets: [\n                            {\n                                label: 'Total Scans',\n                                data: data.days.map(d => d.total),\n                                borderColor: '#5a9cf8',\n                                backgroundColor: 'rgba(90, 156, 248, 0.1)',\n                                fill: true,\n                                tension: 0.4,\n                                borderWidth: 2\n                            },\n                            {\n                                label: 'Malware',\n                                data: data.days.map(d => d.malware),\n                                borderColor: '#ff4757',\n                                backgroundColor: 'rgba(255, 71, 87, 0.1)',\n                                fill: true,\n                                tension: 0.4,\n                                borderWidth: 2\n                            },\n                            {\n                                label: 'Suspicious',\n                                data: data.days.map(d => d.suspicious),\n                                borderColor: '#ffa502',\n                                backgroundColor: 'rgba(255, 165, 2, 0.1)',\n                                fill: true,\n                                tension: 0.4,\n                                borderWidth: 2\n                            },\n                            {\n                                label: 'Benign',\n                                data: data.days.map(d => d.benign),\n                                borderColor: '#26de81',\n                                backgroundColor: 'rgba(38, 222, 129, 0.1)',\n                                fill: true,\n                                tension: 0.4,\n                                borderWidth: 2\n                            }\n                        ]\n                    },\n                    options: {\n                        responsive: true,\n                        maintainAspectRatio: false,\n                        interaction: {\n                            mode: 'index',\n                            intersect: false,\n                        },\n                        plugins: {\n                            legend: {\n                                labels: {\n                                    color: '#e0e0e0',\n                                    font: { size: 12 }\n                                }\n                            },\n                            tooltip: {\n                                backgroundColor: 'rgba(0, 0, 0, 0.8)',\n                                titleColor: '#fff',\n                                bodyColor: '#e0e0e0',\n                                borderColor: 'rgba(255, 255, 255, 0.1)',\n                                borderWidth: 1\n                            }\n                        },\n                        scales: {\n                            x: {\n                                ticks: { \n                                    color: '#888',\n                                    maxRotation: 45,\n                                    minRotation: 45\n                                },\n                                grid: { \n                                    color: 'rgba(255, 255, 255, 0.05)' \n                                }\n                            },\n                            y: {\n                                beginAtZero: true,\n                                ticks: { \n                                    color: '#888',\n                                    stepSize: 1\n                                },\n                                grid: { \n                                    color: 'rgba(255, 255, 255, 0.05)' \n                                }\n                            }\n                        }\n                    }\n                });\n                \n            } catch (error) {\n                console.error('Failed to load daily chart:', error);\n            }\n        }\n        \n        let worldMap = null;\n        let markerLayer = null;\n        let mapInitialized = false;\n        let lastGeoDataHash = '';\n        let sourceChart = null;\n        \n        function initializeMap() {\n            if (mapInitialized) return;\n            \n            try {\n                worldMap = L.map('worldMap', {\n                    zoomControl: true,\n                    scrollWheelZoom: true\n                }).setView([20, 0], 2);\n                \n                // Use dark theme tiles\n                L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {\n                    attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors &copy; <a href=\"https://carto.com/attributions\">CARTO</a>',\n                    subdomains: 'abcd',\n                    maxZoom: 19\n                }).addTo(worldMap);\n                \n                markerLayer = L.layerGroup().addTo(worldMap);\n                mapInitialized = true;\n            } catch (error) {\n                console.error('Failed to initialize map:', error);\n            }\n        }\n        \n        async function loadGeoMap() {\n            try {\n                // Initialize map only once\n                if (!mapInitialized) {\n                    initializeMap();\n                }\n                \n                if (!markerLayer) return;\n                \n                const response = await fetch('/api/geo-data');\n                const data = await response.json();\n                \n                // Generate hash of current data to detect changes\n                const currentHash = JSON.stringify(data.locations.map(l => \n                    `${l.ip}-${l.totalScans}-${l.malwareCount}-${l.suspiciousCount}`\n                )).substring(0, 100);\n                \n                // Skip update if data hasn't changed\n                if (currentHash === lastGeoDataHash && markerLayer.getLayers().length > 0) {\n                    return;\n                }\n                lastGeoDataHash = currentHash;\n                \n                // Clear existing markers\n                markerLayer.clearLayers();\n                \n                // Add markers for each location\n                data.locations.forEach(location => {\n                    const { lat, lng, city, country } = location.location;\n                    \n                    // Determine marker color based on severity\n                    let markerColor = '#26de81'; // benign (green)\n                    let primaryClassification = 'Benign';\n                    \n                    if (location.malwareCount > 0) {\n                        markerColor = '#ff4757'; // malware (red)\n                        primaryClassification = 'Malware';\n                    } else if (location.suspiciousCount > 0) {\n                        markerColor = '#ffa502'; // suspicious (orange)\n                        primaryClassification = 'Suspicious';\n                    }\n                    \n                    // Calculate marker size based on total scans (min 8, max 24)\n                    const markerSize = Math.min(24, Math.max(8, 8 + location.totalScans * 2));\n                    \n                    // Create custom circular marker\n                    const marker = L.circleMarker([lat, lng], {\n                        radius: markerSize / 2,\n                        fillColor: markerColor,\n                        color: '#fff',\n                        weight: 2,\n                        opacity: 0.8,\n                        fillOpacity: 0.6\n                    });\n                    \n                    // Create popup content\n                    const popupContent = `\n                        <div style=\"color: #333; min-width: 200px;\">\n                            <h3 style=\"margin: 0 0 10px 0; color: #1a1a1a; font-size: 1.1rem;\">\n                                <i class=\"fas fa-map-marker-alt\" style=\"color: ${markerColor};\"></i>\n                                ${city}, ${country}\n                            </h3>\n                            <p style=\"margin: 5px 0; color: #555;\"><strong>IP:</strong> ${location.ip}</p>\n                            <p style=\"margin: 5px 0; color: #555;\"><strong>Total Scans:</strong> ${location.totalScans}</p>\n                            <div style=\"margin-top: 10px;\">\n                                <div style=\"margin: 3px 0;\">\n                                    <span style=\"color: #ff4757;\"></span> Malware: ${location.malwareCount}\n                                </div>\n                                <div style=\"margin: 3px 0;\">\n                                    <span style=\"color: #ffa502;\"></span> Suspicious: ${location.suspiciousCount}\n                                </div>\n                                <div style=\"margin: 3px 0;\">\n                                    <span style=\"color: #26de81;\"></span> Benign: ${location.benignCount}\n                                </div>\n                            </div>\n                            ${location.scans.length > 0 ? `\n                                <div style=\"margin-top: 10px; padding-top: 10px; border-top: 1px solid #ddd;\">\n                                    <strong>Recent Detections:</strong>\n                                    <ul style=\"margin: 5px 0; padding-left: 20px; font-size: 0.85rem;\">\n                                        ${location.scans.slice(0, 3).map(scan => `\n                                            <li style=\"margin: 2px 0;\">\n                                                ${scan.filename} \n                                                <span style=\"color: ${\n                                                    scan.classification === 'Malware' ? '#ff4757' : \n                                                    scan.classification === 'Suspicious' ? '#ffa502' : '#26de81'\n                                                };\">(${scan.classification})</span>\n                                            </li>\n                                        `).join('')}\n                                        ${location.scans.length > 3 ? `<li>...and ${location.scans.length - 3} more</li>` : ''}\n                                    </ul>\n                                </div>\n                            ` : ''}\n                        </div>\n                    `;\n                    \n                    marker.bindPopup(popupContent);\n                    marker.addTo(markerLayer);\n                    \n                    // Add hover effect\n                    marker.on('mouseover', function() {\n                        this.setStyle({\n                            fillOpacity: 0.9,\n                            opacity: 1\n                        });\n                    });\n                    \n                    marker.on('mouseout', function() {\n                        this.setStyle({\n                            fillOpacity: 0.6,\n                            opacity: 0.8\n                        });\n                    });\n                });\n                \n                console.log(`Map updated with ${data.locations.length} locations`);\n                \n            } catch (error) {\n                console.error('Failed to load geo map:', error);\n            }\n        }\n        \n        async function loadMalwareSources() {\n            try {\n                const response = await fetch('/api/malware-sources');\n                const data = await response.json();\n                \n                const ctx = document.getElementById('malwareSourceChart');\n                \n                // Destroy existing chart if it exists\n                if (sourceChart) {\n                    sourceChart.destroy();\n                }\n                \n                const labels = data.sources.map(s => s.source);\n                const counts = data.sources.map(s => s.count);\n                \n                // Color scheme for different sources\n                const colors = [\n                    '#ff6b6b', // Email Attachment - red\n                    '#4ecdc4', // Web Download - teal\n                    '#ffe66d', // USB/External Drive - yellow\n                    '#a8dadc', // Internal Network - light blue\n                    '#95a5a6'  // Unknown - gray\n                ];\n                \n                sourceChart = new Chart(ctx, {\n                    type: 'pie',\n                    data: {\n                        labels: labels,\n                        datasets: [{\n                            data: counts,\n                            backgroundColor: colors,\n                            borderColor: '#1a1a2e',\n                            borderWidth: 2\n                        }]\n                    },\n                    options: {\n                        responsive: true,\n                        maintainAspectRatio: true,\n                        plugins: {\n                            legend: {\n                                position: 'bottom',\n                                labels: {\n                                    color: '#e0e0e0',\n                                    font: { size: 12 },\n                                    padding: 15\n                                }\n                            },\n                            tooltip: {\n                                backgroundColor: 'rgba(0, 0, 0, 0.8)',\n                                titleColor: '#fff',\n                                bodyColor: '#e0e0e0',\n                                borderColor: 'rgba(255, 255, 255, 0.1)',\n                                borderWidth: 1,\n                                callbacks: {\n                                    label: function(context) {\n                                        const label = context.label || '';\n                                        const value = context.parsed || 0;\n                                        const total = context.dataset.data.reduce((a, b) => a + b, 0);\n                                        const percentage = total > 0 ? ((value / total) * 100).toFixed(1) : 0;\n                                        return `${label}: ${value} (${percentage}%)`;\n                                    }\n                                }\n                            }\n                        }\n                    }\n                });\n                \n            } catch (error) {\n                console.error('Failed to load malware sources:', error);\n            }\n        }\n        \n        async function loadEmergingThreats() {\n            try {\n                const response = await fetch('/api/emerging-threats');\n                const data = await response.json();\n                \n                // Update summary badges\n                document.getElementById('eti-total').textContent = \n                    `${data.summary.totalThreats} Total Threats`;\n                document.getElementById('eti-recent').textContent = \n                    `${data.summary.recentThreats} Last 24h`;\n                \n                // Helper to render IOC list\n                const renderIOCList = (items, container) => {\n                    if (items.length === 0) {\n                        container.innerHTML = '<div class=\"eti-empty\">No threats detected</div>';\n                        return;\n                    }\n                    \n                    container.innerHTML = items.map((item, index) => {\n                        const rank = index + 1;\n                        const recentBadge = item.recent > 0 ? \n                            `<span class=\"eti-recent-badge\">${item.recent} recent</span>` : '';\n                        const agentBadge = item.agents > 0 ? \n                            `<span class=\"eti-agent-badge\">${item.agents} agents</span>` : '';\n                        \n                        return `\n                            <div class=\"eti-item\" data-rank=\"${rank}\">\n                                <div class=\"eti-rank\">${rank}</div>\n                                <div class=\"eti-content\">\n                                    <div class=\"eti-name\">${item.name}</div>\n                                    <div class=\"eti-meta\">\n                                        <span class=\"eti-count\">${item.count} occurrences</span>\n                                        ${recentBadge}\n                                        ${agentBadge}\n                                    </div>\n                                    ${item.details && item.details.length > 0 ? `\n                                        <div class=\"eti-details\">\n                                            ${item.details.slice(0, 2).join(', ')}\n                                            ${item.details.length > 2 ? '...' : ''}\n                                        </div>\n                                    ` : ''}\n                                </div>\n                            </div>\n                        `;\n                    }).join('');\n                };\n                \n                // Render each section\n                renderIOCList(data.topMalwareFamilies, document.getElementById('eti-malware'));\n                renderIOCList(data.topSuspiciousAPIs, document.getElementById('eti-apis'));\n                renderIOCList(data.topMaliciousStrings, document.getElementById('eti-strings'));\n                renderIOCList(data.topPackers, document.getElementById('eti-packers'));\n                \n            } catch (error) {\n                console.error('Failed to load emerging threats:', error);\n            }\n        }\n        \n        async function analyzeThreatModel() {\n            try {\n                // Get selected values\n                const fileType = document.getElementById('model-filetype').value;\n                const packer = document.getElementById('model-packer').value;\n                const signature = document.getElementById('model-signature').value;\n                \n                // Get multiple selections\n                const apisSelect = document.getElementById('model-apis');\n                const apiImports = Array.from(apisSelect.selectedOptions).map(opt => opt.value);\n                \n                const stringsSelect = document.getElementById('model-strings');\n                const keyStrings = Array.from(stringsSelect.selectedOptions).map(opt => opt.value);\n                \n                // Validate\n                if (apiImports.length === 0) {\n                    alert('Please select at least one API import');\n                    return;\n                }\n                if (keyStrings.length === 0) {\n                    alert('Please select at least one suspicious string');\n                    return;\n                }\n                \n                // Show loading state\n                const outputDiv = document.getElementById('modeler-output');\n                outputDiv.innerHTML = `\n                    <div class=\"modeler-loading\">\n                        <i class=\"fas fa-spinner fa-spin\"></i>\n                        <p>Analyzing threat profile...</p>\n                    </div>\n                `;\n                \n                // Send to server\n                const response = await fetch('/api/threat-model', {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({\n                        fileType,\n                        packer,\n                        signature,\n                        apiImports,\n                        keyStrings\n                    })\n                });\n                \n                const data = await response.json();\n                \n                if (data.success) {\n                    const result = data.result;\n                    const classColor = \n                        result.classification === 'Malware' ? '#ff4757' :\n                        result.classification === 'Suspicious' ? '#ffa502' : '#26de81';\n                    \n                    outputDiv.innerHTML = `\n                        <div class=\"prediction-result\">\n                            <div class=\"prediction-header\">\n                                <div class=\"prediction-badge\" style=\"background: ${classColor};\">\n                                    ${result.classification.toUpperCase()}\n                                </div>\n                                <div class=\"prediction-confidence\">\n                                    <div class=\"confidence-label\">Confidence Score</div>\n                                    <div class=\"confidence-value\">${(parseFloat(result.confidence_score) * 100).toFixed(1)}%</div>\n                                </div>\n                            </div>\n                            \n                            ${result.malware_family ? `\n                                <div class=\"prediction-family\">\n                                    <strong>Predicted Malware Family:</strong>\n                                    <span class=\"family-name\">${result.malware_family}</span>\n                                </div>\n                            ` : ''}\n                            \n                            <div class=\"prediction-section\">\n                                <h4>Threat Analysis</h4>\n                                <div class=\"analysis-item\">\n                                    <i class=\"fas fa-file\"></i>\n                                    <span><strong>File Type:</strong> ${result.key_findings.file_type}</span>\n                                </div>\n                                <div class=\"analysis-item\">\n                                    <i class=\"fas fa-box\"></i>\n                                    <span><strong>Packer:</strong> ${result.key_findings.packer_detected}</span>\n                                </div>\n                                <div class=\"analysis-item\">\n                                    <i class=\"fas fa-certificate\"></i>\n                                    <span><strong>Signature:</strong> ${result.key_findings.signature.name}</span>\n                                </div>\n                                <div class=\"analysis-item\">\n                                    <i class=\"fas fa-tachometer-alt\"></i>\n                                    <span><strong>Threat Score:</strong> ${result.key_findings.threat_score}/100</span>\n                                </div>\n                            </div>\n                            \n                            <div class=\"prediction-section\">\n                                <h4>Detected Indicators</h4>\n                                <div class=\"indicator-group\">\n                                    <strong>API Imports:</strong>\n                                    <div class=\"indicator-list\">\n                                        ${result.key_findings.api_imports.map(api => \n                                            `<span class=\"indicator-tag api-tag\">${api}</span>`\n                                        ).join('')}\n                                    </div>\n                                </div>\n                                <div class=\"indicator-group\">\n                                    <strong>Suspicious Strings:</strong>\n                                    <div class=\"indicator-list\">\n                                        ${result.key_findings.key_strings.map(str => \n                                            `<span class=\"indicator-tag string-tag\">${str}</span>`\n                                        ).join('')}\n                                    </div>\n                                </div>\n                            </div>\n                            \n                            <div class=\"prediction-footer\">\n                                <i class=\"fas fa-info-circle\"></i>\n                                This analysis has been added to the scan results and will appear in all visualizations.\n                            </div>\n                        </div>\n                    `;\n                } else {\n                    outputDiv.innerHTML = `\n                        <div class=\"modeler-error\">\n                            <i class=\"fas fa-exclamation-circle\"></i>\n                            <p>Analysis failed: ${data.error}</p>\n                        </div>\n                    `;\n                }\n                \n            } catch (error) {\n                console.error('Failed to analyze threat model:', error);\n                document.getElementById('modeler-output').innerHTML = `\n                    <div class=\"modeler-error\">\n                        <i class=\"fas fa-exclamation-circle\"></i>\n                        <p>Analysis failed. Please try again.</p>\n                    </div>\n                `;\n            }\n        }\n        \n        let graphSimulation = null;\n        let graphSvg = null;\n        \n        async function loadCorrelationGraph() {\n            try {\n                const response = await fetch('/api/threat-correlations');\n                const data = await response.json();\n                \n                // Clear existing graph\n                d3.select('#correlationGraph').selectAll('*').remove();\n                \n                const container = document.getElementById('correlationGraph');\n                const width = container.clientWidth;\n                const height = 600;\n                \n                // Create SVG\n                graphSvg = d3.select('#correlationGraph')\n                    .append('svg')\n                    .attr('width', width)\n                    .attr('height', height)\n                    .style('background', '#0a0a0a')\n                    .style('border-radius', '8px');\n                \n                const g = graphSvg.append('g');\n                \n                // Add zoom behavior\n                const zoom = d3.zoom()\n                    .scaleExtent([0.1, 4])\n                    .on('zoom', (event) => {\n                        g.attr('transform', event.transform);\n                    });\n                \n                graphSvg.call(zoom);\n                \n                // Color schemes for different node types\n                const colorMap = {\n                    malware: '#ff4757',\n                    agent: '#5a9cf8',\n                    api: '#ffa502',\n                    string: '#26de81'\n                };\n                \n                // Create force simulation\n                graphSimulation = d3.forceSimulation(data.nodes)\n                    .force('link', d3.forceLink(data.links)\n                        .id(d => d.id)\n                        .distance(d => d.type === 'correlated_with' ? 200 : 100)\n                        .strength(d => d.strength * 0.3))\n                    .force('charge', d3.forceManyBody().strength(-300))\n                    .force('center', d3.forceCenter(width / 2, height / 2))\n                    .force('collision', d3.forceCollide().radius(30));\n                \n                // Draw links\n                const link = g.append('g')\n                    .selectAll('line')\n                    .data(data.links)\n                    .enter()\n                    .append('line')\n                    .attr('stroke', d => {\n                        if (d.type === 'correlated_with') return '#ff6b6b';\n                        if (d.type === 'detected_by') return '#5a9cf8';\n                        if (d.type === 'uses_api') return '#ffa502';\n                        return '#26de81';\n                    })\n                    .attr('stroke-width', d => Math.sqrt(d.strength) + 1)\n                    .attr('stroke-opacity', 0.6);\n                \n                // Draw nodes\n                const node = g.append('g')\n                    .selectAll('circle')\n                    .data(data.nodes)\n                    .enter()\n                    .append('circle')\n                    .attr('r', d => {\n                        if (d.type === 'malware') return 15 + Math.min(d.count * 2, 15);\n                        if (d.type === 'agent') return 12 + Math.min(d.count, 10);\n                        return 8 + Math.min(d.count, 8);\n                    })\n                    .attr('fill', d => colorMap[d.type])\n                    .attr('stroke', '#fff')\n                    .attr('stroke-width', 2)\n                    .style('cursor', 'pointer')\n                    .call(d3.drag()\n                        .on('start', dragstarted)\n                        .on('drag', dragged)\n                        .on('end', dragended))\n                    .on('click', (event, d) => showNodeDetails(d, data))\n                    .on('mouseover', function(event, d) {\n                        d3.select(this)\n                            .transition()\n                            .duration(200)\n                            .attr('stroke-width', 4)\n                            .attr('r', function() {\n                                const currentR = parseFloat(d3.select(this).attr('r'));\n                                return currentR * 1.3;\n                            });\n                    })\n                    .on('mouseout', function(event, d) {\n                        d3.select(this)\n                            .transition()\n                            .duration(200)\n                            .attr('stroke-width', 2)\n                            .attr('r', function() {\n                                if (d.type === 'malware') return 15 + Math.min(d.count * 2, 15);\n                                if (d.type === 'agent') return 12 + Math.min(d.count, 10);\n                                return 8 + Math.min(d.count, 8);\n                            });\n                    });\n                \n                // Add labels\n                const label = g.append('g')\n                    .selectAll('text')\n                    .data(data.nodes)\n                    .enter()\n                    .append('text')\n                    .text(d => d.label.length > 20 ? d.label.substring(0, 20) + '...' : d.label)\n                    .attr('font-size', d => d.type === 'malware' ? '12px' : '10px')\n                    .attr('fill', '#e0e0e0')\n                    .attr('text-anchor', 'middle')\n                    .attr('dy', d => {\n                        if (d.type === 'malware') return 35;\n                        if (d.type === 'agent') return 25;\n                        return 20;\n                    })\n                    .style('pointer-events', 'none')\n                    .style('font-weight', d => d.type === 'malware' ? 'bold' : 'normal');\n                \n                // Update positions on simulation tick\n                graphSimulation.on('tick', () => {\n                    link\n                        .attr('x1', d => d.source.x)\n                        .attr('y1', d => d.source.y)\n                        .attr('x2', d => d.target.x)\n                        .attr('y2', d => d.target.y);\n                    \n                    node\n                        .attr('cx', d => d.x)\n                        .attr('cy', d => d.y);\n                    \n                    label\n                        .attr('x', d => d.x)\n                        .attr('y', d => d.y);\n                });\n                \n                // Drag functions\n                function dragstarted(event, d) {\n                    if (!event.active) graphSimulation.alphaTarget(0.3).restart();\n                    d.fx = d.x;\n                    d.fy = d.y;\n                }\n                \n                function dragged(event, d) {\n                    d.fx = event.x;\n                    d.fy = event.y;\n                }\n                \n                function dragended(event, d) {\n                    if (!event.active) graphSimulation.alphaTarget(0);\n                    d.fx = null;\n                    d.fy = null;\n                }\n                \n                console.log(`Correlation graph loaded: ${data.nodes.length} nodes, ${data.links.length} links`);\n                \n            } catch (error) {\n                console.error('Failed to load correlation graph:', error);\n            }\n        }\n        \n        function showNodeDetails(node, graphData) {\n            const detailsPanel = document.getElementById('nodeDetails');\n            const detailsTitle = document.getElementById('detailsTitle');\n            const detailsContent = document.getElementById('detailsContent');\n            \n            detailsTitle.textContent = node.label;\n            \n            let html = `<p><strong>Type:</strong> ${node.type.toUpperCase()}</p>`;\n            html += `<p><strong>Occurrences:</strong> ${node.count}</p>`;\n            \n            // Find connections\n            const connections = graphData.links.filter(l => \n                l.source.id === node.id || l.target.id === node.id\n            );\n            \n            if (connections.length > 0) {\n                html += `<p><strong>Connections:</strong> ${connections.length}</p>`;\n                html += '<ul style=\"margin: 10px 0; padding-left: 20px;\">';\n                connections.slice(0, 10).forEach(link => {\n                    const otherNode = link.source.id === node.id ? link.target : link.source;\n                    html += `<li>${link.type.replace(/_/g, ' ')}: ${otherNode.label}</li>`;\n                });\n                if (connections.length > 10) {\n                    html += `<li>...and ${connections.length - 10} more</li>`;\n                }\n                html += '</ul>';\n            }\n            \n            if (node.details && node.details.length > 0) {\n                html += '<p><strong>Associated Files:</strong></p>';\n                html += '<ul style=\"margin: 10px 0; padding-left: 20px; max-height: 150px; overflow-y: auto;\">';\n                node.details.slice(0, 10).forEach(file => {\n                    html += `<li>${file}</li>`;\n                });\n                if (node.details.length > 10) {\n                    html += `<li>...and ${node.details.length - 10} more</li>`;\n                }\n                html += '</ul>';\n            }\n            \n            detailsContent.innerHTML = html;\n            detailsPanel.style.display = 'block';\n        }\n        \n        function resetGraph() {\n            if (graphSimulation) {\n                graphSimulation.alpha(1).restart();\n            }\n        }\n        \n        function centerGraph() {\n            if (graphSvg) {\n                graphSvg.transition().duration(750).call(\n                    d3.zoom().transform,\n                    d3.zoomIdentity\n                );\n            }\n        }\n        \n        function setChartDays(days) {\n            currentChartDays = days;\n            \n            // Update button states\n            document.querySelectorAll('.chart-btn').forEach(btn => {\n                btn.classList.remove('active');\n            });\n            event.target.classList.add('active');\n            \n            loadDailyChart();\n        }\n        \n        function loadData() {\n            loadStats();\n            loadScans();\n            loadDailyChart();\n            loadMalwareSources();\n            loadEmergingThreats();\n            loadCorrelationGraph();\n            loadGeoMap();\n        }\n        \n        function loadDataWithoutMap() {\n            loadStats();\n            loadScans();\n            loadDailyChart();\n            loadMalwareSources();\n            loadEmergingThreats();\n            loadCorrelationGraph();\n        }\n        \n        // Initial load\n        loadData();\n        \n        // Set up Server-Sent Events for real-time updates\n        const eventSource = new EventSource('/api/events');\n        \n        eventSource.onmessage = function(event) {\n            const data = JSON.parse(event.data);\n            \n            if (data.type === 'connected') {\n                console.log('Connected to server for real-time updates');\n            } else if (data.type === 'new-scan') {\n                console.log('New scan received:', data.scan.detected_filename);\n                // Reload all data when new scan arrives\n                loadDataWithoutMap();\n                // Update map less frequently (only if it's been more than 10 seconds)\n                if (!window.lastMapUpdate || Date.now() - window.lastMapUpdate > 10000) {\n                    loadGeoMap();\n                    window.lastMapUpdate = Date.now();\n                }\n            }\n        };\n        \n        eventSource.onerror = function(error) {\n            console.error('SSE Error:', error);\n            // Fallback: reload data every 30 seconds if SSE connection fails\n            if (eventSource.readyState === EventSource.CLOSED) {\n                console.log('SSE connection closed, falling back to polling...');\n                setInterval(loadDataWithoutMap, 30000);\n            }\n        };\n        \n        // Manual refresh button functionality\n        window.manualRefresh = function() {\n            loadData();\n        };\n    </script>\n</body>\n</html>","range":{"startLineNumber":1,"startColumn":1,"endLineNumber":1167,"endColumn":1}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware-server/public/styles.css","external":"file:///home/trang/localnsv/mAIware-server/public/styles.css","path":"/home/trang/localnsv/mAIware-server/public/styles.css","scheme":"file"},"requestId":"request_05a5b84a-3891-424e-ba29-a5ab551da634","epoch":57,"edits":[{"text":".node-details li {\n    margin: 4px 0;\n}\n\n/* ========================================\n   LIGHT THEME CONTRAST FIXES\n   ======================================== */\n\n/* Fix 1 & 2: Analytics preview backgrounds - lighter for better green contrast */\n[data-theme=\"light\"] .eti-container {\n    background: linear-gradient(135deg, rgba(255, 71, 87, 0.05) 0%, rgba(255, 165, 2, 0.05) 100%);\n    border-color: rgba(255, 71, 87, 0.2);\n}\n\n[data-theme=\"light\"] .modeler-container {\n    background: linear-gradient(135deg, rgba(90, 156, 248, 0.05) 0%, rgba(38, 222, 129, 0.05) 100%);\n    border-color: rgba(90, 156, 248, 0.2);\n}\n\n/* Fix 3: Theme toggle button text - darker for contrast */\n[data-theme=\"light\"] .theme-toggle {\n    color: #1a1f2e;\n    background: rgba(255, 255, 255, 0.8);\n    border-color: rgba(46, 214, 15, 0.4);\n}\n\n/* Fix 4: Daily Analysis chart - darker labels and grid (handled in JS via CSS vars) */\n[data-theme=\"light\"] {\n    --chart-text-color: #374151;\n    --chart-grid-color: rgba(0, 0, 0, 0.12);\n}\n\n:root {\n    --chart-text-color: #9ca3af;\n    --chart-grid-color: rgba(255, 255, 255, 0.1);\n}\n\n/* Fix 5: Chart container labels - darker in light theme */\n[data-theme=\"light\"] .chart-header h2,\n[data-theme=\"light\"] .chart-header {\n    color: #1a1f2e;\n}\n\n/* Fix 6: Threat Vector Correlation header - darker */\n[data-theme=\"light\"] .correlation-header h2 {\n    color: #1a1f2e;\n}\n\n[data-theme=\"light\"] .correlation-subtitle {\n    color: #4a5568;\n}\n\n/* Fix 7: ETI subtitle and summary - darker for better contrast */\n[data-theme=\"light\"] .eti-subtitle {\n    color: #4a5568;\n}\n\n[data-theme=\"light\"] .eti-summary {\n    color: #374151;\n}\n\n/* Fix 8: Prediction labels in threat modeler - darker */\n[data-theme=\"light\"] .modeler-subtitle {\n    color: #4a5568;\n}\n\n[data-theme=\"light\"] .modeler-field label {\n    color: #374151;\n}\n\n[data-theme=\"light\"] .modeler-hint {\n    color: #6b7280;\n}\n","range":{"startLineNumber":2309,"startColumn":1,"endLineNumber":2312,"endColumn":1}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware-server/public/dashboard.html","external":"file:///home/trang/localnsv/mAIware-server/public/dashboard.html","path":"/home/trang/localnsv/mAIware-server/public/dashboard.html","scheme":"file"},"requestId":"request_05a5b84a-3891-424e-ba29-a5ab551da634","epoch":60,"edits":[{"text":"    <script>\n        // Helper function to get CSS variable values dynamically for theming\n        function getCSSVar(varName) {\n            return getComputedStyle(document.documentElement).getPropertyValue(varName).trim();\n        }\n\n        // View Switching System\n        function switchView(viewName) {","range":{"startLineNumber":507,"startColumn":1,"endLineNumber":509,"endColumn":40}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware-server/public/dashboard.html","external":"file:///home/trang/localnsv/mAIware-server/public/dashboard.html","path":"/home/trang/localnsv/mAIware-server/public/dashboard.html","scheme":"file"},"requestId":"request_05a5b84a-3891-424e-ba29-a5ab551da634","epoch":62,"edits":[{"text":"                        plugins: {\n                            legend: {\n                                labels: {\n                                    color: getCSSVar('--chart-text-color') || '#e0e0e0',\n                                    font: { size: 12 }\n                                }\n                            },\n                            tooltip: {\n                                backgroundColor: 'rgba(0, 0, 0, 0.8)',\n                                titleColor: '#fff',\n                                bodyColor: '#e0e0e0',\n                                borderColor: 'rgba(255, 255, 255, 0.1)',\n                                borderWidth: 1\n                            }\n                        },\n                        scales: {\n                            x: {\n                                ticks: { \n                                    color: getCSSVar('--chart-text-color') || '#888',\n                                    maxRotation: 45,\n                                    minRotation: 45\n                                },\n                                grid: { \n                                    color: getCSSVar('--chart-grid-color') || 'rgba(255, 255, 255, 0.05)' \n                                }\n                            },\n                            y: {\n                                beginAtZero: true,\n                                ticks: { \n                                    color: getCSSVar('--chart-text-color') || '#888',\n                                    stepSize: 1\n                                },\n                                grid: { \n                                    color: getCSSVar('--chart-grid-color') || 'rgba(255, 255, 255, 0.05)' \n                                }\n                            }","range":{"startLineNumber":899,"startColumn":1,"endLineNumber":934,"endColumn":30}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware-server/public/dashboard.html","external":"file:///home/trang/localnsv/mAIware-server/public/dashboard.html","path":"/home/trang/localnsv/mAIware-server/public/dashboard.html","scheme":"file"},"requestId":"request_05a5b84a-3891-424e-ba29-a5ab551da634","epoch":64,"edits":[{"text":"                        plugins: {\n                            legend: {\n                                position: 'bottom',\n                                labels: {\n                                    color: getCSSVar('--chart-text-color') || '#e0e0e0',\n                                    font: { size: 12 },\n                                    padding: 15\n                                }\n                            },\n                            tooltip: {\n                                backgroundColor: 'rgba(0, 0, 0, 0.8)',\n                                titleColor: '#fff',\n                                bodyColor: '#e0e0e0',\n                                borderColor: 'rgba(255, 255, 255, 0.1)',\n                                borderWidth: 1,","range":{"startLineNumber":1385,"startColumn":1,"endLineNumber":1399,"endColumn":48}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware-server/public/styles.css","external":"file:///home/trang/localnsv/mAIware-server/public/styles.css","path":"/home/trang/localnsv/mAIware-server/public/styles.css","scheme":"file"},"requestId":"request_5c21c11f-964f-4128-b95d-f7fa294fb3c0","epoch":68,"edits":[{"text":"[data-theme=\"light\"] .modeler-hint {\n    color: #6b7280;\n}\n\n/* Fix 9: Analytics preview backgrounds - much lighter for green text visibility */\n[data-theme=\"light\"] .preview-box {\n    background: rgba(255, 255, 255, 0.6);\n    border-color: rgba(46, 214, 15, 0.3);\n}\n\n/* Fix 10: ETI item text - lighter for better readability */\n[data-theme=\"light\"] .eti-count {\n    color: #6b7280;\n}\n\n[data-theme=\"light\"] .eti-details {\n    color: #9ca3af;\n}\n\n[data-theme=\"light\"] .eti-name {\n    color: #1f2937;\n}\n","range":{"startLineNumber":2379,"startColumn":1,"endLineNumber":2382,"endColumn":1}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware-server/public/styles.css","external":"file:///home/trang/localnsv/mAIware-server/public/styles.css","path":"/home/trang/localnsv/mAIware-server/public/styles.css","scheme":"file"},"requestId":"request_2d995c41-e4fb-4a32-8754-875cabc8f1e3","epoch":72,"edits":[{"text":"[data-theme=\"light\"] .eti-name {\n    color: #1f2937;\n}\n\n/* Fix 11: Make ETI details much more visible in light theme */\n[data-theme=\"light\"] .eti-details {\n    color: #059669;\n    font-weight: 500;\n}\n\n/* Fix 12: Threat ticker text visibility in light theme */\n[data-theme=\"light\"] .ticker-item {\n    color: #374151;\n    font-weight: 500;\n}\n\n/* Back to Top Button */\n.back-to-top {\n    position: fixed;\n    bottom: 30px;\n    right: 30px;\n    width: 50px;\n    height: 50px;\n    background: linear-gradient(135deg, var(--accent-green), var(--accent-green-dim));\n    border: 2px solid var(--accent-green);\n    border-radius: 50%;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    cursor: pointer;\n    z-index: 9998;\n    opacity: 0;\n    visibility: hidden;\n    transition: all 0.3s ease;\n    box-shadow: 0 4px 20px var(--success-glow);\n    color: #000;\n    font-size: 1.2rem;\n}\n\n.back-to-top.visible {\n    opacity: 1;\n    visibility: visible;\n}\n\n.back-to-top:hover {\n    transform: translateY(-5px) scale(1.1);\n    box-shadow: 0 6px 30px var(--success-glow);\n}\n\n.back-to-top:active {\n    transform: translateY(-2px) scale(1.05);\n}\n\n[data-theme=\"light\"] .back-to-top {\n    background: linear-gradient(135deg, #2ed60f, #27b00c);\n    color: #fff;\n}\n","range":{"startLineNumber":2398,"startColumn":1,"endLineNumber":2401,"endColumn":1}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware-server/public/dashboard.html","external":"file:///home/trang/localnsv/mAIware-server/public/dashboard.html","path":"/home/trang/localnsv/mAIware-server/public/dashboard.html","scheme":"file"},"requestId":"request_2d995c41-e4fb-4a32-8754-875cabc8f1e3","epoch":75,"edits":[{"text":"    <!-- Theme Toggle Button -->\n    <button class=\"theme-toggle\" id=\"themeToggle\" onclick=\"toggleTheme()\">\n        <span class=\"icon\" id=\"themeIcon\"></span>\n        <span id=\"themeText\">Dark</span>\n    </button>\n\n    <!-- Back to Top Button -->\n    <button class=\"back-to-top\" id=\"backToTop\" onclick=\"scrollToTop()\">\n        <i class=\"fas fa-arrow-up\"></i>\n    </button>\n\n    <!-- Preview Backdrop -->\n    <div class=\"preview-backdrop\" id=\"previewBackdrop\"></div>","range":{"startLineNumber":22,"startColumn":1,"endLineNumber":29,"endColumn":62}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware-server/public/dashboard.html","external":"file:///home/trang/localnsv/mAIware-server/public/dashboard.html","path":"/home/trang/localnsv/mAIware-server/public/dashboard.html","scheme":"file"},"requestId":"request_2d995c41-e4fb-4a32-8754-875cabc8f1e3","epoch":77,"edits":[{"text":"        // Helper function to get CSS variable values dynamically for theming\n        function getCSSVar(varName) {\n            return getComputedStyle(document.documentElement).getPropertyValue(varName).trim();\n        }\n\n        // Back to Top Button\n        const backToTopBtn = document.getElementById('backToTop');\n        \n        window.addEventListener('scroll', () => {\n            if (window.pageYOffset > 300) {\n                backToTopBtn.classList.add('visible');\n            } else {\n                backToTopBtn.classList.remove('visible');\n            }\n        });\n\n        function scrollToTop() {\n            window.scrollTo({\n                top: 0,\n                behavior: 'smooth'\n            });\n        }\n\n        // View Switching System\n        function switchView(viewName) {","range":{"startLineNumber":513,"startColumn":1,"endLineNumber":519,"endColumn":40}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/script.js","external":"file:///home/trang/localnsv/mAIware/script.js","path":"/home/trang/localnsv/mAIware/script.js","scheme":"file"},"requestId":"request_020092b9-97e0-43b6-b877-ad5f11664ee1","epoch":82,"edits":[{"text":"// --- NAVIGATION STATE ---\nlet scanHistory = [];\nlet currentHistoryIndex = -1;\n\n// --- ELEMENT REFERENCES ---\nconst initialState = document.getElementById('initial-state');\nconst analyzingState = document.getElementById('analyzing-state');","range":{"startLineNumber":38,"startColumn":1,"endLineNumber":40,"endColumn":67}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/script.js","external":"file:///home/trang/localnsv/mAIware/script.js","path":"/home/trang/localnsv/mAIware/script.js","scheme":"file"},"requestId":"request_020092b9-97e0-43b6-b877-ad5f11664ee1","epoch":84,"edits":[{"text":"// --- NAVIGATION FUNCTIONS ---\nfunction updateNavigationButtons() {\n    const prevBtn = document.getElementById('prev-scan-btn');\n    const nextBtn = document.getElementById('next-scan-btn');\n    const navInfo = document.getElementById('nav-info');\n    \n    if (!prevBtn || !nextBtn) return;\n    \n    // Disable/enable buttons based on position\n    prevBtn.disabled = currentHistoryIndex <= 0;\n    nextBtn.disabled = currentHistoryIndex >= scanHistory.length - 1;\n    \n    // Update info text\n    if (navInfo && scanHistory.length > 0) {\n        navInfo.textContent = `${currentHistoryIndex + 1} of ${scanHistory.length}`;\n    }\n}\n\nfunction showPreviousScan() {\n    if (currentHistoryIndex > 0) {\n        currentHistoryIndex--;\n        lastScanResult = scanHistory[currentHistoryIndex];\n        renderScanResult();\n        updateNavigationButtons();\n    }\n}\n\nfunction showNextScan() {\n    if (currentHistoryIndex < scanHistory.length - 1) {\n        currentHistoryIndex++;\n        lastScanResult = scanHistory[currentHistoryIndex];\n        renderScanResult();\n        updateNavigationButtons();\n    }\n}\n\n// Initialize history from electron-store on load\nasync function initializeScanHistory() {\n    try {\n        const storedHistory = await window.electronAPI.getHistory();\n        if (storedHistory && Array.isArray(storedHistory)) {\n            scanHistory = storedHistory;\n            currentHistoryIndex = scanHistory.length - 1;\n        }\n    } catch (error) {\n        console.error('Failed to load scan history:', error);\n    }\n}\n\n// --- Run on Page Load ---\ndocument.addEventListener('DOMContentLoaded', () => {\n    // 1. Animate Stat Cards\n    const statNumbers = document.querySelectorAll('.stat-number');\n    statNumbers.forEach(stat => {\n        const target = +stat.getAttribute('data-target');\n        const duration = 2000;\n        const stepTime = 20;\n        const steps = duration / stepTime;\n        const increment = target / steps;\n        let current = 0;\n\n        const updateCount = () => {\n            current += increment;\n            if (current < target) {\n                stat.textContent = Math.ceil(current).toLocaleString();\n                setTimeout(updateCount, stepTime);\n            } else {\n                stat.textContent = target.toLocaleString();\n            }\n        };\n        updateCount();\n    });\n\n    // 2. Create the charts\n    recreateCharts();\n    \n    // 3. Initialize scan history\n    initializeScanHistory();\n    \n    // 4. Setup navigation button handlers\n    const prevBtn = document.getElementById('prev-scan-btn');\n    const nextBtn = document.getElementById('next-scan-btn');\n    if (prevBtn) prevBtn.addEventListener('click', showPreviousScan);\n    if (nextBtn) nextBtn.addEventListener('click', showNextScan);\n});","range":{"startLineNumber":855,"startColumn":1,"endLineNumber":881,"endColumn":4}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/script.js","external":"file:///home/trang/localnsv/mAIware/script.js","path":"/home/trang/localnsv/mAIware/script.js","scheme":"file"},"requestId":"request_020092b9-97e0-43b6-b877-ad5f11664ee1","epoch":86,"edits":[{"text":"// 2. Listen for the 'scan-result' message\nwindow.electronAPI.onScanResult((scanResult) => {\n  console.log(\"UI: Received scan-result:\", scanResult);\n\n  clearInterval(disassemblyInterval); //\n  disassemblyInterval = null; //\n\n  bodyEl.classList.remove('is-analyzing'); //\n  bodyEl.classList.add('is-showing-result'); //\n\n  analyzingState.classList.remove('active'); //\n  resultState.classList.add('active'); //\n\n  // Add to history\n  scanHistory.push(scanResult);\n  currentHistoryIndex = scanHistory.length - 1;\n  \n  lastScanResult = scanResult;\n\n  renderScanResult();\n  updateNavigationButtons();\n});","range":{"startLineNumber":134,"startColumn":1,"endLineNumber":150,"endColumn":4}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/index.html","external":"file:///home/trang/localnsv/mAIware/index.html","path":"/home/trang/localnsv/mAIware/index.html","scheme":"file"},"requestId":"request_020092b9-97e0-43b6-b877-ad5f11664ee1","epoch":89,"edits":[{"text":"                <!-- State 3: Result -->\n                <div id=\"result-state\" class=\"scanner-state\"> <i class=\"result-icon\" id=\"result-icon\"></i>\n                    <h2 id=\"result-text\"></h2>\n                    <div class=\"filename\" id=\"result-filename\"></div>\n                    <p id=\"result-details\"></p>\n                    <!-- Removed the resetDemo() button as it's automatic now -->\n                    \n                    <!-- Navigation Controls -->\n                    <div class=\"scan-navigation\">\n                        <button id=\"prev-scan-btn\" class=\"nav-btn\" disabled>\n                            <i class=\"fas fa-chevron-left\"></i> Previous\n                        </button>\n                        <span id=\"nav-info\" class=\"nav-info\">1 of 1</span>\n                        <button id=\"next-scan-btn\" class=\"nav-btn\" disabled>\n                            Next <i class=\"fas fa-chevron-right\"></i>\n                        </button>\n                    </div>\n                </div>","range":{"startLineNumber":44,"startColumn":1,"endLineNumber":50,"endColumn":23}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/style.css","external":"file:///home/trang/localnsv/mAIware/style.css","path":"/home/trang/localnsv/mAIware/style.css","scheme":"file"},"requestId":"request_020092b9-97e0-43b6-b877-ad5f11664ee1","epoch":92,"edits":[{"text":".result-state p {\n    font-size: 1rem;\n    margin-bottom: 2rem;\n}\n\n/* --- Scan Navigation Controls --- */\n.scan-navigation {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    gap: 1.5rem;\n    margin-top: 1.5rem;\n    padding-top: 1.5rem;\n    border-top: 1px solid rgba(255, 255, 255, 0.1);\n}\n\n.nav-btn {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    padding: 0.75rem 1.5rem;\n    background: linear-gradient(135deg, var(--primary), var(--secondary));\n    color: white;\n    border: none;\n    border-radius: 8px;\n    font-size: 1rem;\n    font-weight: 600;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);\n}\n\n.nav-btn:hover:not(:disabled) {\n    transform: translateY(-2px);\n    box-shadow: 0 6px 20px rgba(139, 92, 246, 0.5);\n}\n\n.nav-btn:active:not(:disabled) {\n    transform: translateY(0);\n}\n\n.nav-btn:disabled {\n    background: rgba(255, 255, 255, 0.1);\n    color: rgba(255, 255, 255, 0.3);\n    cursor: not-allowed;\n    box-shadow: none;\n}\n\n.nav-info {\n    color: var(--text-medium);\n    font-size: 0.95rem;\n    font-weight: 500;\n    min-width: 80px;\n    text-align: center;\n}\n\n.non-pe-result {\n    display: none;\n    flex-direction: column;\n    align-items: center;\n    gap: 1.5rem;\n    color: var(--text-light);\n    padding: 1rem 0 0 0;\n}","range":{"startLineNumber":337,"startColumn":1,"endLineNumber":349,"endColumn":2}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/index.html","external":"file:///home/trang/localnsv/mAIware/index.html","path":"/home/trang/localnsv/mAIware/index.html","scheme":"file"},"requestId":"request_e1cb39fa-c4c3-4d4b-b7e1-a9c3f8c3b4cc","epoch":98,"edits":[{"text":"                <div id=\"non-pe-result\" class=\"scanner-state non-pe-result\">\n                    <div class=\"non-pe-icon\"><i class=\"fas fa-file\"></i></div>\n                    <h2 id=\"non-pe-title\">File is not a Windows PE executable</h2>\n                    <p class=\"filename\" id=\"non-pe-filename\"></p>\n                    <div class=\"non-pe-hash-grid\">\n                        <div class=\"non-pe-hash\">\n                            <h4>SHA256</h4>\n                            <p id=\"non-pe-hash-sha256\">...</p>\n                        </div>\n                        <div class=\"non-pe-hash\">\n                            <h4>MD5</h4>\n                            <p id=\"non-pe-hash-md5\">...</p>\n                        </div>\n                    </div>\n                    \n                    <!-- Navigation Controls for Non-PE files -->\n                    <div class=\"scan-navigation\">\n                        <button id=\"prev-scan-btn-nonpe\" class=\"nav-btn\" disabled>\n                            <i class=\"fas fa-chevron-left\"></i> Previous\n                        </button>\n                        <span id=\"nav-info-nonpe\" class=\"nav-info\">1 of 1</span>\n                        <button id=\"next-scan-btn-nonpe\" class=\"nav-btn\" disabled>\n                            Next <i class=\"fas fa-chevron-right\"></i>\n                        </button>\n                    </div>\n                </div>","range":{"startLineNumber":62,"startColumn":1,"endLineNumber":76,"endColumn":23}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/script.js","external":"file:///home/trang/localnsv/mAIware/script.js","path":"/home/trang/localnsv/mAIware/script.js","scheme":"file"},"requestId":"request_e1cb39fa-c4c3-4d4b-b7e1-a9c3f8c3b4cc","epoch":99,"edits":[{"text":"    // 3. Initialize scan history\n    initializeScanHistory();\n    \n    // 4. Setup navigation button handlers for both PE and non-PE results\n    const prevBtn = document.getElementById('prev-scan-btn');\n    const nextBtn = document.getElementById('next-scan-btn');\n    const prevBtnNonPe = document.getElementById('prev-scan-btn-nonpe');\n    const nextBtnNonPe = document.getElementById('next-scan-btn-nonpe');\n    \n    if (prevBtn) prevBtn.addEventListener('click', showPreviousScan);\n    if (nextBtn) nextBtn.addEventListener('click', showNextScan);\n    if (prevBtnNonPe) prevBtnNonPe.addEventListener('click', showPreviousScan);\n    if (nextBtnNonPe) nextBtnNonPe.addEventListener('click', showNextScan);\n});","range":{"startLineNumber":936,"startColumn":1,"endLineNumber":944,"endColumn":4}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/script.js","external":"file:///home/trang/localnsv/mAIware/script.js","path":"/home/trang/localnsv/mAIware/script.js","scheme":"file"},"requestId":"request_e1cb39fa-c4c3-4d4b-b7e1-a9c3f8c3b4cc","epoch":100,"edits":[{"text":"// --- NAVIGATION FUNCTIONS ---\nfunction updateNavigationButtons() {\n    // PE result buttons\n    const prevBtn = document.getElementById('prev-scan-btn');\n    const nextBtn = document.getElementById('next-scan-btn');\n    const navInfo = document.getElementById('nav-info');\n    \n    // Non-PE result buttons\n    const prevBtnNonPe = document.getElementById('prev-scan-btn-nonpe');\n    const nextBtnNonPe = document.getElementById('next-scan-btn-nonpe');\n    const navInfoNonPe = document.getElementById('nav-info-nonpe');\n    \n    const buttonsExist = (prevBtn && nextBtn) || (prevBtnNonPe && nextBtnNonPe);\n    if (!buttonsExist) return;\n    \n    // Update both sets of buttons\n    const buttons = [\n        { prev: prevBtn, next: nextBtn, info: navInfo },\n        { prev: prevBtnNonPe, next: nextBtnNonPe, info: navInfoNonPe }\n    ];\n    \n    buttons.forEach(set => {\n        if (set.prev && set.next) {\n            set.prev.disabled = currentHistoryIndex <= 0;\n            set.next.disabled = currentHistoryIndex >= scanHistory.length - 1;\n            \n            if (set.info && scanHistory.length > 0) {\n                set.info.textContent = `${currentHistoryIndex + 1} of ${scanHistory.length}`;\n            }\n        }\n    });\n}","range":{"startLineNumber":860,"startColumn":1,"endLineNumber":876,"endColumn":2}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/style.css","external":"file:///home/trang/localnsv/mAIware/style.css","path":"/home/trang/localnsv/mAIware/style.css","scheme":"file"},"requestId":"request_e1cb39fa-c4c3-4d4b-b7e1-a9c3f8c3b4cc","epoch":103,"edits":[{"text":"body.light-theme .chart-container {\n    color: var(--text-medium);\n}\n\n/* Light theme navigation buttons */\nbody.light-theme .nav-btn {\n    background: linear-gradient(135deg, var(--primary), var(--secondary));\n    color: white;\n    box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);\n}\n\nbody.light-theme .nav-btn:hover:not(:disabled) {\n    box-shadow: 0 6px 20px rgba(139, 92, 246, 0.6);\n}\n\nbody.light-theme .nav-btn:disabled {\n    background: var(--bg-dark-3);\n    color: var(--text-dark);\n    box-shadow: none;\n}\n\nbody.light-theme .nav-info {\n    color: var(--text-light);\n    font-weight: 600;\n}\n\nbody.light-theme .scan-navigation {\n    border-top-color: var(--border-color);\n}","range":{"startLineNumber":1182,"startColumn":1,"endLineNumber":1184,"endColumn":2}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/style.css","external":"file:///home/trang/localnsv/mAIware/style.css","path":"/home/trang/localnsv/mAIware/style.css","scheme":"file"},"requestId":"request_e07a7772-968a-477e-a954-72eb3513ede7","epoch":109,"edits":[{"text":"body.light-theme .nav-btn:disabled {\n    background: var(--bg-dark-3) !important;\n    color: var(--text-dark) !important;\n    box-shadow: none !important;\n}\n\nbody.light-theme .nav-info {\n    color: var(--text-light);\n    font-weight: 600;\n}\n\nbody.light-theme .scan-navigation {\n    border-top-color: var(--border-color);\n}","range":{"startLineNumber":1197,"startColumn":1,"endLineNumber":1210,"endColumn":2}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/index.html","external":"file:///home/trang/localnsv/mAIware/index.html","path":"/home/trang/localnsv/mAIware/index.html","scheme":"file"},"requestId":"request_e07a7772-968a-477e-a954-72eb3513ede7","epoch":110,"edits":[{"text":"                        </div>\n                    </div>\n                </div>","range":{"startLineNumber":74,"startColumn":1,"endLineNumber":87,"endColumn":23}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/style.css","external":"file:///home/trang/localnsv/mAIware/style.css","path":"/home/trang/localnsv/mAIware/style.css","scheme":"file"},"requestId":"request_e07a7772-968a-477e-a954-72eb3513ede7","epoch":111,"edits":[{"text":"/* --- Scan Navigation Controls --- */\n.scan-navigation {\n    display: none;\n    align-items: center;\n    justify-content: center;\n    gap: 1.5rem;\n    margin: 1.5rem 0;\n    padding: 1rem;\n    background: rgba(255, 255, 255, 0.03);\n    border-radius: 8px;\n}\n\n.scan-navigation-top {\n    display: flex;\n}\n\n/* Show navigation when results are displayed */\nbody.is-showing-result .scan-navigation-top,\nbody.is-non-pe .scan-navigation-top {\n    display: flex;\n}","range":{"startLineNumber":342,"startColumn":1,"endLineNumber":351,"endColumn":2}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/index.html","external":"file:///home/trang/localnsv/mAIware/index.html","path":"/home/trang/localnsv/mAIware/index.html","scheme":"file"},"requestId":"request_e07a7772-968a-477e-a954-72eb3513ede7","epoch":112,"edits":[{"text":"                    <div class=\"filename\" id=\"result-filename\"></div>\n                    <p id=\"result-details\"></p>\n                    <!-- Removed the resetDemo() button as it's automatic now -->\n                </div>","range":{"startLineNumber":47,"startColumn":1,"endLineNumber":61,"endColumn":23}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/index.html","external":"file:///home/trang/localnsv/mAIware/index.html","path":"/home/trang/localnsv/mAIware/index.html","scheme":"file"},"requestId":"request_e07a7772-968a-477e-a954-72eb3513ede7","epoch":113,"edits":[{"text":"            <div class=\"scanner-container\">\n                <h1>AI Malware Detection</h1>\n                \n                <!-- Navigation Controls (Top Position) -->\n                <div class=\"scan-navigation scan-navigation-top\">\n                    <button id=\"prev-scan-btn\" class=\"nav-btn\" disabled>\n                        <i class=\"fas fa-chevron-left\"></i> Previous\n                    </button>\n                    <span id=\"nav-info\" class=\"nav-info\">1 of 1</span>\n                    <button id=\"next-scan-btn\" class=\"nav-btn\" disabled>\n                        Next <i class=\"fas fa-chevron-right\"></i>\n                    </button>\n                </div>\n                \n                <!-- State 1: Initial -->","range":{"startLineNumber":26,"startColumn":1,"endLineNumber":28,"endColumn":42}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/script.js","external":"file:///home/trang/localnsv/mAIware/script.js","path":"/home/trang/localnsv/mAIware/script.js","scheme":"file"},"requestId":"request_e07a7772-968a-477e-a954-72eb3513ede7","epoch":116,"edits":[{"text":"// --- NAVIGATION FUNCTIONS ---\nfunction updateNavigationButtons() {\n    const prevBtn = document.getElementById('prev-scan-btn');\n    const nextBtn = document.getElementById('next-scan-btn');\n    const navInfo = document.getElementById('nav-info');\n    \n    if (!prevBtn || !nextBtn) return;\n    \n    // Disable/enable buttons based on position\n    prevBtn.disabled = currentHistoryIndex <= 0;\n    nextBtn.disabled = currentHistoryIndex >= scanHistory.length - 1;\n    \n    // Update info text\n    if (navInfo && scanHistory.length > 0) {\n        navInfo.textContent = `${currentHistoryIndex + 1} of ${scanHistory.length}`;\n    }\n}","range":{"startLineNumber":860,"startColumn":1,"endLineNumber":891,"endColumn":2}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/script.js","external":"file:///home/trang/localnsv/mAIware/script.js","path":"/home/trang/localnsv/mAIware/script.js","scheme":"file"},"requestId":"request_e07a7772-968a-477e-a954-72eb3513ede7","epoch":118,"edits":[{"text":"    // 3. Initialize scan history\n    initializeScanHistory();\n    \n    // 4. Setup navigation button handlers\n    const prevBtn = document.getElementById('prev-scan-btn');\n    const nextBtn = document.getElementById('next-scan-btn');\n    \n    if (prevBtn) prevBtn.addEventListener('click', showPreviousScan);\n    if (nextBtn) nextBtn.addEventListener('click', showNextScan);\n});","range":{"startLineNumber":936,"startColumn":1,"endLineNumber":949,"endColumn":4}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/style.css","external":"file:///home/trang/localnsv/mAIware/style.css","path":"/home/trang/localnsv/mAIware/style.css","scheme":"file"},"requestId":"request_2898cd94-7697-4906-9e9b-0165db937240","epoch":122,"edits":[{"text":".nav-btn:disabled {\n    background: rgba(255, 255, 255, 0.1) !important;\n    color: rgba(255, 255, 255, 0.3) !important;\n    cursor: not-allowed;\n    box-shadow: none !important;\n}","range":{"startLineNumber":389,"startColumn":1,"endLineNumber":394,"endColumn":2}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/style.css","external":"file:///home/trang/localnsv/mAIware/style.css","path":"/home/trang/localnsv/mAIware/style.css","scheme":"file"},"requestId":"request_48c060e3-68ea-41a9-b274-6b28227135f7","epoch":126,"edits":[{"text":"/* --- Scan Navigation Controls --- */\n.scan-navigation {\n    display: none;\n    align-items: center;\n    justify-content: center;\n    gap: 1.5rem;\n    margin: 1.5rem 0;\n    padding: 1rem;\n    background: rgba(255, 255, 255, 0.03);\n    border-radius: 8px;\n}\n\n/* Show navigation only when results are displayed */\nbody.is-showing-result .scan-navigation,\nbody.is-non-pe .scan-navigation {\n    display: flex;\n}","range":{"startLineNumber":342,"startColumn":1,"endLineNumber":362,"endColumn":2}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/style.css","external":"file:///home/trang/localnsv/mAIware/style.css","path":"/home/trang/localnsv/mAIware/style.css","scheme":"file"},"requestId":"request_f66fcc2f-7600-4c3d-b58a-9a70f85ff99e","epoch":130,"edits":[{"text":"body.light-theme .nav-btn:disabled {\n    background: #adb5bd !important;\n    color: #6c757d !important;\n    box-shadow: none !important;\n    opacity: 0.6;\n}","range":{"startLineNumber":1204,"startColumn":1,"endLineNumber":1208,"endColumn":2}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/style.css","external":"file:///home/trang/localnsv/mAIware/style.css","path":"/home/trang/localnsv/mAIware/style.css","scheme":"file"},"requestId":"request_d367970c-4c33-4139-8cfb-aed7f33ec476","epoch":134,"edits":[{"text":"/* Light theme navigation buttons */\nbody.light-theme .nav-btn {\n    background: linear-gradient(135deg, #8b5cf6, #7c3aed) !important;\n    color: white !important;\n    box-shadow: 0 4px 12px rgba(139, 92, 246, 0.5) !important;\n}\n\nbody.light-theme .nav-btn:hover:not(:disabled) {\n    background: linear-gradient(135deg, #7c3aed, #6d28d9) !important;\n    box-shadow: 0 6px 20px rgba(139, 92, 246, 0.7) !important;\n}\n\nbody.light-theme .nav-btn:disabled {\n    background: #e9ecef !important;\n    color: #adb5bd !important;\n    box-shadow: none !important;\n    opacity: 0.7 !important;\n}","range":{"startLineNumber":1194,"startColumn":1,"endLineNumber":1208,"endColumn":2}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/index.html","external":"file:///home/trang/localnsv/mAIware/index.html","path":"/home/trang/localnsv/mAIware/index.html","scheme":"file"},"requestId":"request_072750c6-1243-4dc9-a6c2-997a44762e6d","epoch":138,"edits":[{"text":"                <div class=\"details-section\">\n                    <h4>System IP</h4>\n                    <p class=\"hash-text\" id=\"details-system-ip\">Detecting...</p>\n                </div>\n\n                <div class=\"details-section qr-section\" id=\"qr-section\">\n                    <h4>Scan Report QR Code</h4>\n                    <p class=\"qr-description\">Scan to view the complete JSON report</p>\n                    <div id=\"qr-code-container\" class=\"qr-code-wrapper\"></div>\n                </div>\n\n                <div class=\"details-section\">\n                    <h4>What To Do Next</h4>\n                    <p id=\"details-recommendation\">...</p>\n                </div>","range":{"startLineNumber":124,"startColumn":1,"endLineNumber":132,"endColumn":23}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/index.html","external":"file:///home/trang/localnsv/mAIware/index.html","path":"/home/trang/localnsv/mAIware/index.html","scheme":"file"},"requestId":"request_072750c6-1243-4dc9-a6c2-997a44762e6d","epoch":139,"edits":[{"text":"    <!-- Chart.js for stats (which you already had) -->\n    <script src=\"https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js\"></script>\n    <!-- QRCode.js for QR code generation -->\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js\"></script>\n    <!-- Link to the CSS file -->\n    <link rel=\"stylesheet\" href=\"style.css\">","range":{"startLineNumber":10,"startColumn":1,"endLineNumber":13,"endColumn":45}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/style.css","external":"file:///home/trang/localnsv/mAIware/style.css","path":"/home/trang/localnsv/mAIware/style.css","scheme":"file"},"requestId":"request_072750c6-1243-4dc9-a6c2-997a44762e6d","epoch":142,"edits":[{"text":".hash-text {\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.95rem;\n    word-break: break-all;\n}\n\n/* QR Code Section */\n.qr-section {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    padding: 1.5rem;\n    background: rgba(255, 255, 255, 0.02);\n    border-radius: 8px;\n    border: 1px solid rgba(255, 255, 255, 0.05);\n}\n\n.qr-description {\n    color: var(--text-medium) !important;\n    font-size: 0.9rem !important;\n    margin-bottom: 1rem !important;\n    text-align: center;\n}\n\n.qr-code-wrapper {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    padding: 1rem;\n    background: white;\n    border-radius: 8px;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n}\n\n.qr-code-wrapper canvas,\n.qr-code-wrapper img {\n    display: block;\n    max-width: 200px;\n    height: auto;\n}\n\nbody.light-theme .qr-section {\n    background: rgba(0, 0, 0, 0.02);\n    border-color: var(--border-color);\n}\n\nbody.light-theme .qr-code-wrapper {\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n}","range":{"startLineNumber":675,"startColumn":1,"endLineNumber":679,"endColumn":2}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/script.js","external":"file:///home/trang/localnsv/mAIware/script.js","path":"/home/trang/localnsv/mAIware/script.js","scheme":"file"},"requestId":"request_072750c6-1243-4dc9-a6c2-997a44762e6d","epoch":145,"edits":[{"text":"  populateVendor(scanResult.vendor); //\n  populateSignature(scanResult.key_findings.signature); //\n  populateEntropyBars(scanResult.key_findings.section_entropy || []); //\n  populateKeyStrings(scanResult.key_findings.key_strings || [], scanResult.classification); //\n\n  populateDisassembly(resultMockDisassembly); //\n\n  const apiList = scanResult.key_findings.api_imports || [];\n  const graphData = generateGraphData(apiList, scanResult.classification);\n  drawCallGraph(graphData);\n  \n  generateQRCode(scanResult);\n}","range":{"startLineNumber":260,"startColumn":1,"endLineNumber":270,"endColumn":2}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/script.js","external":"file:///home/trang/localnsv/mAIware/script.js","path":"/home/trang/localnsv/mAIware/script.js","scheme":"file"},"requestId":"request_072750c6-1243-4dc9-a6c2-997a44762e6d","epoch":147,"edits":[{"text":"  nonPeResultWrapper.classList.add('active');\n\n  callGraphEl.innerHTML = '';\n  currentGraphLines.forEach(line => line.remove());\n  currentGraphLines = [];\n  entropyBarsContainer.innerHTML = '';\n  keyStringsContainer.innerHTML = '';\n  \n  generateQRCode(scanResult);\n}","range":{"startLineNumber":291,"startColumn":1,"endLineNumber":298,"endColumn":2}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/script.js","external":"file:///home/trang/localnsv/mAIware/script.js","path":"/home/trang/localnsv/mAIware/script.js","scheme":"file"},"requestId":"request_072750c6-1243-4dc9-a6c2-997a44762e6d","epoch":149,"edits":[{"text":"function updateSystemIpDisplay() {\n    if (!detailsSystemIp || !window.electronAPI || typeof window.electronAPI.getSystemIp !== 'function') {\n        return;\n    }\n\n    detailsSystemIp.textContent = 'Detecting...';\n\n    window.electronAPI.getSystemIp()\n        .then((ip) => {\n            if (!ip) {\n                detailsSystemIp.textContent = 'Unavailable';\n                return;\n            }\n\n            detailsSystemIp.textContent = ip;\n        })\n        .catch(() => {\n            detailsSystemIp.textContent = 'Unavailable';\n        });\n}\n\nfunction generateQRCode(scanResult) {\n    const qrContainer = document.getElementById('qr-code-container');\n    if (!qrContainer) return;\n    \n    // Clear previous QR code\n    qrContainer.innerHTML = '';\n    \n    // Create a clean report object with relevant data\n    const reportData = {\n        filename: scanResult.detected_filename || 'Unknown',\n        classification: scanResult.classification || 'Unknown',\n        confidence_score: scanResult.confidence_score || 0,\n        malware_family: scanResult.malware_family || 'N/A',\n        vendor: scanResult.vendor || 'Unknown',\n        file_hashes: scanResult.file_hashes || {},\n        key_findings: {\n            file_type: scanResult.key_findings?.file_type || 'Unknown',\n            packer: scanResult.key_findings?.packer || 'None',\n            signature: scanResult.key_findings?.signature || 'None',\n            section_entropy: scanResult.key_findings?.section_entropy || [],\n            key_strings: scanResult.key_findings?.key_strings || [],\n            api_imports: scanResult.key_findings?.api_imports || []\n        },\n        scan_timestamp: new Date().toISOString()\n    };\n    \n    // Convert to JSON string\n    const jsonReport = JSON.stringify(reportData, null, 2);\n    \n    // Generate QR code\n    try {\n        new QRCode(qrContainer, {\n            text: jsonReport,\n            width: 200,\n            height: 200,\n            colorDark: '#000000',\n            colorLight: '#ffffff',\n            correctLevel: QRCode.CorrectLevel.M\n        });\n    } catch (error) {\n        console.error('Failed to generate QR code:', error);\n        qrContainer.innerHTML = '<p style=\"color: var(--text-medium);\">QR code generation failed</p>';\n    }\n}","range":{"startLineNumber":426,"startColumn":1,"endLineNumber":445,"endColumn":2}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/script.js","external":"file:///home/trang/localnsv/mAIware/script.js","path":"/home/trang/localnsv/mAIware/script.js","scheme":"file"},"requestId":"request_65c3482f-996f-41ad-92f1-68a84ee31e00","epoch":153,"edits":[{"text":"// 1. Listen for the 'scan-started' message from the backend\nwindow.electronAPI.onScanStarted((filename) => {\n  console.log(`UI: Received scan-started for ${filename}`);\n\n  // Don't auto-switch if we're currently showing a result\n  // User needs to manually navigate using Previous/Next buttons\n  if (bodyEl.classList.contains('is-showing-result') || bodyEl.classList.contains('is-non-pe')) {\n    console.log('UI: Currently viewing a result, not auto-switching to new scan');\n    return;\n  }\n\n  // 1. Set UI to \"Analyzing\" state\n  initialState.classList.remove('active'); //\n  analyzingState.classList.add('active'); //\n  analyzingFilename.textContent = filename; //\n  disassemblyFilenameEl.textContent = filename; //\n\n  currentFileMetadata = { filename, isPe: true };\n  lastScanResult = null;\n  nonPeResultWrapper.classList.remove('active');\n  bodyEl.classList.remove('is-non-pe');\n\n  // 2. Update body class to show disassembly\n  bodyEl.classList.remove('is-showing-result'); //\n  bodyEl.classList.add('is-analyzing'); //\n  removeAnimationClasses(); //\n  \n  // 3. Populate disassembly with a \"suspicious\" default and start animation\n  // (We don't know the result yet, so we pick one)\n  populateDisassembly(mockDisassemblySuspicious); //\n  startDisassemblyAnimation(); //\n\n  // 4. Clear old results\n  clearResultData();\n});","range":{"startLineNumber":105,"startColumn":1,"endLineNumber":132,"endColumn":4}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/script.js","external":"file:///home/trang/localnsv/mAIware/script.js","path":"/home/trang/localnsv/mAIware/script.js","scheme":"file"},"requestId":"request_91be0cc1-01fb-4211-9903-9c2be6b5539e","epoch":157,"edits":[{"text":"// --- MOCK DISASSEMBLY DATA ---\n// (We keep this for now, as requested)\nconst mockDisassemblyBenign = [\n    `<span class=\"addr\">0x401000</span> <span class=\"op\">PUSH</span> <span class=\"args\">ebp</span> <span class=\"comment\">; setup stack frame</span>`,\n    `<span class=\"addr\">0x401001</span> <span class=\"op\">MOV</span> <span class=\"args\">ebp, esp</span>`,\n    `<span class=\"addr\">0x401003</span> <span class=\"op\">SUB</span> <span class=\"args\">esp, 48h</span>`,\n    `<span class=\"addr\">0x40100C</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4012A0</span> <span class=\"comment\">; initialize_string</span>`,\n    `<span class=\"addr\">0x401015</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4013F0</span> <span class=\"comment\">; get_user_input</span>`,\n    `<span class=\"addr\">0x40101E</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4015D0</span> <span class=\"comment\">; print_output</span>`,\n    `<span class=\"addr\">0x401028</span> <span class=\"op\">RETN</span>`,\n    `<span class=\"addr\">...</span>`,\n];\nconst mockDisassemblySuspicious = [\n    `<span class=\"addr\">0x401000</span> <span class=\"op\">PUSH</span> <span class=\"args\">ebp</span>`,\n    `<span class=\"addr\">0x401003</span> <span class=\"op\">SUB</span> <span class=\"args\">esp, 80h</span>`,\n    `<span class=\"addr\">0x40100D</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4012A0</span> <span class=\"comment\">; read_file_to_buffer</span>`,\n    `<span class=\"addr\">0x40101B</span> <span class=\"op\">REP</span> <span class=\"op\">MOVSB</span> <span class=\"comment\">; unsafe buffer write</span>`,\n    `<span class=\"addr\">0x401020</span> <span class=\"op\">JGE</span> <span class=\"args\">0x401030</span> <span class=\"comment\">; jump if overflow</span>`,\n    `<span class=\"addr\">0x401028</span> <span class=\"op\">RETN</span>`,\n    `<span class=\"addr\">...</span>`,\n];\nconst mockDisassemblyMalware = [\n    `<span class=\"addr\">0x401000</span> <span class=\"op\">PUSH</span> <span class=\"args\">ebp</span> <span class=\"comment\">; setup stack frame</span>`,\n    `<span class=\"addr\">0x40100B</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4011B0</span> <span class=\"comment\">; kernel32.LoadLibraryA</span>`,\n    `<span class=\"addr\">0x401013</span> <span class=\"op\">PUSH</span> <span class=\"string\">\"CreateRemoteThread\"</span>`,\n    `<span class=\"addr\">0x401019</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4011C0</span> <span class=\"comment\">; kernel32.GetProcAddress</span>`,\n    `<span class=\"addr\">0x401028</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4012F0</span> <span class=\"comment\">; decrypt_payload</span>`,\n    `<span class=\"addr\">0x401034</span> <span class=\"op\">CALL</span> <span class=\"args\">[ebp-24h]</span> <span class=\"comment\">; call CreateRemoteThread</span>`,\n    `<span class=\"addr\">0x401037</span> <span class=\"op\">JMP</span> <span class=\"args\">0x40102D</span> <span class=\"comment\">; loop?</span>`,\n    `<span class=\"addr\">...</span>`,\n];\n\n// --- REMOVED MOCK GRAPH DATA ---\n// const mockGraphSafe = ... (DELETED)\n// const mockGraphSuspicious = ... (DELETED)\n// const mockGraphMalware = ... (DELETED)\n\n// --- NAVIGATION STATE ---\nlet scanHistory = [];\nlet currentHistoryIndex = -1;\n\n// --- ELEMENT REFERENCES ---\nconst initialState = document.getElementById('initial-state');\nconst analyzingState = document.getElementById('analyzing-state');\nconst resultState = document.getElementById('result-state');\n\nconst analyzingFilename = document.getElementById('analyzing-filename');\nconst resultIcon = document.getElementById('result-icon');\nconst resultText = document.getElementById('result-text');\nconst resultFilename = document.getElementById('result-filename');\nconst resultDetails = document.getElementById('result-details');\nconst nonPeResultWrapper = document.getElementById('non-pe-result');\nconst nonPeFilename = document.getElementById('non-pe-filename');\nconst nonPeHashSha256 = document.getElementById('non-pe-hash-sha256');\nconst nonPeHashMd5 = document.getElementById('non-pe-hash-md5');\n\nconst bodyEl = document.body;\nlet animationWrapper = null;\n\nconst disassemblyWrapper = document.getElementById('disassembly-wrapper');\nconst disassemblyCodeEl = document.getElementById('disassembly-code');\nconst disassemblyFilenameEl = document.getElementById('disassembly-filename');\n\n// Analysis Details elements\nconst analysisDetailsWrapper = document.getElementById('analysis-details-wrapper');\nconst progressBarFill = document.getElementById('progress-bar-fill');\nconst scorePercentage = document.getElementById('score-percentage');\nconst detailsReasoning = document.getElementById('details-reasoning'); // We'll reuse this\nconst detailsHashSha256 = document.getElementById('details-hash-sha256');\nconst detailsHashMd5 = document.getElementById('details-hash-md5');\nconst detailsSystemIp = document.getElementById('details-system-ip');\nconst detailsRecommendation = document.getElementById('details-recommendation');\nconst detailsVendor = document.getElementById('details-vendor');\nconst detailsSignature = document.getElementById('details-signature');\nconst fileInternalsWrapper = document.getElementById('file-internals-wrapper');\nconst entropyBarsContainer = document.getElementById('entropy-bars-container');\nconst keyStringsContainer = document.getElementById('key-strings-container');\n\n// History Panel elements\nconst historyBtn = document.getElementById('history-btn');\nconst historyPanel = document.getElementById('history-panel');\nconst historyCloseBtn = document.getElementById('history-close-btn');\nconst historyOverlay = document.getElementById('history-overlay');\nconst historyListEl = document.querySelector('.history-list');\n\n// Scroll Zone elements\nconst scrollZoneTop = document.getElementById('scroll-zone-top');\nconst scrollZoneBottom = document.getElementById('scroll-zone-bottom');\n\n// Graph Panel elements\nconst graphWrapper = document.getElementById('graph-wrapper');\nconst callGraphEl = document.getElementById('call-graph');\n\n// Stats elements\nconst statsWrapper = document.getElementById('stats-wrapper');\n\n\n// --- STATE ---\nlet disassemblyInterval = null;\nlet scrollInterval = null; // For auto-scrolling\nlet currentGraphLines = []; // Renamed from currentLines to avoid conflict\nlet currentFileMetadata = null;\nlet lastScanResult = null;\n\n// 1. Listen for the 'scan-started' message from the backend\nwindow.electronAPI.onScanStarted((filename) => {\n  console.log(`UI: Received scan-started for ${filename}`);\n\n    // If user is viewing a result, don't auto-switch to analyzing.\n    if (bodyEl.classList.contains('is-showing-result') || bodyEl.classList.contains('is-non-pe')) {\n        console.log('UI: Result is being viewed; deferring analyzing UI switch');\n        return;\n    }\n\n  // 1. Set UI to \"Analyzing\" state\n  initialState.classList.remove('active'); //\n  analyzingState.classList.add('active'); //\n  analyzingFilename.textContent = filename; //\n  disassemblyFilenameEl.textContent = filename; //\n\n  currentFileMetadata = { filename, isPe: true };\n  lastScanResult = null;\n  nonPeResultWrapper.classList.remove('active');\n  bodyEl.classList.remove('is-non-pe');\n\n  // 2. Update body class to show disassembly\n  bodyEl.classList.remove('is-showing-result'); //\n  bodyEl.classList.add('is-analyzing'); //\n  removeAnimationClasses(); //\n  \n  // 3. Populate disassembly with a \"suspicious\" default and start animation\n  // (We don't know the result yet, so we pick one)\n  populateDisassembly(mockDisassemblySuspicious); //\n  startDisassemblyAnimation(); //\n\n  // 4. Clear old results\n  clearResultData();\n});\n\n// 2. Listen for the 'scan-result' message\nwindow.electronAPI.onScanResult((scanResult) => {\n  console.log(\"UI: Received scan-result:\", scanResult);\n\n  clearInterval(disassemblyInterval); //\n  disassemblyInterval = null; //\n\n  // Add to history\n  scanHistory.push(scanResult);\n  currentHistoryIndex = scanHistory.length - 1;\n\n    // If a result is already being viewed, do not auto-advance UI.\n    if (bodyEl.classList.contains('is-showing-result') || bodyEl.classList.contains('is-non-pe')) {\n        updateNavigationButtons();\n        return;\n    }\n\n    bodyEl.classList.remove('is-analyzing'); //\n    bodyEl.classList.add('is-showing-result'); //\n\n    analyzingState.classList.remove('active'); //\n    resultState.classList.add('active'); //\n\n    lastScanResult = scanResult;\n    renderScanResult();\n    updateNavigationButtons();\n});\n\nwindow.electronAPI.onScanFileMetadata((metadata) => {\n  if (!metadata || typeof metadata !== 'object') {\n    return;\n  }\n\n  currentFileMetadata = metadata;\n\n  if (lastScanResult && metadata.filename === lastScanResult.detected_filename) {\n    renderScanResult();\n  }\n});\n\nfunction renderScanResult() {\n  if (!lastScanResult) {\n    return;\n  }\n\n  const metadataMatches = currentFileMetadata && currentFileMetadata.filename === lastScanResult.detected_filename;\n  const isNonPe = metadataMatches && currentFileMetadata.isPe === false;\n\n  if (isNonPe) {\n    renderNonPeResult(lastScanResult);\n    return;\n  }\n\n  renderPeResult(lastScanResult);\n}\n\nfunction ensureAnimationWrapper() {\n  if (animationWrapper) {\n    return;\n  }\n\n  animationWrapper = document.createElement('div');\n  animationWrapper.className = 'animation-swarm';\n  for (let i = 0; i < 10; i++) {\n    const particle = document.createElement('span');\n    animationWrapper.appendChild(particle);\n  }\n  bodyEl.prepend(animationWrapper);\n}\n\nfunction renderPeResult(scanResult) {\n  removeAnimationClasses();\n  bodyEl.classList.remove('is-non-pe');\n  nonPeResultWrapper.classList.remove('active');\n\n  let resultIconClass = 'fas fa-check-circle'; //\n  let resultMockDisassembly = mockDisassemblyBenign; //\n  let resultBodyClass = 'result-safe-active'; //\n  let resultScannerClass = 'result-safe'; //\n  let resultProgressClass = 'progress-bar-green'; //\n  let resultScoreClass = 'score-green'; //\n  let recommendation = 'You can safely run this file.'; //\n\n  if (scanResult.classification.includes('Malware')) {\n    resultIconClass = 'fas fa-bug';\n    resultMockDisassembly = mockDisassemblyMalware;\n    resultBodyClass = 'result-malware-active'; //\n    resultScannerClass = 'result-malware'; //\n    resultProgressClass = 'progress-bar-red'; //\n    resultScoreClass = 'score-red'; //\n    recommendation = 'DO NOT OPEN. Quarantine this file immediately.'; //\n  } else if (scanResult.classification.includes('Suspicious')) {\n    resultIconClass = 'fas fa-exclamation-triangle'; //\n    resultMockDisassembly = mockDisassemblySuspicious; //\n    resultBodyClass = 'result-suspicious-active'; //\n    resultScannerClass = 'result-suspicious'; //\n    resultProgressClass = 'progress-bar-yellow'; //\n    resultScoreClass = 'score-yellow'; //\n    recommendation = 'Be cautious. Only run if you trust the source.'; //\n  }\n\n  ensureAnimationWrapper();\n  bodyEl.classList.add(resultBodyClass); //\n\n  resultState.className = `scanner-state active ${resultScannerClass}`; //\n  resultIcon.className = `result-icon ${resultIconClass}`; //\n  resultText.textContent = scanResult.classification; //\n\n  let detailsText = `Scanned ${scanResult.detected_filename}.`;\n  if (scanResult.malware_family) {\n    detailsText = `Family: ${scanResult.malware_family}`;\n  }\n  resultDetails.textContent = detailsText;\n  resultFilename.textContent = scanResult.detected_filename; //\n\n  progressBarFill.className = 'progress-bar-fill'; //\n  scorePercentage.className = 'score-percentage'; //\n  progressBarFill.classList.add(resultProgressClass); //\n  const rawConfidence = Number(scanResult.confidence_score);\n  const confidenceValue = Number.isFinite(rawConfidence) ? rawConfidence * 100 : 0;\n  progressBarFill.style.width = `${confidenceValue}%`; //\n  scorePercentage.textContent = `${Math.round(confidenceValue)}%`; //\n  scorePercentage.classList.add(resultScoreClass); //\n\n  detailsReasoning.textContent = `Filetype: ${scanResult.key_findings.file_type}. Packer: ${scanResult.key_findings.packer_detected}.`; //\n  const hashData = scanResult.file_hashes || {};\n  detailsHashSha256.textContent = hashData.sha256 || 'Not available'; //\n  detailsHashMd5.textContent = hashData.md5 || 'Not available'; //\n  updateSystemIpDisplay();\n  detailsRecommendation.textContent = recommendation;\n\n  populateVendor(scanResult.vendor); //\n  populateSignature(scanResult.key_findings.signature); //\n  populateEntropyBars(scanResult.key_findings.section_entropy || []); //\n  populateKeyStrings(scanResult.key_findings.key_strings || [], scanResult.classification); //\n\n  populateDisassembly(resultMockDisassembly); //\n\n  const apiList = scanResult.key_findings.api_imports || [];\n  const graphData = generateGraphData(apiList, scanResult.classification);\n  drawCallGraph(graphData);\n}\n\nfunction renderNonPeResult(scanResult) {\n  removeAnimationClasses();\n  bodyEl.classList.add('is-non-pe');\n  resultState.className = 'scanner-state active';\n  resultIcon.className = 'result-icon fas fa-file';\n  resultText.textContent = '';\n  resultDetails.textContent = '';\n  resultFilename.textContent = '';\n\n  const hashData = scanResult.file_hashes || {};\n  nonPeFilename.textContent = scanResult.detected_filename || '';\n  nonPeHashSha256.textContent = hashData.sha256 || 'Not available';\n  nonPeHashMd5.textContent = hashData.md5 || 'Not available';\n\n  detailsHashSha256.textContent = hashData.sha256 || 'Not available';\n  detailsHashMd5.textContent = hashData.md5 || 'Not available';\n\n  nonPeResultWrapper.classList.add('active');\n\n  callGraphEl.innerHTML = '';\n  currentGraphLines.forEach(line => line.remove());\n  currentGraphLines = [];\n  entropyBarsContainer.innerHTML = '';\n  keyStringsContainer.innerHTML = '';\n}\n\n/**\n * Clears all dynamic result data to prepare for the next scan.\n */\nfunction clearResultData() {\n    // Clear scanner panel\n    resultText.textContent = '';\n    resultDetails.textContent = '';\n    resultFilename.textContent = '';\n    nonPeResultWrapper.classList.remove('active');\n    nonPeFilename.textContent = '';\n    nonPeHashSha256.textContent = '...';\n    nonPeHashMd5.textContent = '...';\n    bodyEl.classList.remove('is-non-pe');\n\n    // Clear analysis panel\n    progressBarFill.style.width = `0%`;\n    scorePercentage.textContent = `0%`;\n    detailsReasoning.textContent = '...';\n    detailsHashSha256.textContent = '...';\n    detailsHashMd5.textContent = '...';\n    if (detailsSystemIp) {\n        detailsSystemIp.textContent = 'Detecting...';\n    }\n    detailsRecommendation.textContent = '...';\n\n    // Clear vendor\n    detailsVendor.innerHTML = `\n        <h4>Vendor Analysis</h4>\n        <div class=\"vendor-info\">\n            <i class=\"fas fa-question-circle\"></i>\n            <span>Scanning...</span>\n        </div>`;\n    \n    // Clear signature\n    detailsSignature.innerHTML = `\n        <h4>Digital Signature</h4>\n        <div class=\"signature-info\">\n            <i class=\"fas fa-question-circle\"></i>\n            <span>Checking...</span>\n        </div>`;\n    \n    // Clear internals\n    entropyBarsContainer.innerHTML = '';\n    keyStringsContainer.innerHTML = '';\n    \n    // Clear graph\n    callGraphEl.innerHTML = '';\n    currentGraphLines.forEach(line => line.remove());\n    currentGraphLines = [];\n}\n\n// --- VENDOR UI FUNCTION (IMPLEMENTED) ---\nfunction populateVendor(vendor) {\n    if (!vendor) return;\n    const icon = vendor.icon || 'fas fa-question-circle'; //\n    const name = vendor.name || 'Unknown'; //\n    detailsVendor.innerHTML = `\n        <h4>Vendor Analysis</h4> <div class=\"vendor-info\"> <i class=\"${icon}\"></i>\n            <span>${name}</span>\n        </div>\n    `;\n}\n\n// --- SIGNATURE UI FUNCTION (IMPLEMENTED) ---\nfunction populateSignature(signature) {\n    if (!signature) return;\n    let icon = signature.icon || 'fas fa-question-circle';\n    let cssClass = `sig-${signature.level || 'unknown'}`; // 'sig-verified', 'sig-untrusted', 'sig-unknown'\n\n    detailsSignature.innerHTML = `\n        <h4>Digital Signature</h4> <div class=\"signature-info ${cssClass}\"> <i class=\"${icon}\"></i>\n            <span>${signature.name}</span>\n        </div>\n    `;\n}\n\n// --- ENTROPY BARS UI FUNCTION (IMPLEMENTED) ---\nfunction populateEntropyBars(sections) {\n    entropyBarsContainer.innerHTML = ''; // Clear old bars\n    if (!sections || sections.length === 0) {\n        entropyBarsContainer.innerHTML = '<p class=\"hash-text\">No PE sections found to analyze.</p>';\n        return;\n    }\n\n    sections.forEach(section => { //\n        const value = section.entropy; //\n        const width = (value / 8.0) * 100; // Entropy is 0-8\n        let cssClass = 'low';\n        \n        if (value > 6.0) cssClass = 'medium';\n        if (value > 7.0) cssClass = 'high';\n        if (value > 7.8) cssClass = 'packed'; // Match style.css\n\n        const row = document.createElement('div');\n        row.className = 'entropy-bar-row';\n        row.innerHTML = `\n            <span class=\"entropy-bar-label\">${section.name}</span> <div class=\"entropy-bar-bg\">\n                <div class=\"entropy-bar-fill ${cssClass}\" style=\"width: ${width}%\">\n                    <span class=\"entropy-bar-value\">${value.toFixed(2)}</span>\n                </div>\n            </div>\n        `;\n        entropyBarsContainer.appendChild(row);\n    });\n}\n\n// --- KEY STRINGS UI FUNCTION (IMPLEMENTED) ---\nfunction populateKeyStrings(strings, classification) {\n    keyStringsContainer.innerHTML = ''; // Clear old strings\n    if (!strings || strings.length === 0) {\n        keyStringsContainer.innerHTML = '<span class=\"key-string-tag\">No notable strings found.</span>';\n        return;\n    }\n    \n    const tagClass = classification.includes('Benign') ? 'benign' : 'suspicious'; //\n\n    strings.forEach(str => { //\n        const tag = document.createElement('span');\n        tag.className = `key-string-tag ${tagClass}`;\n        tag.textContent = str;\n        keyStringsContainer.appendChild(tag);\n    });\n}\n\nfunction updateSystemIpDisplay() {\n    if (!detailsSystemIp || !window.electronAPI || typeof window.electronAPI.getSystemIp !== 'function') {\n        return;\n    }\n\n    detailsSystemIp.textContent = 'Detecting...';\n\n    window.electronAPI.getSystemIp()\n        .then((ip) => {\n            if (!ip) {\n                detailsSystemIp.textContent = 'Unavailable';\n                return;\n            }\n\n            detailsSystemIp.textContent = ip;\n        })\n        .catch(() => {\n            detailsSystemIp.textContent = 'Unavailable';\n        });\n}\n\nfunction removeAnimationClasses() {\n    bodyEl.classList.remove('result-safe-active');\n    bodyEl.classList.remove('result-suspicious-active');\n    bodyEl.classList.remove('result-malware-active');\n}\n\n// --- Disassembly Functions ---\n\nfunction populateDisassembly(codeLines) {\n    disassemblyCodeEl.innerHTML = '';\n    codeLines.forEach((line, index) => {\n        const lineEl = document.createElement('span');\n        lineEl.className = 'disassembly-line';\n        lineEl.id = `line-${index}`;\n        lineEl.innerHTML = line;\n        disassemblyCodeEl.appendChild(lineEl);\n    });\n}\n\nfunction startDisassemblyAnimation() {\n    if (disassemblyInterval) {\n        clearInterval(disassemblyInterval);\n    }\n    let currentLine = 0;\n    const totalLines = disassemblyCodeEl.children.length;\n\n    disassemblyInterval = setInterval(() => {\n        const prevLine = document.querySelector('.disassembly-line.active');\n        if (prevLine) {\n            prevLine.classList.remove('active');\n        }\n\n        const lineEl = document.getElementById(`line-${currentLine}`);\n        if (lineEl) {\n            lineEl.classList.add('active');\n            lineEl.scrollIntoView({\n                behavior: 'smooth',\n                block: 'center',\n                inline: 'nearest'\n            });\n        }\n        currentLine = (currentLine + 1) % totalLines;\n    }, 150);\n}\n\n/**\n * This function was MOVED here from jsonsamples.js\n * Dynamically generates the graph data based on API imports.\n * @param {string[]} apiImports - Array of API names (e.g., ['CreateRemoteThread'])\n * @param {string} classification - 'Benign', 'Suspicious', or 'Malware'\n * @returns {object} A graph object with 'nodes' and 'edges' arrays.\n */\nfunction generateGraphData(apiImports, classification) {\n    let nodes = [];\n    let edges = [];\n    const nodeSpacing = 150;\n    const startY = 100;\n    const startX = 250;\n\n    // 1. Add the Main Entry Point node\n    nodes.push({ \n        id: 'main-entry', \n        label: 'main()', \n        class: 'node-entry', \n        pos: { top: `${startY + (apiImports.length / 2) * (nodeSpacing / 2)}px`, left: '50px' } \n    });\n\n    if (!apiImports || apiImports.length === 0) {\n        // Benign/Empty graph\n        nodes.push({ id: 'benign-1', label: 'ReadFile', class: 'node-std', pos: { top: `${startY}px`, left: `${startX}px` } });\n        nodes.push({ id: 'benign-2', label: 'WriteFile', class: 'node-std', pos: { top: `${startY + nodeSpacing / 2}px`, left: `${startX}px` } });\n        edges.push({ from: 'main-entry', to: 'benign-1', options: { color: '#888' } });\n        edges.push({ from: 'main-entry', to: 'benign-2', options: { color: '#888' } });\n    } else {\n        // Suspicious/Malware graph\n        apiImports.forEach((apiName, index) => {\n            let nodeClass = 'node-api'; // Default\n            let edgeColor = '#888'; // Default\n\n            if (classification === 'Malware') {\n                nodeClass = 'node-malicious';\n                edgeColor = '#e74c3c'; // Malware red\n            } else if (classification === 'Suspicious') {\n                nodeClass = 'node-suspicious';\n                edgeColor = '#f1c40f'; // Suspicious yellow\n            } else {\n                // Benign\n                nodeClass = 'node-std';\n                edgeColor = '#888';\n            }\n\n\n            const nodeId = `api-${index}`;\n            const yPos = startY + (index * (nodeSpacing-50)); // Make them a bit closer\n            const xPos = startX + (index % 2 === 0 ? 0 : 150); // Stagger them\n\n            // Add the API node\n            nodes.push({\n                id: nodeId,\n                label: apiName,\n                class: nodeClass,\n                pos: { top: `${yPos}px`, left: `${xPos}px` }\n            });\n\n            // Add the edge from main\n            edges.push({\n                from: 'main-entry',\n                to: nodeId,\n                options: { color: edgeColor }\n            });\n        });\n    }\n\n    return { nodes, edges };\n}\n\n// --- Graph Drawing ---\nfunction drawCallGraph(graphData) {\n    // 1. Clear previous graph (both nodes and lines)\n    callGraphEl.innerHTML = '';\n    currentGraphLines.forEach(line => line.remove());\n    currentGraphLines = [];\n\n    if (!graphData || !graphData.nodes || !graphData.edges) {\n        console.error(\"Invalid graph data received\", graphData);\n        return;\n    }\n\n    // 2. Create and place all nodes\n    graphData.nodes.forEach(node => {\n        const nodeEl = document.createElement('div');\n        nodeEl.id = node.id;\n        nodeEl.className = `graph-node ${node.class}`;\n        nodeEl.style.top = node.pos.top;\n        nodeEl.style.left = node.pos.left;\n        nodeEl.textContent = node.label;\n        callGraphEl.appendChild(nodeEl);\n    });\n\n    // 3. Draw all edges (must be done *after* nodes are in DOM)\n    // Use a slight timeout to ensure DOM is ready\n    setTimeout(() => {\n        graphData.edges.forEach(edge => {\n            try {\n                const line = new LeaderLine(\n                    document.getElementById(edge.from),\n                    document.getElementById(edge.to),\n                    {\n                        color: edge.options.color,\n                        path: edge.options.path || 'straight',\n                        startSocket: edge.options.startSocket || 'auto',\n                        endSocket: edge.options.endSocket || 'auto',\n                        endPlug: 'arrow1',\n                        size: 3,\n                        endPlugSize: 1.5,\n                    }\n                );\n                currentGraphLines.push(line);\n            } catch(e) {\n                console.error(\"Could not draw line:\", e);\n            }\n        });\n    }, 500); // 500ms timeout to let CSS fade-in finish\n}\n\n\n// --- History Panel Logic ---\nasync function loadHistory() {\n  if (!historyListEl) return;\n  \n  historyListEl.innerHTML = '<li class=\"history-item-loading\">Loading...</li>';\n\n  try {\n    const historyData = await window.electronAPI.getHistory();\n\n    if (!historyData || historyData.length === 0) {\n      historyListEl.innerHTML = '<li class=\"history-item-empty\">No scan history found.</li>';\n      return;\n    }\n\n    historyListEl.innerHTML = '';\n\n    historyData.forEach(scan => {\n      const li = document.createElement('li');\n      li.className = 'history-item';\n\n      // Determine classification icon\n      let statusIcon = 'fas fa-check-circle';\n      let classType = 'safe';\n      if (scan.classification.includes('Malware')) {\n        statusIcon = 'fas fa-bug';\n        classType = 'malware';\n      } else if (scan.classification.includes('Suspicious')) {\n        statusIcon = 'fas fa-exclamation-triangle';\n        classType = 'suspicious';\n      }\n\n      // Determine file type icon based on extension\n      const filename = scan.detected_filename || '';\n      const ext = filename.split('.').pop().toLowerCase();\n      let fileTypeIcon = 'fas fa-file';\n      \n      if (['exe', 'dll', 'sys', 'msi'].includes(ext)) {\n        fileTypeIcon = 'fas fa-cog'; // Executable\n      } else if (['jpg', 'jpeg', 'png', 'gif', 'bmp', 'svg', 'webp'].includes(ext)) {\n        fileTypeIcon = 'fas fa-image'; // Image\n      } else if (['js', 'ts', 'py', 'java', 'cpp', 'c', 'h', 'cs', 'go', 'rs', 'php', 'rb'].includes(ext)) {\n        fileTypeIcon = 'fas fa-code'; // Code\n      } else if (['pdf', 'doc', 'docx', 'txt', 'rtf', 'odt'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-alt'; // Document\n      } else if (['zip', 'rar', '7z', 'tar', 'gz', 'bz2'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-archive'; // Archive\n      } else if (['mp3', 'wav', 'ogg', 'flac', 'aac'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-audio'; // Audio\n      } else if (['mp4', 'avi', 'mkv', 'mov', 'wmv', 'flv'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-video'; // Video\n      } else if (['html', 'htm', 'css', 'xml', 'json'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-code'; // Web file\n      }\n\n      const scanDate = new Date(scan.scanDate).toLocaleString();\n      const hashSha256 = scan.file_hashes?.sha256 || 'N/A';\n      const hashDisplay = hashSha256.substring(0, 16) + '...'; // Show first 16 chars\n\n      li.innerHTML = `\n        <div class=\"history-icon-wrapper\">\n          <div class=\"history-icon ${classType}\">\n            <i class=\"${statusIcon}\"></i>\n          </div>\n          <div class=\"history-file-type\">\n            <i class=\"${fileTypeIcon}\"></i>\n          </div>\n        </div>\n        <div class=\"history-details\">\n          <span class=\"history-filename\" title=\"${filename}\">${filename}</span>\n          <span class=\"history-classification ${classType}\">${scan.classification}</span>\n          <span class=\"history-hash\" title=\"${hashSha256}\">SHA256: ${hashDisplay}</span>\n        </div>\n        <span class=\"history-date\">${scanDate}</span>\n      `;\n      \n      historyListEl.appendChild(li);\n    });\n\n  } catch (err) {\n    console.error('Failed to load history:', err);\n    historyListEl.innerHTML = '<li class=\"history-item-empty\">Error loading history.</li>';\n  }\n}\n\nfunction toggleHistoryPanel() {\n  bodyEl.classList.toggle('is-history-open');\n  \n  // ADD THIS: If we are opening the panel, load the history\n  if (bodyEl.classList.contains('is-history-open')) {\n    loadHistory();\n  }\n}\n\nhistoryBtn.addEventListener('click', (e) => {\n    e.preventDefault();\n    toggleHistoryPanel();\n});\nhistoryCloseBtn.addEventListener('click', toggleHistoryPanel);\nhistoryOverlay.addEventListener('click', toggleHistoryPanel);\n\n\n// --- Auto-scroll Logic ---\nfunction startScrolling(direction) {\n    if (scrollInterval) {\n        clearInterval(scrollInterval);\n    }\n    scrollInterval = setInterval(() => {\n        window.scrollBy(0, direction * 10); // 10 pixels at a time\n    }, 20); // every 20ms\n}\n\nfunction stopScrolling() {\n    clearInterval(scrollInterval);\n    scrollInterval = null;\n}\n\nscrollZoneTop.addEventListener('mouseenter', () => {\n    startScrolling(-1); // Scroll Up\n    scrollZoneTop.classList.add('scrolling');\n});\nscrollZoneTop.addEventListener('mouseleave', () => {\n    stopScrolling();\n    scrollZoneTop.classList.remove('scrolling');\n});\n\nscrollZoneBottom.addEventListener('mouseenter', () => {\n    startScrolling(1); // Scroll Down\n    scrollZoneBottom.classList.add('scrolling');\n});\nscrollZoneBottom.addEventListener('mouseleave', () => {\n    stopScrolling();\n    scrollZoneBottom.classList.remove('scrolling');\n});\n\n\n// --- Chart instances ---\nlet malwareTypesChart = null;\nlet topMalwareChart = null;\n\n// --- Function to create/recreate charts ---\nwindow.recreateCharts = function() {\n    // Check if light theme is active\n    const isLightTheme = document.body.classList.contains('light-theme');\n    \n    // Set colors based on theme\n    const chartLegendColor = isLightTheme ? '#6c757d' : '#e0e0e0';\n    const chartAxesColor = isLightTheme ? '#6c757d' : '#aaa';\n    const chartGridColor = isLightTheme ? '#dee2e6' : '#444444';\n\n    // Destroy existing charts if they exist\n    if (malwareTypesChart) {\n        malwareTypesChart.destroy();\n    }\n    if (topMalwareChart) {\n        topMalwareChart.destroy();\n    }\n\n    // Create Malware Types Chart (Doughnut)\n    const typesCtx = document.getElementById('malwareTypesChart');\n    if (typesCtx) {\n        malwareTypesChart = new Chart(typesCtx, {\n            type: 'doughnut',\n            data: {\n                labels: ['PE (exe/dll)', 'JavaScript', 'VBS', 'Macro', 'Other'],\n                datasets: [{\n                    label: 'Submission Types',\n                    data: [65, 15, 8, 7, 5],\n                    backgroundColor: [\n                        '#007bff', // Blue\n                        '#f1c40f', // Yellow\n                        '#e74c3c', // Red\n                        '#9b59b6', // Purple\n                        '#34495e'  // Gray\n                    ],\n                    borderColor: '#2a2a2e',\n                    borderWidth: 3,\n                }]\n            },\n            options: {\n                responsive: true,\n                plugins: {\n                    legend: {\n                        position: 'right',\n                        labels: {\n                            color: chartLegendColor,\n                            boxWidth: 20\n                        }\n                    }\n                }\n            }\n        });\n    }\n\n    // Create Top Malware Chart (Line)\n    const topMalwareCtx = document.getElementById('topMalwareChart');\n    if (topMalwareCtx) {\n        topMalwareChart = new Chart(topMalwareCtx, {\n            type: 'line',\n            data: {\n                labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5'],\n                datasets: [\n                    {\n                        label: 'Zeus',\n                        data: [120, 150, 130, 180, 160],\n                        borderColor: '#e74c3c',\n                        backgroundColor: '#e74c3c20',\n                        fill: true,\n                        tension: 0.4\n                    },\n                    {\n                        label: 'WannaCry',\n                        data: [80, 90, 110, 100, 130],\n                        borderColor: '#007bff',\n                        backgroundColor: '#007bff20',\n                        fill: true,\n                        tension: 0.4\n                    },\n                    {\n                        label: 'Emotet',\n                        data: [50, 60, 80, 70, 90],\n                        borderColor: '#f1c40f',\n                        backgroundColor: '#f1c40f20',\n                        fill: true,\n                        tension: 0.4\n                    }\n                ]\n            },\n            options: {\n                responsive: true,\n                plugins: {\n                    legend: {\n                        labels: {\n                            color: chartLegendColor\n                        }\n                    }\n                },\n                scales: {\n                    x: {\n                        ticks: { color: chartAxesColor },\n                        grid: { color: chartGridColor + '50' }\n                    },\n                    y: {\n                        ticks: { color: chartAxesColor },\n                        grid: { color: chartGridColor }\n                    }\n                }\n            }\n        });\n    }\n};\n\n// --- NAVIGATION FUNCTIONS ---\nfunction updateNavigationButtons() {\n    const prevBtn = document.getElementById('prev-scan-btn');\n    const nextBtn = document.getElementById('next-scan-btn');\n    const navInfo = document.getElementById('nav-info');\n    \n    if (!prevBtn || !nextBtn) return;\n    \n    // Disable/enable buttons based on position\n    prevBtn.disabled = currentHistoryIndex <= 0;\n    nextBtn.disabled = currentHistoryIndex >= scanHistory.length - 1;\n    \n    // Update info text\n    if (navInfo && scanHistory.length > 0) {\n        navInfo.textContent = `${currentHistoryIndex + 1} of ${scanHistory.length}`;\n    }\n}\n\nfunction showPreviousScan() {\n    if (currentHistoryIndex > 0) {\n        currentHistoryIndex--;\n        lastScanResult = scanHistory[currentHistoryIndex];\n        renderScanResult();\n        updateNavigationButtons();\n    }\n}\n\nfunction showNextScan() {\n    if (currentHistoryIndex < scanHistory.length - 1) {\n        currentHistoryIndex++;\n        lastScanResult = scanHistory[currentHistoryIndex];\n        renderScanResult();\n        updateNavigationButtons();\n    }\n}\n\n// Initialize history from electron-store on load\nasync function initializeScanHistory() {\n    try {\n        const storedHistory = await window.electronAPI.getHistory();\n        if (storedHistory && Array.isArray(storedHistory)) {\n            scanHistory = storedHistory;\n            currentHistoryIndex = scanHistory.length - 1;\n        }\n    } catch (error) {\n        console.error('Failed to load scan history:', error);\n    }\n}\n\n// --- Run on Page Load ---\ndocument.addEventListener('DOMContentLoaded', () => {\n    // 1. Animate Stat Cards\n    const statNumbers = document.querySelectorAll('.stat-number');\n    statNumbers.forEach(stat => {\n        const target = +stat.getAttribute('data-target');\n        const duration = 2000;\n        const stepTime = 20;\n        const steps = duration / stepTime;\n        const increment = target / steps;\n        let current = 0;\n\n        const updateCount = () => {\n            current += increment;\n            if (current < target) {\n                stat.textContent = Math.ceil(current).toLocaleString();\n                setTimeout(updateCount, stepTime);\n            } else {\n                stat.textContent = target.toLocaleString();\n            }\n        };\n        updateCount();\n    });\n\n    // 2. Create the charts\n    recreateCharts();\n    \n    // 3. Initialize scan history\n    initializeScanHistory();\n    \n    // 4. Setup navigation button handlers\n    const prevBtn = document.getElementById('prev-scan-btn');\n    const nextBtn = document.getElementById('next-scan-btn');\n    \n    if (prevBtn) prevBtn.addEventListener('click', showPreviousScan);\n    if (nextBtn) nextBtn.addEventListener('click', showNextScan);\n});\n","range":{"startLineNumber":1,"startColumn":1,"endLineNumber":958,"endColumn":1}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/index.html","external":"file:///home/trang/localnsv/mAIware/index.html","path":"/home/trang/localnsv/mAIware/index.html","scheme":"file"},"requestId":"request_0bd3737c-96a7-45c8-bdaa-69c39a73dfda","epoch":161,"edits":[{"text":"<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>mAIware AI Malware Detection Demo</title>\n    <!-- Font Awesome for icons (which you already had) -->\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css\">\n    <!-- Chart.js for stats (which you already had) -->\n    <script src=\"https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js\"></script>\n    <!-- QRCode.js for QR generation -->\n    <script src=\"https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js\"></script>\n    <!-- Link to the CSS file -->\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n\n<body>\n    <nav class=\"top-nav\">\n        <div class=\"logo\"> <i class=\"fas fa-shield-virus\"></i> <span>mAIware</span> </div>\n        <div class=\"nav-links\"> <a href=\"#\" class=\"nav-link\" data-tooltip=\"Login\"><i class=\"fas fa-sign-in-alt\"></i><span class=\"link-text\">Login</span></a> <a href=\"#\" class=\"nav-link\" data-tooltip=\"Sign Up\"><i class=\"fas fa-user-plus\"></i><span class=\"link-text\">Sign Up</span></a> <a href=\"#\" class=\"nav-link\" data-tooltip=\"Community\"><i class=\"fas fa-users\"></i><span class=\"link-text\">Community</span></a> <a href=\"#\" class=\"nav-link\" data-tooltip=\"API Docs\"><i class=\"fas fa-code\"></i><span class=\"link-text\">API</span></a> <a href=\"#\" id=\"history-btn\" class=\"nav-link\" data-tooltip=\"Scan History\"><i class=\"fas fa-history\"></i><span class=\"link-text\">History</span></a> <a href=\"#\" class=\"nav-link\" id=\"theme-toggle\" data-tooltip=\"Toggle Theme\"> <i class=\"fas fa-sun\"></i> </a> </div>\n    </nav>\n\n    <main class=\"main-container\">\n        <!-- Column 1 -->\n        <div class=\"scanner-wrapper\">\n            <!-- Main Scanner Box -->\n            <div class=\"scanner-container\">\n                <h1>AI Malware Detection</h1>\n                \n                <!-- Navigation Controls (Top Position) -->\n                <div class=\"scan-navigation scan-navigation-top\">\n                    <button id=\"prev-scan-btn\" class=\"nav-btn\" disabled>\n                        <i class=\"fas fa-chevron-left\"></i> Previous\n                    </button>\n                    <span id=\"nav-info\" class=\"nav-info\">1 of 1</span>\n                    <button id=\"next-scan-btn\" class=\"nav-btn\" disabled>\n                        Next <i class=\"fas fa-chevron-right\"></i>\n                    </button>\n                </div>\n                \n                <!-- State 1: Initial -->\n                <div id=\"initial-state\" class=\"scanner-state active\">\n                    <p>Watching your Downloads folder for new files...</p>\n                    <div id=\"drop-zone\" class=\"upload-zone\"> <i class=\"upload-icon fas fa-eye\"></i>\n                        <h3>Automatic Scanning Active</h3>\n                        <span>(Download a file to begin)</span>\n                    </div>\n                </div>\n\n                <!-- State 2: Analyzing -->\n                <div id=\"analyzing-state\" class=\"scanner-state\">\n                    <div class=\"analyzing-icon\">\n                        <div class=\"loader\"></div>\n                    </div>\n                    <h3>Analyzing...</h3> <span class=\"filename\" id=\"analyzing-filename\">demo_file.exe</span> </div>\n\n                <!-- State 3: Result -->\n                <div id=\"result-state\" class=\"scanner-state\"> <i class=\"result-icon\" id=\"result-icon\"></i>\n                    <h2 id=\"result-text\"></h2>\n                    <div class=\"filename\" id=\"result-filename\"></div>\n                    <p id=\"result-details\"></p>\n                    <!-- Removed the resetDemo() button as it's automatic now -->\n                </div>\n                <div id=\"non-pe-result\" class=\"scanner-state non-pe-result\">\n                    <div class=\"non-pe-icon\"><i class=\"fas fa-file\"></i></div>\n                    <h2 id=\"non-pe-title\">File is not a Windows PE executable</h2>\n                    <p class=\"filename\" id=\"non-pe-filename\"></p>\n                    <div class=\"non-pe-hash-grid\">\n                        <div class=\"non-pe-hash\">\n                            <h4>SHA256</h4>\n                            <p id=\"non-pe-hash-sha256\">...</p>\n                        </div>\n                        <div class=\"non-pe-hash\">\n                            <h4>MD5</h4>\n                            <p id=\"non-pe-hash-md5\">...</p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Analysis Details (Shows on result) -->\n            <div class=\"analysis-details-container\" id=\"analysis-details-wrapper\">\n                <div class=\"progress-header\">\n                    <h3>Malware Confidence</h3> <span class=\"score-percentage\" id=\"score-percentage\">0%</span> </div>\n                <div class=\"progress-bar-background\">\n                    <div class=\"progress-bar-fill\" id=\"progress-bar-fill\" style=\"width: 0%;\"></div>\n                </div>\n\n                <!-- This grid holds Vendor and Signature -->\n                <div class=\"details-grid\">\n                    <!-- Vendor UI Container -->\n                    <div class=\"details-section\" id=\"details-vendor\">\n                        <h4>Vendor Analysis</h4>\n                        <div class=\"vendor-info\">\n                            <i class=\"fas fa-question-circle\"></i>\n                            <span>Scanning...</span>\n                        </div>\n                    </div>\n                    <!-- Signature UI Container -->\n                    <div class=\"details-section\" id=\"details-signature\">\n                        <h4>Digital Signature</h4>\n                        <div class=\"signature-info\">\n                            <i class=\"fas fa-question-circle\"></i>\n                            <span>Checking...</span>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Reasoning (File Type/Packer) -->\n                <div class=\"details-section\">\n                    <h4>Key Findings</h4>\n                    <p id=\"details-reasoning\">...</p>\n                </div>\n                \n                <div class=\"details-section\">\n                    <h4>SHA256 Hash</h4>\n                    <p class=\"hash-text\" id=\"details-hash-sha256\">...</p>\n                </div>\n\n                <div class=\"details-section\">\n                    <h4>MD5 Hash</h4>\n                    <p class=\"hash-text\" id=\"details-hash-md5\">...</p>\n                </div>\n\n                <div class=\"details-section\">\n                    <h4>System IP</h4>\n                    <p class=\"hash-text\" id=\"details-system-ip\">Detecting...</p>\n                </div>\n\n                <!-- QR Code for PE results -->\n                <div class=\"details-section qr-section\" id=\"qr-section\" style=\"display:none;\">\n                    <h4>Scan Report QR</h4>\n                    <div id=\"qr-code\" class=\"qr-code-wrapper\"></div>\n                </div>\n\n                <div class=\"details-section\">\n                    <h4>What To Do Next</h4>\n                    <p id=\"details-recommendation\">...</p>\n                </div>\n\n                <div class=\"btn-wrapper\"> <button class=\"btn btn-primary\"><i class=\"fas fa-download\"></i> Download Report</button> <button class=\"btn btn-secondary\"><i class=\"fas fa-flag\"></i> Report False Positive</button> </div>\n            </div>\n        </div>\n\n        <!-- Column 2 -->\n        <div class=\"right-panel-wrapper\">\n            <!-- Stats (Shows on initial) -->\n            <div class=\"stats-wrapper\" id=\"stats-wrapper\">\n                <div class=\"stats-grid\">\n                    <div class=\"stat-card\"> <i class=\"fas fa-virus-slash\"></i>\n                        <div class=\"stat-content\"> <span class=\"stat-number\" data-target=\"14720938\">0</span> <span class=\"stat-label\">Malware Analyzed</span> </div>\n                    </div>\n                    <div class=\"stat-card\"> <i class=\"fas fa-users\"></i>\n                        <div class=\"stat-content\"> <span class=\"stat-number\" data-target=\"82041\">0</span> <span class=\"stat-label\">Active Users</span> </div>\n                    </div>\n                    <div class=\"stat-card\"> <i class=\"fas fa-chart-line\"></i>\n                        <div class=\"stat-content\"> <span class=\"stat-number\" data-target=\"1259024\">0</span> <span class=\"stat-label\">Site Visits (24h)</span> </div>\n                    </div>\n                </div>\n                <div class=\"chart-container-wrapper\">\n                    <div class=\"chart-container\">\n                        <h3>Top 5 Malware Families (30 Days)</h3> <canvas id=\"topMalwareChart\"></canvas> </div>\n                    <div class=\"chart-container\">\n                        <h3>Submission Types</h3> <canvas id=\"malwareTypesChart\"></canvas> </div>\n                </div>\n            </div>\n\n            <!-- Disassembly (Shows on analyzing/result) -->\n            <div class=\"disassembly-wrapper\" id=\"disassembly-wrapper\">\n                <div class=\"disassembly-header\">\n                    <h3>Disassembly: <span id=\"disassembly-filename\"></span></h3>\n                </div>\n                <div class=\"disassembly-code\" id=\"disassembly-code\"> </div>\n            </div>\n\n            <!-- File Internals (Shows on result) -->\n            <div class=\"file-internals-container\" id=\"file-internals-wrapper\">\n                <h3>File Internals</h3>\n                \n                <!-- Entropy UI Container -->\n                <div class=\"details-section\">\n                    <h4>Section Entropy (0=Normal, 8=Packed/Encrypted)</h4>\n                    <div class=\"entropy-bars\" id=\"entropy-bars-container\">\n                        <!-- JS will populate this -->\n                    </div>\n                </div>\n                \n                <!-- Key Strings UI Container -->\n                <div class=\"details-section\">\n                    <h4>Suspicious / Key Strings</h4>\n                    <div class=\"key-strings\" id=\"key-strings-container\">\n                        <!-- JS will populate this -->\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Full Width Row -->\n        <div class=\"graph-wrapper\" id=\"graph-wrapper\">\n            <div class=\"graph-header\">\n                <h3>Dynamic Function Call Graph (Simulation)</h3>\n            </div>\n            <div class=\"call-graph-container\">\n                <div class=\"call-graph\" id=\"call-graph\">\n                    <!-- JS will populate this -->\n                </div>\n            </div>\n        </div>\n    </main>\n\n    <!-- History Panel (Hidden by default) -->\n    <div class=\"history-overlay\" id=\"history-overlay\"></div>\n    <div class=\"history-panel\" id=\"history-panel\">\n        <div class=\"history-header\">\n            <h3>Scan History</h3> <button class=\"history-close-btn\" id=\"history-close-btn\"><i class=\"fas fa-times\"></i></button> </div>\n        <ul class=\"history-list\">\n            <!-- JS would populate this -->\n        </ul>\n    </div>\n\n    <!-- Scroll Zones -->\n    <div class=\"scroll-zone top\" id=\"scroll-zone-top\"><i class=\"fas fa-chevron-up\"></i></div>\n    <div class=\"scroll-zone bottom\" id=\"scroll-zone-bottom\"><i class=\"fas fa-chevron-down\"></i></div>\n    \n    <!-- LeaderLine for graph (which you already had) -->\n    <script src=\"https://cdn.jsdelivr.net/npm/leader-line-new@1.1.9/leader-line.min.js\"></script>\n    <!-- Link to the JS file -->\n    <script src=\"script.js\"></script>\n\n    <script>\n    // Apply saved theme class immediately (before DOMContentLoaded)\n    const savedTheme = localStorage.getItem('theme') || 'dark';\n    if (savedTheme === 'light') {\n        document.body.classList.add('light-theme');\n    }\n    \n    document.addEventListener('DOMContentLoaded', () => {\n        const themeToggleButton = document.getElementById('theme-toggle');\n        const body = document.body;\n        const themeIcon = themeToggleButton.querySelector('i');\n\n        // Set icon based on current theme\n        if (body.classList.contains('light-theme')) {\n            themeIcon.classList.remove('fa-sun');\n            themeIcon.classList.add('fa-moon');\n        }\n\n        // Function to apply the saved theme\n        const applyTheme = (theme) => {\n            if (theme === 'light') {\n                body.classList.add('light-theme');\n                themeIcon.classList.remove('fa-sun');\n                themeIcon.classList.add('fa-moon');\n            } else {\n                body.classList.remove('light-theme');\n                themeIcon.classList.remove('fa-moon');\n                themeIcon.classList.add('fa-sun');\n            }\n            \n            // Recreate charts with updated theme colors\n            if (window.recreateCharts) {\n                window.recreateCharts();\n            }\n        };\n\n        // Add click event for the toggle button\n        themeToggleButton.addEventListener('click', (e) => {\n            e.preventDefault(); // Stop the link from navigating\n            \n            // Check current theme\n            const isLightTheme = body.classList.contains('light-theme');\n            \n            // Set new theme\n            const newTheme = isLightTheme ? 'dark' : 'light';\n            \n            // Apply the new theme\n            applyTheme(newTheme);\n            \n            // Save the new theme to localStorage\n            localStorage.setItem('theme', newTheme);\n        });\n    });\n    </script>\n</body>\n</html>\n","range":{"startLineNumber":1,"startColumn":1,"endLineNumber":288,"endColumn":1}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/style.css","external":"file:///home/trang/localnsv/mAIware/style.css","path":"/home/trang/localnsv/mAIware/style.css","scheme":"file"},"requestId":"request_0bd3737c-96a7-45c8-bdaa-69c39a73dfda","epoch":164,"edits":[{"text":"/* --- Global & Fonts --- */\n:root {\n    /* --- Dark Theme (Default) --- */\n    --bg-dark-1: #121212;\n    --bg-dark-2: #1e1e1e;\n    --bg-dark-3: #2a2a2e;\n    --bg-dark-4: #333333;\n    --border-color: #444444;\n    --text-light: #e0e0e0;\n    --text-medium: #aaa;\n    --text-dark: #888;\n    \n    /* --- Semantic Colors --- */\n    --blue: #007bff;\n    --red: #e74c3c;\n    --yellow: #f1c40f;\n    --green: #2ecc71;\n    \n    /* --- Syntax & Node Colors --- */\n    --syntax-op: #c39eff;\n    --syntax-string: #e6db74;\n    --syntax-const-text: #ffffff; /* Constant white for dark buttons/nodes */\n    --node-bg-entry: #254a25;\n    --node-bg-api: #2a3e4a;\n    --node-bg-suspicious: #4a452a;\n    --node-bg-malicious: #4a2a2a;\n\n    --chart-legend-text: var(--text-light);  /* #e0e0e0 */\n    --chart-axes-text: var(--text-medium);   /* #aaa */\n    --chart-grid-line: var(--border-color);\n}\n\n/* --- Light Theme --- */\n/* Add \".light-theme\" to the <body> tag to activate */\nbody.light-theme {\n    --bg-dark-1: #f8f9fa;     /* Main background */\n    --bg-dark-2: #ffffff;     /* Card background */\n    --bg-dark-3: #e9ecef;     /* Hover/active background */\n    --bg-dark-4: #ced4da;     /* Secondary button background */\n    --border-color: #dee2e6;  /* Border color */\n    --text-light: #212529;    /* Main text */\n    --text-medium: #6c757d;   /* Secondary text */\n    --text-dark: #888;        /* Tertiary text (can stay gray) */\n    \n    /* Semantic colors are unchanged */\n    /* --blue, --red, --yellow, --green */\n    \n    /* --- Light Theme Syntax --- */\n    --syntax-op: #a040ff;       /* Darker purple */\n    --syntax-string: #b8860b;     /* Dark goldenrod */\n    --syntax-const-text: #ffffff; /* Stays white for colored buttons/nodes */\n    \n    /* Node backgrounds are unchanged, they look good on a light BG */\n    --chart-legend-text: var(--text-medium); /* User Request */\n    --chart-axes-text: var(--text-medium);   /* User Request */\n    --chart-grid-line: var(--border-color);\n}\n\n\n/* Apply overflow-x to html as well */\nhtml {\n    overflow-x: hidden;\n    font-size: 16px; /* Ensure base font size */\n}\n\nbody {\n    font-family: -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Helvetica, Arial, sans-serif;\n    background-color: var(--bg-dark-1);\n    color: var(--text-light);\n    margin: 0;\n    padding-top: 60px; /* Make space for fixed top nav */\n    overflow-x: hidden; /* Prevent horizontal scroll */\n    width: 100%;\n    min-height: 100vh;\n}\n\n/* --- Main Grid Container --- */\n.main-container {\n    display: grid;\n    grid-template-columns: 1fr 1fr; /* Simpler 2-column definition */\n    grid-template-rows: auto auto; /* Rows for content and graph */\n    gap: 2rem;\n    padding: 2rem; /* Spacing from nav and screen edges */\n    align-items: start;\n    \n    /* Set max-width on the grid itself */\n    max-width: 1400px; \n    /* Center the whole grid */\n    margin: 0 auto; \n    \n    min-height: calc(100vh - 60px); /* Full height minus nav */\n    box-sizing: border-box;\n    width: 100%;\n}\n\n.scanner-wrapper {\n    grid-column: 1 / 2; /* Span first column */\n    grid-row: 1 / 2;\n    display: flex;\n    flex-direction: column;\n    gap: 1.5rem;\n    width: 100%; /* Fill the column */\n}\n\n.right-panel-wrapper {\n    grid-column: 2 / 3; /* Span second column */\n    grid-row: 1 / 2;\n    display: flex; /* Make it a flex container */\n    flex-direction: column; /* Stack its children vertically */\n    gap: 1.5rem; /* Space between its children */\n    width: 100%; /* Fill the column */\n}\n\n.graph-wrapper {\n    grid-column: 1 / 3; /* Span BOTH columns */\n    grid-row: 2 / 3;\n    width: 100%;\n    /* max-width is now inherited from main-container */\n    justify-self: center; /* Center in the grid area */\n}\n\n\n/* --- Top Navigation --- */\n.top-nav {\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    height: 60px;\n    background-color: var(--bg-dark-2);\n    border-bottom: 1px solid var(--border-color);\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 0 2rem;\n    z-index: 1000;\n    box-sizing: border-box;\n}\n\n.top-nav .logo {\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n    font-size: 1.3rem;\n    font-weight: 600;\n    color: var(--text-light);\n}\n\n.top-nav .logo i {\n    color: var(--blue);\n}\n\n.nav-links {\n    display: flex;\n    gap: 0.5rem;\n}\n\n.nav-link {\n    color: var(--text-medium);\n    font-size: 1.25rem;\n    padding: 0.75rem;\n    border-radius: 8px;\n    transition: all 0.2s ease;\n    position: relative;\n    text-decoration: none;\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n}\n\n.nav-link .link-text {\n    font-size: 0.9rem;\n    font-weight: 500;\n    max-width: 0;\n    overflow: hidden;\n    white-space: nowrap;\n    transition: all 0.3s ease;\n}\n\n.nav-link:hover {\n    background-color: var(--bg-dark-3);\n    color: var(--text-light);\n}\n\n.nav-link:hover .link-text {\n    max-width: 80px; /* Expand text on hover */\n    margin-left: 0.25rem;\n}\n\n/* --- Tooltip --- */\n.nav-link:hover::before {\n    content: attr(data-tooltip);\n    position: absolute;\n    bottom: -35px;\n    left: 50%;\n    transform: translateX(-50%);\n    background-color: var(--bg-dark-3);\n    color: var(--text-light);\n    padding: 5px 10px;\n    border-radius: 4px;\n    font-size: 0.8rem;\n    white-space: nowrap;\n    opacity: 0;\n    transition: opacity 0.2s 0.3s; /* Delay tooltip */\n    pointer-events: none;\n}\n.nav-link:hover .link-text {\n    display: none; /* Hide expanded text if tooltip is showing */\n}\n.nav-link:hover:hover::before {\n    opacity: 1;\n}\n\n/* On smaller screens, stack the columns */\n@media (max-width: 1280px) { /* Widened breakpoint */\n    .main-container {\n        grid-template-columns: 1fr; /* Stack columns */\n        padding: 1rem;\n    }\n    .scanner-wrapper, .right-panel-wrapper, .graph-wrapper {\n        grid-column: 1 / 2; /* All in one column */\n        max-width: 100%;\n        justify-self: center;\n    }\n    .right-panel-wrapper {\n        grid-row: 2 / 3;\n    }\n    .graph-wrapper {\n        grid-row: 3 / 4;\n    }\n}\n\n/* Hide link text on very small screens */\n@media (max-width: 768px) {\n    .nav-link .link-text { display: none; }\n    .nav-link:hover .link-text { display: none; }\n    .top-nav { padding: 0 1rem; }\n}\n\n\n/* --- Main Scanner Box --- */\n.scanner-container {\n    width: 100%; /* Ensure it fills its flex parent */\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n    padding: 2.5rem;\n    text-align: center;\n    overflow: hidden;\n    transition: all 0.3s ease;\n    box-sizing: border-box; /* Include padding in width */\n}\n\nh1 {\n    color: var(--text-light);\n    margin-top: 0;\n    margin-bottom: 1rem;\n}\n\n.scanner-container p {\n    color: var(--text-medium);\n    margin-bottom: 2rem;\n    font-size: 1.1rem;\n}\n\n.scanner-state {\n    display: none;\n}\n.scanner-state.active {\n    display: block;\n}\n\n/* --- State 1: Upload --- */\n.upload-zone {\n    border: 2px dashed var(--border-color);\n    border-radius: 8px;\n    padding: 3rem 2rem;\n    cursor: pointer;\n    transition: all 0.3s ease;\n}\n.upload-zone:hover {\n    background-color: var(--bg-dark-3);\n    border-color: var(--blue);\n}\n.upload-icon {\n    font-size: 4rem;\n    color: var(--blue);\n    margin-bottom: 1rem;\n}\n.upload-zone h3 {\n    margin: 0;\n    color: var(--text-light);\n}\n.upload-zone span {\n    color: var(--text-dark);\n}\n\n/* --- State 2: Analyzing --- */\n.analyzing-icon .loader {\n    width: 80px;\n    height: 80px;\n    border: 6px solid var(--bg-dark-4);\n    border-top-color: var(--blue);\n    border-radius: 50%;\n    animation: spin 1s linear infinite;\n    margin: 2rem auto;\n}\n@keyframes spin {\n    to { transform: rotate(360deg); }\n}\n.analyzing-state h3 {\n    color: var(--text-light);\n    margin-bottom: 0.5rem;\n}\n.analyzing-state .filename,\n.result-state .filename {\n    color: var(--text-medium);\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 1.1rem;\n    word-break: break-all;\n}\n\n/* --- State 3: Result --- */\n.result-icon {\n    font-size: 6rem;\n    line-height: 1;\n    margin: 1.5rem 0;\n}\n.result-state h2 {\n    font-size: 2.5rem;\n    margin: 0 0 0.5rem 0;\n}\n.result-malware .result-icon, .result-malware h2 { color: var(--red); }\n.result-suspicious .result-icon, .result-suspicious h2 { color: var(--yellow); }\n.result-safe .result-icon, .result-safe h2 { color: var(--green); }\n.result-state p {\n    font-size: 1rem;\n    margin-bottom: 2rem;\n}\n\n/* --- Scan Navigation Controls --- */\n.scan-navigation {\n    display: none;\n    align-items: center;\n    justify-content: center;\n    gap: 1.5rem;\n    margin: 1.5rem 0;\n    padding: 1rem;\n    background: rgba(255, 255, 255, 0.03);\n    border-radius: 8px;\n}\n\n/* Show navigation only when results are displayed */\nbody.is-showing-result .scan-navigation,\nbody.is-non-pe .scan-navigation {\n    display: flex;\n}\n\n.nav-btn {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    padding: 0.75rem 1.5rem;\n    background: linear-gradient(135deg, var(--primary), var(--secondary));\n    color: white;\n    border: none;\n    border-radius: 8px;\n    font-size: 1rem;\n    font-weight: 600;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    box-shadow: 0 4px 12px rgba(139, 92, 246, 0.3);\n}\n\n.nav-btn:hover:not(:disabled) {\n    transform: translateY(-2px);\n    box-shadow: 0 6px 20px rgba(139, 92, 246, 0.5);\n}\n\n.nav-btn:active:not(:disabled) {\n    transform: translateY(0);\n}\n\n.nav-btn:disabled {\n    background: rgba(255, 255, 255, 0.1) !important;\n    color: rgba(255, 255, 255, 0.3) !important;\n    cursor: not-allowed;\n    box-shadow: none !important;\n}\n\n.nav-info {\n    color: var(--text-medium);\n    font-size: 0.95rem;\n    font-weight: 500;\n    min-width: 80px;\n    text-align: center;\n}\n\n.non-pe-result {\n    display: none;\n    flex-direction: column;\n    align-items: center;\n    gap: 1.5rem;\n    color: var(--text-light);\n    padding: 1rem 0 0 0;\n}\n\n.non-pe-result.active {\n    display: flex;\n}\n\n.non-pe-icon {\n    width: 96px;\n    height: 96px;\n    border-radius: 24px;\n    background: linear-gradient(135deg, rgba(80, 130, 255, 0.2), rgba(80, 130, 255, 0.05));\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-size: 3rem;\n    color: var(--blue);\n}\n\n.non-pe-hash-grid {\n    display: flex;\n    gap: 1.5rem;\n    flex-wrap: wrap;\n    justify-content: center;\n}\n\n.non-pe-hash {\n    min-width: 220px;\n    background: var(--bg-dark-3);\n    padding: 1rem 1.25rem;\n    border-radius: 12px;\n    border: 1px solid rgba(255, 255, 255, 0.05);\n    text-align: left;\n}\n\n.non-pe-hash h4 {\n    margin: 0 0 0.5rem 0;\n    font-size: 0.85rem;\n    text-transform: uppercase;\n    letter-spacing: 0.08rem;\n    color: var(--text-medium);\n}\n\n.non-pe-hash p {\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.9rem;\n    word-break: break-all;\n    color: var(--text-light);\n}\n\nbody.is-non-pe .analysis-details-container,\nbody.is-non-pe #analysis-details-wrapper,\nbody.is-non-pe #disassembly-wrapper,\nbody.is-non-pe #file-internals-wrapper,\nbody.is-non-pe #graph-wrapper {\n    display: none !important;\n}\n\nbody.is-non-pe #result-state {\n    display: none !important;\n}\n\nbody.is-non-pe .non-pe-result {\n    display: flex;\n}\n\n\n/* --- NEW: Stats Dashboard Panel --- */\n.stats-wrapper {\n    display: flex; \n    flex-direction: column;\n    gap: 1.5rem;\n    width: 100%; /* Fill its flex parent */\n    box-sizing: border-box; /* Include padding in width */\n}\n\n/* By default, stats are visible, disassembly is hidden */\n.disassembly-wrapper { display: none; }\n\n/* When analyzing/showing results, hide stats and show disassembly */\nbody.is-analyzing .stats-wrapper,\nbody.is-showing-result .stats-wrapper {\n    display: none;\n}\nbody.is-analyzing .disassembly-wrapper,\nbody.is-showing-result .disassembly-wrapper {\n    display: flex; /* Use flex to match its own styles */\n}\n\n\n.stats-grid {\n    display: flex; \n    flex-direction: column;\n    /* Force stacking */\n    gap: 1.5rem;\n}\n\n.stat-card {\n    display: flex;\n    align-items: center;\n    gap: 1.5rem;\n    background-color: var(--bg-dark-2);\n    padding: 1.5rem;\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n}\n.stat-card i {\n    font-size: 2.5rem;\n    color: var(--blue);\n}\n.stat-content {\n    display: flex;\n    flex-direction: column;\n}\n.stat-number {\n    font-size: 2rem;\n    font-weight: 600;\n    color: var(--text-light);\n    line-height: 1.2;\n}\n.stat-label {\n    font-size: 0.9rem;\n    color: var(--text-medium);\n}\n\n.chart-container-wrapper {\n    display: flex;\n    flex-direction: column;\n    gap: 1.5rem;\n}\n\n.chart-container {\n    background-color: var(--bg-dark-2);\n    padding: 1.5rem;\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    box-sizing: border-box;\n}\n.chart-container h3 {\n    margin-top: 0;\n    margin-bottom: 1.5rem;\n    text-align: center;\n    color: var(--text-light);\n    font-size: 1.1rem;\n}\n\n\n/* --- Disassembly Panel --- */\n.disassembly-wrapper {\n    /* display: none; set by default now */\n    flex-direction: column;\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n    height: 600px; /* Fixed height */\n    max-height: 70vh;\n    opacity: 0;\n    transition: all 0.3s ease;\n    width: 100%;\n    box-sizing: border-box;\n}\n\nbody.is-analyzing .disassembly-wrapper,\nbody.is-showing-result .disassembly-wrapper {\n    opacity: 1;\n}\n\n.disassembly-header {\n    padding: 1rem 1.5rem;\n    border-bottom: 1px solid var(--border-color);\n    background-color: var(--bg-dark-3);\n    border-radius: 12px 12px 0 0;\n}\n.disassembly-header h3 {\n    margin: 0;\n    color: var(--text-light);\n    font-size: 1.1rem;\n    font-family: 'Courier New', Courier, monospace;\n}\n.disassembly-code {\n    flex-grow: 1;\n    overflow-y: auto;\n    padding: 1rem;\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.95rem;\n}\n.disassembly-line {\n    display: block;\n    padding: 2px 1rem;\n    border-radius: 4px;\n    transition: background-color 0.2s ease;\n}\n.disassembly-line.active {\n    background-color: var(--blue);\n    color: var(--syntax-const-text); /* MODIFIED */\n}\n.disassembly-line .addr { color: var(--text-dark); margin-right: 1rem; }\n.disassembly-line .op { color: var(--syntax-op); font-weight: bold; width: 50px; display: inline-block; } /* MODIFIED */\n.disassembly-line .args { color: var(--text-light); }\n.disassembly-line .string { color: var(--syntax-string); } /* MODIFIED */\n.disassembly-line .comment { color: var(--green); margin-left: 1rem; }\n\n\n/* --- Analysis Details Panel --- */\n.analysis-details-container {\n    width: 100%;\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    padding: 2rem;\n    display: none; /* Hidden by default */\n    box-sizing: border-box;\n}\nbody.is-showing-result .analysis-details-container {\n    display: block;\n}\n\n.progress-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    margin-bottom: 0.75rem;\n}\n.progress-header h3 {\n    margin: 0;\n    font-size: 1.1rem;\n    color: var(--text-light);\n}\n.score-percentage {\n    font-size: 1.2rem;\n    font-weight: 600;\n}\n.score-green { color: var(--green); }\n.score-yellow { color: var(--yellow); }\n.score-red { color: var(--red); }\n\n.progress-bar-background {\n    width: 100%;\n    height: 12px;\n    background-color: var(--bg-dark-3);\n    border-radius: 6px;\n    overflow: hidden;\n    margin-bottom: 1.5rem;\n}\n.progress-bar-fill {\n    height: 100%;\n    width: 0%;\n    border-radius: 6px;\n    transition: width 0.5s ease;\n}\n.progress-bar-green { background-color: var(--green); }\n.progress-bar-yellow { background-color: var(--yellow); }\n.progress-bar-red { background-color: var(--red); }\n\n.details-section {\n    margin-bottom: 1.25rem;\n}\n.details-section h4 {\n    margin: 0 0 0.5rem 0;\n    color: var(--text-medium);\n    font-size: 0.9rem;\n    text-transform: uppercase;\n}\n.details-section p {\n    margin: 0;\n    color: var(--text-light);\n    font-size: 1rem;\n}\n.hash-text {\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.95rem;\n    word-break: break-all;\n}\n\n/* --- QR Code Section --- */\n.qr-section {\n    display: none; /* toggled on for PE */\n    align-items: center;\n}\n.qr-code-wrapper {\n    display: inline-flex;\n    padding: 0.5rem;\n    background: #fff;\n    border-radius: 8px;\n    box-shadow: 0 4px 12px rgba(0,0,0,0.08);\n}\n.qr-code-wrapper canvas,\n.qr-code-wrapper img {\n    width: 160px;\n    height: 160px;\n}\nbody.light-theme .qr-code-wrapper {\n    box-shadow: 0 2px 8px rgba(0,0,0,0.08);\n}\n\n/* --- Vendor & Signature --- */\n.details-grid {\n    display: grid;\n    grid-template-columns: 1fr 1fr;\n    gap: 1.5rem;\n    margin-bottom: 1.25rem;\n}\n.vendor-info, .signature-info {\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n    font-size: 1rem;\n    font-weight: 500;\n}\n.vendor-info i {\n    font-size: 1.5rem;\n    color: var(--text-medium);\n}\n.signature-info i {\n    font-size: 1.25rem;\n}\n/* Use the levels from datasrcs.js */\n.sig-verified { color: var(--green); }\n.sig-untrusted { color: var(--red); }\n.sig-unknown { color: var(--yellow); }\n\n/* --- File Internals Card --- */\n.file-internals-container {\n    width: 100%;\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    padding: 2rem;\n    display: none; /* Hidden by default */\n    box-sizing: border-box;\n    flex-direction: column;\n    gap: 1.5rem;\n}\nbody.is-showing-result .file-internals-container {\n    display: flex;\n}\n.file-internals-container h3 {\n    margin-top: 0;\n    margin-bottom: 0;\n    color: var(--text-light);\n    font-size: 1.25rem;\n    padding-bottom: 1rem;\n    border-bottom: 1px solid var(--border-color);\n}\n\n/* --- Entropy Bars --- */\n.entropy-bars {\n    display: flex;\n    flex-direction: column;\n    gap: 0.75rem;\n}\n.entropy-bar-row {\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n}\n.entropy-bar-label {\n    width: 60px;\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.9rem;\n    color: var(--text-medium);\n    flex-shrink: 0;\n}\n.entropy-bar-bg {\n    flex-grow: 1;\n    height: 20px;\n    background-color: var(--bg-dark-3);\n    border-radius: 4px;\n    overflow: hidden;\n}\n.entropy-bar-fill {\n    height: 100%;\n    width: 0%; /* Set by JS */\n    background-color: var(--blue);\n    border-radius: 4px;\n    transition: width 0.5s ease;\n    display: flex;\n    justify-content: flex-end;\n    align-items: center;\n    padding-right: 0.5rem;\n    box-sizing: border-box;\n}\n.entropy-bar-value {\n    font-size: 0.8rem;\n    font-weight: bold;\n    color: var(--syntax-const-text); /* MODIFIED */\n    text-shadow: 0 0 3px rgba(0,0,0,0.5);\n}\n/* Color coding for entropy bars */\n.entropy-bar-fill.low { background-color: var(--green); }\n.entropy-bar-fill.medium { background-color: var(--blue); }\n.entropy-bar-fill.high { background-color: var(--yellow); }\n.entropy-bar-fill.packed { background-color: var(--red); }\n\n/* --- Key Strings --- */\n.key-strings {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 0.5rem;\n}\n.key-string-tag {\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.9rem;\n    background-color: var(--bg-dark-3);\n    border: 1px solid var(--border-color);\n    padding: 0.25rem 0.5rem;\n    border-radius: 4px;\n    color: var(--text-light);\n}\n.key-string-tag.suspicious {\n    border-color: var(--red);\n    color: var(--red);\n    background-color: #e74c3c1a;\n}\n.key-string-tag.benign {\n    border-color: var(--green);\n    color: var(--green);\n    background-color: #2ecc711a;\n}\n\n/* --- Buttons --- */\n.btn-wrapper {\n    margin-top: 2rem;\n    display: flex;\n    gap: 1rem;\n}\n.btn {\n    flex-grow: 1; /* Make buttons fill space */\n    background-color: var(--blue);\n    color: var(--syntax-const-text); /* MODIFIED */\n    border: none;\n    padding: 12px 24px;\n    border-radius: 6px;\n    font-size: 1rem;\n    font-weight: bold;\n    cursor: pointer;\n    transition: all 0.3s ease;\n    text-decoration: none;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    gap: 0.5rem;\n}\n.btn:hover {\n    filter: brightness(1.2);\n}\n.btn-primary {\n    background-color: var(--blue);\n}\n.btn-secondary {\n    background-color: var(--bg-dark-4);\n    color: var(--text-light);\n}\n.btn-secondary:hover {\n    background-color: #555;\n}\n.btn i {\n    margin-right: 0.25rem;\n}\n\n\n/* --- Background Particle Animations --- */\n.animation-swarm {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%; \n    height: 100%;\n    z-index: -1;\n    pointer-events: none;\n    overflow: hidden; \n}\n\n/* Base style for each new span particle */\n.animation-swarm span {\n    position: absolute;\n    top: -20px; /* Start off-screen */\n    font-size: 1.5rem;\n    opacity: 0; /* Start invisible */\n    animation: fall 10s linear infinite;\n}\n\n/* The ::before holds the icon content */\n.animation-swarm span::before {\n    content: '';\n    font-family: \"Font Awesome 6 Free\";\n    font-weight: 900;\n    text-shadow: 0 0 5px;\n}\n\n/* Keyframes for falling (starts with opacity) */\n@keyframes fall {\n    0% {\n        transform: translateY(0vh) rotate(0);\n        opacity: 0.3;\n    }\n    100% {\n        transform: translateY(105vh) rotate(360deg);\n        opacity: 0;\n    }\n}\n\n/* Set icon and color based on body class */\nbody.result-safe-active .animation-swarm span::before {\n    content: '\\f132'; /* fa-shield-halved */\n    color: var(--green);\n}\nbody.result-suspicious-active .animation-swarm span::before {\n    content: '\\f071'; /* fa-exclamation-triangle */\n    color: var(--yellow);\n}\nbody.result-malware-active .animation-swarm span::before {\n    content: '\\f188'; /* fa-bug */\n    color: var(--red);\n}\n\n/* Give each particle a unique position and delay --- THIS IS THE FINAL FIX --- */\n/* All values are kept well away from the 90-100% range */\n.animation-swarm span:nth-child(1) { left: 10%; animation-delay: 0s; }\n.animation-swarm span:nth-child(2) { left: 20%; animation-delay: -2s; }\n.animation-swarm span:nth-child(3) { left: 30%; animation-delay: -4s; }\n.animation-swarm span:nth-child(4) { left: 40%; animation-delay: -6s; }\n.animation-swarm span:nth-child(5) { left: 50%; animation-delay: -8s; }\n.animation-swarm span:nth-child(6) { left: 60%; animation-delay: -1s; }\n.animation-swarm span:nth-child(7) { left: 70%; animation-delay: -3s; }\n.animation-swarm span:nth-child(8) { left: 75%; animation-delay: -5s; } /* Was 80% */\n.animation-swarm span:nth-child(9) { left: 15%; animation-delay: -7s; } /* Was 90% */\n.animation-swarm span:nth-child(10) { left: 5%; animation-delay: -9s; }\n\n\n/* --- History Panel --- */\n.history-overlay {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0,0,0,0.5);\n    z-index: 1001;\n    opacity: 0;\n    visibility: hidden;\n    transition: all 0.3s ease;\n}\n.history-panel {\n    position: fixed;\n    top: 0;\n    right: -450px; /* Start off-screen */\n    width: 400px;\n    max-width: 90%;\n    height: 100%;\n    background-color: var(--bg-dark-2);\n    z-index: 1002;\n    transition: all 0.3s ease;\n    display: flex;\n    flex-direction: column;\n}\nbody.is-history-open .history-overlay {\n    opacity: 1;\n    visibility: visible;\n}\nbody.is-history-open .history-panel {\n    right: 0;\n}\n.history-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 1rem 1.5rem;\n    border-bottom: 1px solid var(--border-color);\n}\n.history-header h3 {\n    margin: 0;\n    font-size: 1.2rem;\n}\n.history-close-btn {\n    background: none;\n    border: none;\n    color: var(--text-medium);\n    font-size: 1.5rem;\n    cursor: pointer;\n    transition: all 0.2s ease;\n}\n.history-close-btn:hover {\n    color: var(--text-light);\n}\n.history-list {\n    list-style: none;\n    padding: 0;\n    margin: 0;\n    overflow-y: auto;\n    flex-grow: 1;\n}\n.history-list li {\n    display: flex;\n    align-items: center;\n    gap: 1rem;\n    padding: 1rem 1.5rem;\n    border-bottom: 1px solid var(--border-color);\n    transition: background-color 0.2s ease;\n}\n\n.history-list li:hover {\n    background-color: var(--bg-dark-3);\n}\n\n.history-item {\n    display: flex;\n    align-items: flex-start;\n    gap: 1rem;\n}\n\n.history-icon-wrapper {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 0.5rem;\n    min-width: 60px;\n}\n\n.history-icon {\n    font-size: 1.8rem;\n    width: 40px;\n    height: 40px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    border-radius: 8px;\n    background-color: var(--bg-dark-3);\n}\n\n.history-icon.safe {\n    color: var(--green);\n    border: 2px solid var(--green);\n}\n\n.history-icon.suspicious {\n    color: var(--yellow);\n    border: 2px solid var(--yellow);\n}\n\n.history-icon.malware {\n    color: var(--red);\n    border: 2px solid var(--red);\n}\n\n.history-file-type {\n    font-size: 1rem;\n    color: var(--text-medium);\n}\n\n.history-details {\n    flex-grow: 1;\n    display: flex;\n    flex-direction: column;\n    gap: 0.5rem;\n    min-width: 0; /* Allow text truncation */\n}\n\n.history-filename {\n    font-weight: 600;\n    color: var(--text-light);\n    font-size: 0.95rem;\n    white-space: nowrap;\n    overflow: hidden;\n    text-overflow: ellipsis;\n}\n\n.history-classification {\n    font-size: 0.85rem;\n    font-weight: 600;\n    text-transform: uppercase;\n    letter-spacing: 0.05em;\n}\n\n.history-classification.safe {\n    color: var(--green);\n}\n\n.history-classification.suspicious {\n    color: var(--yellow);\n}\n\n.history-classification.malware {\n    color: var(--red);\n}\n\n.history-hash {\n    font-family: 'Courier New', Courier, monospace;\n    font-size: 0.75rem;\n    color: var(--text-medium);\n    background-color: var(--bg-dark-3);\n    padding: 0.25rem 0.5rem;\n    border-radius: 4px;\n    word-break: break-all;\n    line-height: 1.4;\n}\n\n.history-date {\n    font-size: 0.8rem;\n    color: var(--text-medium);\n    white-space: nowrap;\n    align-self: flex-start;\n    padding-top: 0.25rem;\n}\n\n.history-item-empty,\n.history-item-loading {\n    color: var(--text-medium);\n    text-align: center;\n    padding: 2rem;\n    font-style: italic;\n}\n\n\n/* --- Hover Scroll Zones --- */\n.scroll-zone {\n    position: fixed;\n    left: 0;\n    width: 100%;\n    height: 80px;\n    z-index: 998;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n}\n.scroll-zone.top { top: 60px; /* Below nav */ }\n.scroll-zone.bottom { bottom: 0; }\n\n.scroll-zone i {\n    font-size: 2rem;\n    color: var(--text-light);\n    opacity: 0;\n    transition: all 0.3s ease;\n    text-shadow: 0 0 15px rgba(0,0,0,0.7);\n}\n.scroll-zone.scrolling i {\n    opacity: 0.3;\n}\n.scroll-zone:hover i {\n    opacity: 0.7;\n}\n\n\n/* --- Graph Panel --- */\n.graph-wrapper {\n    background-color: var(--bg-dark-2);\n    border-radius: 12px;\n    border: 1px solid var(--border-color);\n    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);\n    margin-top: 1rem;\n    display: none; /* Hidden by default */\n    box-sizing: border-box;\n}\nbody.is-showing-result .graph-wrapper {\n    display: block; /* Show with results */\n}\n\n.graph-header {\n    padding: 1rem 1.5rem;\n    border-bottom: 1px solid var(--border-color);\n    background-color: var(--bg-dark-3);\n    border-radius: 12px 12px 0 0;\n}\n.graph-header h3 {\n    margin: 0;\n    color: var(--text-light);\n    font-size: 1.1rem;\n}\n.call-graph-container {\n    overflow: auto; /* Allow scrolling for large graphs */\n}\n.call-graph {\n    flex-grow: 1;\n    overflow: auto;\n    position: relative; /* KEY for node positioning */\n    min-height: 400px;\n    padding: 1rem;\n}\n\n.graph-node {\n    position: absolute;\n    padding: 0.75rem 1.25rem;\n    border-radius: 8px;\n    background-color: var(--bg-dark-3);\n    border: 2px solid var(--border-color);\n    font-family: 'Courier New', Courier, monospace;\n    font-weight: bold;\n    white-space: nowrap;\n    box-shadow: 0 4px 10px rgba(0,0,0,0.3);\n    z-index: 2;\n    text-align: center;\n}\n/* MODIFIED to use variables */\n.node-entry { background-color: var(--node-bg-entry); border-color: var(--green); color: var(--syntax-const-text); }\n.node-std { background-color: var(--bg-dark-3); border-color: var(--border-color); color: var(--text-light); }\n.node-api { background-color: var(--node-bg-api); border-color: var(--blue); color: var(--syntax-const-text); }\n.node-suspicious { background-color: var(--node-bg-suspicious); border-color: var(--yellow); color: var(--syntax-const-text); }\n.node-malicious { background-color: var(--node-bg-malicious); border-color: var(--red); color: var(--syntax-const-text); }\n\n.leader-line {\n    z-index: 1; /* Sit behind nodes */\n    opacity: 0.8;\n}\nbody.light-theme .chart-container {\n    color: var(--text-medium);\n}\n\n/* Light theme navigation buttons */\n/* Light theme navigation buttons */\nbody.light-theme .nav-btn {\n    background: linear-gradient(135deg, #8b5cf6, #7c3aed) !important;\n    color: white !important;\n    box-shadow: 0 4px 12px rgba(139, 92, 246, 0.5) !important;\n}\n\nbody.light-theme .nav-btn:hover:not(:disabled) {\n    background: linear-gradient(135deg, #7c3aed, #6d28d9) !important;\n    box-shadow: 0 6px 20px rgba(139, 92, 246, 0.7) !important;\n}\n\nbody.light-theme .nav-btn:disabled {\n    background: #e9ecef !important;\n    color: #adb5bd !important;\n    box-shadow: none !important;\n    opacity: 0.7 !important;\n}\n\nbody.light-theme .nav-info {\n    color: var(--text-light);\n    font-weight: 600;\n}\n\nbody.light-theme .scan-navigation {\n    border-top-color: var(--border-color);\n}\n","range":{"startLineNumber":1,"startColumn":1,"endLineNumber":1243,"endColumn":1}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/localnsv/mAIware/script.js","external":"file:///home/trang/localnsv/mAIware/script.js","path":"/home/trang/localnsv/mAIware/script.js","scheme":"file"},"requestId":"request_0bd3737c-96a7-45c8-bdaa-69c39a73dfda","epoch":167,"edits":[{"text":"// --- MOCK DISASSEMBLY DATA ---\n// (We keep this for now, as requested)\nconst mockDisassemblyBenign = [\n    `<span class=\"addr\">0x401000</span> <span class=\"op\">PUSH</span> <span class=\"args\">ebp</span> <span class=\"comment\">; setup stack frame</span>`,\n    `<span class=\"addr\">0x401001</span> <span class=\"op\">MOV</span> <span class=\"args\">ebp, esp</span>`,\n    `<span class=\"addr\">0x401003</span> <span class=\"op\">SUB</span> <span class=\"args\">esp, 48h</span>`,\n    `<span class=\"addr\">0x40100C</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4012A0</span> <span class=\"comment\">; initialize_string</span>`,\n    `<span class=\"addr\">0x401015</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4013F0</span> <span class=\"comment\">; get_user_input</span>`,\n    `<span class=\"addr\">0x40101E</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4015D0</span> <span class=\"comment\">; print_output</span>`,\n    `<span class=\"addr\">0x401028</span> <span class=\"op\">RETN</span>`,\n    `<span class=\"addr\">...</span>`,\n];\nconst mockDisassemblySuspicious = [\n    `<span class=\"addr\">0x401000</span> <span class=\"op\">PUSH</span> <span class=\"args\">ebp</span>`,\n    `<span class=\"addr\">0x401003</span> <span class=\"op\">SUB</span> <span class=\"args\">esp, 80h</span>`,\n    `<span class=\"addr\">0x40100D</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4012A0</span> <span class=\"comment\">; read_file_to_buffer</span>`,\n    `<span class=\"addr\">0x40101B</span> <span class=\"op\">REP</span> <span class=\"op\">MOVSB</span> <span class=\"comment\">; unsafe buffer write</span>`,\n    `<span class=\"addr\">0x401020</span> <span class=\"op\">JGE</span> <span class=\"args\">0x401030</span> <span class=\"comment\">; jump if overflow</span>`,\n    `<span class=\"addr\">0x401028</span> <span class=\"op\">RETN</span>`,\n    `<span class=\"addr\">...</span>`,\n];\nconst mockDisassemblyMalware = [\n    `<span class=\"addr\">0x401000</span> <span class=\"op\">PUSH</span> <span class=\"args\">ebp</span> <span class=\"comment\">; setup stack frame</span>`,\n    `<span class=\"addr\">0x40100B</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4011B0</span> <span class=\"comment\">; kernel32.LoadLibraryA</span>`,\n    `<span class=\"addr\">0x401013</span> <span class=\"op\">PUSH</span> <span class=\"string\">\"CreateRemoteThread\"</span>`,\n    `<span class=\"addr\">0x401019</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4011C0</span> <span class=\"comment\">; kernel32.GetProcAddress</span>`,\n    `<span class=\"addr\">0x401028</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4012F0</span> <span class=\"comment\">; decrypt_payload</span>`,\n    `<span class=\"addr\">0x401034</span> <span class=\"op\">CALL</span> <span class=\"args\">[ebp-24h]</span> <span class=\"comment\">; call CreateRemoteThread</span>`,\n    `<span class=\"addr\">0x401037</span> <span class=\"op\">JMP</span> <span class=\"args\">0x40102D</span> <span class=\"comment\">; loop?</span>`,\n    `<span class=\"addr\">...</span>`,\n];\n\n// --- REMOVED MOCK GRAPH DATA ---\n// const mockGraphSafe = ... (DELETED)\n// const mockGraphSuspicious = ... (DELETED)\n// const mockGraphMalware = ... (DELETED)\n\n// --- NAVIGATION STATE ---\nlet scanHistory = [];\nlet currentHistoryIndex = -1;\n\n// --- ELEMENT REFERENCES ---\nconst initialState = document.getElementById('initial-state');\nconst analyzingState = document.getElementById('analyzing-state');\nconst resultState = document.getElementById('result-state');\n\nconst analyzingFilename = document.getElementById('analyzing-filename');\nconst resultIcon = document.getElementById('result-icon');\nconst resultText = document.getElementById('result-text');\nconst resultFilename = document.getElementById('result-filename');\nconst resultDetails = document.getElementById('result-details');\nconst nonPeResultWrapper = document.getElementById('non-pe-result');\nconst nonPeFilename = document.getElementById('non-pe-filename');\nconst nonPeHashSha256 = document.getElementById('non-pe-hash-sha256');\nconst nonPeHashMd5 = document.getElementById('non-pe-hash-md5');\n\nconst bodyEl = document.body;\nlet animationWrapper = null;\n\nconst disassemblyWrapper = document.getElementById('disassembly-wrapper');\nconst disassemblyCodeEl = document.getElementById('disassembly-code');\nconst disassemblyFilenameEl = document.getElementById('disassembly-filename');\n\n// Analysis Details elements\nconst analysisDetailsWrapper = document.getElementById('analysis-details-wrapper');\nconst progressBarFill = document.getElementById('progress-bar-fill');\nconst scorePercentage = document.getElementById('score-percentage');\nconst detailsReasoning = document.getElementById('details-reasoning'); // We'll reuse this\nconst detailsHashSha256 = document.getElementById('details-hash-sha256');\nconst detailsHashMd5 = document.getElementById('details-hash-md5');\nconst detailsSystemIp = document.getElementById('details-system-ip');\nconst detailsRecommendation = document.getElementById('details-recommendation');\nconst detailsVendor = document.getElementById('details-vendor');\nconst detailsSignature = document.getElementById('details-signature');\nconst fileInternalsWrapper = document.getElementById('file-internals-wrapper');\nconst entropyBarsContainer = document.getElementById('entropy-bars-container');\nconst keyStringsContainer = document.getElementById('key-strings-container');\n\n// History Panel elements\nconst historyBtn = document.getElementById('history-btn');\nconst historyPanel = document.getElementById('history-panel');\nconst historyCloseBtn = document.getElementById('history-close-btn');\nconst historyOverlay = document.getElementById('history-overlay');\nconst historyListEl = document.querySelector('.history-list');\n\n// Scroll Zone elements\nconst scrollZoneTop = document.getElementById('scroll-zone-top');\nconst scrollZoneBottom = document.getElementById('scroll-zone-bottom');\n\n// Graph Panel elements\nconst graphWrapper = document.getElementById('graph-wrapper');\nconst callGraphEl = document.getElementById('call-graph');\n\n// Stats elements\nconst statsWrapper = document.getElementById('stats-wrapper');\n\n\n// --- STATE ---\nlet disassemblyInterval = null;\nlet scrollInterval = null; // For auto-scrolling\nlet currentGraphLines = []; // Renamed from currentLines to avoid conflict\nlet currentFileMetadata = null;\nlet lastScanResult = null;\n\n// 1. Listen for the 'scan-started' message from the backend\nwindow.electronAPI.onScanStarted((filename) => {\n  console.log(`UI: Received scan-started for ${filename}`);\n\n    // If user is viewing a result, don't auto-switch to analyzing.\n    if (bodyEl.classList.contains('is-showing-result') || bodyEl.classList.contains('is-non-pe')) {\n        console.log('UI: Result is being viewed; deferring analyzing UI switch');\n        return;\n    }\n\n  // 1. Set UI to \"Analyzing\" state\n  initialState.classList.remove('active'); //\n  analyzingState.classList.add('active'); //\n  analyzingFilename.textContent = filename; //\n  disassemblyFilenameEl.textContent = filename; //\n\n  currentFileMetadata = { filename, isPe: true };\n  lastScanResult = null;\n  nonPeResultWrapper.classList.remove('active');\n  bodyEl.classList.remove('is-non-pe');\n\n  // 2. Update body class to show disassembly\n  bodyEl.classList.remove('is-showing-result'); //\n  bodyEl.classList.add('is-analyzing'); //\n  removeAnimationClasses(); //\n  \n  // 3. Populate disassembly with a \"suspicious\" default and start animation\n  // (We don't know the result yet, so we pick one)\n  populateDisassembly(mockDisassemblySuspicious); //\n  startDisassemblyAnimation(); //\n\n  // 4. Clear old results\n  clearResultData();\n});\n\n// 2. Listen for the 'scan-result' message\nwindow.electronAPI.onScanResult((scanResult) => {\n  console.log(\"UI: Received scan-result:\", scanResult);\n\n  clearInterval(disassemblyInterval); //\n  disassemblyInterval = null; //\n\n  // Add to history\n  scanHistory.push(scanResult);\n  currentHistoryIndex = scanHistory.length - 1;\n\n    // If a result is already being viewed, do not auto-advance UI.\n    if (bodyEl.classList.contains('is-showing-result') || bodyEl.classList.contains('is-non-pe')) {\n        updateNavigationButtons();\n        return;\n    }\n\n    bodyEl.classList.remove('is-analyzing'); //\n    bodyEl.classList.add('is-showing-result'); //\n\n    analyzingState.classList.remove('active'); //\n    resultState.classList.add('active'); //\n\n    lastScanResult = scanResult;\n    renderScanResult();\n    updateNavigationButtons();\n});\n\nwindow.electronAPI.onScanFileMetadata((metadata) => {\n  if (!metadata || typeof metadata !== 'object') {\n    return;\n  }\n\n  currentFileMetadata = metadata;\n\n  if (lastScanResult && metadata.filename === lastScanResult.detected_filename) {\n    renderScanResult();\n  }\n});\n\nfunction renderScanResult() {\n  if (!lastScanResult) {\n    return;\n  }\n\n  const metadataMatches = currentFileMetadata && currentFileMetadata.filename === lastScanResult.detected_filename;\n  const isNonPe = metadataMatches && currentFileMetadata.isPe === false;\n\n  if (isNonPe) {\n    renderNonPeResult(lastScanResult);\n    return;\n  }\n\n  renderPeResult(lastScanResult);\n}\n\nfunction ensureAnimationWrapper() {\n  if (animationWrapper) {\n    return;\n  }\n\n  animationWrapper = document.createElement('div');\n  animationWrapper.className = 'animation-swarm';\n  for (let i = 0; i < 10; i++) {\n    const particle = document.createElement('span');\n    animationWrapper.appendChild(particle);\n  }\n  bodyEl.prepend(animationWrapper);\n}\n\nfunction renderPeResult(scanResult) {\n  removeAnimationClasses();\n  bodyEl.classList.remove('is-non-pe');\n  nonPeResultWrapper.classList.remove('active');\n\n  let resultIconClass = 'fas fa-check-circle'; //\n  let resultMockDisassembly = mockDisassemblyBenign; //\n  let resultBodyClass = 'result-safe-active'; //\n  let resultScannerClass = 'result-safe'; //\n  let resultProgressClass = 'progress-bar-green'; //\n  let resultScoreClass = 'score-green'; //\n  let recommendation = 'You can safely run this file.'; //\n\n  if (scanResult.classification.includes('Malware')) {\n    resultIconClass = 'fas fa-bug';\n    resultMockDisassembly = mockDisassemblyMalware;\n    resultBodyClass = 'result-malware-active'; //\n    resultScannerClass = 'result-malware'; //\n    resultProgressClass = 'progress-bar-red'; //\n    resultScoreClass = 'score-red'; //\n    recommendation = 'DO NOT OPEN. Quarantine this file immediately.'; //\n  } else if (scanResult.classification.includes('Suspicious')) {\n    resultIconClass = 'fas fa-exclamation-triangle'; //\n    resultMockDisassembly = mockDisassemblySuspicious; //\n    resultBodyClass = 'result-suspicious-active'; //\n    resultScannerClass = 'result-suspicious'; //\n    resultProgressClass = 'progress-bar-yellow'; //\n    resultScoreClass = 'score-yellow'; //\n    recommendation = 'Be cautious. Only run if you trust the source.'; //\n  }\n\n  ensureAnimationWrapper();\n  bodyEl.classList.add(resultBodyClass); //\n\n  resultState.className = `scanner-state active ${resultScannerClass}`; //\n  resultIcon.className = `result-icon ${resultIconClass}`; //\n  resultText.textContent = scanResult.classification; //\n\n  let detailsText = `Scanned ${scanResult.detected_filename}.`;\n  if (scanResult.malware_family) {\n    detailsText = `Family: ${scanResult.malware_family}`;\n  }\n  resultDetails.textContent = detailsText;\n  resultFilename.textContent = scanResult.detected_filename; //\n\n  progressBarFill.className = 'progress-bar-fill'; //\n  scorePercentage.className = 'score-percentage'; //\n  progressBarFill.classList.add(resultProgressClass); //\n  const rawConfidence = Number(scanResult.confidence_score);\n  const confidenceValue = Number.isFinite(rawConfidence) ? rawConfidence * 100 : 0;\n  progressBarFill.style.width = `${confidenceValue}%`; //\n  scorePercentage.textContent = `${Math.round(confidenceValue)}%`; //\n  scorePercentage.classList.add(resultScoreClass); //\n\n  detailsReasoning.textContent = `Filetype: ${scanResult.key_findings.file_type}. Packer: ${scanResult.key_findings.packer_detected}.`; //\n  const hashData = scanResult.file_hashes || {};\n  detailsHashSha256.textContent = hashData.sha256 || 'Not available'; //\n  detailsHashMd5.textContent = hashData.md5 || 'Not available'; //\n  updateSystemIpDisplay();\n  detailsRecommendation.textContent = recommendation;\n\n  populateVendor(scanResult.vendor); //\n  populateSignature(scanResult.key_findings.signature); //\n  populateEntropyBars(scanResult.key_findings.section_entropy || []); //\n  populateKeyStrings(scanResult.key_findings.key_strings || [], scanResult.classification); //\n\n  populateDisassembly(resultMockDisassembly); //\n\n  const apiList = scanResult.key_findings.api_imports || [];\n  const graphData = generateGraphData(apiList, scanResult.classification);\n  drawCallGraph(graphData);\n\n    // Generate QR for PE report\n    generatePeQr(scanResult);\n}\n\nfunction renderNonPeResult(scanResult) {\n  removeAnimationClasses();\n  bodyEl.classList.add('is-non-pe');\n  resultState.className = 'scanner-state active';\n  resultIcon.className = 'result-icon fas fa-file';\n  resultText.textContent = '';\n  resultDetails.textContent = '';\n  resultFilename.textContent = '';\n\n  const hashData = scanResult.file_hashes || {};\n  nonPeFilename.textContent = scanResult.detected_filename || '';\n  nonPeHashSha256.textContent = hashData.sha256 || 'Not available';\n  nonPeHashMd5.textContent = hashData.md5 || 'Not available';\n\n  detailsHashSha256.textContent = hashData.sha256 || 'Not available';\n  detailsHashMd5.textContent = hashData.md5 || 'Not available';\n\n  nonPeResultWrapper.classList.add('active');\n\n  callGraphEl.innerHTML = '';\n  currentGraphLines.forEach(line => line.remove());\n  currentGraphLines = [];\n  entropyBarsContainer.innerHTML = '';\n  keyStringsContainer.innerHTML = '';\n\n    // Hide QR for non-PE\n    clearQr();\n}\n\n/**\n * Clears all dynamic result data to prepare for the next scan.\n */\nfunction clearResultData() {\n    // Clear scanner panel\n    resultText.textContent = '';\n    resultDetails.textContent = '';\n    resultFilename.textContent = '';\n    nonPeResultWrapper.classList.remove('active');\n    nonPeFilename.textContent = '';\n    nonPeHashSha256.textContent = '...';\n    nonPeHashMd5.textContent = '...';\n    bodyEl.classList.remove('is-non-pe');\n\n    // Clear analysis panel\n    progressBarFill.style.width = `0%`;\n    scorePercentage.textContent = `0%`;\n    detailsReasoning.textContent = '...';\n    detailsHashSha256.textContent = '...';\n    detailsHashMd5.textContent = '...';\n    if (detailsSystemIp) {\n        detailsSystemIp.textContent = 'Detecting...';\n    }\n    detailsRecommendation.textContent = '...';\n\n    // Clear vendor\n    detailsVendor.innerHTML = `\n        <h4>Vendor Analysis</h4>\n        <div class=\"vendor-info\">\n            <i class=\"fas fa-question-circle\"></i>\n            <span>Scanning...</span>\n        </div>`;\n    \n    // Clear signature\n    detailsSignature.innerHTML = `\n        <h4>Digital Signature</h4>\n        <div class=\"signature-info\">\n            <i class=\"fas fa-question-circle\"></i>\n            <span>Checking...</span>\n        </div>`;\n    \n    // Clear internals\n    entropyBarsContainer.innerHTML = '';\n    keyStringsContainer.innerHTML = '';\n    \n    // Clear graph\n    callGraphEl.innerHTML = '';\n    currentGraphLines.forEach(line => line.remove());\n    currentGraphLines = [];\n}\n\n// --- QR helpers ---\nfunction clearQr() {\n    const qrSection = document.getElementById('qr-section');\n    const qrEl = document.getElementById('qr-code');\n    if (qrEl) qrEl.innerHTML = '';\n    if (qrSection) qrSection.style.display = 'none';\n}\n\nfunction generatePeQr(scanResult) {\n    const qrSection = document.getElementById('qr-section');\n    const qrEl = document.getElementById('qr-code');\n    if (!qrEl || !qrSection || typeof QRCode === 'undefined') return;\n\n    // Build a compact JSON report that fits in a QR\n    const report = {\n        filename: scanResult.detected_filename,\n        classification: scanResult.classification,\n        confidence: Number(scanResult.confidence_score),\n        family: scanResult.malware_family || null,\n        vendor: (scanResult.vendor && scanResult.vendor.name) ? scanResult.vendor.name : null,\n        hashes: {\n            sha256: scanResult.file_hashes?.sha256 || null,\n            md5: scanResult.file_hashes?.md5 || null\n        },\n        ts: Date.now()\n    };\n\n    // Show section and render\n    qrSection.style.display = 'block';\n    qrEl.innerHTML = '';\n    const json = JSON.stringify(report);\n    try {\n        new QRCode(qrEl, { text: json, width: 160, height: 160, colorDark: '#000', colorLight: '#fff', correctLevel: QRCode.CorrectLevel.M });\n    } catch (e) {\n        console.warn('QR generation failed', e);\n        qrEl.textContent = 'QR unavailable';\n    }\n}\n\n// --- VENDOR UI FUNCTION (IMPLEMENTED) ---\nfunction populateVendor(vendor) {\n    if (!vendor) return;\n    const icon = vendor.icon || 'fas fa-question-circle'; //\n    const name = vendor.name || 'Unknown'; //\n    detailsVendor.innerHTML = `\n        <h4>Vendor Analysis</h4> <div class=\"vendor-info\"> <i class=\"${icon}\"></i>\n            <span>${name}</span>\n        </div>\n    `;\n}\n\n// --- SIGNATURE UI FUNCTION (IMPLEMENTED) ---\nfunction populateSignature(signature) {\n    if (!signature) return;\n    let icon = signature.icon || 'fas fa-question-circle';\n    let cssClass = `sig-${signature.level || 'unknown'}`; // 'sig-verified', 'sig-untrusted', 'sig-unknown'\n\n    detailsSignature.innerHTML = `\n        <h4>Digital Signature</h4> <div class=\"signature-info ${cssClass}\"> <i class=\"${icon}\"></i>\n            <span>${signature.name}</span>\n        </div>\n    `;\n}\n\n// --- ENTROPY BARS UI FUNCTION (IMPLEMENTED) ---\nfunction populateEntropyBars(sections) {\n    entropyBarsContainer.innerHTML = ''; // Clear old bars\n    if (!sections || sections.length === 0) {\n        entropyBarsContainer.innerHTML = '<p class=\"hash-text\">No PE sections found to analyze.</p>';\n        return;\n    }\n\n    sections.forEach(section => { //\n        const value = section.entropy; //\n        const width = (value / 8.0) * 100; // Entropy is 0-8\n        let cssClass = 'low';\n        \n        if (value > 6.0) cssClass = 'medium';\n        if (value > 7.0) cssClass = 'high';\n        if (value > 7.8) cssClass = 'packed'; // Match style.css\n\n        const row = document.createElement('div');\n        row.className = 'entropy-bar-row';\n        row.innerHTML = `\n            <span class=\"entropy-bar-label\">${section.name}</span> <div class=\"entropy-bar-bg\">\n                <div class=\"entropy-bar-fill ${cssClass}\" style=\"width: ${width}%\">\n                    <span class=\"entropy-bar-value\">${value.toFixed(2)}</span>\n                </div>\n            </div>\n        `;\n        entropyBarsContainer.appendChild(row);\n    });\n}\n\n// --- KEY STRINGS UI FUNCTION (IMPLEMENTED) ---\nfunction populateKeyStrings(strings, classification) {\n    keyStringsContainer.innerHTML = ''; // Clear old strings\n    if (!strings || strings.length === 0) {\n        keyStringsContainer.innerHTML = '<span class=\"key-string-tag\">No notable strings found.</span>';\n        return;\n    }\n    \n    const tagClass = classification.includes('Benign') ? 'benign' : 'suspicious'; //\n\n    strings.forEach(str => { //\n        const tag = document.createElement('span');\n        tag.className = `key-string-tag ${tagClass}`;\n        tag.textContent = str;\n        keyStringsContainer.appendChild(tag);\n    });\n}\n\nfunction updateSystemIpDisplay() {\n    if (!detailsSystemIp || !window.electronAPI || typeof window.electronAPI.getSystemIp !== 'function') {\n        return;\n    }\n\n    detailsSystemIp.textContent = 'Detecting...';\n\n    window.electronAPI.getSystemIp()\n        .then((ip) => {\n            if (!ip) {\n                detailsSystemIp.textContent = 'Unavailable';\n                return;\n            }\n\n            detailsSystemIp.textContent = ip;\n        })\n        .catch(() => {\n            detailsSystemIp.textContent = 'Unavailable';\n        });\n}\n\nfunction removeAnimationClasses() {\n    bodyEl.classList.remove('result-safe-active');\n    bodyEl.classList.remove('result-suspicious-active');\n    bodyEl.classList.remove('result-malware-active');\n}\n\n// --- Disassembly Functions ---\n\nfunction populateDisassembly(codeLines) {\n    disassemblyCodeEl.innerHTML = '';\n    codeLines.forEach((line, index) => {\n        const lineEl = document.createElement('span');\n        lineEl.className = 'disassembly-line';\n        lineEl.id = `line-${index}`;\n        lineEl.innerHTML = line;\n        disassemblyCodeEl.appendChild(lineEl);\n    });\n}\n\nfunction startDisassemblyAnimation() {\n    if (disassemblyInterval) {\n        clearInterval(disassemblyInterval);\n    }\n    let currentLine = 0;\n    const totalLines = disassemblyCodeEl.children.length;\n\n    disassemblyInterval = setInterval(() => {\n        const prevLine = document.querySelector('.disassembly-line.active');\n        if (prevLine) {\n            prevLine.classList.remove('active');\n        }\n\n        const lineEl = document.getElementById(`line-${currentLine}`);\n        if (lineEl) {\n            lineEl.classList.add('active');\n            lineEl.scrollIntoView({\n                behavior: 'smooth',\n                block: 'center',\n                inline: 'nearest'\n            });\n        }\n        currentLine = (currentLine + 1) % totalLines;\n    }, 150);\n}\n\n/**\n * This function was MOVED here from jsonsamples.js\n * Dynamically generates the graph data based on API imports.\n * @param {string[]} apiImports - Array of API names (e.g., ['CreateRemoteThread'])\n * @param {string} classification - 'Benign', 'Suspicious', or 'Malware'\n * @returns {object} A graph object with 'nodes' and 'edges' arrays.\n */\nfunction generateGraphData(apiImports, classification) {\n    let nodes = [];\n    let edges = [];\n    const nodeSpacing = 150;\n    const startY = 100;\n    const startX = 250;\n\n    // 1. Add the Main Entry Point node\n    nodes.push({ \n        id: 'main-entry', \n        label: 'main()', \n        class: 'node-entry', \n        pos: { top: `${startY + (apiImports.length / 2) * (nodeSpacing / 2)}px`, left: '50px' } \n    });\n\n    if (!apiImports || apiImports.length === 0) {\n        // Benign/Empty graph\n        nodes.push({ id: 'benign-1', label: 'ReadFile', class: 'node-std', pos: { top: `${startY}px`, left: `${startX}px` } });\n        nodes.push({ id: 'benign-2', label: 'WriteFile', class: 'node-std', pos: { top: `${startY + nodeSpacing / 2}px`, left: `${startX}px` } });\n        edges.push({ from: 'main-entry', to: 'benign-1', options: { color: '#888' } });\n        edges.push({ from: 'main-entry', to: 'benign-2', options: { color: '#888' } });\n    } else {\n        // Suspicious/Malware graph\n        apiImports.forEach((apiName, index) => {\n            let nodeClass = 'node-api'; // Default\n            let edgeColor = '#888'; // Default\n\n            if (classification === 'Malware') {\n                nodeClass = 'node-malicious';\n                edgeColor = '#e74c3c'; // Malware red\n            } else if (classification === 'Suspicious') {\n                nodeClass = 'node-suspicious';\n                edgeColor = '#f1c40f'; // Suspicious yellow\n            } else {\n                // Benign\n                nodeClass = 'node-std';\n                edgeColor = '#888';\n            }\n\n\n            const nodeId = `api-${index}`;\n            const yPos = startY + (index * (nodeSpacing-50)); // Make them a bit closer\n            const xPos = startX + (index % 2 === 0 ? 0 : 150); // Stagger them\n\n            // Add the API node\n            nodes.push({\n                id: nodeId,\n                label: apiName,\n                class: nodeClass,\n                pos: { top: `${yPos}px`, left: `${xPos}px` }\n            });\n\n            // Add the edge from main\n            edges.push({\n                from: 'main-entry',\n                to: nodeId,\n                options: { color: edgeColor }\n            });\n        });\n    }\n\n    return { nodes, edges };\n}\n\n// --- Graph Drawing ---\nfunction drawCallGraph(graphData) {\n    // 1. Clear previous graph (both nodes and lines)\n    callGraphEl.innerHTML = '';\n    currentGraphLines.forEach(line => line.remove());\n    currentGraphLines = [];\n\n    if (!graphData || !graphData.nodes || !graphData.edges) {\n        console.error(\"Invalid graph data received\", graphData);\n        return;\n    }\n\n    // 2. Create and place all nodes\n    graphData.nodes.forEach(node => {\n        const nodeEl = document.createElement('div');\n        nodeEl.id = node.id;\n        nodeEl.className = `graph-node ${node.class}`;\n        nodeEl.style.top = node.pos.top;\n        nodeEl.style.left = node.pos.left;\n        nodeEl.textContent = node.label;\n        callGraphEl.appendChild(nodeEl);\n    });\n\n    // 3. Draw all edges (must be done *after* nodes are in DOM)\n    // Use a slight timeout to ensure DOM is ready\n    setTimeout(() => {\n        graphData.edges.forEach(edge => {\n            try {\n                const line = new LeaderLine(\n                    document.getElementById(edge.from),\n                    document.getElementById(edge.to),\n                    {\n                        color: edge.options.color,\n                        path: edge.options.path || 'straight',\n                        startSocket: edge.options.startSocket || 'auto',\n                        endSocket: edge.options.endSocket || 'auto',\n                        endPlug: 'arrow1',\n                        size: 3,\n                        endPlugSize: 1.5,\n                    }\n                );\n                currentGraphLines.push(line);\n            } catch(e) {\n                console.error(\"Could not draw line:\", e);\n            }\n        });\n    }, 500); // 500ms timeout to let CSS fade-in finish\n}\n\n\n// --- History Panel Logic ---\nasync function loadHistory() {\n  if (!historyListEl) return;\n  \n  historyListEl.innerHTML = '<li class=\"history-item-loading\">Loading...</li>';\n\n  try {\n    const historyData = await window.electronAPI.getHistory();\n\n    if (!historyData || historyData.length === 0) {\n      historyListEl.innerHTML = '<li class=\"history-item-empty\">No scan history found.</li>';\n      return;\n    }\n\n    historyListEl.innerHTML = '';\n\n    historyData.forEach(scan => {\n      const li = document.createElement('li');\n      li.className = 'history-item';\n\n      // Determine classification icon\n      let statusIcon = 'fas fa-check-circle';\n      let classType = 'safe';\n      if (scan.classification.includes('Malware')) {\n        statusIcon = 'fas fa-bug';\n        classType = 'malware';\n      } else if (scan.classification.includes('Suspicious')) {\n        statusIcon = 'fas fa-exclamation-triangle';\n        classType = 'suspicious';\n      }\n\n      // Determine file type icon based on extension\n      const filename = scan.detected_filename || '';\n      const ext = filename.split('.').pop().toLowerCase();\n      let fileTypeIcon = 'fas fa-file';\n      \n      if (['exe', 'dll', 'sys', 'msi'].includes(ext)) {\n        fileTypeIcon = 'fas fa-cog'; // Executable\n      } else if (['jpg', 'jpeg', 'png', 'gif', 'bmp', 'svg', 'webp'].includes(ext)) {\n        fileTypeIcon = 'fas fa-image'; // Image\n      } else if (['js', 'ts', 'py', 'java', 'cpp', 'c', 'h', 'cs', 'go', 'rs', 'php', 'rb'].includes(ext)) {\n        fileTypeIcon = 'fas fa-code'; // Code\n      } else if (['pdf', 'doc', 'docx', 'txt', 'rtf', 'odt'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-alt'; // Document\n      } else if (['zip', 'rar', '7z', 'tar', 'gz', 'bz2'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-archive'; // Archive\n      } else if (['mp3', 'wav', 'ogg', 'flac', 'aac'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-audio'; // Audio\n      } else if (['mp4', 'avi', 'mkv', 'mov', 'wmv', 'flv'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-video'; // Video\n      } else if (['html', 'htm', 'css', 'xml', 'json'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-code'; // Web file\n      }\n\n      const scanDate = new Date(scan.scanDate).toLocaleString();\n      const hashSha256 = scan.file_hashes?.sha256 || 'N/A';\n      const hashDisplay = hashSha256.substring(0, 16) + '...'; // Show first 16 chars\n\n      li.innerHTML = `\n        <div class=\"history-icon-wrapper\">\n          <div class=\"history-icon ${classType}\">\n            <i class=\"${statusIcon}\"></i>\n          </div>\n          <div class=\"history-file-type\">\n            <i class=\"${fileTypeIcon}\"></i>\n          </div>\n        </div>\n        <div class=\"history-details\">\n          <span class=\"history-filename\" title=\"${filename}\">${filename}</span>\n          <span class=\"history-classification ${classType}\">${scan.classification}</span>\n          <span class=\"history-hash\" title=\"${hashSha256}\">SHA256: ${hashDisplay}</span>\n        </div>\n        <span class=\"history-date\">${scanDate}</span>\n      `;\n      \n      historyListEl.appendChild(li);\n    });\n\n  } catch (err) {\n    console.error('Failed to load history:', err);\n    historyListEl.innerHTML = '<li class=\"history-item-empty\">Error loading history.</li>';\n  }\n}\n\nfunction toggleHistoryPanel() {\n  bodyEl.classList.toggle('is-history-open');\n  \n  // ADD THIS: If we are opening the panel, load the history\n  if (bodyEl.classList.contains('is-history-open')) {\n    loadHistory();\n  }\n}\n\nhistoryBtn.addEventListener('click', (e) => {\n    e.preventDefault();\n    toggleHistoryPanel();\n});\nhistoryCloseBtn.addEventListener('click', toggleHistoryPanel);\nhistoryOverlay.addEventListener('click', toggleHistoryPanel);\n\n\n// --- Auto-scroll Logic ---\nfunction startScrolling(direction) {\n    if (scrollInterval) {\n        clearInterval(scrollInterval);\n    }\n    scrollInterval = setInterval(() => {\n        window.scrollBy(0, direction * 10); // 10 pixels at a time\n    }, 20); // every 20ms\n}\n\nfunction stopScrolling() {\n    clearInterval(scrollInterval);\n    scrollInterval = null;\n}\n\nscrollZoneTop.addEventListener('mouseenter', () => {\n    startScrolling(-1); // Scroll Up\n    scrollZoneTop.classList.add('scrolling');\n});\nscrollZoneTop.addEventListener('mouseleave', () => {\n    stopScrolling();\n    scrollZoneTop.classList.remove('scrolling');\n});\n\nscrollZoneBottom.addEventListener('mouseenter', () => {\n    startScrolling(1); // Scroll Down\n    scrollZoneBottom.classList.add('scrolling');\n});\nscrollZoneBottom.addEventListener('mouseleave', () => {\n    stopScrolling();\n    scrollZoneBottom.classList.remove('scrolling');\n});\n\n\n// --- Chart instances ---\nlet malwareTypesChart = null;\nlet topMalwareChart = null;\n\n// --- Function to create/recreate charts ---\nwindow.recreateCharts = function() {\n    // Check if light theme is active\n    const isLightTheme = document.body.classList.contains('light-theme');\n    \n    // Set colors based on theme\n    const chartLegendColor = isLightTheme ? '#6c757d' : '#e0e0e0';\n    const chartAxesColor = isLightTheme ? '#6c757d' : '#aaa';\n    const chartGridColor = isLightTheme ? '#dee2e6' : '#444444';\n\n    // Destroy existing charts if they exist\n    if (malwareTypesChart) {\n        malwareTypesChart.destroy();\n    }\n    if (topMalwareChart) {\n        topMalwareChart.destroy();\n    }\n\n    // Create Malware Types Chart (Doughnut)\n    const typesCtx = document.getElementById('malwareTypesChart');\n    if (typesCtx) {\n        malwareTypesChart = new Chart(typesCtx, {\n            type: 'doughnut',\n            data: {\n                labels: ['PE (exe/dll)', 'JavaScript', 'VBS', 'Macro', 'Other'],\n                datasets: [{\n                    label: 'Submission Types',\n                    data: [65, 15, 8, 7, 5],\n                    backgroundColor: [\n                        '#007bff', // Blue\n                        '#f1c40f', // Yellow\n                        '#e74c3c', // Red\n                        '#9b59b6', // Purple\n                        '#34495e'  // Gray\n                    ],\n                    borderColor: '#2a2a2e',\n                    borderWidth: 3,\n                }]\n            },\n            options: {\n                responsive: true,\n                plugins: {\n                    legend: {\n                        position: 'right',\n                        labels: {\n                            color: chartLegendColor,\n                            boxWidth: 20\n                        }\n                    }\n                }\n            }\n        });\n    }\n\n    // Create Top Malware Chart (Line)\n    const topMalwareCtx = document.getElementById('topMalwareChart');\n    if (topMalwareCtx) {\n        topMalwareChart = new Chart(topMalwareCtx, {\n            type: 'line',\n            data: {\n                labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5'],\n                datasets: [\n                    {\n                        label: 'Zeus',\n                        data: [120, 150, 130, 180, 160],\n                        borderColor: '#e74c3c',\n                        backgroundColor: '#e74c3c20',\n                        fill: true,\n                        tension: 0.4\n                    },\n                    {\n                        label: 'WannaCry',\n                        data: [80, 90, 110, 100, 130],\n                        borderColor: '#007bff',\n                        backgroundColor: '#007bff20',\n                        fill: true,\n                        tension: 0.4\n                    },\n                    {\n                        label: 'Emotet',\n                        data: [50, 60, 80, 70, 90],\n                        borderColor: '#f1c40f',\n                        backgroundColor: '#f1c40f20',\n                        fill: true,\n                        tension: 0.4\n                    }\n                ]\n            },\n            options: {\n                responsive: true,\n                plugins: {\n                    legend: {\n                        labels: {\n                            color: chartLegendColor\n                        }\n                    }\n                },\n                scales: {\n                    x: {\n                        ticks: { color: chartAxesColor },\n                        grid: { color: chartGridColor + '50' }\n                    },\n                    y: {\n                        ticks: { color: chartAxesColor },\n                        grid: { color: chartGridColor }\n                    }\n                }\n            }\n        });\n    }\n};\n\n// --- NAVIGATION FUNCTIONS ---\nfunction updateNavigationButtons() {\n    const prevBtn = document.getElementById('prev-scan-btn');\n    const nextBtn = document.getElementById('next-scan-btn');\n    const navInfo = document.getElementById('nav-info');\n    \n    if (!prevBtn || !nextBtn) return;\n    \n    // Disable/enable buttons based on position\n    prevBtn.disabled = currentHistoryIndex <= 0;\n    nextBtn.disabled = currentHistoryIndex >= scanHistory.length - 1;\n    \n    // Update info text\n    if (navInfo && scanHistory.length > 0) {\n        navInfo.textContent = `${currentHistoryIndex + 1} of ${scanHistory.length}`;\n    }\n}\n\nfunction showPreviousScan() {\n    if (currentHistoryIndex > 0) {\n        currentHistoryIndex--;\n        lastScanResult = scanHistory[currentHistoryIndex];\n        renderScanResult();\n        updateNavigationButtons();\n    }\n}\n\nfunction showNextScan() {\n    if (currentHistoryIndex < scanHistory.length - 1) {\n        currentHistoryIndex++;\n        lastScanResult = scanHistory[currentHistoryIndex];\n        renderScanResult();\n        updateNavigationButtons();\n    }\n}\n\n// Initialize history from electron-store on load\nasync function initializeScanHistory() {\n    try {\n        const storedHistory = await window.electronAPI.getHistory();\n        if (storedHistory && Array.isArray(storedHistory)) {\n            scanHistory = storedHistory;\n            currentHistoryIndex = scanHistory.length - 1;\n        }\n    } catch (error) {\n        console.error('Failed to load scan history:', error);\n    }\n}\n\n// --- Run on Page Load ---\ndocument.addEventListener('DOMContentLoaded', () => {\n    // 1. Animate Stat Cards\n    const statNumbers = document.querySelectorAll('.stat-number');\n    statNumbers.forEach(stat => {\n        const target = +stat.getAttribute('data-target');\n        const duration = 2000;\n        const stepTime = 20;\n        const steps = duration / stepTime;\n        const increment = target / steps;\n        let current = 0;\n\n        const updateCount = () => {\n            current += increment;\n            if (current < target) {\n                stat.textContent = Math.ceil(current).toLocaleString();\n                setTimeout(updateCount, stepTime);\n            } else {\n                stat.textContent = target.toLocaleString();\n            }\n        };\n        updateCount();\n    });\n\n    // 2. Create the charts\n    recreateCharts();\n    \n    // 3. Initialize scan history\n    initializeScanHistory();\n    \n    // 4. Setup navigation button handlers\n    const prevBtn = document.getElementById('prev-scan-btn');\n    const nextBtn = document.getElementById('next-scan-btn');\n    \n    if (prevBtn) prevBtn.addEventListener('click', showPreviousScan);\n    if (nextBtn) nextBtn.addEventListener('click', showNextScan);\n});\n","range":{"startLineNumber":1,"startColumn":1,"endLineNumber":1003,"endColumn":1}}]}],"epochCounter":168},"recentSnapshot":{"entries":[{"resource":"file:///home/trang/localnsv/mAIware/scanner-worker.js","languageId":"javascript","originalHash":"2831018","currentHash":"4ba70a1","state":1,"snapshotUri":"chat-editing-snapshot-text-model:/home/trang/localnsv/mAIware/scanner-worker.js?%7B%22sessionId%22%3A%22d2a16561-89d0-479e-b8a9-96146f0b6791%22%2C%22requestId%22%3A%22%22%2C%22undoStop%22%3A%22%22%7D","telemetryInfo":{"requestId":"request_a81df6a6-91d1-44bf-86f6-897ed9dbad49","agentId":"github.copilot.editsAgent","modelId":"copilot/gpt-5","modeId":"agent"}},{"resource":"file:///home/trang/localnsv/mAIware/jsonsamples.js","languageId":"javascript","originalHash":"c18471e","currentHash":"c18471e","state":2,"snapshotUri":"chat-editing-snapshot-text-model:/home/trang/localnsv/mAIware/jsonsamples.js?%7B%22sessionId%22%3A%22d2a16561-89d0-479e-b8a9-96146f0b6791%22%2C%22requestId%22%3A%22%22%2C%22undoStop%22%3A%22%22%7D","telemetryInfo":{"requestId":"request_c4b64de9-7660-4b42-afcf-12b654c111ef","agentId":"github.copilot.editsAgent","modelId":"copilot/claude-sonnet-4.5","modeId":"agent"}},{"resource":"file:///home/trang/localnsv/mAIware-server/server.js","languageId":"javascript","originalHash":"7867633","currentHash":"9e43f58","state":1,"snapshotUri":"chat-editing-snapshot-text-model:/home/trang/localnsv/mAIware-server/server.js?%7B%22sessionId%22%3A%22d2a16561-89d0-479e-b8a9-96146f0b6791%22%2C%22requestId%22%3A%22%22%2C%22undoStop%22%3A%22%22%7D","telemetryInfo":{"requestId":"request_f84e9d07-b060-4595-acd7-32ca34f0d58e","agentId":"github.copilot.editsAgent","modelId":"copilot/gpt-5","modeId":"agent"}},{"resource":"file:///home/trang/localnsv/mAIware-server/public/dashboard.html","languageId":"html","originalHash":"b64cdad","currentHash":"04b0e49","state":1,"snapshotUri":"chat-editing-snapshot-text-model:/home/trang/localnsv/mAIware-server/public/dashboard.html?%7B%22sessionId%22%3A%22d2a16561-89d0-479e-b8a9-96146f0b6791%22%2C%22requestId%22%3A%22%22%2C%22undoStop%22%3A%22%22%7D","telemetryInfo":{"requestId":"request_2d995c41-e4fb-4a32-8754-875cabc8f1e3","agentId":"github.copilot.editsAgent","modelId":"copilot/claude-sonnet-4.5","modeId":"agent"}},{"resource":"file:///home/trang/localnsv/mAIware-server/public/styles.css","languageId":"css","originalHash":"ba79231","currentHash":"2e100e4","state":1,"snapshotUri":"chat-editing-snapshot-text-model:/home/trang/localnsv/mAIware-server/public/styles.css?%7B%22sessionId%22%3A%22d2a16561-89d0-479e-b8a9-96146f0b6791%22%2C%22requestId%22%3A%22%22%2C%22undoStop%22%3A%22%22%7D","telemetryInfo":{"requestId":"request_2d995c41-e4fb-4a32-8754-875cabc8f1e3","agentId":"github.copilot.editsAgent","modelId":"copilot/claude-sonnet-4.5","modeId":"agent"}},{"resource":"file:///home/trang/localnsv/mAIware/script.js","languageId":"javascript","originalHash":"615f98a","currentHash":"615f98a","state":1,"snapshotUri":"chat-editing-snapshot-text-model:/home/trang/localnsv/mAIware/script.js?%7B%22sessionId%22%3A%22d2a16561-89d0-479e-b8a9-96146f0b6791%22%2C%22requestId%22%3A%22%22%2C%22undoStop%22%3A%22%22%7D","telemetryInfo":{"requestId":"request_0bd3737c-96a7-45c8-bdaa-69c39a73dfda","agentId":"github.copilot.editsAgent","modelId":"copilot/gpt-5","modeId":"agent"}},{"resource":"file:///home/trang/localnsv/mAIware/index.html","languageId":"html","originalHash":"66e902a","currentHash":"66e902a","state":1,"snapshotUri":"chat-editing-snapshot-text-model:/home/trang/localnsv/mAIware/index.html?%7B%22sessionId%22%3A%22d2a16561-89d0-479e-b8a9-96146f0b6791%22%2C%22requestId%22%3A%22%22%2C%22undoStop%22%3A%22%22%7D","telemetryInfo":{"requestId":"request_0bd3737c-96a7-45c8-bdaa-69c39a73dfda","agentId":"github.copilot.editsAgent","modelId":"copilot/gpt-5","modeId":"agent"}},{"resource":"file:///home/trang/localnsv/mAIware/style.css","languageId":"css","originalHash":"6fb6755","currentHash":"6fb6755","state":1,"snapshotUri":"chat-editing-snapshot-text-model:/home/trang/localnsv/mAIware/style.css?%7B%22sessionId%22%3A%22d2a16561-89d0-479e-b8a9-96146f0b6791%22%2C%22requestId%22%3A%22%22%2C%22undoStop%22%3A%22%22%7D","telemetryInfo":{"requestId":"request_0bd3737c-96a7-45c8-bdaa-69c39a73dfda","agentId":"github.copilot.editsAgent","modelId":"copilot/gpt-5","modeId":"agent"}}]}}