{"version":2,"sessionId":"e1c6ec5b-7388-4656-b500-368a2912e7fd","initialFileContents":[["file:///home/trang/mAIware/script.js","722591c"],["file:///home/trang/mAIware/index.html","3920da8"]],"timeline":{"checkpoints":[{"checkpointId":"214257e5-8af4-4a57-a3e0-5e3112b1678a","epoch":0,"label":"Initial State","description":"Starting point before any edits"},{"checkpointId":"800af575-34ec-43f2-a6c3-2619e637ce2f","requestId":"request_424e0510-5c08-4f92-af89-15bb7d9f791a","epoch":1,"label":"Request request_424e0510-5c08-4f92-af89-15bb7d9f791a"},{"checkpointId":"b77e3172-aa14-4e75-93d4-540f27e94a8b","requestId":"request_e291023b-a085-431d-9d97-e3db92d6eb3b","epoch":2,"label":"Request request_e291023b-a085-431d-9d97-e3db92d6eb3b"},{"checkpointId":"91ed8651-30a6-4d4b-9400-904ce45fd075","requestId":"request_e291023b-a085-431d-9d97-e3db92d6eb3b","undoStopId":"9386bb3d-4728-471d-9ff3-9250518e50e4","epoch":3,"label":"Request request_e291023b-a085-431d-9d97-e3db92d6eb3b - Stop 9386bb3d-4728-471d-9ff3-9250518e50e4"},{"checkpointId":"e8f43f7f-9d1d-4399-bec2-9cfc34e3abd7","requestId":"request_e291023b-a085-431d-9d97-e3db92d6eb3b","undoStopId":"34530669-f135-4e58-baa6-c498df59ae31","epoch":7,"label":"Request request_e291023b-a085-431d-9d97-e3db92d6eb3b - Stop 34530669-f135-4e58-baa6-c498df59ae31"},{"checkpointId":"6a42c774-18f4-49c1-a257-7d03a56c5212","requestId":"request_e291023b-a085-431d-9d97-e3db92d6eb3b","undoStopId":"4aa20e14-dd66-44b5-93af-f6c2e341c542","epoch":10,"label":"Request request_e291023b-a085-431d-9d97-e3db92d6eb3b - Stop 4aa20e14-dd66-44b5-93af-f6c2e341c542"},{"checkpointId":"00aa2b54-2e9d-4311-9cad-8a9132853e92","requestId":"request_dea95259-dc59-44ee-8b2e-71bfbcd038b0","epoch":12,"label":"Request request_dea95259-dc59-44ee-8b2e-71bfbcd038b0"},{"checkpointId":"c1630b67-52b3-4c4a-940a-510528c8389d","requestId":"request_dea95259-dc59-44ee-8b2e-71bfbcd038b0","undoStopId":"0ab3ca85-b3d8-4369-b358-09a6e1f3a8bd","epoch":13,"label":"Request request_dea95259-dc59-44ee-8b2e-71bfbcd038b0 - Stop 0ab3ca85-b3d8-4369-b358-09a6e1f3a8bd"},{"checkpointId":"daec299e-d092-40df-bd2c-6662dbb70372","requestId":"request_b7d8c486-3525-4954-bb70-78dfb4c10314","epoch":16,"label":"Request request_b7d8c486-3525-4954-bb70-78dfb4c10314"},{"checkpointId":"3ace52df-43c5-4792-a679-eb689b6ccc1a","requestId":"request_b7d8c486-3525-4954-bb70-78dfb4c10314","undoStopId":"72d7c4e4-46b6-40d1-84ea-8b8301a7a2a0","epoch":17,"label":"Request request_b7d8c486-3525-4954-bb70-78dfb4c10314 - Stop 72d7c4e4-46b6-40d1-84ea-8b8301a7a2a0"},{"checkpointId":"4dcfe78e-01b5-4fb7-a5b3-b284a2c52e38","requestId":"request_b7d8c486-3525-4954-bb70-78dfb4c10314","undoStopId":"385d15bd-0268-4baa-be33-ab5c6d882b18","epoch":18,"label":"Request request_b7d8c486-3525-4954-bb70-78dfb4c10314 - Stop 385d15bd-0268-4baa-be33-ab5c6d882b18"},{"checkpointId":"d971288c-b9c4-4436-a703-362f86e14995","requestId":"request_b7d8c486-3525-4954-bb70-78dfb4c10314","undoStopId":"0c83fc54-7599-47b0-b7c1-d3482181e896","epoch":23,"label":"Request request_b7d8c486-3525-4954-bb70-78dfb4c10314 - Stop 0c83fc54-7599-47b0-b7c1-d3482181e896"},{"checkpointId":"c2c5491d-6508-44c8-8af3-1e2d2ea0f504","requestId":"request_b7d8c486-3525-4954-bb70-78dfb4c10314","undoStopId":"59ad6ab2-dc34-4634-a2c9-c743bc75c2dc","epoch":25,"label":"Request request_b7d8c486-3525-4954-bb70-78dfb4c10314 - Stop 59ad6ab2-dc34-4634-a2c9-c743bc75c2dc"},{"checkpointId":"c44f4583-1fad-4c31-8307-49916d1586c8","requestId":"request_ef032d5f-157a-4667-b208-0835d9103e70","epoch":27,"label":"Request request_ef032d5f-157a-4667-b208-0835d9103e70"},{"checkpointId":"a084a02d-82ae-458a-96ed-486a07376591","requestId":"request_ef032d5f-157a-4667-b208-0835d9103e70","undoStopId":"2feeba39-4f15-4269-a6b4-1acdc716b56b","epoch":28,"label":"Request request_ef032d5f-157a-4667-b208-0835d9103e70 - Stop 2feeba39-4f15-4269-a6b4-1acdc716b56b"}],"currentEpoch":31,"fileBaselines":[["file:///home/trang/mAIware/script.js::request_e291023b-a085-431d-9d97-e3db92d6eb3b",{"uri":{"$mid":1,"fsPath":"/home/trang/mAIware/script.js","external":"file:///home/trang/mAIware/script.js","path":"/home/trang/mAIware/script.js","scheme":"file"},"requestId":"request_e291023b-a085-431d-9d97-e3db92d6eb3b","content":"// --- MOCK DISASSEMBLY DATA ---\n// (We keep this for now, as requested)\nconst mockDisassemblyBenign = [\n    `<span class=\"addr\">0x401000</span> <span class=\"op\">PUSH</span> <span class=\"args\">ebp</span> <span class=\"comment\">; setup stack frame</span>`,\n    `<span class=\"addr\">0x401001</span> <span class=\"op\">MOV</span> <span class=\"args\">ebp, esp</span>`,\n    `<span class=\"addr\">0x401003</span> <span class=\"op\">SUB</span> <span class=\"args\">esp, 48h</span>`,\n    `<span class=\"addr\">0x40100C</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4012A0</span> <span class=\"comment\">; initialize_string</span>`,\n    `<span class=\"addr\">0x401015</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4013F0</span> <span class=\"comment\">; get_user_input</span>`,\n    `<span class=\"addr\">0x40101E</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4015D0</span> <span class=\"comment\">; print_output</span>`,\n    `<span class=\"addr\">0x401028</span> <span class=\"op\">RETN</span>`,\n    `<span class=\"addr\">...</span>`,\n];\nconst mockDisassemblySuspicious = [\n    `<span class=\"addr\">0x401000</span> <span class=\"op\">PUSH</span> <span class=\"args\">ebp</span>`,\n    `<span class=\"addr\">0x401003</span> <span class=\"op\">SUB</span> <span class=\"args\">esp, 80h</span>`,\n    `<span class=\"addr\">0x40100D</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4012A0</span> <span class=\"comment\">; read_file_to_buffer</span>`,\n    `<span class=\"addr\">0x40101B</span> <span class=\"op\">REP</span> <span class=\"op\">MOVSB</span> <span class=\"comment\">; unsafe buffer write</span>`,\n    `<span class=\"addr\">0x401020</span> <span class=\"op\">JGE</span> <span class=\"args\">0x401030</span> <span class=\"comment\">; jump if overflow</span>`,\n    `<span class=\"addr\">0x401028</span> <span class=\"op\">RETN</span>`,\n    `<span class=\"addr\">...</span>`,\n];\nconst mockDisassemblyMalware = [\n    `<span class=\"addr\">0x401000</span> <span class=\"op\">PUSH</span> <span class=\"args\">ebp</span> <span class=\"comment\">; setup stack frame</span>`,\n    `<span class=\"addr\">0x40100B</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4011B0</span> <span class=\"comment\">; kernel32.LoadLibraryA</span>`,\n    `<span class=\"addr\">0x401013</span> <span class=\"op\">PUSH</span> <span class=\"string\">\"CreateRemoteThread\"</span>`,\n    `<span class=\"addr\">0x401019</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4011C0</span> <span class=\"comment\">; kernel32.GetProcAddress</span>`,\n    `<span class=\"addr\">0x401028</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4012F0</span> <span class=\"comment\">; decrypt_payload</span>`,\n    `<span class=\"addr\">0x401034</span> <span class=\"op\">CALL</span> <span class=\"args\">[ebp-24h]</span> <span class=\"comment\">; call CreateRemoteThread</span>`,\n    `<span class=\"addr\">0x401037</span> <span class=\"op\">JMP</span> <span class=\"args\">0x40102D</span> <span class=\"comment\">; loop?</span>`,\n    `<span class=\"addr\">...</span>`,\n];\n\n// --- REMOVED MOCK GRAPH DATA ---\n// const mockGraphSafe = ... (DELETED)\n// const mockGraphSuspicious = ... (DELETED)\n// const mockGraphMalware = ... (DELETED)\n\n// --- ELEMENT REFERENCES ---\nconst initialState = document.getElementById('initial-state');\nconst analyzingState = document.getElementById('analyzing-state');\nconst resultState = document.getElementById('result-state');\n\nconst analyzingFilename = document.getElementById('analyzing-filename');\nconst resultIcon = document.getElementById('result-icon');\nconst resultText = document.getElementById('result-text');\nconst resultFilename = document.getElementById('result-filename');\nconst resultDetails = document.getElementById('result-details');\nconst nonPeResultWrapper = document.getElementById('non-pe-result');\nconst nonPeFilename = document.getElementById('non-pe-filename');\nconst nonPeHashSha256 = document.getElementById('non-pe-hash-sha256');\nconst nonPeHashMd5 = document.getElementById('non-pe-hash-md5');\n\nconst bodyEl = document.body;\nlet animationWrapper = null;\n\nconst disassemblyWrapper = document.getElementById('disassembly-wrapper');\nconst disassemblyCodeEl = document.getElementById('disassembly-code');\nconst disassemblyFilenameEl = document.getElementById('disassembly-filename');\n\n// Analysis Details elements\nconst analysisDetailsWrapper = document.getElementById('analysis-details-wrapper');\nconst progressBarFill = document.getElementById('progress-bar-fill');\nconst scorePercentage = document.getElementById('score-percentage');\nconst detailsReasoning = document.getElementById('details-reasoning'); // We'll reuse this\nconst detailsHashSha256 = document.getElementById('details-hash-sha256');\nconst detailsHashMd5 = document.getElementById('details-hash-md5');\nconst detailsSystemIp = document.getElementById('details-system-ip');\nconst detailsRecommendation = document.getElementById('details-recommendation');\nconst detailsVendor = document.getElementById('details-vendor');\nconst detailsSignature = document.getElementById('details-signature');\nconst fileInternalsWrapper = document.getElementById('file-internals-wrapper');\nconst entropyBarsContainer = document.getElementById('entropy-bars-container');\nconst keyStringsContainer = document.getElementById('key-strings-container');\n\n// History Panel elements\nconst historyBtn = document.getElementById('history-btn');\nconst historyPanel = document.getElementById('history-panel');\nconst historyCloseBtn = document.getElementById('history-close-btn');\nconst historyOverlay = document.getElementById('history-overlay');\nconst historyListEl = document.querySelector('.history-list');\n\n// Scroll Zone elements\nconst scrollZoneTop = document.getElementById('scroll-zone-top');\nconst scrollZoneBottom = document.getElementById('scroll-zone-bottom');\n\n// Graph Panel elements\nconst graphWrapper = document.getElementById('graph-wrapper');\nconst callGraphEl = document.getElementById('call-graph');\n\n// Stats elements\nconst statsWrapper = document.getElementById('stats-wrapper');\n\n\n// --- STATE ---\nlet disassemblyInterval = null;\nlet scrollInterval = null; // For auto-scrolling\nlet currentGraphLines = []; // Renamed from currentLines to avoid conflict\nlet currentFileMetadata = null;\nlet lastScanResult = null;\n\n// 1. Listen for the 'scan-started' message from the backend\nwindow.electronAPI.onScanStarted((filename) => {\n  console.log(`UI: Received scan-started for ${filename}`);\n\n  // 1. Set UI to \"Analyzing\" state\n  initialState.classList.remove('active'); //\n  analyzingState.classList.add('active'); //\n  analyzingFilename.textContent = filename; //\n  disassemblyFilenameEl.textContent = filename; //\n\n  currentFileMetadata = { filename, isPe: true };\n  lastScanResult = null;\n  nonPeResultWrapper.classList.remove('active');\n  bodyEl.classList.remove('is-non-pe');\n\n  // 2. Update body class to show disassembly\n  bodyEl.classList.remove('is-showing-result'); //\n  bodyEl.classList.add('is-analyzing'); //\n  removeAnimationClasses(); //\n  \n  // 3. Populate disassembly with a \"suspicious\" default and start animation\n  // (We don't know the result yet, so we pick one)\n  populateDisassembly(mockDisassemblySuspicious); //\n  startDisassemblyAnimation(); //\n\n  // 4. Clear old results\n  clearResultData();\n});\n\n// 2. Listen for the 'scan-result' message\nwindow.electronAPI.onScanResult((scanResult) => {\n  console.log(\"UI: Received scan-result:\", scanResult);\n\n  clearInterval(disassemblyInterval); //\n  disassemblyInterval = null; //\n\n  bodyEl.classList.remove('is-analyzing'); //\n  bodyEl.classList.add('is-showing-result'); //\n\n  analyzingState.classList.remove('active'); //\n  resultState.classList.add('active'); //\n\n  lastScanResult = scanResult;\n\n  renderScanResult();\n});\n\nwindow.electronAPI.onScanFileMetadata((metadata) => {\n  if (!metadata || typeof metadata !== 'object') {\n    return;\n  }\n\n  currentFileMetadata = metadata;\n\n  if (lastScanResult && metadata.filename === lastScanResult.detected_filename) {\n    renderScanResult();\n  }\n});\n\nfunction renderScanResult() {\n  if (!lastScanResult) {\n    return;\n  }\n\n  const metadataMatches = currentFileMetadata && currentFileMetadata.filename === lastScanResult.detected_filename;\n  const isNonPe = metadataMatches && currentFileMetadata.isPe === false;\n\n  if (isNonPe) {\n    renderNonPeResult(lastScanResult);\n    return;\n  }\n\n  renderPeResult(lastScanResult);\n}\n\nfunction ensureAnimationWrapper() {\n  if (animationWrapper) {\n    return;\n  }\n\n  animationWrapper = document.createElement('div');\n  animationWrapper.className = 'animation-swarm';\n  for (let i = 0; i < 10; i++) {\n    const particle = document.createElement('span');\n    animationWrapper.appendChild(particle);\n  }\n  bodyEl.prepend(animationWrapper);\n}\n\nfunction renderPeResult(scanResult) {\n  removeAnimationClasses();\n  bodyEl.classList.remove('is-non-pe');\n  nonPeResultWrapper.classList.remove('active');\n\n  let resultIconClass = 'fas fa-check-circle'; //\n  let resultMockDisassembly = mockDisassemblyBenign; //\n  let resultBodyClass = 'result-safe-active'; //\n  let resultScannerClass = 'result-safe'; //\n  let resultProgressClass = 'progress-bar-green'; //\n  let resultScoreClass = 'score-green'; //\n  let recommendation = 'You can safely run this file.'; //\n\n  if (scanResult.classification.includes('Malware')) {\n    resultIconClass = 'fas fa-bug';\n    resultMockDisassembly = mockDisassemblyMalware;\n    resultBodyClass = 'result-malware-active'; //\n    resultScannerClass = 'result-malware'; //\n    resultProgressClass = 'progress-bar-red'; //\n    resultScoreClass = 'score-red'; //\n    recommendation = 'DO NOT OPEN. Quarantine this file immediately.'; //\n  } else if (scanResult.classification.includes('Suspicious')) {\n    resultIconClass = 'fas fa-exclamation-triangle'; //\n    resultMockDisassembly = mockDisassemblySuspicious; //\n    resultBodyClass = 'result-suspicious-active'; //\n    resultScannerClass = 'result-suspicious'; //\n    resultProgressClass = 'progress-bar-yellow'; //\n    resultScoreClass = 'score-yellow'; //\n    recommendation = 'Be cautious. Only run if you trust the source.'; //\n  }\n\n  ensureAnimationWrapper();\n  bodyEl.classList.add(resultBodyClass); //\n\n  resultState.className = `scanner-state active ${resultScannerClass}`; //\n  resultIcon.className = `result-icon ${resultIconClass}`; //\n  resultText.textContent = scanResult.classification; //\n\n  let detailsText = `Scanned ${scanResult.detected_filename}.`;\n  if (scanResult.malware_family) {\n    detailsText = `Family: ${scanResult.malware_family}`;\n  }\n  resultDetails.textContent = detailsText;\n  resultFilename.textContent = scanResult.detected_filename; //\n\n  progressBarFill.className = 'progress-bar-fill'; //\n  scorePercentage.className = 'score-percentage'; //\n  progressBarFill.classList.add(resultProgressClass); //\n  const rawConfidence = Number(scanResult.confidence_score);\n  const confidenceValue = Number.isFinite(rawConfidence) ? rawConfidence * 100 : 0;\n  progressBarFill.style.width = `${confidenceValue}%`; //\n  scorePercentage.textContent = `${Math.round(confidenceValue)}%`; //\n  scorePercentage.classList.add(resultScoreClass); //\n\n  detailsReasoning.textContent = `Filetype: ${scanResult.key_findings.file_type}. Packer: ${scanResult.key_findings.packer_detected}.`; //\n  const hashData = scanResult.file_hashes || {};\n  detailsHashSha256.textContent = hashData.sha256 || 'Not available'; //\n  detailsHashMd5.textContent = hashData.md5 || 'Not available'; //\n  updateSystemIpDisplay();\n  detailsRecommendation.textContent = recommendation;\n\n  populateVendor(scanResult.vendor); //\n  populateSignature(scanResult.key_findings.signature); //\n  populateEntropyBars(scanResult.key_findings.section_entropy || []); //\n  populateKeyStrings(scanResult.key_findings.key_strings || [], scanResult.classification); //\n\n  populateDisassembly(resultMockDisassembly); //\n\n  const apiList = scanResult.key_findings.api_imports || [];\n  const graphData = generateGraphData(apiList, scanResult.classification);\n  drawCallGraph(graphData);\n}\n\nfunction renderNonPeResult(scanResult) {\n  removeAnimationClasses();\n  bodyEl.classList.add('is-non-pe');\n  resultState.className = 'scanner-state active';\n  resultIcon.className = 'result-icon fas fa-file';\n  resultText.textContent = '';\n  resultDetails.textContent = '';\n  resultFilename.textContent = '';\n\n  const hashData = scanResult.file_hashes || {};\n  nonPeFilename.textContent = scanResult.detected_filename || '';\n  nonPeHashSha256.textContent = hashData.sha256 || 'Not available';\n  nonPeHashMd5.textContent = hashData.md5 || 'Not available';\n\n  detailsHashSha256.textContent = hashData.sha256 || 'Not available';\n  detailsHashMd5.textContent = hashData.md5 || 'Not available';\n\n  nonPeResultWrapper.classList.add('active');\n\n  callGraphEl.innerHTML = '';\n  currentGraphLines.forEach(line => line.remove());\n  currentGraphLines = [];\n  entropyBarsContainer.innerHTML = '';\n  keyStringsContainer.innerHTML = '';\n}\n\n/**\n * Clears all dynamic result data to prepare for the next scan.\n */\nfunction clearResultData() {\n    // Clear scanner panel\n    resultText.textContent = '';\n    resultDetails.textContent = '';\n    resultFilename.textContent = '';\n    nonPeResultWrapper.classList.remove('active');\n    nonPeFilename.textContent = '';\n    nonPeHashSha256.textContent = '...';\n    nonPeHashMd5.textContent = '...';\n    bodyEl.classList.remove('is-non-pe');\n\n    // Clear analysis panel\n    progressBarFill.style.width = `0%`;\n    scorePercentage.textContent = `0%`;\n    detailsReasoning.textContent = '...';\n    detailsHashSha256.textContent = '...';\n    detailsHashMd5.textContent = '...';\n    if (detailsSystemIp) {\n        detailsSystemIp.textContent = 'Detecting...';\n    }\n    detailsRecommendation.textContent = '...';\n\n    // Clear vendor\n    detailsVendor.innerHTML = `\n        <h4>Vendor Analysis</h4>\n        <div class=\"vendor-info\">\n            <i class=\"fas fa-question-circle\"></i>\n            <span>Scanning...</span>\n        </div>`;\n    \n    // Clear signature\n    detailsSignature.innerHTML = `\n        <h4>Digital Signature</h4>\n        <div class=\"signature-info\">\n            <i class=\"fas fa-question-circle\"></i>\n            <span>Checking...</span>\n        </div>`;\n    \n    // Clear internals\n    entropyBarsContainer.innerHTML = '';\n    keyStringsContainer.innerHTML = '';\n    \n    // Clear graph\n    callGraphEl.innerHTML = '';\n    currentGraphLines.forEach(line => line.remove());\n    currentGraphLines = [];\n}\n\n// --- VENDOR UI FUNCTION (IMPLEMENTED) ---\nfunction populateVendor(vendor) {\n    if (!vendor) return;\n    const icon = vendor.icon || 'fas fa-question-circle'; //\n    const name = vendor.name || 'Unknown'; //\n    detailsVendor.innerHTML = `\n        <h4>Vendor Analysis</h4> <div class=\"vendor-info\"> <i class=\"${icon}\"></i>\n            <span>${name}</span>\n        </div>\n    `;\n}\n\n// --- SIGNATURE UI FUNCTION (IMPLEMENTED) ---\nfunction populateSignature(signature) {\n    if (!signature) return;\n    let icon = signature.icon || 'fas fa-question-circle';\n    let cssClass = `sig-${signature.level || 'unknown'}`; // 'sig-verified', 'sig-untrusted', 'sig-unknown'\n\n    detailsSignature.innerHTML = `\n        <h4>Digital Signature</h4> <div class=\"signature-info ${cssClass}\"> <i class=\"${icon}\"></i>\n            <span>${signature.name}</span>\n        </div>\n    `;\n}\n\n// --- ENTROPY BARS UI FUNCTION (IMPLEMENTED) ---\nfunction populateEntropyBars(sections) {\n    entropyBarsContainer.innerHTML = ''; // Clear old bars\n    if (!sections || sections.length === 0) {\n        entropyBarsContainer.innerHTML = '<p class=\"hash-text\">No PE sections found to analyze.</p>';\n        return;\n    }\n\n    sections.forEach(section => { //\n        const value = section.entropy; //\n        const width = (value / 8.0) * 100; // Entropy is 0-8\n        let cssClass = 'low';\n        \n        if (value > 6.0) cssClass = 'medium';\n        if (value > 7.0) cssClass = 'high';\n        if (value > 7.8) cssClass = 'packed'; // Match style.css\n\n        const row = document.createElement('div');\n        row.className = 'entropy-bar-row';\n        row.innerHTML = `\n            <span class=\"entropy-bar-label\">${section.name}</span> <div class=\"entropy-bar-bg\">\n                <div class=\"entropy-bar-fill ${cssClass}\" style=\"width: ${width}%\">\n                    <span class=\"entropy-bar-value\">${value.toFixed(2)}</span>\n                </div>\n            </div>\n        `;\n        entropyBarsContainer.appendChild(row);\n    });\n}\n\n// --- KEY STRINGS UI FUNCTION (IMPLEMENTED) ---\nfunction populateKeyStrings(strings, classification) {\n    keyStringsContainer.innerHTML = ''; // Clear old strings\n    if (!strings || strings.length === 0) {\n        keyStringsContainer.innerHTML = '<span class=\"key-string-tag\">No notable strings found.</span>';\n        return;\n    }\n    \n    const tagClass = classification.includes('Benign') ? 'benign' : 'suspicious'; //\n\n    strings.forEach(str => { //\n        const tag = document.createElement('span');\n        tag.className = `key-string-tag ${tagClass}`;\n        tag.textContent = str;\n        keyStringsContainer.appendChild(tag);\n    });\n}\n\nfunction updateSystemIpDisplay() {\n    if (!detailsSystemIp || !window.electronAPI || typeof window.electronAPI.getSystemIp !== 'function') {\n        return;\n    }\n\n    detailsSystemIp.textContent = 'Detecting...';\n\n    window.electronAPI.getSystemIp()\n        .then((ip) => {\n            if (!ip) {\n                detailsSystemIp.textContent = 'Unavailable';\n                return;\n            }\n\n            detailsSystemIp.textContent = ip;\n        })\n        .catch(() => {\n            detailsSystemIp.textContent = 'Unavailable';\n        });\n}\n\nfunction removeAnimationClasses() {\n    bodyEl.classList.remove('result-safe-active');\n    bodyEl.classList.remove('result-suspicious-active');\n    bodyEl.classList.remove('result-malware-active');\n}\n\n// --- Disassembly Functions ---\n\nfunction populateDisassembly(codeLines) {\n    disassemblyCodeEl.innerHTML = '';\n    codeLines.forEach((line, index) => {\n        const lineEl = document.createElement('span');\n        lineEl.className = 'disassembly-line';\n        lineEl.id = `line-${index}`;\n        lineEl.innerHTML = line;\n        disassemblyCodeEl.appendChild(lineEl);\n    });\n}\n\nfunction startDisassemblyAnimation() {\n    if (disassemblyInterval) {\n        clearInterval(disassemblyInterval);\n    }\n    let currentLine = 0;\n    const totalLines = disassemblyCodeEl.children.length;\n\n    disassemblyInterval = setInterval(() => {\n        const prevLine = document.querySelector('.disassembly-line.active');\n        if (prevLine) {\n            prevLine.classList.remove('active');\n        }\n\n        const lineEl = document.getElementById(`line-${currentLine}`);\n        if (lineEl) {\n            lineEl.classList.add('active');\n            lineEl.scrollIntoView({\n                behavior: 'smooth',\n                block: 'center',\n                inline: 'nearest'\n            });\n        }\n        currentLine = (currentLine + 1) % totalLines;\n    }, 150);\n}\n\n/**\n * This function was MOVED here from jsonsamples.js\n * Dynamically generates the graph data based on API imports.\n * @param {string[]} apiImports - Array of API names (e.g., ['CreateRemoteThread'])\n * @param {string} classification - 'Benign', 'Suspicious', or 'Malware'\n * @returns {object} A graph object with 'nodes' and 'edges' arrays.\n */\nfunction generateGraphData(apiImports, classification) {\n    let nodes = [];\n    let edges = [];\n    const nodeSpacing = 150;\n    const startY = 100;\n    const startX = 250;\n\n    // 1. Add the Main Entry Point node\n    nodes.push({ \n        id: 'main-entry', \n        label: 'main()', \n        class: 'node-entry', \n        pos: { top: `${startY + (apiImports.length / 2) * (nodeSpacing / 2)}px`, left: '50px' } \n    });\n\n    if (!apiImports || apiImports.length === 0) {\n        // Benign/Empty graph\n        nodes.push({ id: 'benign-1', label: 'ReadFile', class: 'node-std', pos: { top: `${startY}px`, left: `${startX}px` } });\n        nodes.push({ id: 'benign-2', label: 'WriteFile', class: 'node-std', pos: { top: `${startY + nodeSpacing / 2}px`, left: `${startX}px` } });\n        edges.push({ from: 'main-entry', to: 'benign-1', options: { color: '#888' } });\n        edges.push({ from: 'main-entry', to: 'benign-2', options: { color: '#888' } });\n    } else {\n        // Suspicious/Malware graph\n        apiImports.forEach((apiName, index) => {\n            let nodeClass = 'node-api'; // Default\n            let edgeColor = '#888'; // Default\n\n            if (classification === 'Malware') {\n                nodeClass = 'node-malicious';\n                edgeColor = '#e74c3c'; // Malware red\n            } else if (classification === 'Suspicious') {\n                nodeClass = 'node-suspicious';\n                edgeColor = '#f1c40f'; // Suspicious yellow\n            } else {\n                // Benign\n                nodeClass = 'node-std';\n                edgeColor = '#888';\n            }\n\n\n            const nodeId = `api-${index}`;\n            const yPos = startY + (index * (nodeSpacing-50)); // Make them a bit closer\n            const xPos = startX + (index % 2 === 0 ? 0 : 150); // Stagger them\n\n            // Add the API node\n            nodes.push({\n                id: nodeId,\n                label: apiName,\n                class: nodeClass,\n                pos: { top: `${yPos}px`, left: `${xPos}px` }\n            });\n\n            // Add the edge from main\n            edges.push({\n                from: 'main-entry',\n                to: nodeId,\n                options: { color: edgeColor }\n            });\n        });\n    }\n\n    return { nodes, edges };\n}\n\n// --- Graph Drawing ---\nfunction drawCallGraph(graphData) {\n    // 1. Clear previous graph (both nodes and lines)\n    callGraphEl.innerHTML = '';\n    currentGraphLines.forEach(line => line.remove());\n    currentGraphLines = [];\n\n    if (!graphData || !graphData.nodes || !graphData.edges) {\n        console.error(\"Invalid graph data received\", graphData);\n        return;\n    }\n\n    // 2. Create and place all nodes\n    graphData.nodes.forEach(node => {\n        const nodeEl = document.createElement('div');\n        nodeEl.id = node.id;\n        nodeEl.className = `graph-node ${node.class}`;\n        nodeEl.style.top = node.pos.top;\n        nodeEl.style.left = node.pos.left;\n        nodeEl.textContent = node.label;\n        callGraphEl.appendChild(nodeEl);\n    });\n\n    // 3. Draw all edges (must be done *after* nodes are in DOM)\n    // Use a slight timeout to ensure DOM is ready\n    setTimeout(() => {\n        graphData.edges.forEach(edge => {\n            try {\n                const line = new LeaderLine(\n                    document.getElementById(edge.from),\n                    document.getElementById(edge.to),\n                    {\n                        color: edge.options.color,\n                        path: edge.options.path || 'straight',\n                        startSocket: edge.options.startSocket || 'auto',\n                        endSocket: edge.options.endSocket || 'auto',\n                        endPlug: 'arrow1',\n                        size: 3,\n                        endPlugSize: 1.5,\n                    }\n                );\n                currentGraphLines.push(line);\n            } catch(e) {\n                console.error(\"Could not draw line:\", e);\n            }\n        });\n    }, 500); // 500ms timeout to let CSS fade-in finish\n}\n\n\n// --- History Panel Logic ---\nasync function loadHistory() {\n  if (!historyListEl) return;\n  \n  historyListEl.innerHTML = '<li class=\"history-item-loading\">Loading...</li>';\n\n  try {\n    const historyData = await window.electronAPI.getHistory();\n\n    if (!historyData || historyData.length === 0) {\n      historyListEl.innerHTML = '<li class=\"history-item-empty\">No scan history found.</li>';\n      return;\n    }\n\n    historyListEl.innerHTML = '';\n\n    historyData.forEach(scan => {\n      const li = document.createElement('li');\n      li.className = 'history-item';\n\n      // Determine classification icon\n      let statusIcon = 'fas fa-check-circle';\n      let classType = 'safe';\n      if (scan.classification.includes('Malware')) {\n        statusIcon = 'fas fa-bug';\n        classType = 'malware';\n      } else if (scan.classification.includes('Suspicious')) {\n        statusIcon = 'fas fa-exclamation-triangle';\n        classType = 'suspicious';\n      }\n\n      // Determine file type icon based on extension\n      const filename = scan.detected_filename || '';\n      const ext = filename.split('.').pop().toLowerCase();\n      let fileTypeIcon = 'fas fa-file';\n      \n      if (['exe', 'dll', 'sys', 'msi'].includes(ext)) {\n        fileTypeIcon = 'fas fa-cog'; // Executable\n      } else if (['jpg', 'jpeg', 'png', 'gif', 'bmp', 'svg', 'webp'].includes(ext)) {\n        fileTypeIcon = 'fas fa-image'; // Image\n      } else if (['js', 'ts', 'py', 'java', 'cpp', 'c', 'h', 'cs', 'go', 'rs', 'php', 'rb'].includes(ext)) {\n        fileTypeIcon = 'fas fa-code'; // Code\n      } else if (['pdf', 'doc', 'docx', 'txt', 'rtf', 'odt'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-alt'; // Document\n      } else if (['zip', 'rar', '7z', 'tar', 'gz', 'bz2'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-archive'; // Archive\n      } else if (['mp3', 'wav', 'ogg', 'flac', 'aac'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-audio'; // Audio\n      } else if (['mp4', 'avi', 'mkv', 'mov', 'wmv', 'flv'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-video'; // Video\n      } else if (['html', 'htm', 'css', 'xml', 'json'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-code'; // Web file\n      }\n\n      const scanDate = new Date(scan.scanDate).toLocaleString();\n      const hashSha256 = scan.file_hashes?.sha256 || 'N/A';\n      const hashDisplay = hashSha256.substring(0, 16) + '...'; // Show first 16 chars\n\n      li.innerHTML = `\n        <div class=\"history-icon-wrapper\">\n          <div class=\"history-icon ${classType}\">\n            <i class=\"${statusIcon}\"></i>\n          </div>\n          <div class=\"history-file-type\">\n            <i class=\"${fileTypeIcon}\"></i>\n          </div>\n        </div>\n        <div class=\"history-details\">\n          <span class=\"history-filename\" title=\"${filename}\">${filename}</span>\n          <span class=\"history-classification ${classType}\">${scan.classification}</span>\n          <span class=\"history-hash\" title=\"${hashSha256}\">SHA256: ${hashDisplay}</span>\n        </div>\n        <span class=\"history-date\">${scanDate}</span>\n      `;\n      \n      historyListEl.appendChild(li);\n    });\n\n  } catch (err) {\n    console.error('Failed to load history:', err);\n    historyListEl.innerHTML = '<li class=\"history-item-empty\">Error loading history.</li>';\n  }\n}\n\nfunction toggleHistoryPanel() {\n  bodyEl.classList.toggle('is-history-open');\n  \n  // ADD THIS: If we are opening the panel, load the history\n  if (bodyEl.classList.contains('is-history-open')) {\n    loadHistory();\n  }\n}\n\nhistoryBtn.addEventListener('click', (e) => {\n    e.preventDefault();\n    toggleHistoryPanel();\n});\nhistoryCloseBtn.addEventListener('click', toggleHistoryPanel);\nhistoryOverlay.addEventListener('click', toggleHistoryPanel);\n\n\n// --- Auto-scroll Logic ---\nfunction startScrolling(direction) {\n    if (scrollInterval) {\n        clearInterval(scrollInterval);\n    }\n    scrollInterval = setInterval(() => {\n        window.scrollBy(0, direction * 10); // 10 pixels at a time\n    }, 20); // every 20ms\n}\n\nfunction stopScrolling() {\n    clearInterval(scrollInterval);\n    scrollInterval = null;\n}\n\nscrollZoneTop.addEventListener('mouseenter', () => {\n    startScrolling(-1); // Scroll Up\n    scrollZoneTop.classList.add('scrolling');\n});\nscrollZoneTop.addEventListener('mouseleave', () => {\n    stopScrolling();\n    scrollZoneTop.classList.remove('scrolling');\n});\n\nscrollZoneBottom.addEventListener('mouseenter', () => {\n    startScrolling(1); // Scroll Down\n    scrollZoneBottom.classList.add('scrolling');\n});\nscrollZoneBottom.addEventListener('mouseleave', () => {\n    stopScrolling();\n    scrollZoneBottom.classList.remove('scrolling');\n});\n\n\n// --- Run on Page Load ---\ndocument.addEventListener('DOMContentLoaded', () => {\n    // 1. Animate Stat Cards\n    const statNumbers = document.querySelectorAll('.stat-number');\n    statNumbers.forEach(stat => {\n        const target = +stat.getAttribute('data-target');\n        const duration = 2000;\n        const stepTime = 20;\n        const steps = duration / stepTime;\n        const increment = target / steps;\n        let current = 0;\n\n        const updateCount = () => {\n            current += increment;\n            if (current < target) {\n                stat.textContent = Math.ceil(current).toLocaleString();\n                setTimeout(updateCount, stepTime);\n            } else {\n                stat.textContent = target.toLocaleString();\n            }\n        };\n        updateCount();\n    });\n\n    // 2. Create Malware Types Chart (Doughnut)\n    const typesCtx = document.getElementById('malwareTypesChart');\n    if (typesCtx) {\n        new Chart(typesCtx, {\n            type: 'doughnut',\n            data: {\n                labels: ['PE (exe/dll)', 'JavaScript', 'VBS', 'Macro', 'Other'],\n                datasets: [{\n                    label: 'Submission Types',\n                    data: [65, 15, 8, 7, 5],\n                    backgroundColor: [\n                        '#007bff', // Blue\n                        '#f1c40f', // Yellow\n                        '#e74c3c', // Red\n                        '#9b59b6', // Purple\n                        '#34495e'  // Gray\n                    ],\n                    borderColor: '#2a2a2e',\n                    borderWidth: 3,\n                }]\n            },\n            options: {\n                responsive: true,\n                plugins: {\n                    legend: {\n                        position: 'right',\n                        labels: {\n                            color: '#e0e0e0', // Text color\n                            boxWidth: 20\n                        }\n                    }\n                }\n            }\n        });\n    }\n\n    // 3. Create Top Malware Chart (Line)\n    const topMalwareCtx = document.getElementById('topMalwareChart');\n    if (topMalwareCtx) {\n        new Chart(topMalwareCtx, {\n            type: 'line',\n            data: {\n                labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5'],\n                datasets: [\n                    {\n                        label: 'Zeus',\n                        data: [120, 150, 130, 180, 160],\n                        borderColor: '#e74c3c',\n                        backgroundColor: '#e74c3c20',\n                        fill: true,\n                        tension: 0.4\n                    },\n                    {\n                        label: 'WannaCry',\n                        data: [80, 90, 110, 100, 130],\n                        borderColor: '#007bff',\n                        backgroundColor: '#007bff20',\n                        fill: true,\n                        tension: 0.4\n                    },\n                    {\n                        label: 'Emotet',\n                        data: [50, 60, 80, 70, 90],\n                        borderColor: '#f1c40f',\n                        backgroundColor: '#f1c40f20',\n                        fill: true,\n                        tension: 0.4\n                    }\n                ]\n            },\n            options: {\n                responsive: true,\n                plugins: {\n                    legend: {\n                        labels: {\n                            color: '#e0e0e0' // Text color\n                        }\n                    }\n                },\n                scales: {\n                    x: {\n                        ticks: { color: '#aaa' },\n                        grid: { color: '#44444450' }\n                    },\n                    y: {\n                        ticks: { color: '#aaa' },\n                        grid: { color: '#444444' }\n                    }\n                }\n            }\n        });\n    }\n});\n","epoch":4,"telemetryInfo":{}}],["file:///home/trang/mAIware/index.html::request_e291023b-a085-431d-9d97-e3db92d6eb3b",{"uri":{"$mid":1,"fsPath":"/home/trang/mAIware/index.html","external":"file:///home/trang/mAIware/index.html","path":"/home/trang/mAIware/index.html","scheme":"file"},"requestId":"request_e291023b-a085-431d-9d97-e3db92d6eb3b","content":"<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>mAIware AI Malware Detection Demo</title>\n    <!-- Font Awesome for icons (which you already had) -->\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css\">\n    <!-- Chart.js for stats (which you already had) -->\n    <script src=\"https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js\"></script>\n    <!-- Link to the CSS file -->\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n\n<body>\n    <nav class=\"top-nav\">\n        <div class=\"logo\"> <i class=\"fas fa-shield-virus\"></i> <span>mAIware</span> </div>\n        <div class=\"nav-links\"> <a href=\"#\" class=\"nav-link\" data-tooltip=\"Login\"><i class=\"fas fa-sign-in-alt\"></i><span class=\"link-text\">Login</span></a> <a href=\"#\" class=\"nav-link\" data-tooltip=\"Sign Up\"><i class=\"fas fa-user-plus\"></i><span class=\"link-text\">Sign Up</span></a> <a href=\"#\" class=\"nav-link\" data-tooltip=\"Community\"><i class=\"fas fa-users\"></i><span class=\"link-text\">Community</span></a> <a href=\"#\" class=\"nav-link\" data-tooltip=\"API Docs\"><i class=\"fas fa-code\"></i><span class=\"link-text\">API</span></a> <a href=\"#\" id=\"history-btn\" class=\"nav-link\" data-tooltip=\"Scan History\"><i class=\"fas fa-history\"></i><span class=\"link-text\">History</span></a> <a href=\"#\" class=\"nav-link\" id=\"theme-toggle\" data-tooltip=\"Toggle Theme\"> <i class=\"fas fa-sun\"></i> </a> </div>\n    </nav>\n\n    <main class=\"main-container\">\n        <!-- Column 1 -->\n        <div class=\"scanner-wrapper\">\n            <!-- Main Scanner Box -->\n            <div class=\"scanner-container\">\n                <h1>AI Malware Detection</h1>\n                <!-- State 1: Initial -->\n                <div id=\"initial-state\" class=\"scanner-state active\">\n                    <p>Watching your Downloads folder for new files...</p>\n                    <div id=\"drop-zone\" class=\"upload-zone\"> <i class=\"upload-icon fas fa-eye\"></i>\n                        <h3>Automatic Scanning Active</h3>\n                        <span>(Download a file to begin)</span>\n                    </div>\n                </div>\n\n                <!-- State 2: Analyzing -->\n                <div id=\"analyzing-state\" class=\"scanner-state\">\n                    <div class=\"analyzing-icon\">\n                        <div class=\"loader\"></div>\n                    </div>\n                    <h3>Analyzing...</h3> <span class=\"filename\" id=\"analyzing-filename\">demo_file.exe</span> </div>\n\n                <!-- State 3: Result -->\n                <div id=\"result-state\" class=\"scanner-state\"> <i class=\"result-icon\" id=\"result-icon\"></i>\n                    <h2 id=\"result-text\"></h2>\n                    <div class=\"filename\" id=\"result-filename\"></div>\n                    <p id=\"result-details\"></p>\n                    <!-- Removed the resetDemo() button as it's automatic now -->\n                </div>\n                <div id=\"non-pe-result\" class=\"scanner-state non-pe-result\">\n                    <div class=\"non-pe-icon\"><i class=\"fas fa-file\"></i></div>\n                    <h2 id=\"non-pe-title\">File is not a Windows PE executable</h2>\n                    <p class=\"filename\" id=\"non-pe-filename\"></p>\n                    <div class=\"non-pe-hash-grid\">\n                        <div class=\"non-pe-hash\">\n                            <h4>SHA256</h4>\n                            <p id=\"non-pe-hash-sha256\">...</p>\n                        </div>\n                        <div class=\"non-pe-hash\">\n                            <h4>MD5</h4>\n                            <p id=\"non-pe-hash-md5\">...</p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Analysis Details (Shows on result) -->\n            <div class=\"analysis-details-container\" id=\"analysis-details-wrapper\">\n                <div class=\"progress-header\">\n                    <h3>Malware Confidence</h3> <span class=\"score-percentage\" id=\"score-percentage\">0%</span> </div>\n                <div class=\"progress-bar-background\">\n                    <div class=\"progress-bar-fill\" id=\"progress-bar-fill\" style=\"width: 0%;\"></div>\n                </div>\n\n                <!-- This grid holds Vendor and Signature -->\n                <div class=\"details-grid\">\n                    <!-- Vendor UI Container -->\n                    <div class=\"details-section\" id=\"details-vendor\">\n                        <h4>Vendor Analysis</h4>\n                        <div class=\"vendor-info\">\n                            <i class=\"fas fa-question-circle\"></i>\n                            <span>Scanning...</span>\n                        </div>\n                    </div>\n                    <!-- Signature UI Container -->\n                    <div class=\"details-section\" id=\"details-signature\">\n                        <h4>Digital Signature</h4>\n                        <div class=\"signature-info\">\n                            <i class=\"fas fa-question-circle\"></i>\n                            <span>Checking...</span>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Reasoning (File Type/Packer) -->\n                <div class=\"details-section\">\n                    <h4>Key Findings</h4>\n                    <p id=\"details-reasoning\">...</p>\n                </div>\n                \n                <div class=\"details-section\">\n                    <h4>SHA256 Hash</h4>\n                    <p class=\"hash-text\" id=\"details-hash-sha256\">...</p>\n                </div>\n\n                <div class=\"details-section\">\n                    <h4>MD5 Hash</h4>\n                    <p class=\"hash-text\" id=\"details-hash-md5\">...</p>\n                </div>\n\n                <div class=\"details-section\">\n                    <h4>System IP</h4>\n                    <p class=\"hash-text\" id=\"details-system-ip\">Detecting...</p>\n                </div>\n\n                <div class=\"details-section\">\n                    <h4>What To Do Next</h4>\n                    <p id=\"details-recommendation\">...</p>\n                </div>\n\n                <div class=\"btn-wrapper\"> <button class=\"btn btn-primary\"><i class=\"fas fa-download\"></i> Download Report</button> <button class=\"btn btn-secondary\"><i class=\"fas fa-flag\"></i> Report False Positive</button> </div>\n            </div>\n        </div>\n\n        <!-- Column 2 -->\n        <div class=\"right-panel-wrapper\">\n            <!-- Stats (Shows on initial) -->\n            <div class=\"stats-wrapper\" id=\"stats-wrapper\">\n                <div class=\"stats-grid\">\n                    <div class=\"stat-card\"> <i class=\"fas fa-virus-slash\"></i>\n                        <div class=\"stat-content\"> <span class=\"stat-number\" data-target=\"14720938\">0</span> <span class=\"stat-label\">Malware Analyzed</span> </div>\n                    </div>\n                    <div class=\"stat-card\"> <i class=\"fas fa-users\"></i>\n                        <div class=\"stat-content\"> <span class=\"stat-number\" data-target=\"82041\">0</span> <span class=\"stat-label\">Active Users</span> </div>\n                    </div>\n                    <div class=\"stat-card\"> <i class=\"fas fa-chart-line\"></i>\n                        <div class=\"stat-content\"> <span class=\"stat-number\" data-target=\"1259024\">0</span> <span class=\"stat-label\">Site Visits (24h)</span> </div>\n                    </div>\n                </div>\n                <div class=\"chart-container-wrapper\">\n                    <div class=\"chart-container\">\n                        <h3>Top 5 Malware Families (30 Days)</h3> <canvas id=\"topMalwareChart\"></canvas> </div>\n                    <div class=\"chart-container\">\n                        <h3>Submission Types</h3> <canvas id=\"malwareTypesChart\"></canvas> </div>\n                </div>\n            </div>\n\n            <!-- Disassembly (Shows on analyzing/result) -->\n            <div class=\"disassembly-wrapper\" id=\"disassembly-wrapper\">\n                <div class=\"disassembly-header\">\n                    <h3>Disassembly: <span id=\"disassembly-filename\"></span></h3>\n                </div>\n                <div class=\"disassembly-code\" id=\"disassembly-code\"> </div>\n            </div>\n\n            <!-- File Internals (Shows on result) -->\n            <div class=\"file-internals-container\" id=\"file-internals-wrapper\">\n                <h3>File Internals</h3>\n                \n                <!-- Entropy UI Container -->\n                <div class=\"details-section\">\n                    <h4>Section Entropy (0=Normal, 8=Packed/Encrypted)</h4>\n                    <div class=\"entropy-bars\" id=\"entropy-bars-container\">\n                        <!-- JS will populate this -->\n                    </div>\n                </div>\n                \n                <!-- Key Strings UI Container -->\n                <div class=\"details-section\">\n                    <h4>Suspicious / Key Strings</h4>\n                    <div class=\"key-strings\" id=\"key-strings-container\">\n                        <!-- JS will populate this -->\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Full Width Row -->\n        <div class=\"graph-wrapper\" id=\"graph-wrapper\">\n            <div class=\"graph-header\">\n                <h3>Dynamic Function Call Graph (Simulation)</h3>\n            </div>\n            <div class=\"call-graph-container\">\n                <div class=\"call-graph\" id=\"call-graph\">\n                    <!-- JS will populate this -->\n                </div>\n            </div>\n        </div>\n    </main>\n\n    <!-- History Panel (Hidden by default) -->\n    <div class=\"history-overlay\" id=\"history-overlay\"></div>\n    <div class=\"history-panel\" id=\"history-panel\">\n        <div class=\"history-header\">\n            <h3>Scan History</h3> <button class=\"history-close-btn\" id=\"history-close-btn\"><i class=\"fas fa-times\"></i></button> </div>\n        <ul class=\"history-list\">\n            <!-- JS would populate this -->\n        </ul>\n    </div>\n\n    <!-- Scroll Zones -->\n    <div class=\"scroll-zone top\" id=\"scroll-zone-top\"><i class=\"fas fa-chevron-up\"></i></div>\n    <div class=\"scroll-zone bottom\" id=\"scroll-zone-bottom\"><i class=\"fas fa-chevron-down\"></i></div>\n    \n    <!-- LeaderLine for graph (which you already had) -->\n    <script src=\"https://cdn.jsdelivr.net/npm/leader-line-new@1.1.9/leader-line.min.js\"></script>\n    <!-- Link to the JS file -->\n    <script src=\"script.js\"></script>\n\n    <script>\n    document.addEventListener('DOMContentLoaded', () => {\n        const themeToggleButton = document.getElementById('theme-toggle');\n        const body = document.body;\n        const themeIcon = themeToggleButton.querySelector('i');\n\n        // Function to apply the saved theme\n        const applyTheme = (theme) => {\n            if (theme === 'light') {\n                body.classList.add('light-theme');\n                themeIcon.classList.remove('fa-sun');\n                themeIcon.classList.add('fa-moon');\n            } else {\n                body.classList.remove('light-theme');\n                themeIcon.classList.remove('fa-moon');\n                themeIcon.classList.add('fa-sun');\n            }\n        };\n\n        // Load the saved theme on page load\n        const savedTheme = localStorage.getItem('theme') || 'dark'; // Default to dark\n        applyTheme(savedTheme);\n\n        // Add click event for the toggle button\n        themeToggleButton.addEventListener('click', (e) => {\n            e.preventDefault(); // Stop the link from navigating\n            \n            // Check current theme\n            const isLightTheme = body.classList.contains('light-theme');\n            \n            // Set new theme\n            const newTheme = isLightTheme ? 'dark' : 'light';\n            \n            // Apply the new theme\n            applyTheme(newTheme);\n            \n            // Save the new theme to localStorage\n            localStorage.setItem('theme', newTheme);\n        });\n    });\n    </script>\n</body>\n</html>\n","epoch":8,"telemetryInfo":{}}],["file:///home/trang/mAIware/index.html::request_dea95259-dc59-44ee-8b2e-71bfbcd038b0",{"uri":{"$mid":1,"fsPath":"/home/trang/mAIware/index.html","external":"file:///home/trang/mAIware/index.html","path":"/home/trang/mAIware/index.html","scheme":"file"},"requestId":"request_dea95259-dc59-44ee-8b2e-71bfbcd038b0","content":"<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>mAIware AI Malware Detection Demo</title>\n    <!-- Font Awesome for icons (which you already had) -->\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css\">\n    <!-- Chart.js for stats (which you already had) -->\n    <script src=\"https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js\"></script>\n    <!-- Link to the CSS file -->\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n\n<body>\n    <nav class=\"top-nav\">\n        <div class=\"logo\"> <i class=\"fas fa-shield-virus\"></i> <span>mAIware</span> </div>\n        <div class=\"nav-links\"> <a href=\"#\" class=\"nav-link\" data-tooltip=\"Login\"><i class=\"fas fa-sign-in-alt\"></i><span class=\"link-text\">Login</span></a> <a href=\"#\" class=\"nav-link\" data-tooltip=\"Sign Up\"><i class=\"fas fa-user-plus\"></i><span class=\"link-text\">Sign Up</span></a> <a href=\"#\" class=\"nav-link\" data-tooltip=\"Community\"><i class=\"fas fa-users\"></i><span class=\"link-text\">Community</span></a> <a href=\"#\" class=\"nav-link\" data-tooltip=\"API Docs\"><i class=\"fas fa-code\"></i><span class=\"link-text\">API</span></a> <a href=\"#\" id=\"history-btn\" class=\"nav-link\" data-tooltip=\"Scan History\"><i class=\"fas fa-history\"></i><span class=\"link-text\">History</span></a> <a href=\"#\" class=\"nav-link\" id=\"theme-toggle\" data-tooltip=\"Toggle Theme\"> <i class=\"fas fa-sun\"></i> </a> </div>\n    </nav>\n\n    <main class=\"main-container\">\n        <!-- Column 1 -->\n        <div class=\"scanner-wrapper\">\n            <!-- Main Scanner Box -->\n            <div class=\"scanner-container\">\n                <h1>AI Malware Detection</h1>\n                <!-- State 1: Initial -->\n                <div id=\"initial-state\" class=\"scanner-state active\">\n                    <p>Watching your Downloads folder for new files...</p>\n                    <div id=\"drop-zone\" class=\"upload-zone\"> <i class=\"upload-icon fas fa-eye\"></i>\n                        <h3>Automatic Scanning Active</h3>\n                        <span>(Download a file to begin)</span>\n                    </div>\n                </div>\n\n                <!-- State 2: Analyzing -->\n                <div id=\"analyzing-state\" class=\"scanner-state\">\n                    <div class=\"analyzing-icon\">\n                        <div class=\"loader\"></div>\n                    </div>\n                    <h3>Analyzing...</h3> <span class=\"filename\" id=\"analyzing-filename\">demo_file.exe</span> </div>\n\n                <!-- State 3: Result -->\n                <div id=\"result-state\" class=\"scanner-state\"> <i class=\"result-icon\" id=\"result-icon\"></i>\n                    <h2 id=\"result-text\"></h2>\n                    <div class=\"filename\" id=\"result-filename\"></div>\n                    <p id=\"result-details\"></p>\n                    <!-- Removed the resetDemo() button as it's automatic now -->\n                </div>\n                <div id=\"non-pe-result\" class=\"scanner-state non-pe-result\">\n                    <div class=\"non-pe-icon\"><i class=\"fas fa-file\"></i></div>\n                    <h2 id=\"non-pe-title\">File is not a Windows PE executable</h2>\n                    <p class=\"filename\" id=\"non-pe-filename\"></p>\n                    <div class=\"non-pe-hash-grid\">\n                        <div class=\"non-pe-hash\">\n                            <h4>SHA256</h4>\n                            <p id=\"non-pe-hash-sha256\">...</p>\n                        </div>\n                        <div class=\"non-pe-hash\">\n                            <h4>MD5</h4>\n                            <p id=\"non-pe-hash-md5\">...</p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Analysis Details (Shows on result) -->\n            <div class=\"analysis-details-container\" id=\"analysis-details-wrapper\">\n                <div class=\"progress-header\">\n                    <h3>Malware Confidence</h3> <span class=\"score-percentage\" id=\"score-percentage\">0%</span> </div>\n                <div class=\"progress-bar-background\">\n                    <div class=\"progress-bar-fill\" id=\"progress-bar-fill\" style=\"width: 0%;\"></div>\n                </div>\n\n                <!-- This grid holds Vendor and Signature -->\n                <div class=\"details-grid\">\n                    <!-- Vendor UI Container -->\n                    <div class=\"details-section\" id=\"details-vendor\">\n                        <h4>Vendor Analysis</h4>\n                        <div class=\"vendor-info\">\n                            <i class=\"fas fa-question-circle\"></i>\n                            <span>Scanning...</span>\n                        </div>\n                    </div>\n                    <!-- Signature UI Container -->\n                    <div class=\"details-section\" id=\"details-signature\">\n                        <h4>Digital Signature</h4>\n                        <div class=\"signature-info\">\n                            <i class=\"fas fa-question-circle\"></i>\n                            <span>Checking...</span>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Reasoning (File Type/Packer) -->\n                <div class=\"details-section\">\n                    <h4>Key Findings</h4>\n                    <p id=\"details-reasoning\">...</p>\n                </div>\n                \n                <div class=\"details-section\">\n                    <h4>SHA256 Hash</h4>\n                    <p class=\"hash-text\" id=\"details-hash-sha256\">...</p>\n                </div>\n\n                <div class=\"details-section\">\n                    <h4>MD5 Hash</h4>\n                    <p class=\"hash-text\" id=\"details-hash-md5\">...</p>\n                </div>\n\n                <div class=\"details-section\">\n                    <h4>System IP</h4>\n                    <p class=\"hash-text\" id=\"details-system-ip\">Detecting...</p>\n                </div>\n\n                <div class=\"details-section\">\n                    <h4>What To Do Next</h4>\n                    <p id=\"details-recommendation\">...</p>\n                </div>\n\n                <div class=\"btn-wrapper\"> <button class=\"btn btn-primary\"><i class=\"fas fa-download\"></i> Download Report</button> <button class=\"btn btn-secondary\"><i class=\"fas fa-flag\"></i> Report False Positive</button> </div>\n            </div>\n        </div>\n\n        <!-- Column 2 -->\n        <div class=\"right-panel-wrapper\">\n            <!-- Stats (Shows on initial) -->\n            <div class=\"stats-wrapper\" id=\"stats-wrapper\">\n                <div class=\"stats-grid\">\n                    <div class=\"stat-card\"> <i class=\"fas fa-virus-slash\"></i>\n                        <div class=\"stat-content\"> <span class=\"stat-number\" data-target=\"14720938\">0</span> <span class=\"stat-label\">Malware Analyzed</span> </div>\n                    </div>\n                    <div class=\"stat-card\"> <i class=\"fas fa-users\"></i>\n                        <div class=\"stat-content\"> <span class=\"stat-number\" data-target=\"82041\">0</span> <span class=\"stat-label\">Active Users</span> </div>\n                    </div>\n                    <div class=\"stat-card\"> <i class=\"fas fa-chart-line\"></i>\n                        <div class=\"stat-content\"> <span class=\"stat-number\" data-target=\"1259024\">0</span> <span class=\"stat-label\">Site Visits (24h)</span> </div>\n                    </div>\n                </div>\n                <div class=\"chart-container-wrapper\">\n                    <div class=\"chart-container\">\n                        <h3>Top 5 Malware Families (30 Days)</h3> <canvas id=\"topMalwareChart\"></canvas> </div>\n                    <div class=\"chart-container\">\n                        <h3>Submission Types</h3> <canvas id=\"malwareTypesChart\"></canvas> </div>\n                </div>\n            </div>\n\n            <!-- Disassembly (Shows on analyzing/result) -->\n            <div class=\"disassembly-wrapper\" id=\"disassembly-wrapper\">\n                <div class=\"disassembly-header\">\n                    <h3>Disassembly: <span id=\"disassembly-filename\"></span></h3>\n                </div>\n                <div class=\"disassembly-code\" id=\"disassembly-code\"> </div>\n            </div>\n\n            <!-- File Internals (Shows on result) -->\n            <div class=\"file-internals-container\" id=\"file-internals-wrapper\">\n                <h3>File Internals</h3>\n                \n                <!-- Entropy UI Container -->\n                <div class=\"details-section\">\n                    <h4>Section Entropy (0=Normal, 8=Packed/Encrypted)</h4>\n                    <div class=\"entropy-bars\" id=\"entropy-bars-container\">\n                        <!-- JS will populate this -->\n                    </div>\n                </div>\n                \n                <!-- Key Strings UI Container -->\n                <div class=\"details-section\">\n                    <h4>Suspicious / Key Strings</h4>\n                    <div class=\"key-strings\" id=\"key-strings-container\">\n                        <!-- JS will populate this -->\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Full Width Row -->\n        <div class=\"graph-wrapper\" id=\"graph-wrapper\">\n            <div class=\"graph-header\">\n                <h3>Dynamic Function Call Graph (Simulation)</h3>\n            </div>\n            <div class=\"call-graph-container\">\n                <div class=\"call-graph\" id=\"call-graph\">\n                    <!-- JS will populate this -->\n                </div>\n            </div>\n        </div>\n    </main>\n\n    <!-- History Panel (Hidden by default) -->\n    <div class=\"history-overlay\" id=\"history-overlay\"></div>\n    <div class=\"history-panel\" id=\"history-panel\">\n        <div class=\"history-header\">\n            <h3>Scan History</h3> <button class=\"history-close-btn\" id=\"history-close-btn\"><i class=\"fas fa-times\"></i></button> </div>\n        <ul class=\"history-list\">\n            <!-- JS would populate this -->\n        </ul>\n    </div>\n\n    <!-- Scroll Zones -->\n    <div class=\"scroll-zone top\" id=\"scroll-zone-top\"><i class=\"fas fa-chevron-up\"></i></div>\n    <div class=\"scroll-zone bottom\" id=\"scroll-zone-bottom\"><i class=\"fas fa-chevron-down\"></i></div>\n    \n    <!-- LeaderLine for graph (which you already had) -->\n    <script src=\"https://cdn.jsdelivr.net/npm/leader-line-new@1.1.9/leader-line.min.js\"></script>\n    <!-- Link to the JS file -->\n    <script src=\"script.js\"></script>\n\n    <script>\n    document.addEventListener('DOMContentLoaded', () => {\n        const themeToggleButton = document.getElementById('theme-toggle');\n        const body = document.body;\n        const themeIcon = themeToggleButton.querySelector('i');\n\n        // Function to apply the saved theme\n        const applyTheme = (theme) => {\n            if (theme === 'light') {\n                body.classList.add('light-theme');\n                themeIcon.classList.remove('fa-sun');\n                themeIcon.classList.add('fa-moon');\n            } else {\n                body.classList.remove('light-theme');\n                themeIcon.classList.remove('fa-moon');\n                themeIcon.classList.add('fa-sun');\n            }\n            \n            // Recreate charts with updated theme colors\n            if (window.recreateCharts) {\n                window.recreateCharts();\n            }\n        };\n\n        // Load the saved theme on page load\n        const savedTheme = localStorage.getItem('theme') || 'dark'; // Default to dark\n        applyTheme(savedTheme);\n\n        // Add click event for the toggle button\n        themeToggleButton.addEventListener('click', (e) => {\n            e.preventDefault(); // Stop the link from navigating\n            \n            // Check current theme\n            const isLightTheme = body.classList.contains('light-theme');\n            \n            // Set new theme\n            const newTheme = isLightTheme ? 'dark' : 'light';\n            \n            // Apply the new theme\n            applyTheme(newTheme);\n            \n            // Save the new theme to localStorage\n            localStorage.setItem('theme', newTheme);\n        });\n    });\n    </script>\n</body>\n</html>\n","epoch":14,"telemetryInfo":{}}],["file:///home/trang/mAIware/script.js::request_b7d8c486-3525-4954-bb70-78dfb4c10314",{"uri":{"$mid":1,"fsPath":"/home/trang/mAIware/script.js","external":"file:///home/trang/mAIware/script.js","path":"/home/trang/mAIware/script.js","scheme":"file"},"requestId":"request_b7d8c486-3525-4954-bb70-78dfb4c10314","content":"// --- MOCK DISASSEMBLY DATA ---\n// (We keep this for now, as requested)\nconst mockDisassemblyBenign = [\n    `<span class=\"addr\">0x401000</span> <span class=\"op\">PUSH</span> <span class=\"args\">ebp</span> <span class=\"comment\">; setup stack frame</span>`,\n    `<span class=\"addr\">0x401001</span> <span class=\"op\">MOV</span> <span class=\"args\">ebp, esp</span>`,\n    `<span class=\"addr\">0x401003</span> <span class=\"op\">SUB</span> <span class=\"args\">esp, 48h</span>`,\n    `<span class=\"addr\">0x40100C</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4012A0</span> <span class=\"comment\">; initialize_string</span>`,\n    `<span class=\"addr\">0x401015</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4013F0</span> <span class=\"comment\">; get_user_input</span>`,\n    `<span class=\"addr\">0x40101E</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4015D0</span> <span class=\"comment\">; print_output</span>`,\n    `<span class=\"addr\">0x401028</span> <span class=\"op\">RETN</span>`,\n    `<span class=\"addr\">...</span>`,\n];\nconst mockDisassemblySuspicious = [\n    `<span class=\"addr\">0x401000</span> <span class=\"op\">PUSH</span> <span class=\"args\">ebp</span>`,\n    `<span class=\"addr\">0x401003</span> <span class=\"op\">SUB</span> <span class=\"args\">esp, 80h</span>`,\n    `<span class=\"addr\">0x40100D</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4012A0</span> <span class=\"comment\">; read_file_to_buffer</span>`,\n    `<span class=\"addr\">0x40101B</span> <span class=\"op\">REP</span> <span class=\"op\">MOVSB</span> <span class=\"comment\">; unsafe buffer write</span>`,\n    `<span class=\"addr\">0x401020</span> <span class=\"op\">JGE</span> <span class=\"args\">0x401030</span> <span class=\"comment\">; jump if overflow</span>`,\n    `<span class=\"addr\">0x401028</span> <span class=\"op\">RETN</span>`,\n    `<span class=\"addr\">...</span>`,\n];\nconst mockDisassemblyMalware = [\n    `<span class=\"addr\">0x401000</span> <span class=\"op\">PUSH</span> <span class=\"args\">ebp</span> <span class=\"comment\">; setup stack frame</span>`,\n    `<span class=\"addr\">0x40100B</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4011B0</span> <span class=\"comment\">; kernel32.LoadLibraryA</span>`,\n    `<span class=\"addr\">0x401013</span> <span class=\"op\">PUSH</span> <span class=\"string\">\"CreateRemoteThread\"</span>`,\n    `<span class=\"addr\">0x401019</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4011C0</span> <span class=\"comment\">; kernel32.GetProcAddress</span>`,\n    `<span class=\"addr\">0x401028</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4012F0</span> <span class=\"comment\">; decrypt_payload</span>`,\n    `<span class=\"addr\">0x401034</span> <span class=\"op\">CALL</span> <span class=\"args\">[ebp-24h]</span> <span class=\"comment\">; call CreateRemoteThread</span>`,\n    `<span class=\"addr\">0x401037</span> <span class=\"op\">JMP</span> <span class=\"args\">0x40102D</span> <span class=\"comment\">; loop?</span>`,\n    `<span class=\"addr\">...</span>`,\n];\n\n// --- REMOVED MOCK GRAPH DATA ---\n// const mockGraphSafe = ... (DELETED)\n// const mockGraphSuspicious = ... (DELETED)\n// const mockGraphMalware = ... (DELETED)\n\n// --- ELEMENT REFERENCES ---\nconst initialState = document.getElementById('initial-state');\nconst analyzingState = document.getElementById('analyzing-state');\nconst resultState = document.getElementById('result-state');\n\nconst analyzingFilename = document.getElementById('analyzing-filename');\nconst resultIcon = document.getElementById('result-icon');\nconst resultText = document.getElementById('result-text');\nconst resultFilename = document.getElementById('result-filename');\nconst resultDetails = document.getElementById('result-details');\nconst nonPeResultWrapper = document.getElementById('non-pe-result');\nconst nonPeFilename = document.getElementById('non-pe-filename');\nconst nonPeHashSha256 = document.getElementById('non-pe-hash-sha256');\nconst nonPeHashMd5 = document.getElementById('non-pe-hash-md5');\n\nconst bodyEl = document.body;\nlet animationWrapper = null;\n\nconst disassemblyWrapper = document.getElementById('disassembly-wrapper');\nconst disassemblyCodeEl = document.getElementById('disassembly-code');\nconst disassemblyFilenameEl = document.getElementById('disassembly-filename');\n\n// Analysis Details elements\nconst analysisDetailsWrapper = document.getElementById('analysis-details-wrapper');\nconst progressBarFill = document.getElementById('progress-bar-fill');\nconst scorePercentage = document.getElementById('score-percentage');\nconst detailsReasoning = document.getElementById('details-reasoning'); // We'll reuse this\nconst detailsHashSha256 = document.getElementById('details-hash-sha256');\nconst detailsHashMd5 = document.getElementById('details-hash-md5');\nconst detailsSystemIp = document.getElementById('details-system-ip');\nconst detailsRecommendation = document.getElementById('details-recommendation');\nconst detailsVendor = document.getElementById('details-vendor');\nconst detailsSignature = document.getElementById('details-signature');\nconst fileInternalsWrapper = document.getElementById('file-internals-wrapper');\nconst entropyBarsContainer = document.getElementById('entropy-bars-container');\nconst keyStringsContainer = document.getElementById('key-strings-container');\n\n// History Panel elements\nconst historyBtn = document.getElementById('history-btn');\nconst historyPanel = document.getElementById('history-panel');\nconst historyCloseBtn = document.getElementById('history-close-btn');\nconst historyOverlay = document.getElementById('history-overlay');\nconst historyListEl = document.querySelector('.history-list');\n\n// Scroll Zone elements\nconst scrollZoneTop = document.getElementById('scroll-zone-top');\nconst scrollZoneBottom = document.getElementById('scroll-zone-bottom');\n\n// Graph Panel elements\nconst graphWrapper = document.getElementById('graph-wrapper');\nconst callGraphEl = document.getElementById('call-graph');\n\n// Stats elements\nconst statsWrapper = document.getElementById('stats-wrapper');\n\n\n// --- STATE ---\nlet disassemblyInterval = null;\nlet scrollInterval = null; // For auto-scrolling\nlet currentGraphLines = []; // Renamed from currentLines to avoid conflict\nlet currentFileMetadata = null;\nlet lastScanResult = null;\n\n// 1. Listen for the 'scan-started' message from the backend\nwindow.electronAPI.onScanStarted((filename) => {\n  console.log(`UI: Received scan-started for ${filename}`);\n\n  // 1. Set UI to \"Analyzing\" state\n  initialState.classList.remove('active'); //\n  analyzingState.classList.add('active'); //\n  analyzingFilename.textContent = filename; //\n  disassemblyFilenameEl.textContent = filename; //\n\n  currentFileMetadata = { filename, isPe: true };\n  lastScanResult = null;\n  nonPeResultWrapper.classList.remove('active');\n  bodyEl.classList.remove('is-non-pe');\n\n  // 2. Update body class to show disassembly\n  bodyEl.classList.remove('is-showing-result'); //\n  bodyEl.classList.add('is-analyzing'); //\n  removeAnimationClasses(); //\n  \n  // 3. Populate disassembly with a \"suspicious\" default and start animation\n  // (We don't know the result yet, so we pick one)\n  populateDisassembly(mockDisassemblySuspicious); //\n  startDisassemblyAnimation(); //\n\n  // 4. Clear old results\n  clearResultData();\n});\n\n// 2. Listen for the 'scan-result' message\nwindow.electronAPI.onScanResult((scanResult) => {\n  console.log(\"UI: Received scan-result:\", scanResult);\n\n  clearInterval(disassemblyInterval); //\n  disassemblyInterval = null; //\n\n  bodyEl.classList.remove('is-analyzing'); //\n  bodyEl.classList.add('is-showing-result'); //\n\n  analyzingState.classList.remove('active'); //\n  resultState.classList.add('active'); //\n\n  lastScanResult = scanResult;\n\n  renderScanResult();\n});\n\nwindow.electronAPI.onScanFileMetadata((metadata) => {\n  if (!metadata || typeof metadata !== 'object') {\n    return;\n  }\n\n  currentFileMetadata = metadata;\n\n  if (lastScanResult && metadata.filename === lastScanResult.detected_filename) {\n    renderScanResult();\n  }\n});\n\nfunction renderScanResult() {\n  if (!lastScanResult) {\n    return;\n  }\n\n  const metadataMatches = currentFileMetadata && currentFileMetadata.filename === lastScanResult.detected_filename;\n  const isNonPe = metadataMatches && currentFileMetadata.isPe === false;\n\n  if (isNonPe) {\n    renderNonPeResult(lastScanResult);\n    return;\n  }\n\n  renderPeResult(lastScanResult);\n}\n\nfunction ensureAnimationWrapper() {\n  if (animationWrapper) {\n    return;\n  }\n\n  animationWrapper = document.createElement('div');\n  animationWrapper.className = 'animation-swarm';\n  for (let i = 0; i < 10; i++) {\n    const particle = document.createElement('span');\n    animationWrapper.appendChild(particle);\n  }\n  bodyEl.prepend(animationWrapper);\n}\n\nfunction renderPeResult(scanResult) {\n  removeAnimationClasses();\n  bodyEl.classList.remove('is-non-pe');\n  nonPeResultWrapper.classList.remove('active');\n\n  let resultIconClass = 'fas fa-check-circle'; //\n  let resultMockDisassembly = mockDisassemblyBenign; //\n  let resultBodyClass = 'result-safe-active'; //\n  let resultScannerClass = 'result-safe'; //\n  let resultProgressClass = 'progress-bar-green'; //\n  let resultScoreClass = 'score-green'; //\n  let recommendation = 'You can safely run this file.'; //\n\n  if (scanResult.classification.includes('Malware')) {\n    resultIconClass = 'fas fa-bug';\n    resultMockDisassembly = mockDisassemblyMalware;\n    resultBodyClass = 'result-malware-active'; //\n    resultScannerClass = 'result-malware'; //\n    resultProgressClass = 'progress-bar-red'; //\n    resultScoreClass = 'score-red'; //\n    recommendation = 'DO NOT OPEN. Quarantine this file immediately.'; //\n  } else if (scanResult.classification.includes('Suspicious')) {\n    resultIconClass = 'fas fa-exclamation-triangle'; //\n    resultMockDisassembly = mockDisassemblySuspicious; //\n    resultBodyClass = 'result-suspicious-active'; //\n    resultScannerClass = 'result-suspicious'; //\n    resultProgressClass = 'progress-bar-yellow'; //\n    resultScoreClass = 'score-yellow'; //\n    recommendation = 'Be cautious. Only run if you trust the source.'; //\n  }\n\n  ensureAnimationWrapper();\n  bodyEl.classList.add(resultBodyClass); //\n\n  resultState.className = `scanner-state active ${resultScannerClass}`; //\n  resultIcon.className = `result-icon ${resultIconClass}`; //\n  resultText.textContent = scanResult.classification; //\n\n  let detailsText = `Scanned ${scanResult.detected_filename}.`;\n  if (scanResult.malware_family) {\n    detailsText = `Family: ${scanResult.malware_family}`;\n  }\n  resultDetails.textContent = detailsText;\n  resultFilename.textContent = scanResult.detected_filename; //\n\n  progressBarFill.className = 'progress-bar-fill'; //\n  scorePercentage.className = 'score-percentage'; //\n  progressBarFill.classList.add(resultProgressClass); //\n  const rawConfidence = Number(scanResult.confidence_score);\n  const confidenceValue = Number.isFinite(rawConfidence) ? rawConfidence * 100 : 0;\n  progressBarFill.style.width = `${confidenceValue}%`; //\n  scorePercentage.textContent = `${Math.round(confidenceValue)}%`; //\n  scorePercentage.classList.add(resultScoreClass); //\n\n  detailsReasoning.textContent = `Filetype: ${scanResult.key_findings.file_type}. Packer: ${scanResult.key_findings.packer_detected}.`; //\n  const hashData = scanResult.file_hashes || {};\n  detailsHashSha256.textContent = hashData.sha256 || 'Not available'; //\n  detailsHashMd5.textContent = hashData.md5 || 'Not available'; //\n  updateSystemIpDisplay();\n  detailsRecommendation.textContent = recommendation;\n\n  populateVendor(scanResult.vendor); //\n  populateSignature(scanResult.key_findings.signature); //\n  populateEntropyBars(scanResult.key_findings.section_entropy || []); //\n  populateKeyStrings(scanResult.key_findings.key_strings || [], scanResult.classification); //\n\n  populateDisassembly(resultMockDisassembly); //\n\n  const apiList = scanResult.key_findings.api_imports || [];\n  const graphData = generateGraphData(apiList, scanResult.classification);\n  drawCallGraph(graphData);\n}\n\nfunction renderNonPeResult(scanResult) {\n  removeAnimationClasses();\n  bodyEl.classList.add('is-non-pe');\n  resultState.className = 'scanner-state active';\n  resultIcon.className = 'result-icon fas fa-file';\n  resultText.textContent = '';\n  resultDetails.textContent = '';\n  resultFilename.textContent = '';\n\n  const hashData = scanResult.file_hashes || {};\n  nonPeFilename.textContent = scanResult.detected_filename || '';\n  nonPeHashSha256.textContent = hashData.sha256 || 'Not available';\n  nonPeHashMd5.textContent = hashData.md5 || 'Not available';\n\n  detailsHashSha256.textContent = hashData.sha256 || 'Not available';\n  detailsHashMd5.textContent = hashData.md5 || 'Not available';\n\n  nonPeResultWrapper.classList.add('active');\n\n  callGraphEl.innerHTML = '';\n  currentGraphLines.forEach(line => line.remove());\n  currentGraphLines = [];\n  entropyBarsContainer.innerHTML = '';\n  keyStringsContainer.innerHTML = '';\n}\n\n/**\n * Clears all dynamic result data to prepare for the next scan.\n */\nfunction clearResultData() {\n    // Clear scanner panel\n    resultText.textContent = '';\n    resultDetails.textContent = '';\n    resultFilename.textContent = '';\n    nonPeResultWrapper.classList.remove('active');\n    nonPeFilename.textContent = '';\n    nonPeHashSha256.textContent = '...';\n    nonPeHashMd5.textContent = '...';\n    bodyEl.classList.remove('is-non-pe');\n\n    // Clear analysis panel\n    progressBarFill.style.width = `0%`;\n    scorePercentage.textContent = `0%`;\n    detailsReasoning.textContent = '...';\n    detailsHashSha256.textContent = '...';\n    detailsHashMd5.textContent = '...';\n    if (detailsSystemIp) {\n        detailsSystemIp.textContent = 'Detecting...';\n    }\n    detailsRecommendation.textContent = '...';\n\n    // Clear vendor\n    detailsVendor.innerHTML = `\n        <h4>Vendor Analysis</h4>\n        <div class=\"vendor-info\">\n            <i class=\"fas fa-question-circle\"></i>\n            <span>Scanning...</span>\n        </div>`;\n    \n    // Clear signature\n    detailsSignature.innerHTML = `\n        <h4>Digital Signature</h4>\n        <div class=\"signature-info\">\n            <i class=\"fas fa-question-circle\"></i>\n            <span>Checking...</span>\n        </div>`;\n    \n    // Clear internals\n    entropyBarsContainer.innerHTML = '';\n    keyStringsContainer.innerHTML = '';\n    \n    // Clear graph\n    callGraphEl.innerHTML = '';\n    currentGraphLines.forEach(line => line.remove());\n    currentGraphLines = [];\n}\n\n// --- VENDOR UI FUNCTION (IMPLEMENTED) ---\nfunction populateVendor(vendor) {\n    if (!vendor) return;\n    const icon = vendor.icon || 'fas fa-question-circle'; //\n    const name = vendor.name || 'Unknown'; //\n    detailsVendor.innerHTML = `\n        <h4>Vendor Analysis</h4> <div class=\"vendor-info\"> <i class=\"${icon}\"></i>\n            <span>${name}</span>\n        </div>\n    `;\n}\n\n// --- SIGNATURE UI FUNCTION (IMPLEMENTED) ---\nfunction populateSignature(signature) {\n    if (!signature) return;\n    let icon = signature.icon || 'fas fa-question-circle';\n    let cssClass = `sig-${signature.level || 'unknown'}`; // 'sig-verified', 'sig-untrusted', 'sig-unknown'\n\n    detailsSignature.innerHTML = `\n        <h4>Digital Signature</h4> <div class=\"signature-info ${cssClass}\"> <i class=\"${icon}\"></i>\n            <span>${signature.name}</span>\n        </div>\n    `;\n}\n\n// --- ENTROPY BARS UI FUNCTION (IMPLEMENTED) ---\nfunction populateEntropyBars(sections) {\n    entropyBarsContainer.innerHTML = ''; // Clear old bars\n    if (!sections || sections.length === 0) {\n        entropyBarsContainer.innerHTML = '<p class=\"hash-text\">No PE sections found to analyze.</p>';\n        return;\n    }\n\n    sections.forEach(section => { //\n        const value = section.entropy; //\n        const width = (value / 8.0) * 100; // Entropy is 0-8\n        let cssClass = 'low';\n        \n        if (value > 6.0) cssClass = 'medium';\n        if (value > 7.0) cssClass = 'high';\n        if (value > 7.8) cssClass = 'packed'; // Match style.css\n\n        const row = document.createElement('div');\n        row.className = 'entropy-bar-row';\n        row.innerHTML = `\n            <span class=\"entropy-bar-label\">${section.name}</span> <div class=\"entropy-bar-bg\">\n                <div class=\"entropy-bar-fill ${cssClass}\" style=\"width: ${width}%\">\n                    <span class=\"entropy-bar-value\">${value.toFixed(2)}</span>\n                </div>\n            </div>\n        `;\n        entropyBarsContainer.appendChild(row);\n    });\n}\n\n// --- KEY STRINGS UI FUNCTION (IMPLEMENTED) ---\nfunction populateKeyStrings(strings, classification) {\n    keyStringsContainer.innerHTML = ''; // Clear old strings\n    if (!strings || strings.length === 0) {\n        keyStringsContainer.innerHTML = '<span class=\"key-string-tag\">No notable strings found.</span>';\n        return;\n    }\n    \n    const tagClass = classification.includes('Benign') ? 'benign' : 'suspicious'; //\n\n    strings.forEach(str => { //\n        const tag = document.createElement('span');\n        tag.className = `key-string-tag ${tagClass}`;\n        tag.textContent = str;\n        keyStringsContainer.appendChild(tag);\n    });\n}\n\nfunction updateSystemIpDisplay() {\n    if (!detailsSystemIp || !window.electronAPI || typeof window.electronAPI.getSystemIp !== 'function') {\n        return;\n    }\n\n    detailsSystemIp.textContent = 'Detecting...';\n\n    window.electronAPI.getSystemIp()\n        .then((ip) => {\n            if (!ip) {\n                detailsSystemIp.textContent = 'Unavailable';\n                return;\n            }\n\n            detailsSystemIp.textContent = ip;\n        })\n        .catch(() => {\n            detailsSystemIp.textContent = 'Unavailable';\n        });\n}\n\nfunction removeAnimationClasses() {\n    bodyEl.classList.remove('result-safe-active');\n    bodyEl.classList.remove('result-suspicious-active');\n    bodyEl.classList.remove('result-malware-active');\n}\n\n// --- Disassembly Functions ---\n\nfunction populateDisassembly(codeLines) {\n    disassemblyCodeEl.innerHTML = '';\n    codeLines.forEach((line, index) => {\n        const lineEl = document.createElement('span');\n        lineEl.className = 'disassembly-line';\n        lineEl.id = `line-${index}`;\n        lineEl.innerHTML = line;\n        disassemblyCodeEl.appendChild(lineEl);\n    });\n}\n\nfunction startDisassemblyAnimation() {\n    if (disassemblyInterval) {\n        clearInterval(disassemblyInterval);\n    }\n    let currentLine = 0;\n    const totalLines = disassemblyCodeEl.children.length;\n\n    disassemblyInterval = setInterval(() => {\n        const prevLine = document.querySelector('.disassembly-line.active');\n        if (prevLine) {\n            prevLine.classList.remove('active');\n        }\n\n        const lineEl = document.getElementById(`line-${currentLine}`);\n        if (lineEl) {\n            lineEl.classList.add('active');\n            lineEl.scrollIntoView({\n                behavior: 'smooth',\n                block: 'center',\n                inline: 'nearest'\n            });\n        }\n        currentLine = (currentLine + 1) % totalLines;\n    }, 150);\n}\n\n/**\n * This function was MOVED here from jsonsamples.js\n * Dynamically generates the graph data based on API imports.\n * @param {string[]} apiImports - Array of API names (e.g., ['CreateRemoteThread'])\n * @param {string} classification - 'Benign', 'Suspicious', or 'Malware'\n * @returns {object} A graph object with 'nodes' and 'edges' arrays.\n */\nfunction generateGraphData(apiImports, classification) {\n    let nodes = [];\n    let edges = [];\n    const nodeSpacing = 150;\n    const startY = 100;\n    const startX = 250;\n\n    // 1. Add the Main Entry Point node\n    nodes.push({ \n        id: 'main-entry', \n        label: 'main()', \n        class: 'node-entry', \n        pos: { top: `${startY + (apiImports.length / 2) * (nodeSpacing / 2)}px`, left: '50px' } \n    });\n\n    if (!apiImports || apiImports.length === 0) {\n        // Benign/Empty graph\n        nodes.push({ id: 'benign-1', label: 'ReadFile', class: 'node-std', pos: { top: `${startY}px`, left: `${startX}px` } });\n        nodes.push({ id: 'benign-2', label: 'WriteFile', class: 'node-std', pos: { top: `${startY + nodeSpacing / 2}px`, left: `${startX}px` } });\n        edges.push({ from: 'main-entry', to: 'benign-1', options: { color: '#888' } });\n        edges.push({ from: 'main-entry', to: 'benign-2', options: { color: '#888' } });\n    } else {\n        // Suspicious/Malware graph\n        apiImports.forEach((apiName, index) => {\n            let nodeClass = 'node-api'; // Default\n            let edgeColor = '#888'; // Default\n\n            if (classification === 'Malware') {\n                nodeClass = 'node-malicious';\n                edgeColor = '#e74c3c'; // Malware red\n            } else if (classification === 'Suspicious') {\n                nodeClass = 'node-suspicious';\n                edgeColor = '#f1c40f'; // Suspicious yellow\n            } else {\n                // Benign\n                nodeClass = 'node-std';\n                edgeColor = '#888';\n            }\n\n\n            const nodeId = `api-${index}`;\n            const yPos = startY + (index * (nodeSpacing-50)); // Make them a bit closer\n            const xPos = startX + (index % 2 === 0 ? 0 : 150); // Stagger them\n\n            // Add the API node\n            nodes.push({\n                id: nodeId,\n                label: apiName,\n                class: nodeClass,\n                pos: { top: `${yPos}px`, left: `${xPos}px` }\n            });\n\n            // Add the edge from main\n            edges.push({\n                from: 'main-entry',\n                to: nodeId,\n                options: { color: edgeColor }\n            });\n        });\n    }\n\n    return { nodes, edges };\n}\n\n// --- Graph Drawing ---\nfunction drawCallGraph(graphData) {\n    // 1. Clear previous graph (both nodes and lines)\n    callGraphEl.innerHTML = '';\n    currentGraphLines.forEach(line => line.remove());\n    currentGraphLines = [];\n\n    if (!graphData || !graphData.nodes || !graphData.edges) {\n        console.error(\"Invalid graph data received\", graphData);\n        return;\n    }\n\n    // 2. Create and place all nodes\n    graphData.nodes.forEach(node => {\n        const nodeEl = document.createElement('div');\n        nodeEl.id = node.id;\n        nodeEl.className = `graph-node ${node.class}`;\n        nodeEl.style.top = node.pos.top;\n        nodeEl.style.left = node.pos.left;\n        nodeEl.textContent = node.label;\n        callGraphEl.appendChild(nodeEl);\n    });\n\n    // 3. Draw all edges (must be done *after* nodes are in DOM)\n    // Use a slight timeout to ensure DOM is ready\n    setTimeout(() => {\n        graphData.edges.forEach(edge => {\n            try {\n                const line = new LeaderLine(\n                    document.getElementById(edge.from),\n                    document.getElementById(edge.to),\n                    {\n                        color: edge.options.color,\n                        path: edge.options.path || 'straight',\n                        startSocket: edge.options.startSocket || 'auto',\n                        endSocket: edge.options.endSocket || 'auto',\n                        endPlug: 'arrow1',\n                        size: 3,\n                        endPlugSize: 1.5,\n                    }\n                );\n                currentGraphLines.push(line);\n            } catch(e) {\n                console.error(\"Could not draw line:\", e);\n            }\n        });\n    }, 500); // 500ms timeout to let CSS fade-in finish\n}\n\n\n// --- History Panel Logic ---\nasync function loadHistory() {\n  if (!historyListEl) return;\n  \n  historyListEl.innerHTML = '<li class=\"history-item-loading\">Loading...</li>';\n\n  try {\n    const historyData = await window.electronAPI.getHistory();\n\n    if (!historyData || historyData.length === 0) {\n      historyListEl.innerHTML = '<li class=\"history-item-empty\">No scan history found.</li>';\n      return;\n    }\n\n    historyListEl.innerHTML = '';\n\n    historyData.forEach(scan => {\n      const li = document.createElement('li');\n      li.className = 'history-item';\n\n      // Determine classification icon\n      let statusIcon = 'fas fa-check-circle';\n      let classType = 'safe';\n      if (scan.classification.includes('Malware')) {\n        statusIcon = 'fas fa-bug';\n        classType = 'malware';\n      } else if (scan.classification.includes('Suspicious')) {\n        statusIcon = 'fas fa-exclamation-triangle';\n        classType = 'suspicious';\n      }\n\n      // Determine file type icon based on extension\n      const filename = scan.detected_filename || '';\n      const ext = filename.split('.').pop().toLowerCase();\n      let fileTypeIcon = 'fas fa-file';\n      \n      if (['exe', 'dll', 'sys', 'msi'].includes(ext)) {\n        fileTypeIcon = 'fas fa-cog'; // Executable\n      } else if (['jpg', 'jpeg', 'png', 'gif', 'bmp', 'svg', 'webp'].includes(ext)) {\n        fileTypeIcon = 'fas fa-image'; // Image\n      } else if (['js', 'ts', 'py', 'java', 'cpp', 'c', 'h', 'cs', 'go', 'rs', 'php', 'rb'].includes(ext)) {\n        fileTypeIcon = 'fas fa-code'; // Code\n      } else if (['pdf', 'doc', 'docx', 'txt', 'rtf', 'odt'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-alt'; // Document\n      } else if (['zip', 'rar', '7z', 'tar', 'gz', 'bz2'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-archive'; // Archive\n      } else if (['mp3', 'wav', 'ogg', 'flac', 'aac'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-audio'; // Audio\n      } else if (['mp4', 'avi', 'mkv', 'mov', 'wmv', 'flv'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-video'; // Video\n      } else if (['html', 'htm', 'css', 'xml', 'json'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-code'; // Web file\n      }\n\n      const scanDate = new Date(scan.scanDate).toLocaleString();\n      const hashSha256 = scan.file_hashes?.sha256 || 'N/A';\n      const hashDisplay = hashSha256.substring(0, 16) + '...'; // Show first 16 chars\n\n      li.innerHTML = `\n        <div class=\"history-icon-wrapper\">\n          <div class=\"history-icon ${classType}\">\n            <i class=\"${statusIcon}\"></i>\n          </div>\n          <div class=\"history-file-type\">\n            <i class=\"${fileTypeIcon}\"></i>\n          </div>\n        </div>\n        <div class=\"history-details\">\n          <span class=\"history-filename\" title=\"${filename}\">${filename}</span>\n          <span class=\"history-classification ${classType}\">${scan.classification}</span>\n          <span class=\"history-hash\" title=\"${hashSha256}\">SHA256: ${hashDisplay}</span>\n        </div>\n        <span class=\"history-date\">${scanDate}</span>\n      `;\n      \n      historyListEl.appendChild(li);\n    });\n\n  } catch (err) {\n    console.error('Failed to load history:', err);\n    historyListEl.innerHTML = '<li class=\"history-item-empty\">Error loading history.</li>';\n  }\n}\n\nfunction toggleHistoryPanel() {\n  bodyEl.classList.toggle('is-history-open');\n  \n  // ADD THIS: If we are opening the panel, load the history\n  if (bodyEl.classList.contains('is-history-open')) {\n    loadHistory();\n  }\n}\n\nhistoryBtn.addEventListener('click', (e) => {\n    e.preventDefault();\n    toggleHistoryPanel();\n});\nhistoryCloseBtn.addEventListener('click', toggleHistoryPanel);\nhistoryOverlay.addEventListener('click', toggleHistoryPanel);\n\n\n// --- Auto-scroll Logic ---\nfunction startScrolling(direction) {\n    if (scrollInterval) {\n        clearInterval(scrollInterval);\n    }\n    scrollInterval = setInterval(() => {\n        window.scrollBy(0, direction * 10); // 10 pixels at a time\n    }, 20); // every 20ms\n}\n\nfunction stopScrolling() {\n    clearInterval(scrollInterval);\n    scrollInterval = null;\n}\n\nscrollZoneTop.addEventListener('mouseenter', () => {\n    startScrolling(-1); // Scroll Up\n    scrollZoneTop.classList.add('scrolling');\n});\nscrollZoneTop.addEventListener('mouseleave', () => {\n    stopScrolling();\n    scrollZoneTop.classList.remove('scrolling');\n});\n\nscrollZoneBottom.addEventListener('mouseenter', () => {\n    startScrolling(1); // Scroll Down\n    scrollZoneBottom.classList.add('scrolling');\n});\nscrollZoneBottom.addEventListener('mouseleave', () => {\n    stopScrolling();\n    scrollZoneBottom.classList.remove('scrolling');\n});\n\n\n// --- Chart instances ---\nlet malwareTypesChart = null;\nlet topMalwareChart = null;\n\n// --- Function to create/recreate charts ---\nwindow.recreateCharts = function() {\n    // Get CSS variables for theme-aware colors\n    const chartLegendColor = getComputedStyle(document.documentElement).getPropertyValue('--chart-legend-text').trim();\n    const chartAxesColor = getComputedStyle(document.documentElement).getPropertyValue('--chart-axes-text').trim();\n    const chartGridColor = getComputedStyle(document.documentElement).getPropertyValue('--chart-grid-line').trim();\n\n    // Destroy existing charts if they exist\n    if (malwareTypesChart) {\n        malwareTypesChart.destroy();\n    }\n    if (topMalwareChart) {\n        topMalwareChart.destroy();\n    }\n\n    // Create Malware Types Chart (Doughnut)\n    const typesCtx = document.getElementById('malwareTypesChart');\n    if (typesCtx) {\n        malwareTypesChart = new Chart(typesCtx, {\n            type: 'doughnut',\n            data: {\n                labels: ['PE (exe/dll)', 'JavaScript', 'VBS', 'Macro', 'Other'],\n                datasets: [{\n                    label: 'Submission Types',\n                    data: [65, 15, 8, 7, 5],\n                    backgroundColor: [\n                        '#007bff', // Blue\n                        '#f1c40f', // Yellow\n                        '#e74c3c', // Red\n                        '#9b59b6', // Purple\n                        '#34495e'  // Gray\n                    ],\n                    borderColor: '#2a2a2e',\n                    borderWidth: 3,\n                }]\n            },\n            options: {\n                responsive: true,\n                plugins: {\n                    legend: {\n                        position: 'right',\n                        labels: {\n                            color: chartLegendColor,\n                            boxWidth: 20\n                        }\n                    }\n                }\n            }\n        });\n    }\n\n    // Create Top Malware Chart (Line)\n    const topMalwareCtx = document.getElementById('topMalwareChart');\n    if (topMalwareCtx) {\n        topMalwareChart = new Chart(topMalwareCtx, {\n            type: 'line',\n            data: {\n                labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5'],\n                datasets: [\n                    {\n                        label: 'Zeus',\n                        data: [120, 150, 130, 180, 160],\n                        borderColor: '#e74c3c',\n                        backgroundColor: '#e74c3c20',\n                        fill: true,\n                        tension: 0.4\n                    },\n                    {\n                        label: 'WannaCry',\n                        data: [80, 90, 110, 100, 130],\n                        borderColor: '#007bff',\n                        backgroundColor: '#007bff20',\n                        fill: true,\n                        tension: 0.4\n                    },\n                    {\n                        label: 'Emotet',\n                        data: [50, 60, 80, 70, 90],\n                        borderColor: '#f1c40f',\n                        backgroundColor: '#f1c40f20',\n                        fill: true,\n                        tension: 0.4\n                    }\n                ]\n            },\n            options: {\n                responsive: true,\n                plugins: {\n                    legend: {\n                        labels: {\n                            color: chartLegendColor\n                        }\n                    }\n                },\n                scales: {\n                    x: {\n                        ticks: { color: chartAxesColor },\n                        grid: { color: chartGridColor + '50' }\n                    },\n                    y: {\n                        ticks: { color: chartAxesColor },\n                        grid: { color: chartGridColor }\n                    }\n                }\n            }\n        });\n    }\n};\n\n// --- Run on Page Load ---\ndocument.addEventListener('DOMContentLoaded', () => {\n    // 1. Animate Stat Cards\n    const statNumbers = document.querySelectorAll('.stat-number');\n    statNumbers.forEach(stat => {\n        const target = +stat.getAttribute('data-target');\n        const duration = 2000;\n        const stepTime = 20;\n        const steps = duration / stepTime;\n        const increment = target / steps;\n        let current = 0;\n\n        const updateCount = () => {\n            current += increment;\n            if (current < target) {\n                stat.textContent = Math.ceil(current).toLocaleString();\n                setTimeout(updateCount, stepTime);\n            } else {\n                stat.textContent = target.toLocaleString();\n            }\n        };\n        updateCount();\n    });\n\n    // 2. Create the charts\n    recreateCharts();\n});\n","epoch":19,"telemetryInfo":{}}],["file:///home/trang/mAIware/index.html::request_b7d8c486-3525-4954-bb70-78dfb4c10314",{"uri":{"$mid":1,"fsPath":"/home/trang/mAIware/index.html","external":"file:///home/trang/mAIware/index.html","path":"/home/trang/mAIware/index.html","scheme":"file"},"requestId":"request_b7d8c486-3525-4954-bb70-78dfb4c10314","content":"<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>mAIware AI Malware Detection Demo</title>\n    <!-- Font Awesome for icons (which you already had) -->\n    <link rel=\"stylesheet\" href=\"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css\">\n    <!-- Chart.js for stats (which you already had) -->\n    <script src=\"https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js\"></script>\n    <!-- Link to the CSS file -->\n    <link rel=\"stylesheet\" href=\"style.css\">\n</head>\n\n<body>\n    <nav class=\"top-nav\">\n        <div class=\"logo\"> <i class=\"fas fa-shield-virus\"></i> <span>mAIware</span> </div>\n        <div class=\"nav-links\"> <a href=\"#\" class=\"nav-link\" data-tooltip=\"Login\"><i class=\"fas fa-sign-in-alt\"></i><span class=\"link-text\">Login</span></a> <a href=\"#\" class=\"nav-link\" data-tooltip=\"Sign Up\"><i class=\"fas fa-user-plus\"></i><span class=\"link-text\">Sign Up</span></a> <a href=\"#\" class=\"nav-link\" data-tooltip=\"Community\"><i class=\"fas fa-users\"></i><span class=\"link-text\">Community</span></a> <a href=\"#\" class=\"nav-link\" data-tooltip=\"API Docs\"><i class=\"fas fa-code\"></i><span class=\"link-text\">API</span></a> <a href=\"#\" id=\"history-btn\" class=\"nav-link\" data-tooltip=\"Scan History\"><i class=\"fas fa-history\"></i><span class=\"link-text\">History</span></a> <a href=\"#\" class=\"nav-link\" id=\"theme-toggle\" data-tooltip=\"Toggle Theme\"> <i class=\"fas fa-sun\"></i> </a> </div>\n    </nav>\n\n    <main class=\"main-container\">\n        <!-- Column 1 -->\n        <div class=\"scanner-wrapper\">\n            <!-- Main Scanner Box -->\n            <div class=\"scanner-container\">\n                <h1>AI Malware Detection</h1>\n                <!-- State 1: Initial -->\n                <div id=\"initial-state\" class=\"scanner-state active\">\n                    <p>Watching your Downloads folder for new files...</p>\n                    <div id=\"drop-zone\" class=\"upload-zone\"> <i class=\"upload-icon fas fa-eye\"></i>\n                        <h3>Automatic Scanning Active</h3>\n                        <span>(Download a file to begin)</span>\n                    </div>\n                </div>\n\n                <!-- State 2: Analyzing -->\n                <div id=\"analyzing-state\" class=\"scanner-state\">\n                    <div class=\"analyzing-icon\">\n                        <div class=\"loader\"></div>\n                    </div>\n                    <h3>Analyzing...</h3> <span class=\"filename\" id=\"analyzing-filename\">demo_file.exe</span> </div>\n\n                <!-- State 3: Result -->\n                <div id=\"result-state\" class=\"scanner-state\"> <i class=\"result-icon\" id=\"result-icon\"></i>\n                    <h2 id=\"result-text\"></h2>\n                    <div class=\"filename\" id=\"result-filename\"></div>\n                    <p id=\"result-details\"></p>\n                    <!-- Removed the resetDemo() button as it's automatic now -->\n                </div>\n                <div id=\"non-pe-result\" class=\"scanner-state non-pe-result\">\n                    <div class=\"non-pe-icon\"><i class=\"fas fa-file\"></i></div>\n                    <h2 id=\"non-pe-title\">File is not a Windows PE executable</h2>\n                    <p class=\"filename\" id=\"non-pe-filename\"></p>\n                    <div class=\"non-pe-hash-grid\">\n                        <div class=\"non-pe-hash\">\n                            <h4>SHA256</h4>\n                            <p id=\"non-pe-hash-sha256\">...</p>\n                        </div>\n                        <div class=\"non-pe-hash\">\n                            <h4>MD5</h4>\n                            <p id=\"non-pe-hash-md5\">...</p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Analysis Details (Shows on result) -->\n            <div class=\"analysis-details-container\" id=\"analysis-details-wrapper\">\n                <div class=\"progress-header\">\n                    <h3>Malware Confidence</h3> <span class=\"score-percentage\" id=\"score-percentage\">0%</span> </div>\n                <div class=\"progress-bar-background\">\n                    <div class=\"progress-bar-fill\" id=\"progress-bar-fill\" style=\"width: 0%;\"></div>\n                </div>\n\n                <!-- This grid holds Vendor and Signature -->\n                <div class=\"details-grid\">\n                    <!-- Vendor UI Container -->\n                    <div class=\"details-section\" id=\"details-vendor\">\n                        <h4>Vendor Analysis</h4>\n                        <div class=\"vendor-info\">\n                            <i class=\"fas fa-question-circle\"></i>\n                            <span>Scanning...</span>\n                        </div>\n                    </div>\n                    <!-- Signature UI Container -->\n                    <div class=\"details-section\" id=\"details-signature\">\n                        <h4>Digital Signature</h4>\n                        <div class=\"signature-info\">\n                            <i class=\"fas fa-question-circle\"></i>\n                            <span>Checking...</span>\n                        </div>\n                    </div>\n                </div>\n\n                <!-- Reasoning (File Type/Packer) -->\n                <div class=\"details-section\">\n                    <h4>Key Findings</h4>\n                    <p id=\"details-reasoning\">...</p>\n                </div>\n                \n                <div class=\"details-section\">\n                    <h4>SHA256 Hash</h4>\n                    <p class=\"hash-text\" id=\"details-hash-sha256\">...</p>\n                </div>\n\n                <div class=\"details-section\">\n                    <h4>MD5 Hash</h4>\n                    <p class=\"hash-text\" id=\"details-hash-md5\">...</p>\n                </div>\n\n                <div class=\"details-section\">\n                    <h4>System IP</h4>\n                    <p class=\"hash-text\" id=\"details-system-ip\">Detecting...</p>\n                </div>\n\n                <div class=\"details-section\">\n                    <h4>What To Do Next</h4>\n                    <p id=\"details-recommendation\">...</p>\n                </div>\n\n                <div class=\"btn-wrapper\"> <button class=\"btn btn-primary\"><i class=\"fas fa-download\"></i> Download Report</button> <button class=\"btn btn-secondary\"><i class=\"fas fa-flag\"></i> Report False Positive</button> </div>\n            </div>\n        </div>\n\n        <!-- Column 2 -->\n        <div class=\"right-panel-wrapper\">\n            <!-- Stats (Shows on initial) -->\n            <div class=\"stats-wrapper\" id=\"stats-wrapper\">\n                <div class=\"stats-grid\">\n                    <div class=\"stat-card\"> <i class=\"fas fa-virus-slash\"></i>\n                        <div class=\"stat-content\"> <span class=\"stat-number\" data-target=\"14720938\">0</span> <span class=\"stat-label\">Malware Analyzed</span> </div>\n                    </div>\n                    <div class=\"stat-card\"> <i class=\"fas fa-users\"></i>\n                        <div class=\"stat-content\"> <span class=\"stat-number\" data-target=\"82041\">0</span> <span class=\"stat-label\">Active Users</span> </div>\n                    </div>\n                    <div class=\"stat-card\"> <i class=\"fas fa-chart-line\"></i>\n                        <div class=\"stat-content\"> <span class=\"stat-number\" data-target=\"1259024\">0</span> <span class=\"stat-label\">Site Visits (24h)</span> </div>\n                    </div>\n                </div>\n                <div class=\"chart-container-wrapper\">\n                    <div class=\"chart-container\">\n                        <h3>Top 5 Malware Families (30 Days)</h3> <canvas id=\"topMalwareChart\"></canvas> </div>\n                    <div class=\"chart-container\">\n                        <h3>Submission Types</h3> <canvas id=\"malwareTypesChart\"></canvas> </div>\n                </div>\n            </div>\n\n            <!-- Disassembly (Shows on analyzing/result) -->\n            <div class=\"disassembly-wrapper\" id=\"disassembly-wrapper\">\n                <div class=\"disassembly-header\">\n                    <h3>Disassembly: <span id=\"disassembly-filename\"></span></h3>\n                </div>\n                <div class=\"disassembly-code\" id=\"disassembly-code\"> </div>\n            </div>\n\n            <!-- File Internals (Shows on result) -->\n            <div class=\"file-internals-container\" id=\"file-internals-wrapper\">\n                <h3>File Internals</h3>\n                \n                <!-- Entropy UI Container -->\n                <div class=\"details-section\">\n                    <h4>Section Entropy (0=Normal, 8=Packed/Encrypted)</h4>\n                    <div class=\"entropy-bars\" id=\"entropy-bars-container\">\n                        <!-- JS will populate this -->\n                    </div>\n                </div>\n                \n                <!-- Key Strings UI Container -->\n                <div class=\"details-section\">\n                    <h4>Suspicious / Key Strings</h4>\n                    <div class=\"key-strings\" id=\"key-strings-container\">\n                        <!-- JS will populate this -->\n                    </div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Full Width Row -->\n        <div class=\"graph-wrapper\" id=\"graph-wrapper\">\n            <div class=\"graph-header\">\n                <h3>Dynamic Function Call Graph (Simulation)</h3>\n            </div>\n            <div class=\"call-graph-container\">\n                <div class=\"call-graph\" id=\"call-graph\">\n                    <!-- JS will populate this -->\n                </div>\n            </div>\n        </div>\n    </main>\n\n    <!-- History Panel (Hidden by default) -->\n    <div class=\"history-overlay\" id=\"history-overlay\"></div>\n    <div class=\"history-panel\" id=\"history-panel\">\n        <div class=\"history-header\">\n            <h3>Scan History</h3> <button class=\"history-close-btn\" id=\"history-close-btn\"><i class=\"fas fa-times\"></i></button> </div>\n        <ul class=\"history-list\">\n            <!-- JS would populate this -->\n        </ul>\n    </div>\n\n    <!-- Scroll Zones -->\n    <div class=\"scroll-zone top\" id=\"scroll-zone-top\"><i class=\"fas fa-chevron-up\"></i></div>\n    <div class=\"scroll-zone bottom\" id=\"scroll-zone-bottom\"><i class=\"fas fa-chevron-down\"></i></div>\n    \n    <!-- LeaderLine for graph (which you already had) -->\n    <script src=\"https://cdn.jsdelivr.net/npm/leader-line-new@1.1.9/leader-line.min.js\"></script>\n    <!-- Link to the JS file -->\n    <script src=\"script.js\"></script>\n\n    <script>\n    document.addEventListener('DOMContentLoaded', () => {\n        const themeToggleButton = document.getElementById('theme-toggle');\n        const body = document.body;\n        const themeIcon = themeToggleButton.querySelector('i');\n\n        // Function to apply the saved theme\n        const applyTheme = (theme) => {\n            if (theme === 'light') {\n                body.classList.add('light-theme');\n                themeIcon.classList.remove('fa-sun');\n                themeIcon.classList.add('fa-moon');\n            } else {\n                body.classList.remove('light-theme');\n                themeIcon.classList.remove('fa-moon');\n                themeIcon.classList.add('fa-sun');\n            }\n            \n            // Recreate charts with updated theme colors\n            if (window.recreateCharts) {\n                window.recreateCharts();\n            }\n        };\n\n        // Load the saved theme on page load\n        const savedTheme = localStorage.getItem('theme') || 'dark'; // Default to dark\n        applyTheme(savedTheme);\n\n        // Add click event for the toggle button\n        themeToggleButton.addEventListener('click', (e) => {\n            e.preventDefault(); // Stop the link from navigating\n            \n            // Check current theme\n            const isLightTheme = body.classList.contains('light-theme');\n            \n            // Set new theme\n            const newTheme = isLightTheme ? 'dark' : 'light';\n            \n            // Apply the new theme\n            applyTheme(newTheme);\n            \n            // Save the new theme to localStorage\n            localStorage.setItem('theme', newTheme);\n        });\n    });\n    </script>\n</body>\n</html>\n","epoch":20,"telemetryInfo":{}}],["file:///home/trang/mAIware/script.js::request_ef032d5f-157a-4667-b208-0835d9103e70",{"uri":{"$mid":1,"fsPath":"/home/trang/mAIware/script.js","external":"file:///home/trang/mAIware/script.js","path":"/home/trang/mAIware/script.js","scheme":"file"},"requestId":"request_ef032d5f-157a-4667-b208-0835d9103e70","content":"// --- MOCK DISASSEMBLY DATA ---\n// (We keep this for now, as requested)\nconst mockDisassemblyBenign = [\n    `<span class=\"addr\">0x401000</span> <span class=\"op\">PUSH</span> <span class=\"args\">ebp</span> <span class=\"comment\">; setup stack frame</span>`,\n    `<span class=\"addr\">0x401001</span> <span class=\"op\">MOV</span> <span class=\"args\">ebp, esp</span>`,\n    `<span class=\"addr\">0x401003</span> <span class=\"op\">SUB</span> <span class=\"args\">esp, 48h</span>`,\n    `<span class=\"addr\">0x40100C</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4012A0</span> <span class=\"comment\">; initialize_string</span>`,\n    `<span class=\"addr\">0x401015</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4013F0</span> <span class=\"comment\">; get_user_input</span>`,\n    `<span class=\"addr\">0x40101E</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4015D0</span> <span class=\"comment\">; print_output</span>`,\n    `<span class=\"addr\">0x401028</span> <span class=\"op\">RETN</span>`,\n    `<span class=\"addr\">...</span>`,\n];\nconst mockDisassemblySuspicious = [\n    `<span class=\"addr\">0x401000</span> <span class=\"op\">PUSH</span> <span class=\"args\">ebp</span>`,\n    `<span class=\"addr\">0x401003</span> <span class=\"op\">SUB</span> <span class=\"args\">esp, 80h</span>`,\n    `<span class=\"addr\">0x40100D</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4012A0</span> <span class=\"comment\">; read_file_to_buffer</span>`,\n    `<span class=\"addr\">0x40101B</span> <span class=\"op\">REP</span> <span class=\"op\">MOVSB</span> <span class=\"comment\">; unsafe buffer write</span>`,\n    `<span class=\"addr\">0x401020</span> <span class=\"op\">JGE</span> <span class=\"args\">0x401030</span> <span class=\"comment\">; jump if overflow</span>`,\n    `<span class=\"addr\">0x401028</span> <span class=\"op\">RETN</span>`,\n    `<span class=\"addr\">...</span>`,\n];\nconst mockDisassemblyMalware = [\n    `<span class=\"addr\">0x401000</span> <span class=\"op\">PUSH</span> <span class=\"args\">ebp</span> <span class=\"comment\">; setup stack frame</span>`,\n    `<span class=\"addr\">0x40100B</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4011B0</span> <span class=\"comment\">; kernel32.LoadLibraryA</span>`,\n    `<span class=\"addr\">0x401013</span> <span class=\"op\">PUSH</span> <span class=\"string\">\"CreateRemoteThread\"</span>`,\n    `<span class=\"addr\">0x401019</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4011C0</span> <span class=\"comment\">; kernel32.GetProcAddress</span>`,\n    `<span class=\"addr\">0x401028</span> <span class=\"op\">CALL</span> <span class=\"args\">0x4012F0</span> <span class=\"comment\">; decrypt_payload</span>`,\n    `<span class=\"addr\">0x401034</span> <span class=\"op\">CALL</span> <span class=\"args\">[ebp-24h]</span> <span class=\"comment\">; call CreateRemoteThread</span>`,\n    `<span class=\"addr\">0x401037</span> <span class=\"op\">JMP</span> <span class=\"args\">0x40102D</span> <span class=\"comment\">; loop?</span>`,\n    `<span class=\"addr\">...</span>`,\n];\n\n// --- REMOVED MOCK GRAPH DATA ---\n// const mockGraphSafe = ... (DELETED)\n// const mockGraphSuspicious = ... (DELETED)\n// const mockGraphMalware = ... (DELETED)\n\n// --- ELEMENT REFERENCES ---\nconst initialState = document.getElementById('initial-state');\nconst analyzingState = document.getElementById('analyzing-state');\nconst resultState = document.getElementById('result-state');\n\nconst analyzingFilename = document.getElementById('analyzing-filename');\nconst resultIcon = document.getElementById('result-icon');\nconst resultText = document.getElementById('result-text');\nconst resultFilename = document.getElementById('result-filename');\nconst resultDetails = document.getElementById('result-details');\nconst nonPeResultWrapper = document.getElementById('non-pe-result');\nconst nonPeFilename = document.getElementById('non-pe-filename');\nconst nonPeHashSha256 = document.getElementById('non-pe-hash-sha256');\nconst nonPeHashMd5 = document.getElementById('non-pe-hash-md5');\n\nconst bodyEl = document.body;\nlet animationWrapper = null;\n\nconst disassemblyWrapper = document.getElementById('disassembly-wrapper');\nconst disassemblyCodeEl = document.getElementById('disassembly-code');\nconst disassemblyFilenameEl = document.getElementById('disassembly-filename');\n\n// Analysis Details elements\nconst analysisDetailsWrapper = document.getElementById('analysis-details-wrapper');\nconst progressBarFill = document.getElementById('progress-bar-fill');\nconst scorePercentage = document.getElementById('score-percentage');\nconst detailsReasoning = document.getElementById('details-reasoning'); // We'll reuse this\nconst detailsHashSha256 = document.getElementById('details-hash-sha256');\nconst detailsHashMd5 = document.getElementById('details-hash-md5');\nconst detailsSystemIp = document.getElementById('details-system-ip');\nconst detailsRecommendation = document.getElementById('details-recommendation');\nconst detailsVendor = document.getElementById('details-vendor');\nconst detailsSignature = document.getElementById('details-signature');\nconst fileInternalsWrapper = document.getElementById('file-internals-wrapper');\nconst entropyBarsContainer = document.getElementById('entropy-bars-container');\nconst keyStringsContainer = document.getElementById('key-strings-container');\n\n// History Panel elements\nconst historyBtn = document.getElementById('history-btn');\nconst historyPanel = document.getElementById('history-panel');\nconst historyCloseBtn = document.getElementById('history-close-btn');\nconst historyOverlay = document.getElementById('history-overlay');\nconst historyListEl = document.querySelector('.history-list');\n\n// Scroll Zone elements\nconst scrollZoneTop = document.getElementById('scroll-zone-top');\nconst scrollZoneBottom = document.getElementById('scroll-zone-bottom');\n\n// Graph Panel elements\nconst graphWrapper = document.getElementById('graph-wrapper');\nconst callGraphEl = document.getElementById('call-graph');\n\n// Stats elements\nconst statsWrapper = document.getElementById('stats-wrapper');\n\n\n// --- STATE ---\nlet disassemblyInterval = null;\nlet scrollInterval = null; // For auto-scrolling\nlet currentGraphLines = []; // Renamed from currentLines to avoid conflict\nlet currentFileMetadata = null;\nlet lastScanResult = null;\n\n// 1. Listen for the 'scan-started' message from the backend\nwindow.electronAPI.onScanStarted((filename) => {\n  console.log(`UI: Received scan-started for ${filename}`);\n\n  // 1. Set UI to \"Analyzing\" state\n  initialState.classList.remove('active'); //\n  analyzingState.classList.add('active'); //\n  analyzingFilename.textContent = filename; //\n  disassemblyFilenameEl.textContent = filename; //\n\n  currentFileMetadata = { filename, isPe: true };\n  lastScanResult = null;\n  nonPeResultWrapper.classList.remove('active');\n  bodyEl.classList.remove('is-non-pe');\n\n  // 2. Update body class to show disassembly\n  bodyEl.classList.remove('is-showing-result'); //\n  bodyEl.classList.add('is-analyzing'); //\n  removeAnimationClasses(); //\n  \n  // 3. Populate disassembly with a \"suspicious\" default and start animation\n  // (We don't know the result yet, so we pick one)\n  populateDisassembly(mockDisassemblySuspicious); //\n  startDisassemblyAnimation(); //\n\n  // 4. Clear old results\n  clearResultData();\n});\n\n// 2. Listen for the 'scan-result' message\nwindow.electronAPI.onScanResult((scanResult) => {\n  console.log(\"UI: Received scan-result:\", scanResult);\n\n  clearInterval(disassemblyInterval); //\n  disassemblyInterval = null; //\n\n  bodyEl.classList.remove('is-analyzing'); //\n  bodyEl.classList.add('is-showing-result'); //\n\n  analyzingState.classList.remove('active'); //\n  resultState.classList.add('active'); //\n\n  lastScanResult = scanResult;\n\n  renderScanResult();\n});\n\nwindow.electronAPI.onScanFileMetadata((metadata) => {\n  if (!metadata || typeof metadata !== 'object') {\n    return;\n  }\n\n  currentFileMetadata = metadata;\n\n  if (lastScanResult && metadata.filename === lastScanResult.detected_filename) {\n    renderScanResult();\n  }\n});\n\nfunction renderScanResult() {\n  if (!lastScanResult) {\n    return;\n  }\n\n  const metadataMatches = currentFileMetadata && currentFileMetadata.filename === lastScanResult.detected_filename;\n  const isNonPe = metadataMatches && currentFileMetadata.isPe === false;\n\n  if (isNonPe) {\n    renderNonPeResult(lastScanResult);\n    return;\n  }\n\n  renderPeResult(lastScanResult);\n}\n\nfunction ensureAnimationWrapper() {\n  if (animationWrapper) {\n    return;\n  }\n\n  animationWrapper = document.createElement('div');\n  animationWrapper.className = 'animation-swarm';\n  for (let i = 0; i < 10; i++) {\n    const particle = document.createElement('span');\n    animationWrapper.appendChild(particle);\n  }\n  bodyEl.prepend(animationWrapper);\n}\n\nfunction renderPeResult(scanResult) {\n  removeAnimationClasses();\n  bodyEl.classList.remove('is-non-pe');\n  nonPeResultWrapper.classList.remove('active');\n\n  let resultIconClass = 'fas fa-check-circle'; //\n  let resultMockDisassembly = mockDisassemblyBenign; //\n  let resultBodyClass = 'result-safe-active'; //\n  let resultScannerClass = 'result-safe'; //\n  let resultProgressClass = 'progress-bar-green'; //\n  let resultScoreClass = 'score-green'; //\n  let recommendation = 'You can safely run this file.'; //\n\n  if (scanResult.classification.includes('Malware')) {\n    resultIconClass = 'fas fa-bug';\n    resultMockDisassembly = mockDisassemblyMalware;\n    resultBodyClass = 'result-malware-active'; //\n    resultScannerClass = 'result-malware'; //\n    resultProgressClass = 'progress-bar-red'; //\n    resultScoreClass = 'score-red'; //\n    recommendation = 'DO NOT OPEN. Quarantine this file immediately.'; //\n  } else if (scanResult.classification.includes('Suspicious')) {\n    resultIconClass = 'fas fa-exclamation-triangle'; //\n    resultMockDisassembly = mockDisassemblySuspicious; //\n    resultBodyClass = 'result-suspicious-active'; //\n    resultScannerClass = 'result-suspicious'; //\n    resultProgressClass = 'progress-bar-yellow'; //\n    resultScoreClass = 'score-yellow'; //\n    recommendation = 'Be cautious. Only run if you trust the source.'; //\n  }\n\n  ensureAnimationWrapper();\n  bodyEl.classList.add(resultBodyClass); //\n\n  resultState.className = `scanner-state active ${resultScannerClass}`; //\n  resultIcon.className = `result-icon ${resultIconClass}`; //\n  resultText.textContent = scanResult.classification; //\n\n  let detailsText = `Scanned ${scanResult.detected_filename}.`;\n  if (scanResult.malware_family) {\n    detailsText = `Family: ${scanResult.malware_family}`;\n  }\n  resultDetails.textContent = detailsText;\n  resultFilename.textContent = scanResult.detected_filename; //\n\n  progressBarFill.className = 'progress-bar-fill'; //\n  scorePercentage.className = 'score-percentage'; //\n  progressBarFill.classList.add(resultProgressClass); //\n  const rawConfidence = Number(scanResult.confidence_score);\n  const confidenceValue = Number.isFinite(rawConfidence) ? rawConfidence * 100 : 0;\n  progressBarFill.style.width = `${confidenceValue}%`; //\n  scorePercentage.textContent = `${Math.round(confidenceValue)}%`; //\n  scorePercentage.classList.add(resultScoreClass); //\n\n  detailsReasoning.textContent = `Filetype: ${scanResult.key_findings.file_type}. Packer: ${scanResult.key_findings.packer_detected}.`; //\n  const hashData = scanResult.file_hashes || {};\n  detailsHashSha256.textContent = hashData.sha256 || 'Not available'; //\n  detailsHashMd5.textContent = hashData.md5 || 'Not available'; //\n  updateSystemIpDisplay();\n  detailsRecommendation.textContent = recommendation;\n\n  populateVendor(scanResult.vendor); //\n  populateSignature(scanResult.key_findings.signature); //\n  populateEntropyBars(scanResult.key_findings.section_entropy || []); //\n  populateKeyStrings(scanResult.key_findings.key_strings || [], scanResult.classification); //\n\n  populateDisassembly(resultMockDisassembly); //\n\n  const apiList = scanResult.key_findings.api_imports || [];\n  const graphData = generateGraphData(apiList, scanResult.classification);\n  drawCallGraph(graphData);\n}\n\nfunction renderNonPeResult(scanResult) {\n  removeAnimationClasses();\n  bodyEl.classList.add('is-non-pe');\n  resultState.className = 'scanner-state active';\n  resultIcon.className = 'result-icon fas fa-file';\n  resultText.textContent = '';\n  resultDetails.textContent = '';\n  resultFilename.textContent = '';\n\n  const hashData = scanResult.file_hashes || {};\n  nonPeFilename.textContent = scanResult.detected_filename || '';\n  nonPeHashSha256.textContent = hashData.sha256 || 'Not available';\n  nonPeHashMd5.textContent = hashData.md5 || 'Not available';\n\n  detailsHashSha256.textContent = hashData.sha256 || 'Not available';\n  detailsHashMd5.textContent = hashData.md5 || 'Not available';\n\n  nonPeResultWrapper.classList.add('active');\n\n  callGraphEl.innerHTML = '';\n  currentGraphLines.forEach(line => line.remove());\n  currentGraphLines = [];\n  entropyBarsContainer.innerHTML = '';\n  keyStringsContainer.innerHTML = '';\n}\n\n/**\n * Clears all dynamic result data to prepare for the next scan.\n */\nfunction clearResultData() {\n    // Clear scanner panel\n    resultText.textContent = '';\n    resultDetails.textContent = '';\n    resultFilename.textContent = '';\n    nonPeResultWrapper.classList.remove('active');\n    nonPeFilename.textContent = '';\n    nonPeHashSha256.textContent = '...';\n    nonPeHashMd5.textContent = '...';\n    bodyEl.classList.remove('is-non-pe');\n\n    // Clear analysis panel\n    progressBarFill.style.width = `0%`;\n    scorePercentage.textContent = `0%`;\n    detailsReasoning.textContent = '...';\n    detailsHashSha256.textContent = '...';\n    detailsHashMd5.textContent = '...';\n    if (detailsSystemIp) {\n        detailsSystemIp.textContent = 'Detecting...';\n    }\n    detailsRecommendation.textContent = '...';\n\n    // Clear vendor\n    detailsVendor.innerHTML = `\n        <h4>Vendor Analysis</h4>\n        <div class=\"vendor-info\">\n            <i class=\"fas fa-question-circle\"></i>\n            <span>Scanning...</span>\n        </div>`;\n    \n    // Clear signature\n    detailsSignature.innerHTML = `\n        <h4>Digital Signature</h4>\n        <div class=\"signature-info\">\n            <i class=\"fas fa-question-circle\"></i>\n            <span>Checking...</span>\n        </div>`;\n    \n    // Clear internals\n    entropyBarsContainer.innerHTML = '';\n    keyStringsContainer.innerHTML = '';\n    \n    // Clear graph\n    callGraphEl.innerHTML = '';\n    currentGraphLines.forEach(line => line.remove());\n    currentGraphLines = [];\n}\n\n// --- VENDOR UI FUNCTION (IMPLEMENTED) ---\nfunction populateVendor(vendor) {\n    if (!vendor) return;\n    const icon = vendor.icon || 'fas fa-question-circle'; //\n    const name = vendor.name || 'Unknown'; //\n    detailsVendor.innerHTML = `\n        <h4>Vendor Analysis</h4> <div class=\"vendor-info\"> <i class=\"${icon}\"></i>\n            <span>${name}</span>\n        </div>\n    `;\n}\n\n// --- SIGNATURE UI FUNCTION (IMPLEMENTED) ---\nfunction populateSignature(signature) {\n    if (!signature) return;\n    let icon = signature.icon || 'fas fa-question-circle';\n    let cssClass = `sig-${signature.level || 'unknown'}`; // 'sig-verified', 'sig-untrusted', 'sig-unknown'\n\n    detailsSignature.innerHTML = `\n        <h4>Digital Signature</h4> <div class=\"signature-info ${cssClass}\"> <i class=\"${icon}\"></i>\n            <span>${signature.name}</span>\n        </div>\n    `;\n}\n\n// --- ENTROPY BARS UI FUNCTION (IMPLEMENTED) ---\nfunction populateEntropyBars(sections) {\n    entropyBarsContainer.innerHTML = ''; // Clear old bars\n    if (!sections || sections.length === 0) {\n        entropyBarsContainer.innerHTML = '<p class=\"hash-text\">No PE sections found to analyze.</p>';\n        return;\n    }\n\n    sections.forEach(section => { //\n        const value = section.entropy; //\n        const width = (value / 8.0) * 100; // Entropy is 0-8\n        let cssClass = 'low';\n        \n        if (value > 6.0) cssClass = 'medium';\n        if (value > 7.0) cssClass = 'high';\n        if (value > 7.8) cssClass = 'packed'; // Match style.css\n\n        const row = document.createElement('div');\n        row.className = 'entropy-bar-row';\n        row.innerHTML = `\n            <span class=\"entropy-bar-label\">${section.name}</span> <div class=\"entropy-bar-bg\">\n                <div class=\"entropy-bar-fill ${cssClass}\" style=\"width: ${width}%\">\n                    <span class=\"entropy-bar-value\">${value.toFixed(2)}</span>\n                </div>\n            </div>\n        `;\n        entropyBarsContainer.appendChild(row);\n    });\n}\n\n// --- KEY STRINGS UI FUNCTION (IMPLEMENTED) ---\nfunction populateKeyStrings(strings, classification) {\n    keyStringsContainer.innerHTML = ''; // Clear old strings\n    if (!strings || strings.length === 0) {\n        keyStringsContainer.innerHTML = '<span class=\"key-string-tag\">No notable strings found.</span>';\n        return;\n    }\n    \n    const tagClass = classification.includes('Benign') ? 'benign' : 'suspicious'; //\n\n    strings.forEach(str => { //\n        const tag = document.createElement('span');\n        tag.className = `key-string-tag ${tagClass}`;\n        tag.textContent = str;\n        keyStringsContainer.appendChild(tag);\n    });\n}\n\nfunction updateSystemIpDisplay() {\n    if (!detailsSystemIp || !window.electronAPI || typeof window.electronAPI.getSystemIp !== 'function') {\n        return;\n    }\n\n    detailsSystemIp.textContent = 'Detecting...';\n\n    window.electronAPI.getSystemIp()\n        .then((ip) => {\n            if (!ip) {\n                detailsSystemIp.textContent = 'Unavailable';\n                return;\n            }\n\n            detailsSystemIp.textContent = ip;\n        })\n        .catch(() => {\n            detailsSystemIp.textContent = 'Unavailable';\n        });\n}\n\nfunction removeAnimationClasses() {\n    bodyEl.classList.remove('result-safe-active');\n    bodyEl.classList.remove('result-suspicious-active');\n    bodyEl.classList.remove('result-malware-active');\n}\n\n// --- Disassembly Functions ---\n\nfunction populateDisassembly(codeLines) {\n    disassemblyCodeEl.innerHTML = '';\n    codeLines.forEach((line, index) => {\n        const lineEl = document.createElement('span');\n        lineEl.className = 'disassembly-line';\n        lineEl.id = `line-${index}`;\n        lineEl.innerHTML = line;\n        disassemblyCodeEl.appendChild(lineEl);\n    });\n}\n\nfunction startDisassemblyAnimation() {\n    if (disassemblyInterval) {\n        clearInterval(disassemblyInterval);\n    }\n    let currentLine = 0;\n    const totalLines = disassemblyCodeEl.children.length;\n\n    disassemblyInterval = setInterval(() => {\n        const prevLine = document.querySelector('.disassembly-line.active');\n        if (prevLine) {\n            prevLine.classList.remove('active');\n        }\n\n        const lineEl = document.getElementById(`line-${currentLine}`);\n        if (lineEl) {\n            lineEl.classList.add('active');\n            lineEl.scrollIntoView({\n                behavior: 'smooth',\n                block: 'center',\n                inline: 'nearest'\n            });\n        }\n        currentLine = (currentLine + 1) % totalLines;\n    }, 150);\n}\n\n/**\n * This function was MOVED here from jsonsamples.js\n * Dynamically generates the graph data based on API imports.\n * @param {string[]} apiImports - Array of API names (e.g., ['CreateRemoteThread'])\n * @param {string} classification - 'Benign', 'Suspicious', or 'Malware'\n * @returns {object} A graph object with 'nodes' and 'edges' arrays.\n */\nfunction generateGraphData(apiImports, classification) {\n    let nodes = [];\n    let edges = [];\n    const nodeSpacing = 150;\n    const startY = 100;\n    const startX = 250;\n\n    // 1. Add the Main Entry Point node\n    nodes.push({ \n        id: 'main-entry', \n        label: 'main()', \n        class: 'node-entry', \n        pos: { top: `${startY + (apiImports.length / 2) * (nodeSpacing / 2)}px`, left: '50px' } \n    });\n\n    if (!apiImports || apiImports.length === 0) {\n        // Benign/Empty graph\n        nodes.push({ id: 'benign-1', label: 'ReadFile', class: 'node-std', pos: { top: `${startY}px`, left: `${startX}px` } });\n        nodes.push({ id: 'benign-2', label: 'WriteFile', class: 'node-std', pos: { top: `${startY + nodeSpacing / 2}px`, left: `${startX}px` } });\n        edges.push({ from: 'main-entry', to: 'benign-1', options: { color: '#888' } });\n        edges.push({ from: 'main-entry', to: 'benign-2', options: { color: '#888' } });\n    } else {\n        // Suspicious/Malware graph\n        apiImports.forEach((apiName, index) => {\n            let nodeClass = 'node-api'; // Default\n            let edgeColor = '#888'; // Default\n\n            if (classification === 'Malware') {\n                nodeClass = 'node-malicious';\n                edgeColor = '#e74c3c'; // Malware red\n            } else if (classification === 'Suspicious') {\n                nodeClass = 'node-suspicious';\n                edgeColor = '#f1c40f'; // Suspicious yellow\n            } else {\n                // Benign\n                nodeClass = 'node-std';\n                edgeColor = '#888';\n            }\n\n\n            const nodeId = `api-${index}`;\n            const yPos = startY + (index * (nodeSpacing-50)); // Make them a bit closer\n            const xPos = startX + (index % 2 === 0 ? 0 : 150); // Stagger them\n\n            // Add the API node\n            nodes.push({\n                id: nodeId,\n                label: apiName,\n                class: nodeClass,\n                pos: { top: `${yPos}px`, left: `${xPos}px` }\n            });\n\n            // Add the edge from main\n            edges.push({\n                from: 'main-entry',\n                to: nodeId,\n                options: { color: edgeColor }\n            });\n        });\n    }\n\n    return { nodes, edges };\n}\n\n// --- Graph Drawing ---\nfunction drawCallGraph(graphData) {\n    // 1. Clear previous graph (both nodes and lines)\n    callGraphEl.innerHTML = '';\n    currentGraphLines.forEach(line => line.remove());\n    currentGraphLines = [];\n\n    if (!graphData || !graphData.nodes || !graphData.edges) {\n        console.error(\"Invalid graph data received\", graphData);\n        return;\n    }\n\n    // 2. Create and place all nodes\n    graphData.nodes.forEach(node => {\n        const nodeEl = document.createElement('div');\n        nodeEl.id = node.id;\n        nodeEl.className = `graph-node ${node.class}`;\n        nodeEl.style.top = node.pos.top;\n        nodeEl.style.left = node.pos.left;\n        nodeEl.textContent = node.label;\n        callGraphEl.appendChild(nodeEl);\n    });\n\n    // 3. Draw all edges (must be done *after* nodes are in DOM)\n    // Use a slight timeout to ensure DOM is ready\n    setTimeout(() => {\n        graphData.edges.forEach(edge => {\n            try {\n                const line = new LeaderLine(\n                    document.getElementById(edge.from),\n                    document.getElementById(edge.to),\n                    {\n                        color: edge.options.color,\n                        path: edge.options.path || 'straight',\n                        startSocket: edge.options.startSocket || 'auto',\n                        endSocket: edge.options.endSocket || 'auto',\n                        endPlug: 'arrow1',\n                        size: 3,\n                        endPlugSize: 1.5,\n                    }\n                );\n                currentGraphLines.push(line);\n            } catch(e) {\n                console.error(\"Could not draw line:\", e);\n            }\n        });\n    }, 500); // 500ms timeout to let CSS fade-in finish\n}\n\n\n// --- History Panel Logic ---\nasync function loadHistory() {\n  if (!historyListEl) return;\n  \n  historyListEl.innerHTML = '<li class=\"history-item-loading\">Loading...</li>';\n\n  try {\n    const historyData = await window.electronAPI.getHistory();\n\n    if (!historyData || historyData.length === 0) {\n      historyListEl.innerHTML = '<li class=\"history-item-empty\">No scan history found.</li>';\n      return;\n    }\n\n    historyListEl.innerHTML = '';\n\n    historyData.forEach(scan => {\n      const li = document.createElement('li');\n      li.className = 'history-item';\n\n      // Determine classification icon\n      let statusIcon = 'fas fa-check-circle';\n      let classType = 'safe';\n      if (scan.classification.includes('Malware')) {\n        statusIcon = 'fas fa-bug';\n        classType = 'malware';\n      } else if (scan.classification.includes('Suspicious')) {\n        statusIcon = 'fas fa-exclamation-triangle';\n        classType = 'suspicious';\n      }\n\n      // Determine file type icon based on extension\n      const filename = scan.detected_filename || '';\n      const ext = filename.split('.').pop().toLowerCase();\n      let fileTypeIcon = 'fas fa-file';\n      \n      if (['exe', 'dll', 'sys', 'msi'].includes(ext)) {\n        fileTypeIcon = 'fas fa-cog'; // Executable\n      } else if (['jpg', 'jpeg', 'png', 'gif', 'bmp', 'svg', 'webp'].includes(ext)) {\n        fileTypeIcon = 'fas fa-image'; // Image\n      } else if (['js', 'ts', 'py', 'java', 'cpp', 'c', 'h', 'cs', 'go', 'rs', 'php', 'rb'].includes(ext)) {\n        fileTypeIcon = 'fas fa-code'; // Code\n      } else if (['pdf', 'doc', 'docx', 'txt', 'rtf', 'odt'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-alt'; // Document\n      } else if (['zip', 'rar', '7z', 'tar', 'gz', 'bz2'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-archive'; // Archive\n      } else if (['mp3', 'wav', 'ogg', 'flac', 'aac'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-audio'; // Audio\n      } else if (['mp4', 'avi', 'mkv', 'mov', 'wmv', 'flv'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-video'; // Video\n      } else if (['html', 'htm', 'css', 'xml', 'json'].includes(ext)) {\n        fileTypeIcon = 'fas fa-file-code'; // Web file\n      }\n\n      const scanDate = new Date(scan.scanDate).toLocaleString();\n      const hashSha256 = scan.file_hashes?.sha256 || 'N/A';\n      const hashDisplay = hashSha256.substring(0, 16) + '...'; // Show first 16 chars\n\n      li.innerHTML = `\n        <div class=\"history-icon-wrapper\">\n          <div class=\"history-icon ${classType}\">\n            <i class=\"${statusIcon}\"></i>\n          </div>\n          <div class=\"history-file-type\">\n            <i class=\"${fileTypeIcon}\"></i>\n          </div>\n        </div>\n        <div class=\"history-details\">\n          <span class=\"history-filename\" title=\"${filename}\">${filename}</span>\n          <span class=\"history-classification ${classType}\">${scan.classification}</span>\n          <span class=\"history-hash\" title=\"${hashSha256}\">SHA256: ${hashDisplay}</span>\n        </div>\n        <span class=\"history-date\">${scanDate}</span>\n      `;\n      \n      historyListEl.appendChild(li);\n    });\n\n  } catch (err) {\n    console.error('Failed to load history:', err);\n    historyListEl.innerHTML = '<li class=\"history-item-empty\">Error loading history.</li>';\n  }\n}\n\nfunction toggleHistoryPanel() {\n  bodyEl.classList.toggle('is-history-open');\n  \n  // ADD THIS: If we are opening the panel, load the history\n  if (bodyEl.classList.contains('is-history-open')) {\n    loadHistory();\n  }\n}\n\nhistoryBtn.addEventListener('click', (e) => {\n    e.preventDefault();\n    toggleHistoryPanel();\n});\nhistoryCloseBtn.addEventListener('click', toggleHistoryPanel);\nhistoryOverlay.addEventListener('click', toggleHistoryPanel);\n\n\n// --- Auto-scroll Logic ---\nfunction startScrolling(direction) {\n    if (scrollInterval) {\n        clearInterval(scrollInterval);\n    }\n    scrollInterval = setInterval(() => {\n        window.scrollBy(0, direction * 10); // 10 pixels at a time\n    }, 20); // every 20ms\n}\n\nfunction stopScrolling() {\n    clearInterval(scrollInterval);\n    scrollInterval = null;\n}\n\nscrollZoneTop.addEventListener('mouseenter', () => {\n    startScrolling(-1); // Scroll Up\n    scrollZoneTop.classList.add('scrolling');\n});\nscrollZoneTop.addEventListener('mouseleave', () => {\n    stopScrolling();\n    scrollZoneTop.classList.remove('scrolling');\n});\n\nscrollZoneBottom.addEventListener('mouseenter', () => {\n    startScrolling(1); // Scroll Down\n    scrollZoneBottom.classList.add('scrolling');\n});\nscrollZoneBottom.addEventListener('mouseleave', () => {\n    stopScrolling();\n    scrollZoneBottom.classList.remove('scrolling');\n});\n\n\n// --- Chart instances ---\nlet malwareTypesChart = null;\nlet topMalwareChart = null;\n\n// --- Function to create/recreate charts ---\nwindow.recreateCharts = function() {\n    // Get CSS variables for theme-aware colors\n    const chartLegendColor = getComputedStyle(document.documentElement).getPropertyValue('--chart-legend-text').trim();\n    const chartAxesColor = getComputedStyle(document.documentElement).getPropertyValue('--chart-axes-text').trim();\n    const chartGridColor = getComputedStyle(document.documentElement).getPropertyValue('--chart-grid-line').trim();\n\n    // Destroy existing charts if they exist\n    if (malwareTypesChart) {\n        malwareTypesChart.destroy();\n    }\n    if (topMalwareChart) {\n        topMalwareChart.destroy();\n    }\n\n    // Create Malware Types Chart (Doughnut)\n    const typesCtx = document.getElementById('malwareTypesChart');\n    if (typesCtx) {\n        malwareTypesChart = new Chart(typesCtx, {\n            type: 'doughnut',\n            data: {\n                labels: ['PE (exe/dll)', 'JavaScript', 'VBS', 'Macro', 'Other'],\n                datasets: [{\n                    label: 'Submission Types',\n                    data: [65, 15, 8, 7, 5],\n                    backgroundColor: [\n                        '#007bff', // Blue\n                        '#f1c40f', // Yellow\n                        '#e74c3c', // Red\n                        '#9b59b6', // Purple\n                        '#34495e'  // Gray\n                    ],\n                    borderColor: '#2a2a2e',\n                    borderWidth: 3,\n                }]\n            },\n            options: {\n                responsive: true,\n                plugins: {\n                    legend: {\n                        position: 'right',\n                        labels: {\n                            color: chartLegendColor,\n                            boxWidth: 20\n                        }\n                    }\n                }\n            }\n        });\n    }\n\n    // Create Top Malware Chart (Line)\n    const topMalwareCtx = document.getElementById('topMalwareChart');\n    if (topMalwareCtx) {\n        topMalwareChart = new Chart(topMalwareCtx, {\n            type: 'line',\n            data: {\n                labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5'],\n                datasets: [\n                    {\n                        label: 'Zeus',\n                        data: [120, 150, 130, 180, 160],\n                        borderColor: '#e74c3c',\n                        backgroundColor: '#e74c3c20',\n                        fill: true,\n                        tension: 0.4\n                    },\n                    {\n                        label: 'WannaCry',\n                        data: [80, 90, 110, 100, 130],\n                        borderColor: '#007bff',\n                        backgroundColor: '#007bff20',\n                        fill: true,\n                        tension: 0.4\n                    },\n                    {\n                        label: 'Emotet',\n                        data: [50, 60, 80, 70, 90],\n                        borderColor: '#f1c40f',\n                        backgroundColor: '#f1c40f20',\n                        fill: true,\n                        tension: 0.4\n                    }\n                ]\n            },\n            options: {\n                responsive: true,\n                plugins: {\n                    legend: {\n                        labels: {\n                            color: chartLegendColor\n                        }\n                    }\n                },\n                scales: {\n                    x: {\n                        ticks: { color: chartAxesColor },\n                        grid: { color: chartGridColor + '50' }\n                    },\n                    y: {\n                        ticks: { color: chartAxesColor },\n                        grid: { color: chartGridColor }\n                    }\n                }\n            }\n        });\n    }\n};\n\n// --- Run on Page Load ---\ndocument.addEventListener('DOMContentLoaded', () => {\n    // 1. Animate Stat Cards\n    const statNumbers = document.querySelectorAll('.stat-number');\n    statNumbers.forEach(stat => {\n        const target = +stat.getAttribute('data-target');\n        const duration = 2000;\n        const stepTime = 20;\n        const steps = duration / stepTime;\n        const increment = target / steps;\n        let current = 0;\n\n        const updateCount = () => {\n            current += increment;\n            if (current < target) {\n                stat.textContent = Math.ceil(current).toLocaleString();\n                setTimeout(updateCount, stepTime);\n            } else {\n                stat.textContent = target.toLocaleString();\n            }\n        };\n        updateCount();\n    });\n\n    // 2. Create the charts\n    recreateCharts();\n});\n","epoch":29,"telemetryInfo":{}}]],"operations":[{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/mAIware/script.js","external":"file:///home/trang/mAIware/script.js","path":"/home/trang/mAIware/script.js","scheme":"file"},"requestId":"request_e291023b-a085-431d-9d97-e3db92d6eb3b","epoch":5,"edits":[{"text":"    // 3. Create Top Malware Chart (Line)\n    const topMalwareCtx = document.getElementById('topMalwareChart');\n    if (topMalwareCtx) {\n        // Get CSS variables for theme-aware colors\n        const chartLegendColor = getComputedStyle(document.documentElement).getPropertyValue('--chart-legend-text').trim();\n        const chartAxesColor = getComputedStyle(document.documentElement).getPropertyValue('--chart-axes-text').trim();\n        const chartGridColor = getComputedStyle(document.documentElement).getPropertyValue('--chart-grid-line').trim();\n        \n        new Chart(topMalwareCtx, {\n            type: 'line',\n            data: {\n                labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5'],\n                datasets: [\n                    {\n                        label: 'Zeus',\n                        data: [120, 150, 130, 180, 160],\n                        borderColor: '#e74c3c',\n                        backgroundColor: '#e74c3c20',\n                        fill: true,\n                        tension: 0.4\n                    },\n                    {\n                        label: 'WannaCry',\n                        data: [80, 90, 110, 100, 130],\n                        borderColor: '#007bff',\n                        backgroundColor: '#007bff20',\n                        fill: true,\n                        tension: 0.4\n                    },\n                    {\n                        label: 'Emotet',\n                        data: [50, 60, 80, 70, 90],\n                        borderColor: '#f1c40f',\n                        backgroundColor: '#f1c40f20',\n                        fill: true,\n                        tension: 0.4\n                    }\n                ]\n            },\n            options: {\n                responsive: true,\n                plugins: {\n                    legend: {\n                        labels: {\n                            color: chartLegendColor\n                        }\n                    }\n                },\n                scales: {\n                    x: {\n                        ticks: { color: chartAxesColor },\n                        grid: { color: chartGridColor + '50' }\n                    },\n                    y: {\n                        ticks: { color: chartAxesColor },\n                        grid: { color: chartGridColor }\n                    }\n                }\n            }\n        });\n    }","range":{"startLineNumber":795,"startColumn":1,"endLineNumber":850,"endColumn":6}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/mAIware/script.js","external":"file:///home/trang/mAIware/script.js","path":"/home/trang/mAIware/script.js","scheme":"file"},"requestId":"request_e291023b-a085-431d-9d97-e3db92d6eb3b","epoch":6,"edits":[{"text":"    // 2. Create Malware Types Chart (Doughnut)\n    const typesCtx = document.getElementById('malwareTypesChart');\n    if (typesCtx) {\n        // Get CSS variables for theme-aware colors\n        const chartLegendColor = getComputedStyle(document.documentElement).getPropertyValue('--chart-legend-text').trim();\n        \n        new Chart(typesCtx, {\n            type: 'doughnut',\n            data: {\n                labels: ['PE (exe/dll)', 'JavaScript', 'VBS', 'Macro', 'Other'],\n                datasets: [{\n                    label: 'Submission Types',\n                    data: [65, 15, 8, 7, 5],\n                    backgroundColor: [\n                        '#007bff', // Blue\n                        '#f1c40f', // Yellow\n                        '#e74c3c', // Red\n                        '#9b59b6', // Purple\n                        '#34495e'  // Gray\n                    ],\n                    borderColor: '#2a2a2e',\n                    borderWidth: 3,\n                }]\n            },\n            options: {\n                responsive: true,\n                plugins: {\n                    legend: {\n                        position: 'right',\n                        labels: {\n                            color: chartLegendColor,\n                            boxWidth: 20\n                        }\n                    }\n                }\n            }\n        });\n    }","range":{"startLineNumber":759,"startColumn":1,"endLineNumber":793,"endColumn":6}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/mAIware/index.html","external":"file:///home/trang/mAIware/index.html","path":"/home/trang/mAIware/index.html","scheme":"file"},"requestId":"request_e291023b-a085-431d-9d97-e3db92d6eb3b","epoch":9,"edits":[{"text":"    <script>\n    document.addEventListener('DOMContentLoaded', () => {\n        const themeToggleButton = document.getElementById('theme-toggle');\n        const body = document.body;\n        const themeIcon = themeToggleButton.querySelector('i');\n\n        // Function to apply the saved theme\n        const applyTheme = (theme) => {\n            if (theme === 'light') {\n                body.classList.add('light-theme');\n                themeIcon.classList.remove('fa-sun');\n                themeIcon.classList.add('fa-moon');\n            } else {\n                body.classList.remove('light-theme');\n                themeIcon.classList.remove('fa-moon');\n                themeIcon.classList.add('fa-sun');\n            }\n            \n            // Recreate charts with updated theme colors\n            if (window.recreateCharts) {\n                window.recreateCharts();\n            }\n        };\n\n        // Load the saved theme on page load\n        const savedTheme = localStorage.getItem('theme') || 'dark'; // Default to dark\n        applyTheme(savedTheme);\n\n        // Add click event for the toggle button\n        themeToggleButton.addEventListener('click', (e) => {\n            e.preventDefault(); // Stop the link from navigating\n            \n            // Check current theme\n            const isLightTheme = body.classList.contains('light-theme');\n            \n            // Set new theme\n            const newTheme = isLightTheme ? 'dark' : 'light';\n            \n            // Apply the new theme\n            applyTheme(newTheme);\n            \n            // Save the new theme to localStorage\n            localStorage.setItem('theme', newTheme);\n        });\n    });","range":{"startLineNumber":211,"startColumn":1,"endLineNumber":250,"endColumn":8}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/mAIware/script.js","external":"file:///home/trang/mAIware/script.js","path":"/home/trang/mAIware/script.js","scheme":"file"},"requestId":"request_e291023b-a085-431d-9d97-e3db92d6eb3b","epoch":11,"edits":[{"text":"// --- Chart instances ---\nlet malwareTypesChart = null;\nlet topMalwareChart = null;\n\n// --- Function to create/recreate charts ---\nwindow.recreateCharts = function() {\n    // Get CSS variables for theme-aware colors\n    const chartLegendColor = getComputedStyle(document.documentElement).getPropertyValue('--chart-legend-text').trim();\n    const chartAxesColor = getComputedStyle(document.documentElement).getPropertyValue('--chart-axes-text').trim();\n    const chartGridColor = getComputedStyle(document.documentElement).getPropertyValue('--chart-grid-line').trim();\n\n    // Destroy existing charts if they exist\n    if (malwareTypesChart) {\n        malwareTypesChart.destroy();\n    }\n    if (topMalwareChart) {\n        topMalwareChart.destroy();\n    }\n\n    // Create Malware Types Chart (Doughnut)\n    const typesCtx = document.getElementById('malwareTypesChart');\n    if (typesCtx) {\n        malwareTypesChart = new Chart(typesCtx, {\n            type: 'doughnut',\n            data: {\n                labels: ['PE (exe/dll)', 'JavaScript', 'VBS', 'Macro', 'Other'],\n                datasets: [{\n                    label: 'Submission Types',\n                    data: [65, 15, 8, 7, 5],\n                    backgroundColor: [\n                        '#007bff', // Blue\n                        '#f1c40f', // Yellow\n                        '#e74c3c', // Red\n                        '#9b59b6', // Purple\n                        '#34495e'  // Gray\n                    ],\n                    borderColor: '#2a2a2e',\n                    borderWidth: 3,\n                }]\n            },\n            options: {\n                responsive: true,\n                plugins: {\n                    legend: {\n                        position: 'right',\n                        labels: {\n                            color: chartLegendColor,\n                            boxWidth: 20\n                        }\n                    }\n                }\n            }\n        });\n    }\n\n    // Create Top Malware Chart (Line)\n    const topMalwareCtx = document.getElementById('topMalwareChart');\n    if (topMalwareCtx) {\n        topMalwareChart = new Chart(topMalwareCtx, {\n            type: 'line',\n            data: {\n                labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5'],\n                datasets: [\n                    {\n                        label: 'Zeus',\n                        data: [120, 150, 130, 180, 160],\n                        borderColor: '#e74c3c',\n                        backgroundColor: '#e74c3c20',\n                        fill: true,\n                        tension: 0.4\n                    },\n                    {\n                        label: 'WannaCry',\n                        data: [80, 90, 110, 100, 130],\n                        borderColor: '#007bff',\n                        backgroundColor: '#007bff20',\n                        fill: true,\n                        tension: 0.4\n                    },\n                    {\n                        label: 'Emotet',\n                        data: [50, 60, 80, 70, 90],\n                        borderColor: '#f1c40f',\n                        backgroundColor: '#f1c40f20',\n                        fill: true,\n                        tension: 0.4\n                    }\n                ]\n            },\n            options: {\n                responsive: true,\n                plugins: {\n                    legend: {\n                        labels: {\n                            color: chartLegendColor\n                        }\n                    }\n                },\n                scales: {\n                    x: {\n                        ticks: { color: chartAxesColor },\n                        grid: { color: chartGridColor + '50' }\n                    },\n                    y: {\n                        ticks: { color: chartAxesColor },\n                        grid: { color: chartGridColor }\n                    }\n                }\n            }\n        });\n    }\n};\n\n// --- Run on Page Load ---\ndocument.addEventListener('DOMContentLoaded', () => {\n    // 1. Animate Stat Cards\n    const statNumbers = document.querySelectorAll('.stat-number');\n    statNumbers.forEach(stat => {\n        const target = +stat.getAttribute('data-target');\n        const duration = 2000;\n        const stepTime = 20;\n        const steps = duration / stepTime;\n        const increment = target / steps;\n        let current = 0;\n\n        const updateCount = () => {\n            current += increment;\n            if (current < target) {\n                stat.textContent = Math.ceil(current).toLocaleString();\n                setTimeout(updateCount, stepTime);\n            } else {\n                stat.textContent = target.toLocaleString();\n            }\n        };\n        updateCount();\n    });\n\n    // 2. Create the charts\n    recreateCharts();\n});","range":{"startLineNumber":735,"startColumn":1,"endLineNumber":859,"endColumn":4}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/mAIware/index.html","external":"file:///home/trang/mAIware/index.html","path":"/home/trang/mAIware/index.html","scheme":"file"},"requestId":"request_dea95259-dc59-44ee-8b2e-71bfbcd038b0","epoch":15,"edits":[{"text":"    <script>\n    // Apply theme BEFORE DOMContentLoaded so it's ready when charts are created\n    const savedTheme = localStorage.getItem('theme') || 'dark';\n    if (savedTheme === 'light') {\n        document.body.classList.add('light-theme');\n    }\n    \n    document.addEventListener('DOMContentLoaded', () => {\n        const themeToggleButton = document.getElementById('theme-toggle');\n        const body = document.body;\n        const themeIcon = themeToggleButton.querySelector('i');\n\n        // Update icon based on current theme\n        if (body.classList.contains('light-theme')) {\n            themeIcon.classList.remove('fa-sun');\n            themeIcon.classList.add('fa-moon');\n        }\n\n        // Function to apply the saved theme\n        const applyTheme = (theme) => {\n            if (theme === 'light') {\n                body.classList.add('light-theme');\n                themeIcon.classList.remove('fa-sun');\n                themeIcon.classList.add('fa-moon');\n            } else {\n                body.classList.remove('light-theme');\n                themeIcon.classList.remove('fa-moon');\n                themeIcon.classList.add('fa-sun');\n            }\n            \n            // Recreate charts with updated theme colors\n            if (window.recreateCharts) {\n                window.recreateCharts();\n            }\n        };","range":{"startLineNumber":211,"startColumn":1,"endLineNumber":237,"endColumn":32}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/mAIware/script.js","external":"file:///home/trang/mAIware/script.js","path":"/home/trang/mAIware/script.js","scheme":"file"},"requestId":"request_b7d8c486-3525-4954-bb70-78dfb4c10314","epoch":21,"edits":[{"text":"    // 2. Create the charts\n    recreateCharts();\n    \n    // Notify that charts are ready\n    window.chartsReady = true;\n    const event = new CustomEvent('chartsReady');\n    window.dispatchEvent(event);\n});","range":{"startLineNumber":872,"startColumn":1,"endLineNumber":874,"endColumn":4}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/mAIware/index.html","external":"file:///home/trang/mAIware/index.html","path":"/home/trang/mAIware/index.html","scheme":"file"},"requestId":"request_b7d8c486-3525-4954-bb70-78dfb4c10314","epoch":22,"edits":[{"text":"        // Load the saved theme on page load\n        const savedTheme = localStorage.getItem('theme') || 'dark'; // Default to dark\n        \n        // Wait for charts to be created before applying theme\n        if (window.chartsReady) {\n            applyTheme(savedTheme);\n        } else {\n            window.addEventListener('chartsReady', () => {\n                applyTheme(savedTheme);\n            });\n        }","range":{"startLineNumber":235,"startColumn":1,"endLineNumber":237,"endColumn":32}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/mAIware/index.html","external":"file:///home/trang/mAIware/index.html","path":"/home/trang/mAIware/index.html","scheme":"file"},"requestId":"request_b7d8c486-3525-4954-bb70-78dfb4c10314","epoch":24,"edits":[{"text":"    <script>\n    // Apply saved theme class immediately (before DOMContentLoaded)\n    const savedTheme = localStorage.getItem('theme') || 'dark';\n    if (savedTheme === 'light') {\n        document.body.classList.add('light-theme');\n    }\n    \n    document.addEventListener('DOMContentLoaded', () => {\n        const themeToggleButton = document.getElementById('theme-toggle');\n        const body = document.body;\n        const themeIcon = themeToggleButton.querySelector('i');\n\n        // Set icon based on current theme\n        if (body.classList.contains('light-theme')) {\n            themeIcon.classList.remove('fa-sun');\n            themeIcon.classList.add('fa-moon');\n        }\n\n        // Function to apply the saved theme\n        const applyTheme = (theme) => {\n            if (theme === 'light') {\n                body.classList.add('light-theme');\n                themeIcon.classList.remove('fa-sun');\n                themeIcon.classList.add('fa-moon');\n            } else {\n                body.classList.remove('light-theme');\n                themeIcon.classList.remove('fa-moon');\n                themeIcon.classList.add('fa-sun');\n            }\n            \n            // Recreate charts with updated theme colors\n            if (window.recreateCharts) {\n                window.recreateCharts();\n            }\n        };","range":{"startLineNumber":211,"startColumn":1,"endLineNumber":245,"endColumn":10}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/mAIware/script.js","external":"file:///home/trang/mAIware/script.js","path":"/home/trang/mAIware/script.js","scheme":"file"},"requestId":"request_b7d8c486-3525-4954-bb70-78dfb4c10314","epoch":26,"edits":[{"text":"    // 2. Create the charts\n    recreateCharts();\n});","range":{"startLineNumber":872,"startColumn":1,"endLineNumber":879,"endColumn":4}}]},{"type":"textEdit","uri":{"$mid":1,"fsPath":"/home/trang/mAIware/script.js","external":"file:///home/trang/mAIware/script.js","path":"/home/trang/mAIware/script.js","scheme":"file"},"requestId":"request_ef032d5f-157a-4667-b208-0835d9103e70","epoch":30,"edits":[{"text":"// --- Function to create/recreate charts ---\nwindow.recreateCharts = function() {\n    // Check if light theme is active\n    const isLightTheme = document.body.classList.contains('light-theme');\n    \n    // Set colors based on theme\n    const chartLegendColor = isLightTheme ? '#6c757d' : '#e0e0e0';\n    const chartAxesColor = isLightTheme ? '#6c757d' : '#aaa';\n    const chartGridColor = isLightTheme ? '#dee2e6' : '#444444';\n\n    // Destroy existing charts if they exist\n    if (malwareTypesChart) {\n        malwareTypesChart.destroy();\n    }\n    if (topMalwareChart) {\n        topMalwareChart.destroy();\n    }","range":{"startLineNumber":739,"startColumn":1,"endLineNumber":752,"endColumn":6}}]}],"epochCounter":31},"recentSnapshot":{"entries":[{"resource":"file:///home/trang/mAIware/script.js","languageId":"javascript","originalHash":"36347d9","currentHash":"101d21e","state":0,"snapshotUri":"chat-editing-snapshot-text-model:/home/trang/mAIware/script.js?%7B%22sessionId%22%3A%22e1c6ec5b-7388-4656-b500-368a2912e7fd%22%2C%22requestId%22%3A%22%22%2C%22undoStop%22%3A%22%22%7D","telemetryInfo":{"requestId":"request_ef032d5f-157a-4667-b208-0835d9103e70","agentId":"github.copilot.editsAgent","modelId":"copilot/claude-sonnet-4.5","modeId":"agent"}},{"resource":"file:///home/trang/mAIware/index.html","languageId":"html","originalHash":"ae7f0e3","currentHash":"ae7f0e3","state":1,"snapshotUri":"chat-editing-snapshot-text-model:/home/trang/mAIware/index.html?%7B%22sessionId%22%3A%22e1c6ec5b-7388-4656-b500-368a2912e7fd%22%2C%22requestId%22%3A%22%22%2C%22undoStop%22%3A%22%22%7D","telemetryInfo":{"requestId":"request_b7d8c486-3525-4954-bb70-78dfb4c10314","agentId":"github.copilot.editsAgent","modelId":"copilot/claude-sonnet-4.5","modeId":"agent"}}]}}